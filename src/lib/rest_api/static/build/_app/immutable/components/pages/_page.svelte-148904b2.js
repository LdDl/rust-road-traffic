import{S as Ma,i as ka,s as Da,k as Wt,l as $t,m as ii,h as Nt,n as Yt,b as qs,J as ht,B as Ys,K as vn,o as _l,L as Gc,M as Pu,a as Zi,c as Ki,N as Uc,O as Ms,q as Tr,r as Er,P as zo,Q as Iu,D as Xc,w as hl,x as ul,y as dl,f as fl,t as pl,z as ml,R as yu,e as vu,T as Sf,p as ll,u as cl}from"../../chunks/index-53191b19.js";import{w as as,d as Cf}from"../../chunks/index-28c66de4.js";var Ia=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tf(Fe){var I=Fe.default;if(typeof I=="function"){var pt=function(){return I.apply(this,arguments)};pt.prototype=I.prototype}else pt={};return Object.defineProperty(pt,"__esModule",{value:!0}),Object.keys(Fe).forEach(function(tt){var wt=Object.getOwnPropertyDescriptor(Fe,tt);Object.defineProperty(pt,tt,wt.get?wt:{enumerable:!0,get:function(){return Fe[tt]}})}),pt}var dn={};const Ef={},Pf=Object.freeze(Object.defineProperty({__proto__:null,default:Ef},Symbol.toStringTag,{value:"Module"})),Bc=Tf(Pf);(function(Fe){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var I=I||{version:"5.2.4"};if(Fe.fabric=I,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?I.document=document:I.document=document.implementation.createHTMLDocument(""),I.window=window;else{var pt=Bc,tt=new pt.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;I.document=tt.document,I.jsdomImplForWrapper=Bc.implForWrapper,I.nodeCanvas=Bc.Canvas,I.window=tt,DOMParser=I.window.DOMParser}I.isTouchSupported="ontouchstart"in I.window||"ontouchstart"in I.document||I.window&&I.window.navigator&&I.window.navigator.maxTouchPoints>0,I.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",I.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],I.DPI=96,I.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",I.commaWsp="(?:\\s+,?\\s*|,\\s*)",I.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,I.reNonWord=/[ \n\.,;!\?\-]/,I.fontPaths={},I.iMatrix=[1,0,0,1,0,0],I.svgNS="http://www.w3.org/2000/svg",I.perfLimitSizeTotal=2097152,I.maxCacheSideLimit=4096,I.minCacheSideLimit=256,I.charWidthsCache={},I.textureSize=2048,I.disableStyleCopyPaste=!1,I.enableGLFiltering=!0,I.devicePixelRatio=I.window.devicePixelRatio||I.window.webkitDevicePixelRatio||I.window.mozDevicePixelRatio||1,I.browserShadowBlurConstant=1,I.arcToSegmentsCache={},I.boundsOfCurveCache={},I.cachesBoundsOfCurve=!0,I.forceGLPutImageData=!1,I.initFilterBackend=function(){if(I.enableGLFiltering&&I.isWebglSupported&&I.isWebglSupported(I.textureSize))return console.log("max texture size: "+I.maxTextureSize),new I.WebglFilterBackend({tileSize:I.textureSize});if(I.Canvas2dFilterBackend)return new I.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=I),function(){function n(c,f){if(!!this.__eventListeners[c]){var _=this.__eventListeners[c];f?_[_.indexOf(f)]=!1:I.util.array.fill(_,!1)}}function g(c,f){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var _ in c)this.on(_,c[_]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(f);return this}function x(c,f){var _=function(){f.apply(this,arguments),this.off(c,_)}.bind(this);this.on(c,_)}function v(c,f){if(arguments.length===1)for(var _ in c)x.call(this,_,c[_]);else x.call(this,c,f);return this}function h(c,f){if(!this.__eventListeners)return this;if(arguments.length===0)for(c in this.__eventListeners)n.call(this,c);else if(arguments.length===1&&typeof arguments[0]=="object")for(var _ in c)n.call(this,_,c[_]);else n.call(this,c,f);return this}function l(c,f){if(!this.__eventListeners)return this;var _=this.__eventListeners[c];if(!_)return this;for(var u=0,S=_.length;u<S;u++)_[u]&&_[u].call(this,f||{});return this.__eventListeners[c]=_.filter(function(C){return C!==!1}),this}I.Observable={fire:l,on:g,once:v,off:h}}(),I.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var n=0,g=arguments.length;n<g;n++)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(n,g,x){var v=this._objects;return x?v[g]=n:v.splice(g,0,n),this._onObjectAdded&&this._onObjectAdded(n),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var n=this._objects,g,x=!1,v=0,h=arguments.length;v<h;v++)g=n.indexOf(arguments[v]),g!==-1&&(x=!0,n.splice(g,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[v]));return this.renderOnAddRemove&&x&&this.requestRenderAll(),this},forEachObject:function(n,g){for(var x=this.getObjects(),v=0,h=x.length;v<h;v++)n.call(g,x[v],v,x);return this},getObjects:function(n){return typeof n>"u"?this._objects.concat():this._objects.filter(function(g){return g.type===n})},item:function(n){return this._objects[n]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(n,g){return this._objects.indexOf(n)>-1?!0:g?this._objects.some(function(x){return typeof x.contains=="function"&&x.contains(n,!0)}):!1},complexity:function(){return this._objects.reduce(function(n,g){return n+=g.complexity?g.complexity():0,n},0)}},I.CommonMethods={_setOptions:function(n){for(var g in n)this.set(g,n[g])},_initGradient:function(n,g){n&&n.colorStops&&!(n instanceof I.Gradient)&&this.set(g,new I.Gradient(n))},_initPattern:function(n,g,x){n&&n.source&&!(n instanceof I.Pattern)?this.set(g,new I.Pattern(n,x)):x&&x()},_setObject:function(n){for(var g in n)this._set(g,n[g])},set:function(n,g){return typeof n=="object"?this._setObject(n):this._set(n,g),this},_set:function(n,g){this[n]=g},toggle:function(n){var g=this.get(n);return typeof g=="boolean"&&this.set(n,!g),this},get:function(n){return this[n]}},function(n){var g=Math.sqrt,x=Math.atan2,v=Math.pow,h=Math.PI/180,l=Math.PI/2;I.util={cos:function(c){if(c===0)return 1;c<0&&(c=-c);var f=c/l;switch(f){case 1:case 3:return 0;case 2:return-1}return Math.cos(c)},sin:function(c){if(c===0)return 0;var f=c/l,_=1;switch(c<0&&(_=-1),f){case 1:return _;case 2:return 0;case 3:return-_}return Math.sin(c)},removeFromArray:function(c,f){var _=c.indexOf(f);return _!==-1&&c.splice(_,1),c},getRandomInt:function(c,f){return Math.floor(Math.random()*(f-c+1))+c},degreesToRadians:function(c){return c*h},radiansToDegrees:function(c){return c/h},rotatePoint:function(c,f,_){var u=new I.Point(c.x-f.x,c.y-f.y),S=I.util.rotateVector(u,_);return new I.Point(S.x,S.y).addEquals(f)},rotateVector:function(c,f){var _=I.util.sin(f),u=I.util.cos(f),S=c.x*u-c.y*_,C=c.x*_+c.y*u;return{x:S,y:C}},createVector:function(c,f){return new I.Point(f.x-c.x,f.y-c.y)},calcAngleBetweenVectors:function(c,f){return Math.acos((c.x*f.x+c.y*f.y)/(Math.hypot(c.x,c.y)*Math.hypot(f.x,f.y)))},getHatVector:function(c){return new I.Point(c.x,c.y).multiply(1/Math.hypot(c.x,c.y))},getBisector:function(c,f,_){var u=I.util.createVector(c,f),S=I.util.createVector(c,_),C=I.util.calcAngleBetweenVectors(u,S),A=I.util.calcAngleBetweenVectors(I.util.rotateVector(u,C),S),O=C*(A===0?1:-1)/2;return{vector:I.util.getHatVector(I.util.rotateVector(u,O)),angle:C}},projectStrokeOnPoints:function(c,f,_){var u=[],S=f.strokeWidth/2,C=f.strokeUniform?new I.Point(1/f.scaleX,1/f.scaleY):new I.Point(1,1),A=function(O){var j=S/Math.hypot(O.x,O.y);return new I.Point(O.x*j*C.x,O.y*j*C.y)};return c.length<=1||c.forEach(function(O,j){var Y=new I.Point(O.x,O.y),oe,ge;j===0?(ge=c[j+1],oe=_?A(I.util.createVector(ge,Y)).addEquals(Y):c[c.length-1]):j===c.length-1?(oe=c[j-1],ge=_?A(I.util.createVector(oe,Y)).addEquals(Y):c[0]):(oe=c[j-1],ge=c[j+1]);var De=I.util.getBisector(Y,oe,ge),qe=De.vector,lt=De.angle,_t,xt;if(f.strokeLineJoin==="miter"&&(_t=-S/Math.sin(lt/2),xt=new I.Point(qe.x*_t*C.x,qe.y*_t*C.y),Math.hypot(xt.x,xt.y)/S<=f.strokeMiterLimit)){u.push(Y.add(xt)),u.push(Y.subtract(xt));return}_t=-S*Math.SQRT2,xt=new I.Point(qe.x*_t*C.x,qe.y*_t*C.y),u.push(Y.add(xt)),u.push(Y.subtract(xt))}),u},transformPoint:function(c,f,_){return _?new I.Point(f[0]*c.x+f[2]*c.y,f[1]*c.x+f[3]*c.y):new I.Point(f[0]*c.x+f[2]*c.y+f[4],f[1]*c.x+f[3]*c.y+f[5])},makeBoundingBoxFromPoints:function(c,f){if(f)for(var _=0;_<c.length;_++)c[_]=I.util.transformPoint(c[_],f);var u=[c[0].x,c[1].x,c[2].x,c[3].x],S=I.util.array.min(u),C=I.util.array.max(u),A=C-S,O=[c[0].y,c[1].y,c[2].y,c[3].y],j=I.util.array.min(O),Y=I.util.array.max(O),oe=Y-j;return{left:S,top:j,width:A,height:oe}},invertTransform:function(c){var f=1/(c[0]*c[3]-c[1]*c[2]),_=[f*c[3],-f*c[1],-f*c[2],f*c[0]],u=I.util.transformPoint({x:c[4],y:c[5]},_,!0);return _[4]=-u.x,_[5]=-u.y,_},toFixed:function(c,f){return parseFloat(Number(c).toFixed(f))},parseUnit:function(c,f){var _=/\D{0,2}$/.exec(c),u=parseFloat(c);switch(f||(f=I.Text.DEFAULT_SVG_FONT_SIZE),_[0]){case"mm":return u*I.DPI/25.4;case"cm":return u*I.DPI/2.54;case"in":return u*I.DPI;case"pt":return u*I.DPI/72;case"pc":return u*I.DPI/72*12;case"em":return u*f;default:return u}},falseFunction:function(){return!1},getKlass:function(c,f){return c=I.util.string.camelize(c.charAt(0).toUpperCase()+c.slice(1)),I.util.resolveNamespace(f)[c]},getSvgAttributes:function(c){var f=["instantiated_by_use","style","id","class"];switch(c){case"linearGradient":f=f.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":f=f.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":f=f.concat(["offset","stop-color","stop-opacity"]);break}return f},resolveNamespace:function(c){if(!c)return I;var f=c.split("."),_=f.length,u,S=n||I.window;for(u=0;u<_;++u)S=S[f[u]];return S},loadImage:function(c,f,_,u){if(!c){f&&f.call(_,c);return}var S=I.util.createImage(),C=function(){f&&f.call(_,S,!1),S=S.onload=S.onerror=null};S.onload=C,S.onerror=function(){I.log("Error loading "+S.src),f&&f.call(_,null,!0),S=S.onload=S.onerror=null},c.indexOf("data")!==0&&u!==void 0&&u!==null&&(S.crossOrigin=u),c.substring(0,14)==="data:image/svg"&&(S.onload=null,I.util.loadImageInDom(S,C)),S.src=c},loadImageInDom:function(c,f){var _=I.document.createElement("div");_.style.width=_.style.height="1px",_.style.left=_.style.top="-100%",_.style.position="absolute",_.appendChild(c),I.document.querySelector("body").appendChild(_),c.onload=function(){f(),_.parentNode.removeChild(_),_=null}},enlivenObjects:function(c,f,_,u){c=c||[];var S=[],C=0,A=c.length;function O(){++C===A&&f&&f(S.filter(function(j){return j}))}if(!A){f&&f(S);return}c.forEach(function(j,Y){if(!j||!j.type){O();return}var oe=I.util.getKlass(j.type,_);oe.fromObject(j,function(ge,De){De||(S[Y]=ge),u&&u(j,ge,De),O()})})},enlivenObjectEnlivables:function(c,f,_){var u=I.Object.ENLIVEN_PROPS.filter(function(S){return!!c[S]});I.util.enlivenObjects(u.map(function(S){return c[S]}),function(S){var C={};u.forEach(function(A,O){C[A]=S[O],f&&(f[A]=S[O])}),_&&_(C)})},enlivenPatterns:function(c,f){c=c||[];function _(){++S===C&&f&&f(u)}var u=[],S=0,C=c.length;if(!C){f&&f(u);return}c.forEach(function(A,O){A&&A.source?new I.Pattern(A,function(j){u[O]=j,_()}):(u[O]=A,_())})},groupSVGElements:function(c,f,_){var u;return c&&c.length===1?(typeof _<"u"&&(c[0].sourcePath=_),c[0]):(f&&(f.width&&f.height?f.centerPoint={x:f.width/2,y:f.height/2}:(delete f.width,delete f.height)),u=new I.Group(c,f),typeof _<"u"&&(u.sourcePath=_),u)},populateWithProperties:function(c,f,_){if(_&&Array.isArray(_))for(var u=0,S=_.length;u<S;u++)_[u]in c&&(f[_[u]]=c[_[u]])},createCanvasElement:function(){return I.document.createElement("canvas")},copyCanvasElement:function(c){var f=I.util.createCanvasElement();return f.width=c.width,f.height=c.height,f.getContext("2d").drawImage(c,0,0),f},toDataURL:function(c,f,_){return c.toDataURL("image/"+f,_)},createImage:function(){return I.document.createElement("img")},multiplyTransformMatrices:function(c,f,_){return[c[0]*f[0]+c[2]*f[1],c[1]*f[0]+c[3]*f[1],c[0]*f[2]+c[2]*f[3],c[1]*f[2]+c[3]*f[3],_?0:c[0]*f[4]+c[2]*f[5]+c[4],_?0:c[1]*f[4]+c[3]*f[5]+c[5]]},qrDecompose:function(c){var f=x(c[1],c[0]),_=v(c[0],2)+v(c[1],2),u=g(_),S=(c[0]*c[3]-c[2]*c[1])/u,C=x(c[0]*c[2]+c[1]*c[3],_);return{angle:f/h,scaleX:u,scaleY:S,skewX:C/h,skewY:0,translateX:c[4],translateY:c[5]}},calcRotateMatrix:function(c){if(!c.angle)return I.iMatrix.concat();var f=I.util.degreesToRadians(c.angle),_=I.util.cos(f),u=I.util.sin(f);return[_,u,-u,_,0,0]},calcDimensionsMatrix:function(c){var f=typeof c.scaleX>"u"?1:c.scaleX,_=typeof c.scaleY>"u"?1:c.scaleY,u=[c.flipX?-f:f,0,0,c.flipY?-_:_,0,0],S=I.util.multiplyTransformMatrices,C=I.util.degreesToRadians;return c.skewX&&(u=S(u,[1,0,Math.tan(C(c.skewX)),1],!0)),c.skewY&&(u=S(u,[1,Math.tan(C(c.skewY)),0,1],!0)),u},composeMatrix:function(c){var f=[1,0,0,1,c.translateX||0,c.translateY||0],_=I.util.multiplyTransformMatrices;return c.angle&&(f=_(f,I.util.calcRotateMatrix(c))),(c.scaleX!==1||c.scaleY!==1||c.skewX||c.skewY||c.flipX||c.flipY)&&(f=_(f,I.util.calcDimensionsMatrix(c))),f},resetObjectTransform:function(c){c.scaleX=1,c.scaleY=1,c.skewX=0,c.skewY=0,c.flipX=!1,c.flipY=!1,c.rotate(0)},saveObjectTransform:function(c){return{scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,angle:c.angle,left:c.left,flipX:c.flipX,flipY:c.flipY,top:c.top}},isTransparent:function(c,f,_,u){u>0&&(f>u?f-=u:f=0,_>u?_-=u:_=0);var S=!0,C,A,O=c.getImageData(f,_,u*2||1,u*2||1),j=O.data.length;for(C=3;C<j&&(A=O.data[C],S=A<=0,S!==!1);C+=4);return O=null,S},parsePreserveAspectRatioAttribute:function(c){var f="meet",_="Mid",u="Mid",S=c.split(" "),C;return S&&S.length&&(f=S.pop(),f!=="meet"&&f!=="slice"?(C=f,f="meet"):S.length&&(C=S.pop())),_=C!=="none"?C.slice(1,4):"none",u=C!=="none"?C.slice(5,8):"none",{meetOrSlice:f,alignX:_,alignY:u}},clearFabricFontCache:function(c){c=(c||"").toLowerCase(),c?I.charWidthsCache[c]&&delete I.charWidthsCache[c]:I.charWidthsCache={}},limitDimsByArea:function(c,f){var _=Math.sqrt(f*c),u=Math.floor(f/_);return{x:Math.floor(_),y:u}},capValue:function(c,f,_){return Math.max(c,Math.min(f,_))},findScaleToFit:function(c,f){return Math.min(f.width/c.width,f.height/c.height)},findScaleToCover:function(c,f){return Math.max(f.width/c.width,f.height/c.height)},matrixToSVG:function(c){return"matrix("+c.map(function(f){return I.util.toFixed(f,I.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(c,f){var _=I.util.invertTransform(f),u=I.util.multiplyTransformMatrices(_,c.calcOwnMatrix());I.util.applyTransformToObject(c,u)},addTransformToObject:function(c,f){I.util.applyTransformToObject(c,I.util.multiplyTransformMatrices(f,c.calcOwnMatrix()))},applyTransformToObject:function(c,f){var _=I.util.qrDecompose(f),u=new I.Point(_.translateX,_.translateY);c.flipX=!1,c.flipY=!1,c.set("scaleX",_.scaleX),c.set("scaleY",_.scaleY),c.skewX=_.skewX,c.skewY=_.skewY,c.angle=_.angle,c.setPositionByOrigin(u,"center","center")},sizeAfterTransform:function(c,f,_){var u=c/2,S=f/2,C=[{x:-u,y:-S},{x:u,y:-S},{x:-u,y:S},{x:u,y:S}],A=I.util.calcDimensionsMatrix(_),O=I.util.makeBoundingBoxFromPoints(C,A);return{x:O.width,y:O.height}},mergeClipPaths:function(c,f){var _=c,u=f;_.inverted&&!u.inverted&&(_=f,u=c),I.util.applyTransformToObject(u,I.util.multiplyTransformMatrices(I.util.invertTransform(_.calcTransformMatrix()),u.calcTransformMatrix()));var S=_.inverted&&u.inverted;return S&&(_.inverted=u.inverted=!1),new I.Group([_],{clipPath:u,inverted:S})},hasStyleChanged:function(c,f,_){return _=_||!1,c.fill!==f.fill||c.stroke!==f.stroke||c.strokeWidth!==f.strokeWidth||c.fontSize!==f.fontSize||c.fontFamily!==f.fontFamily||c.fontWeight!==f.fontWeight||c.fontStyle!==f.fontStyle||c.deltaY!==f.deltaY||_&&(c.overline!==f.overline||c.underline!==f.underline||c.linethrough!==f.linethrough)},stylesToArray:function(_,f){for(var _=I.util.object.clone(_,!0),u=f.split(`
`),S=-1,C={},A=[],O=0;O<u.length;O++){if(!_[O]){S+=u[O].length;continue}for(var j=0;j<u[O].length;j++){S++;var Y=_[O][j];if(Y){var oe=I.util.hasStyleChanged(C,Y,!0);oe?A.push({start:S,end:S+1,style:Y}):A[A.length-1].end++}C=Y||{}}}return A},stylesFromArray:function(c,f){if(!Array.isArray(c))return c;for(var _=f.split(`
`),u=-1,S=0,C={},A=0;A<_.length;A++)for(var O=0;O<_[A].length;O++)u++,c[S]&&c[S].start<=u&&u<c[S].end&&(C[A]=C[A]||{},C[A][O]=Object.assign({},c[S].style),u===c[S].end-1&&S++);return C}}}(Fe),function(){var n=Array.prototype.join,g={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},x={m:"l",M:"L"};function v(Q,se,ue,de,je,K,W,re,ye,Ae,be){var Be=I.util.cos(Q),Ze=I.util.sin(Q),nt=I.util.cos(se),Re=I.util.sin(se),we=ue*je*nt-de*K*Re+W,Le=de*je*nt+ue*K*Re+re,Ke=Ae+ye*(-ue*je*Ze-de*K*Be),$e=be+ye*(-de*je*Ze+ue*K*Be),ut=we+ye*(ue*je*Re+de*K*nt),ct=Le+ye*(de*je*Re-ue*K*nt);return["C",Ke,$e,ut,ct,we,Le]}function h(Q,se,ue,de,je,K,W){var re=Math.PI,ye=W*re/180,Ae=I.util.sin(ye),be=I.util.cos(ye),Be=0,Ze=0;ue=Math.abs(ue),de=Math.abs(de);var nt=-be*Q*.5-Ae*se*.5,Re=-be*se*.5+Ae*Q*.5,we=ue*ue,Le=de*de,Ke=Re*Re,$e=nt*nt,ut=we*Le-we*Ke-Le*$e,ct=0;if(ut<0){var Ht=Math.sqrt(1-ut/(we*Le));ue*=Ht,de*=Ht}else ct=(je===K?-1:1)*Math.sqrt(ut/(we*Ke+Le*$e));var Zt=ct*ue*Re/de,Je=-ct*de*nt/ue,Gt=be*Zt-Ae*Je+Q*.5,Qt=Ae*Zt+be*Je+se*.5,mi=l(1,0,(nt-Zt)/ue,(Re-Je)/de),Di=l((nt-Zt)/ue,(Re-Je)/de,(-nt-Zt)/ue,(-Re-Je)/de);K===0&&Di>0?Di-=2*re:K===1&&Di<0&&(Di+=2*re);for(var wi=Math.ceil(Math.abs(Di/re*2)),Ge=[],vt=Di/wi,Ri=8/3*Math.sin(vt/4)*Math.sin(vt/4)/Math.sin(vt/2),Ji=mi+vt,si=0;si<wi;si++)Ge[si]=v(mi,Ji,be,Ae,ue,de,Gt,Qt,Ri,Be,Ze),Be=Ge[si][5],Ze=Ge[si][6],mi=Ji,Ji+=vt;return Ge}function l(Q,se,ue,de){var je=Math.atan2(se,Q),K=Math.atan2(de,ue);return K>=je?K-je:2*Math.PI-(je-K)}function c(Q,se,ue,de,je,K,W,re){var ye;if(I.cachesBoundsOfCurve&&(ye=n.call(arguments),I.boundsOfCurveCache[ye]))return I.boundsOfCurveCache[ye];var Ae=Math.sqrt,be=Math.min,Be=Math.max,Ze=Math.abs,nt=[],Re=[[],[]],we,Le,Ke,$e,ut,ct,Ht,Zt;Le=6*Q-12*ue+6*je,we=-3*Q+9*ue-9*je+3*W,Ke=3*ue-3*Q;for(var Je=0;Je<2;++Je){if(Je>0&&(Le=6*se-12*de+6*K,we=-3*se+9*de-9*K+3*re,Ke=3*de-3*se),Ze(we)<1e-12){if(Ze(Le)<1e-12)continue;$e=-Ke/Le,0<$e&&$e<1&&nt.push($e);continue}Ht=Le*Le-4*Ke*we,!(Ht<0)&&(Zt=Ae(Ht),ut=(-Le+Zt)/(2*we),0<ut&&ut<1&&nt.push(ut),ct=(-Le-Zt)/(2*we),0<ct&&ct<1&&nt.push(ct))}for(var Gt,Qt,mi=nt.length,Di=mi,wi;mi--;)$e=nt[mi],wi=1-$e,Gt=wi*wi*wi*Q+3*wi*wi*$e*ue+3*wi*$e*$e*je+$e*$e*$e*W,Re[0][mi]=Gt,Qt=wi*wi*wi*se+3*wi*wi*$e*de+3*wi*$e*$e*K+$e*$e*$e*re,Re[1][mi]=Qt;Re[0][Di]=Q,Re[1][Di]=se,Re[0][Di+1]=W,Re[1][Di+1]=re;var Ge=[{x:be.apply(null,Re[0]),y:be.apply(null,Re[1])},{x:Be.apply(null,Re[0]),y:Be.apply(null,Re[1])}];return I.cachesBoundsOfCurve&&(I.boundsOfCurveCache[ye]=Ge),Ge}function f(Q,se,ue){for(var de=ue[1],je=ue[2],K=ue[3],W=ue[4],re=ue[5],ye=ue[6],Ae=ue[7],be=h(ye-Q,Ae-se,de,je,W,re,K),Be=0,Ze=be.length;Be<Ze;Be++)be[Be][1]+=Q,be[Be][2]+=se,be[Be][3]+=Q,be[Be][4]+=se,be[Be][5]+=Q,be[Be][6]+=se;return be}function _(Q){var se=0,ue=0,de=Q.length,je=0,K=0,W,re,ye,Ae=[],be,Be,Ze;for(re=0;re<de;++re){switch(ye=!1,W=Q[re].slice(0),W[0]){case"l":W[0]="L",W[1]+=se,W[2]+=ue;case"L":se=W[1],ue=W[2];break;case"h":W[1]+=se;case"H":W[0]="L",W[2]=ue,se=W[1];break;case"v":W[1]+=ue;case"V":W[0]="L",ue=W[1],W[1]=se,W[2]=ue;break;case"m":W[0]="M",W[1]+=se,W[2]+=ue;case"M":se=W[1],ue=W[2],je=W[1],K=W[2];break;case"c":W[0]="C",W[1]+=se,W[2]+=ue,W[3]+=se,W[4]+=ue,W[5]+=se,W[6]+=ue;case"C":Be=W[3],Ze=W[4],se=W[5],ue=W[6];break;case"s":W[0]="S",W[1]+=se,W[2]+=ue,W[3]+=se,W[4]+=ue;case"S":be==="C"?(Be=2*se-Be,Ze=2*ue-Ze):(Be=se,Ze=ue),se=W[3],ue=W[4],W[0]="C",W[5]=W[3],W[6]=W[4],W[3]=W[1],W[4]=W[2],W[1]=Be,W[2]=Ze,Be=W[3],Ze=W[4];break;case"q":W[0]="Q",W[1]+=se,W[2]+=ue,W[3]+=se,W[4]+=ue;case"Q":Be=W[1],Ze=W[2],se=W[3],ue=W[4];break;case"t":W[0]="T",W[1]+=se,W[2]+=ue;case"T":be==="Q"?(Be=2*se-Be,Ze=2*ue-Ze):(Be=se,Ze=ue),W[0]="Q",se=W[1],ue=W[2],W[1]=Be,W[2]=Ze,W[3]=se,W[4]=ue;break;case"a":W[0]="A",W[6]+=se,W[7]+=ue;case"A":ye=!0,Ae=Ae.concat(f(se,ue,W)),se=W[6],ue=W[7];break;case"z":case"Z":se=je,ue=K;break}ye||Ae.push(W),be=W[0]}return Ae}function u(Q,se,ue,de){return Math.sqrt((ue-Q)*(ue-Q)+(de-se)*(de-se))}function S(Q){return Q*Q*Q}function C(Q){return 3*Q*Q*(1-Q)}function A(Q){return 3*Q*(1-Q)*(1-Q)}function O(Q){return(1-Q)*(1-Q)*(1-Q)}function j(Q,se,ue,de,je,K,W,re){return function(ye){var Ae=S(ye),be=C(ye),Be=A(ye),Ze=O(ye);return{x:W*Ae+je*be+ue*Be+Q*Ze,y:re*Ae+K*be+de*Be+se*Ze}}}function Y(Q,se,ue,de,je,K,W,re){return function(ye){var Ae=1-ye,be=3*Ae*Ae*(ue-Q)+6*Ae*ye*(je-ue)+3*ye*ye*(W-je),Be=3*Ae*Ae*(de-se)+6*Ae*ye*(K-de)+3*ye*ye*(re-K);return Math.atan2(Be,be)}}function oe(Q){return Q*Q}function ge(Q){return 2*Q*(1-Q)}function De(Q){return(1-Q)*(1-Q)}function qe(Q,se,ue,de,je,K){return function(W){var re=oe(W),ye=ge(W),Ae=De(W);return{x:je*re+ue*ye+Q*Ae,y:K*re+de*ye+se*Ae}}}function lt(Q,se,ue,de,je,K){return function(W){var re=1-W,ye=2*re*(ue-Q)+2*W*(je-ue),Ae=2*re*(de-se)+2*W*(K-de);return Math.atan2(Ae,ye)}}function _t(Q,se,ue){var de={x:se,y:ue},je,K=0,W;for(W=1;W<=100;W+=1)je=Q(W/100),K+=u(de.x,de.y,je.x,je.y),de=je;return K}function xt(Q,se){for(var ue=0,de=0,je=Q.iterator,K={x:Q.x,y:Q.y},W,re,ye=.01,Ae=Q.angleFinder,be;de<se&&ye>1e-4;)W=je(ue),be=ue,re=u(K.x,K.y,W.x,W.y),re+de>se?(ue-=ye,ye/=2):(K=W,ue+=ye,de+=re);return W.angle=Ae(be),W}function st(Q){for(var se=0,ue=Q.length,de,je=0,K=0,W=0,re=0,ye=[],Ae,be,Be,Ze=0;Ze<ue;Ze++){switch(de=Q[Ze],be={x:je,y:K,command:de[0]},de[0]){case"M":be.length=0,W=je=de[1],re=K=de[2];break;case"L":be.length=u(je,K,de[1],de[2]),je=de[1],K=de[2];break;case"C":Ae=j(je,K,de[1],de[2],de[3],de[4],de[5],de[6]),Be=Y(je,K,de[1],de[2],de[3],de[4],de[5],de[6]),be.iterator=Ae,be.angleFinder=Be,be.length=_t(Ae,je,K),je=de[5],K=de[6];break;case"Q":Ae=qe(je,K,de[1],de[2],de[3],de[4]),Be=lt(je,K,de[1],de[2],de[3],de[4]),be.iterator=Ae,be.angleFinder=Be,be.length=_t(Ae,je,K),je=de[3],K=de[4];break;case"Z":case"z":be.destX=W,be.destY=re,be.length=u(je,K,W,re),je=W,K=re;break}se+=be.length,ye.push(be)}return ye.push({length:se,x:je,y:K}),ye}function yt(Q,se,ue){ue||(ue=st(Q));for(var de=0;se-ue[de].length>0&&de<ue.length-2;)se-=ue[de].length,de++;var je=ue[de],K=se/je.length,W=je.command,re=Q[de],ye;switch(W){case"M":return{x:je.x,y:je.y,angle:0};case"Z":case"z":return ye=new I.Point(je.x,je.y).lerp(new I.Point(je.destX,je.destY),K),ye.angle=Math.atan2(je.destY-je.y,je.destX-je.x),ye;case"L":return ye=new I.Point(je.x,je.y).lerp(new I.Point(re[1],re[2]),K),ye.angle=Math.atan2(re[2]-je.y,re[1]-je.x),ye;case"C":return xt(je,se);case"Q":return xt(je,se)}}function it(Q){var se=[],ue=[],de,je,K=I.rePathCommand,W="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",re="("+W+")"+I.commaWsp,ye="([01])"+I.commaWsp+"?",Ae=re+"?"+re+"?"+re+ye+ye+re+"?("+W+")",be=new RegExp(Ae,"g"),Be,Ze,nt;if(!Q||!Q.match)return se;nt=Q.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var Re=0,we,Le=nt.length;Re<Le;Re++){de=nt[Re],Ze=de.slice(1).trim(),ue.length=0;var Ke=de.charAt(0);if(we=[Ke],Ke.toLowerCase()==="a")for(var $e;$e=be.exec(Ze);)for(var ut=1;ut<$e.length;ut++)ue.push($e[ut]);else for(;Be=K.exec(Ze);)ue.push(Be[0]);for(var ut=0,ct=ue.length;ut<ct;ut++)je=parseFloat(ue[ut]),isNaN(je)||we.push(je);var Ht=g[Ke.toLowerCase()],Zt=x[Ke]||Ke;if(we.length-1>Ht)for(var Je=1,Gt=we.length;Je<Gt;Je+=Ht)se.push([Ke].concat(we.slice(Je,Je+Ht))),Ke=Zt;else se.push(we)}return se}function Rt(Q,se){var ue=[],de,je=new I.Point(Q[0].x,Q[0].y),K=new I.Point(Q[1].x,Q[1].y),W=Q.length,re=1,ye=0,Ae=W>2;for(se=se||0,Ae&&(re=Q[2].x<K.x?-1:Q[2].x===K.x?0:1,ye=Q[2].y<K.y?-1:Q[2].y===K.y?0:1),ue.push(["M",je.x-re*se,je.y-ye*se]),de=1;de<W;de++){if(!je.eq(K)){var be=je.midPointFrom(K);ue.push(["Q",je.x,je.y,be.x,be.y])}je=Q[de],de+1<Q.length&&(K=Q[de+1])}return Ae&&(re=je.x>Q[de-2].x?1:je.x===Q[de-2].x?0:-1,ye=je.y>Q[de-2].y?1:je.y===Q[de-2].y?0:-1),ue.push(["L",je.x+re*se,je.y+ye*se]),ue}function Pt(Q,se,ue){return ue&&(se=I.util.multiplyTransformMatrices(se,[1,0,0,1,-ue.x,-ue.y])),Q.map(function(de){for(var je=de.slice(0),K={},W=1;W<de.length-1;W+=2)K.x=de[W],K.y=de[W+1],K=I.util.transformPoint(K,se),je[W]=K.x,je[W+1]=K.y;return je})}I.util.joinPath=function(Q){return Q.map(function(se){return se.join(" ")}).join(" ")},I.util.parsePath=it,I.util.makePathSimpler=_,I.util.getSmoothPathFromPoints=Rt,I.util.getPathSegmentsInfo=st,I.util.getBoundsOfCurve=c,I.util.getPointOnPath=yt,I.util.transformPath=Pt}(),function(){var n=Array.prototype.slice;function g(c,f){for(var _=n.call(arguments,2),u=[],S=0,C=c.length;S<C;S++)u[S]=_.length?c[S][f].apply(c[S],_):c[S][f].call(c[S]);return u}function x(c,f){return l(c,f,function(_,u){return _>=u})}function v(c,f){return l(c,f,function(_,u){return _<u})}function h(c,f){for(var _=c.length;_--;)c[_]=f;return c}function l(c,f,_){if(!(!c||c.length===0)){var u=c.length-1,S=f?c[u][f]:c[u];if(f)for(;u--;)_(c[u][f],S)&&(S=c[u][f]);else for(;u--;)_(c[u],S)&&(S=c[u]);return S}}I.util.array={fill:h,invoke:g,min:v,max:x}}(),function(){function n(x,v,h){if(h)if(!I.isLikelyNode&&v instanceof Element)x=v;else if(v instanceof Array){x=[];for(var l=0,c=v.length;l<c;l++)x[l]=n({},v[l],h)}else if(v&&typeof v=="object")for(var f in v)f==="canvas"||f==="group"?x[f]=null:v.hasOwnProperty(f)&&(x[f]=n({},v[f],h));else x=v;else for(var f in v)x[f]=v[f];return x}function g(x,v){return n({},x,v)}I.util.object={extend:n,clone:g},I.util.object.extend(I.util,I.Observable)}(),function(){function n(l){return l.replace(/-+(.)?/g,function(c,f){return f?f.toUpperCase():""})}function g(l,c){return l.charAt(0).toUpperCase()+(c?l.slice(1):l.slice(1).toLowerCase())}function x(l){return l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function v(l){var c=0,f,_=[];for(c=0,f;c<l.length;c++)(f=h(l,c))!==!1&&_.push(f);return _}function h(l,c){var f=l.charCodeAt(c);if(isNaN(f))return"";if(f<55296||f>57343)return l.charAt(c);if(55296<=f&&f<=56319){if(l.length<=c+1)throw"High surrogate without following low surrogate";var _=l.charCodeAt(c+1);if(56320>_||_>57343)throw"High surrogate without following low surrogate";return l.charAt(c)+l.charAt(c+1)}if(c===0)throw"Low surrogate without preceding high surrogate";var u=l.charCodeAt(c-1);if(55296>u||u>56319)throw"Low surrogate without preceding high surrogate";return!1}I.util.string={camelize:n,capitalize:g,escapeXml:x,graphemeSplit:v}}(),function(){var n=Array.prototype.slice,g=function(){},x=function(){for(var f in{toString:1})if(f==="toString")return!1;return!0}(),v=function(f,_,u){for(var S in _)S in f.prototype&&typeof f.prototype[S]=="function"&&(_[S]+"").indexOf("callSuper")>-1?f.prototype[S]=function(C){return function(){var A=this.constructor.superclass;this.constructor.superclass=u;var O=_[C].apply(this,arguments);if(this.constructor.superclass=A,C!=="initialize")return O}}(S):f.prototype[S]=_[S],x&&(_.toString!==Object.prototype.toString&&(f.prototype.toString=_.toString),_.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=_.valueOf))};function h(){}function l(f){for(var _=null,u=this;u.constructor.superclass;){var S=u.constructor.superclass.prototype[f];if(u[f]!==S){_=S;break}u=u.constructor.superclass.prototype}return _?arguments.length>1?_.apply(this,n.call(arguments,1)):_.call(this):console.log("tried to callSuper "+f+", method not found in prototype chain",this)}function c(){var f=null,_=n.call(arguments,0);typeof _[0]=="function"&&(f=_.shift());function u(){this.initialize.apply(this,arguments)}u.superclass=f,u.subclasses=[],f&&(h.prototype=f.prototype,u.prototype=new h,f.subclasses.push(u));for(var S=0,C=_.length;S<C;S++)v(u,_[S],f);return u.prototype.initialize||(u.prototype.initialize=g),u.prototype.constructor=u,u.prototype.callSuper=l,u}I.util.createClass=c}(),function(){var n=!!I.document.createElement("div").attachEvent,g=["touchstart","touchmove","touchend"];I.util.addListener=function(v,h,l,c){v&&v.addEventListener(h,l,n?!1:c)},I.util.removeListener=function(v,h,l,c){v&&v.removeEventListener(h,l,n?!1:c)};function x(v){var h=v.changedTouches;return h&&h[0]?h[0]:v}I.util.getPointer=function(v){var h=v.target,l=I.util.getScrollLeftTop(h),c=x(v);return{x:c.clientX+l.left,y:c.clientY+l.top}},I.util.isTouchEvent=function(v){return g.indexOf(v.type)>-1||v.pointerType==="touch"}}(),function(){function n(c,f){var _=c.style;if(!_)return c;if(typeof f=="string")return c.style.cssText+=";"+f,f.indexOf("opacity")>-1?l(c,f.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var u in f)if(u==="opacity")l(c,f[u]);else{var S=u==="float"||u==="cssFloat"?typeof _.styleFloat>"u"?"cssFloat":"styleFloat":u;_.setProperty(S,f[u])}return c}var g=I.document.createElement("div"),x=typeof g.style.opacity=="string",v=typeof g.style.filter=="string",h=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,l=function(c){return c};x?l=function(c,f){return c.style.opacity=f,c}:v&&(l=function(c,f){var _=c.style;return c.currentStyle&&!c.currentStyle.hasLayout&&(_.zoom=1),h.test(_.filter)?(f=f>=.9999?"":"alpha(opacity="+f*100+")",_.filter=_.filter.replace(h,f)):_.filter+=" alpha(opacity="+f*100+")",c}),I.util.setStyle=n}(),function(){var n=Array.prototype.slice;function g(O){return typeof O=="string"?I.document.getElementById(O):O}var x,v=function(O){return n.call(O,0)};try{x=v(I.document.childNodes)instanceof Array}catch{}x||(v=function(O){for(var j=new Array(O.length),Y=O.length;Y--;)j[Y]=O[Y];return j});function h(O,j){var Y=I.document.createElement(O);for(var oe in j)oe==="class"?Y.className=j[oe]:oe==="for"?Y.htmlFor=j[oe]:Y.setAttribute(oe,j[oe]);return Y}function l(O,j){O&&(" "+O.className+" ").indexOf(" "+j+" ")===-1&&(O.className+=(O.className?" ":"")+j)}function c(O,j,Y){return typeof j=="string"&&(j=h(j,Y)),O.parentNode&&O.parentNode.replaceChild(j,O),j.appendChild(O),j}function f(O){for(var j=0,Y=0,oe=I.document.documentElement,ge=I.document.body||{scrollLeft:0,scrollTop:0};O&&(O.parentNode||O.host)&&(O=O.parentNode||O.host,O===I.document?(j=ge.scrollLeft||oe.scrollLeft||0,Y=ge.scrollTop||oe.scrollTop||0):(j+=O.scrollLeft||0,Y+=O.scrollTop||0),!(O.nodeType===1&&O.style.position==="fixed")););return{left:j,top:Y}}function _(O){var j,Y=O&&O.ownerDocument,oe={left:0,top:0},ge={left:0,top:0},De,qe={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!Y)return ge;for(var lt in qe)ge[qe[lt]]+=parseInt(u(O,lt),10)||0;return j=Y.documentElement,typeof O.getBoundingClientRect<"u"&&(oe=O.getBoundingClientRect()),De=f(O),{left:oe.left+De.left-(j.clientLeft||0)+ge.left,top:oe.top+De.top-(j.clientTop||0)+ge.top}}var u;I.document.defaultView&&I.document.defaultView.getComputedStyle?u=function(O,j){var Y=I.document.defaultView.getComputedStyle(O,null);return Y?Y[j]:void 0}:u=function(O,j){var Y=O.style[j];return!Y&&O.currentStyle&&(Y=O.currentStyle[j]),Y},function(){var O=I.document.documentElement.style,j="userSelect"in O?"userSelect":"MozUserSelect"in O?"MozUserSelect":"WebkitUserSelect"in O?"WebkitUserSelect":"KhtmlUserSelect"in O?"KhtmlUserSelect":"";function Y(ge){return typeof ge.onselectstart<"u"&&(ge.onselectstart=I.util.falseFunction),j?ge.style[j]="none":typeof ge.unselectable=="string"&&(ge.unselectable="on"),ge}function oe(ge){return typeof ge.onselectstart<"u"&&(ge.onselectstart=null),j?ge.style[j]="":typeof ge.unselectable=="string"&&(ge.unselectable=""),ge}I.util.makeElementUnselectable=Y,I.util.makeElementSelectable=oe}();function S(O){var j=I.jsdomImplForWrapper(O);return j._canvas||j._image}function C(O){if(!!I.isLikelyNode){var j=I.jsdomImplForWrapper(O);j&&(j._image=null,j._canvas=null,j._currentSrc=null,j._attributes=null,j._classList=null)}}function A(O,j){O.imageSmoothingEnabled=O.imageSmoothingEnabled||O.webkitImageSmoothingEnabled||O.mozImageSmoothingEnabled||O.msImageSmoothingEnabled||O.oImageSmoothingEnabled,O.imageSmoothingEnabled=j}I.util.setImageSmoothing=A,I.util.getById=g,I.util.toArray=v,I.util.addClass=l,I.util.makeElement=h,I.util.wrapElement=c,I.util.getScrollLeftTop=f,I.util.getElementOffset=_,I.util.getNodeCanvas=S,I.util.cleanUpJsdomNode=C}(),function(){function n(v,h){return v+(/\?/.test(v)?"&":"?")+h}function g(){}function x(v,h){h||(h={});var l=h.method?h.method.toUpperCase():"GET",c=h.onComplete||function(){},f=new I.window.XMLHttpRequest,_=h.body||h.parameters;return f.onreadystatechange=function(){f.readyState===4&&(c(f),f.onreadystatechange=g)},l==="GET"&&(_=null,typeof h.parameters=="string"&&(v=n(v,h.parameters))),f.open(l,v,!0),(l==="POST"||l==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(_),f}I.util.request=x}(),I.log=console.log,I.warn=console.warn,function(){var n=I.util.object.extend,g=I.util.object.clone,x=[];I.util.object.extend(x,{cancelAll:function(){var S=this.splice(0);return S.forEach(function(C){C.cancel()}),S},cancelByCanvas:function(S){if(!S)return[];var C=this.filter(function(A){return typeof A.target=="object"&&A.target.canvas===S});return C.forEach(function(A){A.cancel()}),C},cancelByTarget:function(S){var C=this.findAnimationsByTarget(S);return C.forEach(function(A){A.cancel()}),C},findAnimationIndex:function(S){return this.indexOf(this.findAnimation(S))},findAnimation:function(S){return this.find(function(C){return C.cancel===S})},findAnimationsByTarget:function(S){return S?this.filter(function(C){return C.target===S}):[]}});function v(){return!1}function h(S,C,A,O){return-A*Math.cos(S/O*(Math.PI/2))+A+C}function l(S){S||(S={});var C=!1,A,O=function(){var j=I.runningAnimations.indexOf(A);return j>-1&&I.runningAnimations.splice(j,1)[0]};return A=n(g(S),{cancel:function(){return C=!0,O()},currentValue:"startValue"in S?S.startValue:0,completionRate:0,durationRate:0}),I.runningAnimations.push(A),_(function(j){var Y=j||+new Date,oe=S.duration||500,ge=Y+oe,De,qe=S.onChange||v,lt=S.abort||v,_t=S.onComplete||v,xt=S.easing||h,st="startValue"in S?S.startValue.length>0:!1,yt="startValue"in S?S.startValue:0,it="endValue"in S?S.endValue:100,Rt=S.byValue||(st?yt.map(function(Pt,Q){return it[Q]-yt[Q]}):it-yt);S.onStart&&S.onStart(),function Pt(Q){De=Q||+new Date;var se=De>ge?oe:De-Y,ue=se/oe,de=st?yt.map(function(K,W){return xt(se,yt[W],Rt[W],oe)}):xt(se,yt,Rt,oe),je=Math.abs(st?(de[0]-yt[0])/Rt[0]:(de-yt)/Rt);if(A.currentValue=st?de.slice():de,A.completionRate=je,A.durationRate=ue,!C){if(lt(de,je,ue)){O();return}if(De>ge){A.currentValue=st?it.slice():it,A.completionRate=1,A.durationRate=1,qe(st?it.slice():it,1,1),_t(it,1,1),O();return}else qe(de,je,ue),_(Pt)}}(Y)}),A.cancel}var c=I.window.requestAnimationFrame||I.window.webkitRequestAnimationFrame||I.window.mozRequestAnimationFrame||I.window.oRequestAnimationFrame||I.window.msRequestAnimationFrame||function(S){return I.window.setTimeout(S,1e3/60)},f=I.window.cancelAnimationFrame||I.window.clearTimeout;function _(){return c.apply(I.window,arguments)}function u(){return f.apply(I.window,arguments)}I.util.animate=l,I.util.requestAnimFrame=_,I.util.cancelAnimFrame=u,I.runningAnimations=x}(),function(){function n(x,v,h){var l="rgba("+parseInt(x[0]+h*(v[0]-x[0]),10)+","+parseInt(x[1]+h*(v[1]-x[1]),10)+","+parseInt(x[2]+h*(v[2]-x[2]),10);return l+=","+(x&&v?parseFloat(x[3]+h*(v[3]-x[3])):1),l+=")",l}function g(x,v,h,l){var c=new I.Color(x).getSource(),f=new I.Color(v).getSource(),_=l.onComplete,u=l.onChange;return l=l||{},I.util.animate(I.util.object.extend(l,{duration:h||500,startValue:c,endValue:f,byValue:f,easing:function(S,C,A,O){var j=l.colorEasing?l.colorEasing(S,O):1-Math.cos(S/O*(Math.PI/2));return n(C,A,j)},onComplete:function(S,C,A){if(_)return _(n(f,f,0),C,A)},onChange:function(S,C,A){if(u){if(Array.isArray(S))return u(n(S,S,0),C,A);u(S,C,A)}}}))}I.util.animateColor=g}(),function(){function n(Q,se,ue,de){return Q<Math.abs(se)?(Q=se,de=ue/4):se===0&&Q===0?de=ue/(2*Math.PI)*Math.asin(1):de=ue/(2*Math.PI)*Math.asin(se/Q),{a:Q,c:se,p:ue,s:de}}function g(Q,se,ue){return Q.a*Math.pow(2,10*(se-=1))*Math.sin((se*ue-Q.s)*(2*Math.PI)/Q.p)}function x(Q,se,ue,de){return ue*((Q=Q/de-1)*Q*Q+1)+se}function v(Q,se,ue,de){return Q/=de/2,Q<1?ue/2*Q*Q*Q+se:ue/2*((Q-=2)*Q*Q+2)+se}function h(Q,se,ue,de){return ue*(Q/=de)*Q*Q*Q+se}function l(Q,se,ue,de){return-ue*((Q=Q/de-1)*Q*Q*Q-1)+se}function c(Q,se,ue,de){return Q/=de/2,Q<1?ue/2*Q*Q*Q*Q+se:-ue/2*((Q-=2)*Q*Q*Q-2)+se}function f(Q,se,ue,de){return ue*(Q/=de)*Q*Q*Q*Q+se}function _(Q,se,ue,de){return ue*((Q=Q/de-1)*Q*Q*Q*Q+1)+se}function u(Q,se,ue,de){return Q/=de/2,Q<1?ue/2*Q*Q*Q*Q*Q+se:ue/2*((Q-=2)*Q*Q*Q*Q+2)+se}function S(Q,se,ue,de){return-ue*Math.cos(Q/de*(Math.PI/2))+ue+se}function C(Q,se,ue,de){return ue*Math.sin(Q/de*(Math.PI/2))+se}function A(Q,se,ue,de){return-ue/2*(Math.cos(Math.PI*Q/de)-1)+se}function O(Q,se,ue,de){return Q===0?se:ue*Math.pow(2,10*(Q/de-1))+se}function j(Q,se,ue,de){return Q===de?se+ue:ue*(-Math.pow(2,-10*Q/de)+1)+se}function Y(Q,se,ue,de){return Q===0?se:Q===de?se+ue:(Q/=de/2,Q<1?ue/2*Math.pow(2,10*(Q-1))+se:ue/2*(-Math.pow(2,-10*--Q)+2)+se)}function oe(Q,se,ue,de){return-ue*(Math.sqrt(1-(Q/=de)*Q)-1)+se}function ge(Q,se,ue,de){return ue*Math.sqrt(1-(Q=Q/de-1)*Q)+se}function De(Q,se,ue,de){return Q/=de/2,Q<1?-ue/2*(Math.sqrt(1-Q*Q)-1)+se:ue/2*(Math.sqrt(1-(Q-=2)*Q)+1)+se}function qe(Q,se,ue,de){var je=1.70158,K=0,W=ue;if(Q===0)return se;if(Q/=de,Q===1)return se+ue;K||(K=de*.3);var re=n(W,ue,K,je);return-g(re,Q,de)+se}function lt(Q,se,ue,de){var je=1.70158,K=0,W=ue;if(Q===0)return se;if(Q/=de,Q===1)return se+ue;K||(K=de*.3);var re=n(W,ue,K,je);return re.a*Math.pow(2,-10*Q)*Math.sin((Q*de-re.s)*(2*Math.PI)/re.p)+re.c+se}function _t(Q,se,ue,de){var je=1.70158,K=0,W=ue;if(Q===0)return se;if(Q/=de/2,Q===2)return se+ue;K||(K=de*(.3*1.5));var re=n(W,ue,K,je);return Q<1?-.5*g(re,Q,de)+se:re.a*Math.pow(2,-10*(Q-=1))*Math.sin((Q*de-re.s)*(2*Math.PI)/re.p)*.5+re.c+se}function xt(Q,se,ue,de,je){return je===void 0&&(je=1.70158),ue*(Q/=de)*Q*((je+1)*Q-je)+se}function st(Q,se,ue,de,je){return je===void 0&&(je=1.70158),ue*((Q=Q/de-1)*Q*((je+1)*Q+je)+1)+se}function yt(Q,se,ue,de,je){return je===void 0&&(je=1.70158),Q/=de/2,Q<1?ue/2*(Q*Q*(((je*=1.525)+1)*Q-je))+se:ue/2*((Q-=2)*Q*(((je*=1.525)+1)*Q+je)+2)+se}function it(Q,se,ue,de){return ue-Rt(de-Q,0,ue,de)+se}function Rt(Q,se,ue,de){return(Q/=de)<1/2.75?ue*(7.5625*Q*Q)+se:Q<2/2.75?ue*(7.5625*(Q-=1.5/2.75)*Q+.75)+se:Q<2.5/2.75?ue*(7.5625*(Q-=2.25/2.75)*Q+.9375)+se:ue*(7.5625*(Q-=2.625/2.75)*Q+.984375)+se}function Pt(Q,se,ue,de){return Q<de/2?it(Q*2,0,ue,de)*.5+se:Rt(Q*2-de,0,ue,de)*.5+ue*.5+se}I.util.ease={easeInQuad:function(Q,se,ue,de){return ue*(Q/=de)*Q+se},easeOutQuad:function(Q,se,ue,de){return-ue*(Q/=de)*(Q-2)+se},easeInOutQuad:function(Q,se,ue,de){return Q/=de/2,Q<1?ue/2*Q*Q+se:-ue/2*(--Q*(Q-2)-1)+se},easeInCubic:function(Q,se,ue,de){return ue*(Q/=de)*Q*Q+se},easeOutCubic:x,easeInOutCubic:v,easeInQuart:h,easeOutQuart:l,easeInOutQuart:c,easeInQuint:f,easeOutQuint:_,easeInOutQuint:u,easeInSine:S,easeOutSine:C,easeInOutSine:A,easeInExpo:O,easeOutExpo:j,easeInOutExpo:Y,easeInCirc:oe,easeOutCirc:ge,easeInOutCirc:De,easeInElastic:qe,easeOutElastic:lt,easeInOutElastic:_t,easeInBack:xt,easeOutBack:st,easeInOutBack:yt,easeInBounce:it,easeOutBounce:Rt,easeInOutBounce:Pt}}(),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.util.object.clone,h=g.util.toFixed,l=g.util.parseUnit,c=g.util.multiplyTransformMatrices,f=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],_=["symbol","image","marker","pattern","view","svg"],u=["pattern","defs","symbol","metadata","clipPath","mask","desc"],S=["symbol","g","a","svg","clipPath","defs"],C={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},A={stroke:"strokeOpacity",fill:"fillOpacity"},O="font-size",j="clip-path";g.svgValidTagNamesRegEx=ge(f),g.svgViewBoxElementsRegEx=ge(_),g.svgInvalidAncestorsRegEx=ge(u),g.svgValidParentsRegEx=ge(S),g.cssRules={},g.gradientDefs={},g.clipPaths={};function Y(K){return K in C?C[K]:K}function oe(K,W,re,ye){var Ae=Array.isArray(W),be;if((K==="fill"||K==="stroke")&&W==="none")W="";else{if(K==="strokeUniform")return W==="non-scaling-stroke";if(K==="strokeDashArray")W==="none"?W=null:W=W.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(K==="transformMatrix")re&&re.transformMatrix?W=c(re.transformMatrix,g.parseTransformAttribute(W)):W=g.parseTransformAttribute(W);else if(K==="visible")W=W!=="none"&&W!=="hidden",re&&re.visible===!1&&(W=!1);else if(K==="opacity")W=parseFloat(W),re&&typeof re.opacity<"u"&&(W*=re.opacity);else if(K==="textAnchor")W=W==="start"?"left":W==="end"?"right":"center";else if(K==="charSpacing")be=l(W,ye)/ye*1e3;else if(K==="paintFirst"){var Be=W.indexOf("fill"),Ze=W.indexOf("stroke"),W="fill";(Be>-1&&Ze>-1&&Ze<Be||Be===-1&&Ze>-1)&&(W="stroke")}else{if(K==="href"||K==="xlink:href"||K==="font")return W;if(K==="imageSmoothing")return W==="optimizeQuality";be=Ae?W.map(l):l(W,ye)}}return!Ae&&isNaN(be)?W:be}function ge(K){return new RegExp("^("+K.join("|")+")\\b","i")}function De(K){for(var W in A)if(!(typeof K[A[W]]>"u"||K[W]==="")){if(typeof K[W]>"u"){if(!g.Object.prototype[W])continue;K[W]=g.Object.prototype[W]}if(K[W].indexOf("url(")!==0){var re=new g.Color(K[W]);K[W]=re.setAlpha(h(re.getAlpha()*K[A[W]],2)).toRgba()}}return K}function qe(K,W){var re,ye=[],Ae,be,Be;for(be=0,Be=W.length;be<Be;be++)re=W[be],Ae=K.getElementsByTagName(re),ye=ye.concat(Array.prototype.slice.call(Ae));return ye}g.parseTransformAttribute=function(){function K(Je,Gt){var Qt=g.util.cos(Gt[0]),mi=g.util.sin(Gt[0]),Di=0,wi=0;Gt.length===3&&(Di=Gt[1],wi=Gt[2]),Je[0]=Qt,Je[1]=mi,Je[2]=-mi,Je[3]=Qt,Je[4]=Di-(Qt*Di-mi*wi),Je[5]=wi-(mi*Di+Qt*wi)}function W(Je,Gt){var Qt=Gt[0],mi=Gt.length===2?Gt[1]:Gt[0];Je[0]=Qt,Je[3]=mi}function re(Je,Gt,Qt){Je[Qt]=Math.tan(g.util.degreesToRadians(Gt[0]))}function ye(Je,Gt){Je[4]=Gt[0],Gt.length===2&&(Je[5]=Gt[1])}var Ae=g.iMatrix,be=g.reNum,Be=g.commaWsp,Ze="(?:(skewX)\\s*\\(\\s*("+be+")\\s*\\))",nt="(?:(skewY)\\s*\\(\\s*("+be+")\\s*\\))",Re="(?:(rotate)\\s*\\(\\s*("+be+")(?:"+Be+"("+be+")"+Be+"("+be+"))?\\s*\\))",we="(?:(scale)\\s*\\(\\s*("+be+")(?:"+Be+"("+be+"))?\\s*\\))",Le="(?:(translate)\\s*\\(\\s*("+be+")(?:"+Be+"("+be+"))?\\s*\\))",Ke="(?:(matrix)\\s*\\(\\s*("+be+")"+Be+"("+be+")"+Be+"("+be+")"+Be+"("+be+")"+Be+"("+be+")"+Be+"("+be+")\\s*\\))",$e="(?:"+Ke+"|"+Le+"|"+we+"|"+Re+"|"+Ze+"|"+nt+")",ut="(?:"+$e+"(?:"+Be+"*"+$e+")*)",ct="^\\s*(?:"+ut+"?)\\s*$",Ht=new RegExp(ct),Zt=new RegExp($e,"g");return function(Je){var Gt=Ae.concat(),Qt=[];if(!Je||Je&&!Ht.test(Je))return Gt;Je.replace(Zt,function(Di){var wi=new RegExp($e).exec(Di).filter(function(Ri){return!!Ri}),Ge=wi[1],vt=wi.slice(2).map(parseFloat);switch(Ge){case"translate":ye(Gt,vt);break;case"rotate":vt[0]=g.util.degreesToRadians(vt[0]),K(Gt,vt);break;case"scale":W(Gt,vt);break;case"skewX":re(Gt,vt,2);break;case"skewY":re(Gt,vt,1);break;case"matrix":Gt=vt;break}Qt.push(Gt.concat()),Gt=Ae.concat()});for(var mi=Qt[0];Qt.length>1;)Qt.shift(),mi=g.util.multiplyTransformMatrices(mi,Qt[0]);return mi}}();function lt(K,W){var re,ye;K.replace(/;\s*$/,"").split(";").forEach(function(Ae){var be=Ae.split(":");re=be[0].trim().toLowerCase(),ye=be[1].trim(),W[re]=ye})}function _t(K,W){var re,ye;for(var Ae in K)typeof K[Ae]>"u"||(re=Ae.toLowerCase(),ye=K[Ae],W[re]=ye)}function xt(K,W){var re={};for(var ye in g.cssRules[W])if(st(K,ye.split(" ")))for(var Ae in g.cssRules[W][ye])re[Ae]=g.cssRules[W][ye][Ae];return re}function st(K,W){var re,ye=!0;return re=it(K,W.pop()),re&&W.length&&(ye=yt(K,W)),re&&ye&&W.length===0}function yt(K,W){for(var re,ye=!0;K.parentNode&&K.parentNode.nodeType===1&&W.length;)ye&&(re=W.pop()),K=K.parentNode,ye=it(K,re);return W.length===0}function it(K,W){var re=K.nodeName,ye=K.getAttribute("class"),Ae=K.getAttribute("id"),be,Be;if(be=new RegExp("^"+re,"i"),W=W.replace(be,""),Ae&&W.length&&(be=new RegExp("#"+Ae+"(?![a-zA-Z\\-]+)","i"),W=W.replace(be,"")),ye&&W.length)for(ye=ye.split(" "),Be=ye.length;Be--;)be=new RegExp("\\."+ye[Be]+"(?![a-zA-Z\\-]+)","i"),W=W.replace(be,"");return W.length===0}function Rt(K,W){var re;if(K.getElementById&&(re=K.getElementById(W)),re)return re;var ye,Ae,be,Be=K.getElementsByTagName("*");for(Ae=0,be=Be.length;Ae<be;Ae++)if(ye=Be[Ae],W===ye.getAttribute("id"))return ye}function Pt(K){for(var W=qe(K,["use","svg:use"]),re=0;W.length&&re<W.length;){var ye=W[re],Ae=ye.getAttribute("xlink:href")||ye.getAttribute("href");if(Ae===null)return;var be=Ae.slice(1),Be=ye.getAttribute("x")||0,Ze=ye.getAttribute("y")||0,nt=Rt(K,be).cloneNode(!0),Re=(nt.getAttribute("transform")||"")+" translate("+Be+", "+Ze+")",we,Le=W.length,Ke,$e,ut,ct,Ht=g.svgNS;if(se(nt),/^svg$/i.test(nt.nodeName)){var Zt=nt.ownerDocument.createElementNS(Ht,"g");for($e=0,ut=nt.attributes,ct=ut.length;$e<ct;$e++)Ke=ut.item($e),Zt.setAttributeNS(Ht,Ke.nodeName,Ke.nodeValue);for(;nt.firstChild;)Zt.appendChild(nt.firstChild);nt=Zt}for($e=0,ut=ye.attributes,ct=ut.length;$e<ct;$e++)Ke=ut.item($e),!(Ke.nodeName==="x"||Ke.nodeName==="y"||Ke.nodeName==="xlink:href"||Ke.nodeName==="href")&&(Ke.nodeName==="transform"?Re=Ke.nodeValue+" "+Re:nt.setAttribute(Ke.nodeName,Ke.nodeValue));nt.setAttribute("transform",Re),nt.setAttribute("instantiated_by_use","1"),nt.removeAttribute("id"),we=ye.parentNode,we.replaceChild(nt,ye),W.length===Le&&re++}}var Q=new RegExp("^\\s*("+g.reNum+"+)\\s*,?\\s*("+g.reNum+"+)\\s*,?\\s*("+g.reNum+"+)\\s*,?\\s*("+g.reNum+"+)\\s*$");function se(K){if(!g.svgViewBoxElementsRegEx.test(K.nodeName))return{};var W=K.getAttribute("viewBox"),re=1,ye=1,Ae=0,be=0,Be,Ze,nt,Re,we=K.getAttribute("width"),Le=K.getAttribute("height"),Ke=K.getAttribute("x")||0,$e=K.getAttribute("y")||0,ut=K.getAttribute("preserveAspectRatio")||"",ct=!W||!(W=W.match(Q)),Ht=!we||!Le||we==="100%"||Le==="100%",Zt=ct&&Ht,Je={},Gt="",Qt=0,mi=0;if(Je.width=0,Je.height=0,Je.toBeParsed=Zt,ct&&(Ke||$e)&&K.parentNode&&K.parentNode.nodeName!=="#document"&&(Gt=" translate("+l(Ke)+" "+l($e)+") ",nt=(K.getAttribute("transform")||"")+Gt,K.setAttribute("transform",nt),K.removeAttribute("x"),K.removeAttribute("y")),Zt)return Je;if(ct)return Je.width=l(we),Je.height=l(Le),Je;if(Ae=-parseFloat(W[1]),be=-parseFloat(W[2]),Be=parseFloat(W[3]),Ze=parseFloat(W[4]),Je.minX=Ae,Je.minY=be,Je.viewBoxWidth=Be,Je.viewBoxHeight=Ze,Ht?(Je.width=Be,Je.height=Ze):(Je.width=l(we),Je.height=l(Le),re=Je.width/Be,ye=Je.height/Ze),ut=g.util.parsePreserveAspectRatioAttribute(ut),ut.alignX!=="none"&&(ut.meetOrSlice==="meet"&&(ye=re=re>ye?ye:re),ut.meetOrSlice==="slice"&&(ye=re=re>ye?re:ye),Qt=Je.width-Be*re,mi=Je.height-Ze*re,ut.alignX==="Mid"&&(Qt/=2),ut.alignY==="Mid"&&(mi/=2),ut.alignX==="Min"&&(Qt=0),ut.alignY==="Min"&&(mi=0)),re===1&&ye===1&&Ae===0&&be===0&&Ke===0&&$e===0)return Je;if((Ke||$e)&&K.parentNode.nodeName!=="#document"&&(Gt=" translate("+l(Ke)+" "+l($e)+") "),nt=Gt+" matrix("+re+" 0 0 "+ye+" "+(Ae*re+Qt)+" "+(be*ye+mi)+") ",K.nodeName==="svg"){for(Re=K.ownerDocument.createElementNS(g.svgNS,"g");K.firstChild;)Re.appendChild(K.firstChild);K.appendChild(Re)}else Re=K,Re.removeAttribute("x"),Re.removeAttribute("y"),nt=Re.getAttribute("transform")+nt;return Re.setAttribute("transform",nt),Je}function ue(K,W){for(;K&&(K=K.parentNode);)if(K.nodeName&&W.test(K.nodeName.replace("svg:",""))&&!K.getAttribute("instantiated_by_use"))return!0;return!1}g.parseSVGDocument=function(K,W,re,ye){if(!!K){Pt(K);var Ae=g.Object.__uid++,be,Be,Ze=se(K),nt=g.util.toArray(K.getElementsByTagName("*"));if(Ze.crossOrigin=ye&&ye.crossOrigin,Ze.svgUid=Ae,nt.length===0&&g.isLikelyNode){nt=K.selectNodes('//*[name(.)!="svg"]');var Re=[];for(be=0,Be=nt.length;be<Be;be++)Re[be]=nt[be];nt=Re}var we=nt.filter(function(Ke){return se(Ke),g.svgValidTagNamesRegEx.test(Ke.nodeName.replace("svg:",""))&&!ue(Ke,g.svgInvalidAncestorsRegEx)});if(!we||we&&!we.length){W&&W([],{});return}var Le={};nt.filter(function(Ke){return Ke.nodeName.replace("svg:","")==="clipPath"}).forEach(function(Ke){var $e=Ke.getAttribute("id");Le[$e]=g.util.toArray(Ke.getElementsByTagName("*")).filter(function(ut){return g.svgValidTagNamesRegEx.test(ut.nodeName.replace("svg:",""))})}),g.gradientDefs[Ae]=g.getGradientDefs(K),g.cssRules[Ae]=g.getCSSRules(K),g.clipPaths[Ae]=Le,g.parseElements(we,function(Ke,$e){W&&(W(Ke,Ze,$e,nt),delete g.gradientDefs[Ae],delete g.cssRules[Ae],delete g.clipPaths[Ae])},v(Ze),re,ye)}};function de(K,W){var re=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],ye="xlink:href",Ae=W.getAttribute(ye).slice(1),be=Rt(K,Ae);if(be&&be.getAttribute(ye)&&de(K,be),re.forEach(function(Ze){be&&!W.hasAttribute(Ze)&&be.hasAttribute(Ze)&&W.setAttribute(Ze,be.getAttribute(Ze))}),!W.children.length)for(var Be=be.cloneNode(!0);Be.firstChild;)W.appendChild(Be.firstChild);W.removeAttribute(ye)}var je=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+g.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+g.reNum+"))?\\s+(.*)");x(g,{parseFontDeclaration:function(K,W){var re=K.match(je);if(!!re){var ye=re[1],Ae=re[3],be=re[4],Be=re[5],Ze=re[6];ye&&(W.fontStyle=ye),Ae&&(W.fontWeight=isNaN(parseFloat(Ae))?Ae:parseFloat(Ae)),be&&(W.fontSize=l(be)),Ze&&(W.fontFamily=Ze),Be&&(W.lineHeight=Be==="normal"?1:Be)}},getGradientDefs:function(K){var W=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],re=qe(K,W),ye,Ae=0,be={};for(Ae=re.length;Ae--;)ye=re[Ae],ye.getAttribute("xlink:href")&&de(K,ye),be[ye.getAttribute("id")]=ye;return be},parseAttributes:function(K,W,re){if(!!K){var ye,Ae={},be,Be;typeof re>"u"&&(re=K.getAttribute("svgUid")),K.parentNode&&g.svgValidParentsRegEx.test(K.parentNode.nodeName)&&(Ae=g.parseAttributes(K.parentNode,W,re));var Ze=W.reduce(function(ut,ct){return ye=K.getAttribute(ct),ye&&(ut[ct]=ye),ut},{}),nt=x(xt(K,re),g.parseStyleAttribute(K));Ze=x(Ze,nt),nt[j]&&K.setAttribute(j,nt[j]),be=Be=Ae.fontSize||g.Text.DEFAULT_SVG_FONT_SIZE,Ze[O]&&(Ze[O]=be=l(Ze[O],Be));var Re,we,Le={};for(var Ke in Ze)Re=Y(Ke),we=oe(Re,Ze[Ke],Ae,be),Le[Re]=we;Le&&Le.font&&g.parseFontDeclaration(Le.font,Le);var $e=x(Ae,Le);return g.svgValidParentsRegEx.test(K.nodeName)?$e:De($e)}},parseElements:function(K,W,re,ye,Ae){new g.ElementsParser(K,W,re,ye,Ae).parse()},parseStyleAttribute:function(K){var W={},re=K.getAttribute("style");return re&&(typeof re=="string"?lt(re,W):_t(re,W)),W},parsePointsAttribute:function(K){if(!K)return null;K=K.replace(/,/g," ").trim(),K=K.split(/\s+/);var W=[],re,ye;for(re=0,ye=K.length;re<ye;re+=2)W.push({x:parseFloat(K[re]),y:parseFloat(K[re+1])});return W},getCSSRules:function(K){var W=K.getElementsByTagName("style"),re,ye,Ae={},be;for(re=0,ye=W.length;re<ye;re++){var Be=W[re].textContent;Be=Be.replace(/\/\*[\s\S]*?\*\//g,""),Be.trim()!==""&&(be=Be.split("}"),be=be.filter(function(Ze){return Ze.trim()}),be.forEach(function(Ze){var nt=Ze.split("{"),Re={},we=nt[1].trim(),Le=we.split(";").filter(function(ct){return ct.trim()});for(re=0,ye=Le.length;re<ye;re++){var Ke=Le[re].split(":"),$e=Ke[0].trim(),ut=Ke[1].trim();Re[$e]=ut}Ze=nt[0].trim(),Ze.split(",").forEach(function(ct){ct=ct.replace(/^svg/i,"").trim(),ct!==""&&(Ae[ct]?g.util.object.extend(Ae[ct],Re):Ae[ct]=g.util.object.clone(Re))})}))}return Ae},loadSVGFromURL:function(K,W,re,ye){K=K.replace(/^\n\s*/,"").trim(),new g.util.request(K,{method:"get",onComplete:Ae});function Ae(be){var Be=be.responseXML;if(!Be||!Be.documentElement)return W&&W(null),!1;g.parseSVGDocument(Be.documentElement,function(Ze,nt,Re,we){W&&W(Ze,nt,Re,we)},re,ye)}},loadSVGFromString:function(K,W,re,ye){var Ae=new g.window.DOMParser,be=Ae.parseFromString(K.trim(),"text/xml");g.parseSVGDocument(be.documentElement,function(Be,Ze,nt,Re){W(Be,Ze,nt,Re)},re,ye)}})}(Fe),I.ElementsParser=function(n,g,x,v,h,l){this.elements=n,this.callback=g,this.options=x,this.reviver=v,this.svgUid=x&&x.svgUid||0,this.parsingOptions=h,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=l},function(n){n.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},n.createObjects=function(){var g=this;this.elements.forEach(function(x,v){x.setAttribute("svgUid",g.svgUid),g.createObject(x,v)})},n.findTag=function(g){return I[I.util.string.capitalize(g.tagName.replace("svg:",""))]},n.createObject=function(g,x){var v=this.findTag(g);if(v&&v.fromElement)try{v.fromElement(g,this.createCallback(x,g),this.options)}catch(h){I.log(h)}else this.checkIfDone()},n.createCallback=function(g,x){var v=this;return function(h){var l;v.resolveGradient(h,x,"fill"),v.resolveGradient(h,x,"stroke"),h instanceof I.Image&&h._originalElement&&(l=h.parsePreserveAspectRatioAttribute(x)),h._removeTransformMatrix(l),v.resolveClipPath(h,x),v.reviver&&v.reviver(x,h),v.instances[g]=h,v.checkIfDone()}},n.extractPropertyDefinition=function(g,x,v){var h=g[x],l=this.regexUrl;if(!!l.test(h)){l.lastIndex=0;var c=l.exec(h)[1];return l.lastIndex=0,I[v][this.svgUid][c]}},n.resolveGradient=function(g,x,v){var h=this.extractPropertyDefinition(g,v,"gradientDefs");if(h){var l=x.getAttribute(v+"-opacity"),c=I.Gradient.fromElement(h,g,l,this.options);g.set(v,c)}},n.createClipPathCallback=function(g,x){return function(v){v._removeTransformMatrix(),v.fillRule=v.clipRule,x.push(v)}},n.resolveClipPath=function(g,x){var v=this.extractPropertyDefinition(g,"clipPath","clipPaths"),h,l,c,f,_,u;if(v){f=[],c=I.util.invertTransform(g.calcTransformMatrix());for(var S=v[0].parentNode,C=x;C.parentNode&&C.getAttribute("clip-path")!==g.clipPath;)C=C.parentNode;C.parentNode.appendChild(S);for(var A=0;A<v.length;A++)h=v[A],l=this.findTag(h),l.fromElement(h,this.createClipPathCallback(g,f),this.options);f.length===1?v=f[0]:v=new I.Group(f),_=I.util.multiplyTransformMatrices(c,v.calcTransformMatrix()),v.clipPath&&this.resolveClipPath(v,C);var u=I.util.qrDecompose(_);v.flipX=!1,v.flipY=!1,v.set("scaleX",u.scaleX),v.set("scaleY",u.scaleY),v.angle=u.angle,v.skewX=u.skewX,v.skewY=0,v.setPositionByOrigin({x:u.translateX,y:u.translateY},"center","center"),g.clipPath=v}else delete g.clipPath},n.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(g){return g!=null}),this.callback(this.instances,this.elements))}}(I.ElementsParser.prototype),function(n){var g=n.fabric||(n.fabric={});if(g.Point){g.warn("fabric.Point is already defined");return}g.Point=x;function x(v,h){this.x=v,this.y=h}x.prototype={type:"point",constructor:x,add:function(v){return new x(this.x+v.x,this.y+v.y)},addEquals:function(v){return this.x+=v.x,this.y+=v.y,this},scalarAdd:function(v){return new x(this.x+v,this.y+v)},scalarAddEquals:function(v){return this.x+=v,this.y+=v,this},subtract:function(v){return new x(this.x-v.x,this.y-v.y)},subtractEquals:function(v){return this.x-=v.x,this.y-=v.y,this},scalarSubtract:function(v){return new x(this.x-v,this.y-v)},scalarSubtractEquals:function(v){return this.x-=v,this.y-=v,this},multiply:function(v){return new x(this.x*v,this.y*v)},multiplyEquals:function(v){return this.x*=v,this.y*=v,this},divide:function(v){return new x(this.x/v,this.y/v)},divideEquals:function(v){return this.x/=v,this.y/=v,this},eq:function(v){return this.x===v.x&&this.y===v.y},lt:function(v){return this.x<v.x&&this.y<v.y},lte:function(v){return this.x<=v.x&&this.y<=v.y},gt:function(v){return this.x>v.x&&this.y>v.y},gte:function(v){return this.x>=v.x&&this.y>=v.y},lerp:function(v,h){return typeof h>"u"&&(h=.5),h=Math.max(Math.min(1,h),0),new x(this.x+(v.x-this.x)*h,this.y+(v.y-this.y)*h)},distanceFrom:function(v){var h=this.x-v.x,l=this.y-v.y;return Math.sqrt(h*h+l*l)},midPointFrom:function(v){return this.lerp(v)},min:function(v){return new x(Math.min(this.x,v.x),Math.min(this.y,v.y))},max:function(v){return new x(Math.max(this.x,v.x),Math.max(this.y,v.y))},toString:function(){return this.x+","+this.y},setXY:function(v,h){return this.x=v,this.y=h,this},setX:function(v){return this.x=v,this},setY:function(v){return this.y=v,this},setFromPoint:function(v){return this.x=v.x,this.y=v.y,this},swap:function(v){var h=this.x,l=this.y;this.x=v.x,this.y=v.y,v.x=h,v.y=l},clone:function(){return new x(this.x,this.y)}}}(Fe),function(n){var g=n.fabric||(n.fabric={});if(g.Intersection){g.warn("fabric.Intersection is already defined");return}function x(v){this.status=v,this.points=[]}g.Intersection=x,g.Intersection.prototype={constructor:x,appendPoint:function(v){return this.points.push(v),this},appendPoints:function(v){return this.points=this.points.concat(v),this}},g.Intersection.intersectLineLine=function(v,h,l,c){var f,_=(c.x-l.x)*(v.y-l.y)-(c.y-l.y)*(v.x-l.x),u=(h.x-v.x)*(v.y-l.y)-(h.y-v.y)*(v.x-l.x),S=(c.y-l.y)*(h.x-v.x)-(c.x-l.x)*(h.y-v.y);if(S!==0){var C=_/S,A=u/S;0<=C&&C<=1&&0<=A&&A<=1?(f=new x("Intersection"),f.appendPoint(new g.Point(v.x+C*(h.x-v.x),v.y+C*(h.y-v.y)))):f=new x}else _===0||u===0?f=new x("Coincident"):f=new x("Parallel");return f},g.Intersection.intersectLinePolygon=function(v,h,l){var c=new x,f=l.length,_,u,S,C;for(C=0;C<f;C++)_=l[C],u=l[(C+1)%f],S=x.intersectLineLine(v,h,_,u),c.appendPoints(S.points);return c.points.length>0&&(c.status="Intersection"),c},g.Intersection.intersectPolygonPolygon=function(v,h){var l=new x,c=v.length,f;for(f=0;f<c;f++){var _=v[f],u=v[(f+1)%c],S=x.intersectLinePolygon(_,u,h);l.appendPoints(S.points)}return l.points.length>0&&(l.status="Intersection"),l},g.Intersection.intersectPolygonRectangle=function(v,h,l){var c=h.min(l),f=h.max(l),_=new g.Point(f.x,c.y),u=new g.Point(c.x,f.y),S=x.intersectLinePolygon(c,_,v),C=x.intersectLinePolygon(_,f,v),A=x.intersectLinePolygon(f,u,v),O=x.intersectLinePolygon(u,c,v),j=new x;return j.appendPoints(S.points),j.appendPoints(C.points),j.appendPoints(A.points),j.appendPoints(O.points),j.points.length>0&&(j.status="Intersection"),j}}(Fe),function(n){var g=n.fabric||(n.fabric={});if(g.Color){g.warn("fabric.Color is already defined.");return}function x(h){h?this._tryParsingColor(h):this.setSource([0,0,0,1])}g.Color=x,g.Color.prototype={_tryParsingColor:function(h){var l;h in x.colorNameMap&&(h=x.colorNameMap[h]),h==="transparent"&&(l=[255,255,255,0]),l||(l=x.sourceFromHex(h)),l||(l=x.sourceFromRgb(h)),l||(l=x.sourceFromHsl(h)),l||(l=[0,0,0,1]),l&&this.setSource(l)},_rgbToHsl:function(h,l,c){h/=255,l/=255,c/=255;var f,_,u,S=g.util.array.max([h,l,c]),C=g.util.array.min([h,l,c]);if(u=(S+C)/2,S===C)f=_=0;else{var A=S-C;switch(_=u>.5?A/(2-S-C):A/(S+C),S){case h:f=(l-c)/A+(l<c?6:0);break;case l:f=(c-h)/A+2;break;case c:f=(h-l)/A+4;break}f/=6}return[Math.round(f*360),Math.round(_*100),Math.round(u*100)]},getSource:function(){return this._source},setSource:function(h){this._source=h},toRgb:function(){var h=this.getSource();return"rgb("+h[0]+","+h[1]+","+h[2]+")"},toRgba:function(){var h=this.getSource();return"rgba("+h[0]+","+h[1]+","+h[2]+","+h[3]+")"},toHsl:function(){var h=this.getSource(),l=this._rgbToHsl(h[0],h[1],h[2]);return"hsl("+l[0]+","+l[1]+"%,"+l[2]+"%)"},toHsla:function(){var h=this.getSource(),l=this._rgbToHsl(h[0],h[1],h[2]);return"hsla("+l[0]+","+l[1]+"%,"+l[2]+"%,"+h[3]+")"},toHex:function(){var h=this.getSource(),l,c,f;return l=h[0].toString(16),l=l.length===1?"0"+l:l,c=h[1].toString(16),c=c.length===1?"0"+c:c,f=h[2].toString(16),f=f.length===1?"0"+f:f,l.toUpperCase()+c.toUpperCase()+f.toUpperCase()},toHexa:function(){var h=this.getSource(),l;return l=Math.round(h[3]*255),l=l.toString(16),l=l.length===1?"0"+l:l,this.toHex()+l.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(h){var l=this.getSource();return l[3]=h,this.setSource(l),this},toGrayscale:function(){var h=this.getSource(),l=parseInt((h[0]*.3+h[1]*.59+h[2]*.11).toFixed(0),10),c=h[3];return this.setSource([l,l,l,c]),this},toBlackWhite:function(h){var l=this.getSource(),c=(l[0]*.3+l[1]*.59+l[2]*.11).toFixed(0),f=l[3];return h=h||127,c=Number(c)<Number(h)?0:255,this.setSource([c,c,c,f]),this},overlayWith:function(h){h instanceof x||(h=new x(h));var l=[],c=this.getAlpha(),f=.5,_=this.getSource(),u=h.getSource(),S;for(S=0;S<3;S++)l.push(Math.round(_[S]*(1-f)+u[S]*f));return l[3]=c,this.setSource(l),this}},g.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,g.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,g.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,g.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function v(h,l,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?h+(l-h)*6*c:c<1/2?l:c<2/3?h+(l-h)*(2/3-c)*6:h}g.Color.fromRgb=function(h){return x.fromSource(x.sourceFromRgb(h))},g.Color.sourceFromRgb=function(h){var l=h.match(x.reRGBa);if(l){var c=parseInt(l[1],10)/(/%$/.test(l[1])?100:1)*(/%$/.test(l[1])?255:1),f=parseInt(l[2],10)/(/%$/.test(l[2])?100:1)*(/%$/.test(l[2])?255:1),_=parseInt(l[3],10)/(/%$/.test(l[3])?100:1)*(/%$/.test(l[3])?255:1);return[parseInt(c,10),parseInt(f,10),parseInt(_,10),l[4]?parseFloat(l[4]):1]}},g.Color.fromRgba=x.fromRgb,g.Color.fromHsl=function(h){return x.fromSource(x.sourceFromHsl(h))},g.Color.sourceFromHsl=function(h){var l=h.match(x.reHSLa);if(!!l){var c=(parseFloat(l[1])%360+360)%360/360,f=parseFloat(l[2])/(/%$/.test(l[2])?100:1),_=parseFloat(l[3])/(/%$/.test(l[3])?100:1),u,S,C;if(f===0)u=S=C=_;else{var A=_<=.5?_*(f+1):_+f-_*f,O=_*2-A;u=v(O,A,c+1/3),S=v(O,A,c),C=v(O,A,c-1/3)}return[Math.round(u*255),Math.round(S*255),Math.round(C*255),l[4]?parseFloat(l[4]):1]}},g.Color.fromHsla=x.fromHsl,g.Color.fromHex=function(h){return x.fromSource(x.sourceFromHex(h))},g.Color.sourceFromHex=function(h){if(h.match(x.reHex)){var l=h.slice(h.indexOf("#")+1),c=l.length===3||l.length===4,f=l.length===8||l.length===4,_=c?l.charAt(0)+l.charAt(0):l.substring(0,2),u=c?l.charAt(1)+l.charAt(1):l.substring(2,4),S=c?l.charAt(2)+l.charAt(2):l.substring(4,6),C=f?c?l.charAt(3)+l.charAt(3):l.substring(6,8):"FF";return[parseInt(_,16),parseInt(u,16),parseInt(S,16),parseFloat((parseInt(C,16)/255).toFixed(2))]}},g.Color.fromSource=function(h){var l=new x;return l.setSource(h),l}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=["e","se","s","sw","w","nw","n","ne","e"],v=["ns","nesw","ew","nwse"],h={},l="left",c="top",f="right",_="bottom",u="center",S={top:_,bottom:c,left:f,right:l,center:u},C=g.util.radiansToDegrees,A=Math.sign||function(Re){return(Re>0)-(Re<0)||+Re};function O(Re,we){var Le=Re.angle+C(Math.atan2(we.y,we.x))+360;return Math.round(Le%360/45)}function j(Re,we){var Le=we.transform.target,Ke=Le.canvas,$e=g.util.object.clone(we);$e.target=Le,Ke&&Ke.fire("object:"+Re,$e),Le.fire(Re,we)}function Y(Re,we){var Le=we.canvas,Ke=Le.uniScaleKey,$e=Re[Ke];return Le.uniformScaling&&!$e||!Le.uniformScaling&&$e}function oe(Re){return Re.originX===u&&Re.originY===u}function ge(Re,we,Le){var Ke=Re.lockScalingX,$e=Re.lockScalingY;return!!(Ke&&$e||!we&&(Ke||$e)&&Le||Ke&&we==="x"||$e&&we==="y")}function De(Re,we,Le){var Ke="not-allowed",$e=Y(Re,Le),ut="";if(we.x!==0&&we.y===0?ut="x":we.x===0&&we.y!==0&&(ut="y"),ge(Le,ut,$e))return Ke;var ct=O(Le,we);return x[ct]+"-resize"}function qe(Re,we,Le){var Ke="not-allowed";if(we.x!==0&&Le.lockSkewingY||we.y!==0&&Le.lockSkewingX)return Ke;var $e=O(Le,we)%4;return v[$e]+"-resize"}function lt(Re,we,Le){return Re[Le.canvas.altActionKey]?h.skewCursorStyleHandler(Re,we,Le):h.scaleCursorStyleHandler(Re,we,Le)}function _t(Re,we,Le){var Ke=Re[Le.canvas.altActionKey];if(we.x===0)return Ke?"skewX":"scaleY";if(we.y===0)return Ke?"skewY":"scaleX"}function xt(Re,we,Le){return Le.lockRotation?"not-allowed":we.cursorStyle}function st(Re,we,Le,Ke){return{e:Re,transform:we,pointer:{x:Le,y:Ke}}}function yt(Re){return function(we,Le,Ke,$e){var ut=Le.target,ct=ut.getCenterPoint(),Ht=ut.translateToOriginPoint(ct,Le.originX,Le.originY),Zt=Re(we,Le,Ke,$e);return ut.setPositionByOrigin(Ht,Le.originX,Le.originY),Zt}}function it(Re,we){return function(Le,Ke,$e,ut){var ct=we(Le,Ke,$e,ut);return ct&&j(Re,st(Le,Ke,$e,ut)),ct}}function Rt(Re,we,Le,Ke,$e){var ut=Re.target,ct=ut.controls[Re.corner],Ht=ut.canvas.getZoom(),Zt=ut.padding/Ht,Je=ut.toLocalPoint(new g.Point(Ke,$e),we,Le);return Je.x>=Zt&&(Je.x-=Zt),Je.x<=-Zt&&(Je.x+=Zt),Je.y>=Zt&&(Je.y-=Zt),Je.y<=Zt&&(Je.y+=Zt),Je.x-=ct.offsetX,Je.y-=ct.offsetY,Je}function Pt(Re){return Re.flipX!==Re.flipY}function Q(Re,we,Le,Ke,$e){if(Re[we]!==0){var ut=Re._getTransformedDimensions()[Ke],ct=$e/ut*Re[Le];Re.set(Le,ct)}}function se(Re,we,Le,Ke){var $e=we.target,ut=$e._getTransformedDimensions(0,$e.skewY),ct=Rt(we,we.originX,we.originY,Le,Ke),Ht=Math.abs(ct.x*2)-ut.x,Zt=$e.skewX,Je;Ht<2?Je=0:(Je=C(Math.atan2(Ht/$e.scaleX,ut.y/$e.scaleY)),we.originX===l&&we.originY===_&&(Je=-Je),we.originX===f&&we.originY===c&&(Je=-Je),Pt($e)&&(Je=-Je));var Gt=Zt!==Je;if(Gt){var Qt=$e._getTransformedDimensions().y;$e.set("skewX",Je),Q($e,"skewY","scaleY","y",Qt)}return Gt}function ue(Re,we,Le,Ke){var $e=we.target,ut=$e._getTransformedDimensions($e.skewX,0),ct=Rt(we,we.originX,we.originY,Le,Ke),Ht=Math.abs(ct.y*2)-ut.y,Zt=$e.skewY,Je;Ht<2?Je=0:(Je=C(Math.atan2(Ht/$e.scaleY,ut.x/$e.scaleX)),we.originX===l&&we.originY===_&&(Je=-Je),we.originX===f&&we.originY===c&&(Je=-Je),Pt($e)&&(Je=-Je));var Gt=Zt!==Je;if(Gt){var Qt=$e._getTransformedDimensions().x;$e.set("skewY",Je),Q($e,"skewX","scaleX","x",Qt)}return Gt}function de(Re,we,Le,Ke){var $e=we.target,ut=$e.skewX,ct,Ht=we.originY;if($e.lockSkewingX)return!1;if(ut===0){var Zt=Rt(we,u,u,Le,Ke);Zt.x>0?ct=l:ct=f}else ut>0&&(ct=Ht===c?l:f),ut<0&&(ct=Ht===c?f:l),Pt($e)&&(ct=ct===l?f:l);we.originX=ct;var Je=it("skewing",yt(se));return Je(Re,we,Le,Ke)}function je(Re,we,Le,Ke){var $e=we.target,ut=$e.skewY,ct,Ht=we.originX;if($e.lockSkewingY)return!1;if(ut===0){var Zt=Rt(we,u,u,Le,Ke);Zt.y>0?ct=c:ct=_}else ut>0&&(ct=Ht===l?c:_),ut<0&&(ct=Ht===l?_:c),Pt($e)&&(ct=ct===c?_:c);we.originY=ct;var Je=it("skewing",yt(ue));return Je(Re,we,Le,Ke)}function K(Re,we,Le,Ke){var $e=we,ut=$e.target,ct=ut.translateToOriginPoint(ut.getCenterPoint(),$e.originX,$e.originY);if(ut.lockRotation)return!1;var Ht=Math.atan2($e.ey-ct.y,$e.ex-ct.x),Zt=Math.atan2(Ke-ct.y,Le-ct.x),Je=C(Zt-Ht+$e.theta),Gt=!0;if(ut.snapAngle>0){var Qt=ut.snapAngle,mi=ut.snapThreshold||Qt,Di=Math.ceil(Je/Qt)*Qt,wi=Math.floor(Je/Qt)*Qt;Math.abs(Je-wi)<mi?Je=wi:Math.abs(Je-Di)<mi&&(Je=Di)}return Je<0&&(Je=360+Je),Je%=360,Gt=ut.angle!==Je,ut.angle=Je,Gt}function W(Re,we,Le,Ke,$e){$e=$e||{};var ut=we.target,ct=ut.lockScalingX,Ht=ut.lockScalingY,Zt=$e.by,Je,Gt,Qt,mi,Di=Y(Re,ut),wi=ge(ut,Zt,Di),Ge,vt,Ri=we.gestureScale;if(wi)return!1;if(Ri)Gt=we.scaleX*Ri,Qt=we.scaleY*Ri;else{if(Je=Rt(we,we.originX,we.originY,Le,Ke),Ge=Zt!=="y"?A(Je.x):1,vt=Zt!=="x"?A(Je.y):1,we.signX||(we.signX=Ge),we.signY||(we.signY=vt),ut.lockScalingFlip&&(we.signX!==Ge||we.signY!==vt))return!1;if(mi=ut._getTransformedDimensions(),Di&&!Zt){var Ji=Math.abs(Je.x)+Math.abs(Je.y),si=we.original,Ei=Math.abs(mi.x*si.scaleX/ut.scaleX)+Math.abs(mi.y*si.scaleY/ut.scaleY),dr=Ji/Ei;Gt=si.scaleX*dr,Qt=si.scaleY*dr}else Gt=Math.abs(Je.x*ut.scaleX/mi.x),Qt=Math.abs(Je.y*ut.scaleY/mi.y);oe(we)&&(Gt*=2,Qt*=2),we.signX!==Ge&&Zt!=="y"&&(we.originX=S[we.originX],Gt*=-1,we.signX=Ge),we.signY!==vt&&Zt!=="x"&&(we.originY=S[we.originY],Qt*=-1,we.signY=vt)}var fr=ut.scaleX,Qi=ut.scaleY;return Zt?(Zt==="x"&&ut.set("scaleX",Gt),Zt==="y"&&ut.set("scaleY",Qt)):(!ct&&ut.set("scaleX",Gt),!Ht&&ut.set("scaleY",Qt)),fr!==ut.scaleX||Qi!==ut.scaleY}function re(Re,we,Le,Ke){return W(Re,we,Le,Ke)}function ye(Re,we,Le,Ke){return W(Re,we,Le,Ke,{by:"x"})}function Ae(Re,we,Le,Ke){return W(Re,we,Le,Ke,{by:"y"})}function be(Re,we,Le,Ke){return Re[we.target.canvas.altActionKey]?h.skewHandlerX(Re,we,Le,Ke):h.scalingY(Re,we,Le,Ke)}function Be(Re,we,Le,Ke){return Re[we.target.canvas.altActionKey]?h.skewHandlerY(Re,we,Le,Ke):h.scalingX(Re,we,Le,Ke)}function Ze(Re,we,Le,Ke){var $e=we.target,ut=Rt(we,we.originX,we.originY,Le,Ke),ct=$e.strokeWidth/($e.strokeUniform?$e.scaleX:1),Ht=oe(we)?2:1,Zt=$e.width,Je=Math.abs(ut.x*Ht/$e.scaleX)-ct;return $e.set("width",Math.max(Je,0)),Zt!==Je}function nt(Re,we,Le,Ke){var $e=we.target,ut=Le-we.offsetX,ct=Ke-we.offsetY,Ht=!$e.get("lockMovementX")&&$e.left!==ut,Zt=!$e.get("lockMovementY")&&$e.top!==ct;return Ht&&$e.set("left",ut),Zt&&$e.set("top",ct),(Ht||Zt)&&j("moving",st(Re,we,Le,Ke)),Ht||Zt}h.scaleCursorStyleHandler=De,h.skewCursorStyleHandler=qe,h.scaleSkewCursorStyleHandler=lt,h.rotationWithSnapping=it("rotating",yt(K)),h.scalingEqually=it("scaling",yt(re)),h.scalingX=it("scaling",yt(ye)),h.scalingY=it("scaling",yt(Ae)),h.scalingYOrSkewingX=be,h.scalingXOrSkewingY=Be,h.changeWidth=it("resizing",yt(Ze)),h.skewHandlerX=de,h.skewHandlerY=je,h.dragHandler=nt,h.scaleOrSkewActionName=_t,h.rotationStyleHandler=xt,h.fireEvent=j,h.wrapWithFixedAnchor=yt,h.wrapWithFireEvent=it,h.getLocalPoint=Rt,g.controlsUtils=h}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.degreesToRadians,v=g.controlsUtils;function h(c,f,_,u,S){u=u||{};var C=this.sizeX||u.cornerSize||S.cornerSize,A=this.sizeY||u.cornerSize||S.cornerSize,O=typeof u.transparentCorners<"u"?u.transparentCorners:S.transparentCorners,j=O?"stroke":"fill",Y=!O&&(u.cornerStrokeColor||S.cornerStrokeColor),oe=f,ge=_,De;c.save(),c.fillStyle=u.cornerColor||S.cornerColor,c.strokeStyle=u.cornerStrokeColor||S.cornerStrokeColor,C>A?(De=C,c.scale(1,A/C),ge=_*C/A):A>C?(De=A,c.scale(C/A,1),oe=f*A/C):De=C,c.lineWidth=1,c.beginPath(),c.arc(oe,ge,De/2,0,2*Math.PI,!1),c[j](),Y&&c.stroke(),c.restore()}function l(c,f,_,u,S){u=u||{};var C=this.sizeX||u.cornerSize||S.cornerSize,A=this.sizeY||u.cornerSize||S.cornerSize,O=typeof u.transparentCorners<"u"?u.transparentCorners:S.transparentCorners,j=O?"stroke":"fill",Y=!O&&(u.cornerStrokeColor||S.cornerStrokeColor),oe=C/2,ge=A/2;c.save(),c.fillStyle=u.cornerColor||S.cornerColor,c.strokeStyle=u.cornerStrokeColor||S.cornerStrokeColor,c.lineWidth=1,c.translate(f,_),c.rotate(x(S.angle)),c[j+"Rect"](-oe,-ge,C,A),Y&&c.strokeRect(-oe,-ge,C,A),c.restore()}v.renderCircleControl=h,v.renderSquareControl=l}(Fe),function(n){var g=n.fabric||(n.fabric={});function x(v){for(var h in v)this[h]=v[h]}g.Control=x,g.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(v,h){return h.cursorStyle},getActionName:function(v,h){return h.actionName},getVisibility:function(v,h){var l=v._controlsVisibility;return l&&typeof l[h]<"u"?l[h]:this.visible},setVisibility:function(v){this.visible=v},positionHandler:function(v,h){var l=g.util.transformPoint({x:this.x*v.x+this.offsetX,y:this.y*v.y+this.offsetY},h);return l},calcCornerCoords:function(v,h,l,c,f){var _,u,S,C,A=f?this.touchSizeX:this.sizeX,O=f?this.touchSizeY:this.sizeY;if(A&&O&&A!==O){var j=Math.atan2(O,A),Y=Math.sqrt(A*A+O*O)/2,oe=j-g.util.degreesToRadians(v),ge=Math.PI/2-j-g.util.degreesToRadians(v);_=Y*g.util.cos(oe),u=Y*g.util.sin(oe),S=Y*g.util.cos(ge),C=Y*g.util.sin(ge)}else{var De=A&&O?A:h;Y=De*.7071067812;var oe=g.util.degreesToRadians(45-v);_=S=Y*g.util.cos(oe),u=C=Y*g.util.sin(oe)}return{tl:{x:l-C,y:c-S},tr:{x:l+_,y:c-u},bl:{x:l-_,y:c+u},br:{x:l+C,y:c+S}}},render:function(v,h,l,c,f){switch(c=c||{},c.cornerStyle||f.cornerStyle){case"circle":g.controlsUtils.renderCircleControl.call(this,v,h,l,c,f);break;default:g.controlsUtils.renderSquareControl.call(this,v,h,l,c,f)}}}}(Fe),function(){function n(l,c){var f=l.getAttribute("style"),_=l.getAttribute("offset")||0,u,S,C,A;if(_=parseFloat(_)/(/%$/.test(_)?100:1),_=_<0?0:_>1?1:_,f){var O=f.split(/\s*;\s*/);for(O[O.length-1]===""&&O.pop(),A=O.length;A--;){var j=O[A].split(/\s*:\s*/),Y=j[0].trim(),oe=j[1].trim();Y==="stop-color"?u=oe:Y==="stop-opacity"&&(C=oe)}}return u||(u=l.getAttribute("stop-color")||"rgb(0,0,0)"),C||(C=l.getAttribute("stop-opacity")),u=new I.Color(u),S=u.getAlpha(),C=isNaN(parseFloat(C))?1:parseFloat(C),C*=S*c,{offset:_,color:u.toRgb(),opacity:C}}function g(l){return{x1:l.getAttribute("x1")||0,y1:l.getAttribute("y1")||0,x2:l.getAttribute("x2")||"100%",y2:l.getAttribute("y2")||0}}function x(l){return{x1:l.getAttribute("fx")||l.getAttribute("cx")||"50%",y1:l.getAttribute("fy")||l.getAttribute("cy")||"50%",r1:0,x2:l.getAttribute("cx")||"50%",y2:l.getAttribute("cy")||"50%",r2:l.getAttribute("r")||"50%"}}var v=I.util.object.clone;I.Gradient=I.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var c,f=this;Object.keys(l).forEach(function(_){f[_]=l[_]}),this.id?this.id+="_"+I.Object.__uid++:this.id=I.Object.__uid++,c={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(c.r1=l.coords.r1||0,c.r2=l.coords.r2||0),this.coords=c,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var c in l){var f=new I.Color(l[c]);this.colorStops.push({offset:parseFloat(c),color:f.toRgb(),opacity:f.getAlpha()})}return this},toObject:function(l){var c={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return I.util.populateWithProperties(this,c,l),c},toSVG:function(l,S){var f=v(this.coords,!0),_,u,S=S||{},C,A,O=v(this.colorStops,!0),j=f.r1>f.r2,Y=this.gradientTransform?this.gradientTransform.concat():I.iMatrix.concat(),oe=-this.offsetX,ge=-this.offsetY,De=!!S.additionalTransform,qe=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(O.sort(function(yt,it){return yt.offset-it.offset}),qe==="objectBoundingBox"?(oe/=l.width,ge/=l.height):(oe+=l.width/2,ge+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(oe-=l.pathOffset.x,ge-=l.pathOffset.y),Y[4]-=oe,Y[5]-=ge,A='id="SVGID_'+this.id+'" gradientUnits="'+qe+'"',A+=' gradientTransform="'+(De?S.additionalTransform+" ":"")+I.util.matrixToSVG(Y)+'" ',this.type==="linear"?C=["<linearGradient ",A,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(C=["<radialGradient ",A,' cx="',j?f.x1:f.x2,'" cy="',j?f.y1:f.y2,'" r="',j?f.r1:f.r2,'" fx="',j?f.x2:f.x1,'" fy="',j?f.y2:f.y1,`">
`]),this.type==="radial"){if(j)for(O=O.concat(),O.reverse(),_=0,u=O.length;_<u;_++)O[_].offset=1-O[_].offset;var lt=Math.min(f.r1,f.r2);if(lt>0){var _t=Math.max(f.r1,f.r2),xt=lt/_t;for(_=0,u=O.length;_<u;_++)O[_].offset+=xt*(1-O[_].offset)}}for(_=0,u=O.length;_<u;_++){var st=O[_];C.push("<stop ",'offset="',st.offset*100+"%",'" style="stop-color:',st.color,typeof st.opacity<"u"?";stop-opacity: "+st.opacity:";",`"/>
`)}return C.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),C.join("")},toLive:function(l){var c,f=I.util.object.clone(this.coords),_,u;if(!!this.type){for(this.type==="linear"?c=l.createLinearGradient(f.x1,f.y1,f.x2,f.y2):this.type==="radial"&&(c=l.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2)),_=0,u=this.colorStops.length;_<u;_++){var S=this.colorStops[_].color,C=this.colorStops[_].opacity,A=this.colorStops[_].offset;typeof C<"u"&&(S=new I.Color(S).setAlpha(C).toRgba()),c.addColorStop(A,S)}return c}}}),I.util.object.extend(I.Gradient,{fromElement:function(l,c,f,_){var u=parseFloat(f)/(/%$/.test(f)?100:1);u=u<0?0:u>1?1:u,isNaN(u)&&(u=1);var S=l.getElementsByTagName("stop"),C,A=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",O=l.getAttribute("gradientTransform")||"",j=[],Y,oe,ge=0,De=0,qe;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(C="linear",Y=g(l)):(C="radial",Y=x(l)),oe=S.length;oe--;)j.push(n(S[oe],u));qe=I.parseTransformAttribute(O),h(c,Y,_,A),A==="pixels"&&(ge=-c.left,De=-c.top);var lt=new I.Gradient({id:l.getAttribute("id"),type:C,coords:Y,colorStops:j,gradientUnits:A,gradientTransform:qe,offsetX:ge,offsetY:De});return lt}});function h(l,c,f,_){var u,S;Object.keys(c).forEach(function(C){u=c[C],u==="Infinity"?S=1:u==="-Infinity"?S=0:(S=parseFloat(c[C],10),typeof u=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(u)&&(S*=.01,_==="pixels"&&((C==="x1"||C==="x2"||C==="r2")&&(S*=f.viewBoxWidth||f.width),(C==="y1"||C==="y2")&&(S*=f.viewBoxHeight||f.height)))),c[C]=S})}}(),function(){var n=I.util.toFixed;I.Pattern=I.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(g,x){if(g||(g={}),this.id=I.Object.__uid++,this.setOptions(g),!g.source||g.source&&typeof g.source!="string"){x&&x(this);return}else{var v=this;this.source=I.util.createImage(),I.util.loadImage(g.source,function(h,l){v.source=h,x&&x(v,l)},null,this.crossOrigin)}},toObject:function(g){var x=I.Object.NUM_FRACTION_DIGITS,v,h;return typeof this.source.src=="string"?v=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(v=this.source.toDataURL()),h={type:"pattern",source:v,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:n(this.offsetX,x),offsetY:n(this.offsetY,x),patternTransform:this.patternTransform?this.patternTransform.concat():null},I.util.populateWithProperties(this,h,g),h},toSVG:function(g){var x=typeof this.source=="function"?this.source():this.source,v=x.width/g.width,h=x.height/g.height,l=this.offsetX/g.width,c=this.offsetY/g.height,f="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(h=1,c&&(h+=Math.abs(c))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(v=1,l&&(v+=Math.abs(l))),x.src?f=x.src:x.toDataURL&&(f=x.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+l+'" y="'+c+'" width="'+v+'" height="'+h+`">
<image x="0" y="0" width="`+x.width+'" height="'+x.height+'" xlink:href="'+f+`"></image>
</pattern>
`},setOptions:function(g){for(var x in g)this[x]=g[x]},toLive:function(g){var x=this.source;return!x||typeof x.src<"u"&&(!x.complete||x.naturalWidth===0||x.naturalHeight===0)?"":g.createPattern(x,this.repeat)}})}(),function(n){var g=n.fabric||(n.fabric={}),x=g.util.toFixed;if(g.Shadow){g.warn("fabric.Shadow is already defined.");return}g.Shadow=g.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(v){typeof v=="string"&&(v=this._parseShadow(v));for(var h in v)this[h]=v[h];this.id=g.Object.__uid++},_parseShadow:function(v){var h=v.trim(),l=g.Shadow.reOffsetsAndBlur.exec(h)||[],c=h.replace(g.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:c.trim(),offsetX:parseFloat(l[1],10)||0,offsetY:parseFloat(l[2],10)||0,blur:parseFloat(l[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(v){var h=40,l=40,c=g.Object.NUM_FRACTION_DIGITS,f=g.util.rotateVector({x:this.offsetX,y:this.offsetY},g.util.degreesToRadians(-v.angle)),_=20,u=new g.Color(this.color);return v.width&&v.height&&(h=x((Math.abs(f.x)+this.blur)/v.width,c)*100+_,l=x((Math.abs(f.y)+this.blur)/v.height,c)*100+_),v.flipX&&(f.x*=-1),v.flipY&&(f.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+l+'%" height="'+(100+2*l)+'%" x="-'+h+'%" width="'+(100+2*h)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+x(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+x(f.x,c)+'" dy="'+x(f.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+u.toRgb()+'" flood-opacity="'+u.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var v={},h=g.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(l){this[l]!==h[l]&&(v[l]=this[l])},this),v}}),g.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(Fe),function(){if(I.StaticCanvas){I.warn("fabric.StaticCanvas is already defined.");return}var n=I.util.object.extend,g=I.util.getElementOffset,x=I.util.removeFromArray,v=I.util.toFixed,h=I.util.transformPoint,l=I.util.invertTransform,c=I.util.getNodeCanvas,f=I.util.createCanvasElement,_=new Error("Could not initialize `canvas` element");I.StaticCanvas=I.util.createClass(I.CommonMethods,{initialize:function(u,S){S||(S={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(u,S)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:I.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(u,S){var C=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(u),this._initOptions(S),this.interactive||this._initRetinaScaling(),S.overlayImage&&this.setOverlayImage(S.overlayImage,C),S.backgroundImage&&this.setBackgroundImage(S.backgroundImage,C),S.backgroundColor&&this.setBackgroundColor(S.backgroundColor,C),S.overlayColor&&this.setOverlayColor(S.overlayColor,C),this.calcOffset()},_isRetinaScaling:function(){return I.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,I.devicePixelRatio):1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var u=I.devicePixelRatio;this.__initRetinaScaling(u,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(u,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(u,S,C){S.setAttribute("width",this.width*u),S.setAttribute("height",this.height*u),C.scale(u,u)},calcOffset:function(){return this._offset=g(this.lowerCanvasEl),this},setOverlayImage:function(u,S,C){return this.__setBgOverlayImage("overlayImage",u,S,C)},setBackgroundImage:function(u,S,C){return this.__setBgOverlayImage("backgroundImage",u,S,C)},setOverlayColor:function(u,S){return this.__setBgOverlayColor("overlayColor",u,S)},setBackgroundColor:function(u,S){return this.__setBgOverlayColor("backgroundColor",u,S)},__setBgOverlayImage:function(u,S,C,A){return typeof S=="string"?I.util.loadImage(S,function(O,j){if(O){var Y=new I.Image(O,A);this[u]=Y,Y.canvas=this}C&&C(O,j)},this,A&&A.crossOrigin):(A&&S.setOptions(A),this[u]=S,S&&(S.canvas=this),C&&C(S,!1)),this},__setBgOverlayColor:function(u,S,C){return this[u]=S,this._initGradient(S,u),this._initPattern(S,u,C),this},_createCanvasElement:function(){var u=f();if(!u||(u.style||(u.style={}),typeof u.getContext>"u"))throw _;return u},_initOptions:function(u){var S=this.lowerCanvasEl;this._setOptions(u),this.width=this.width||parseInt(S.width,10)||0,this.height=this.height||parseInt(S.height,10)||0,this.lowerCanvasEl.style&&(S.width=this.width,S.height=this.height,S.style.width=this.width+"px",S.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(u){u&&u.getContext?this.lowerCanvasEl=u:this.lowerCanvasEl=I.util.getById(u)||this._createCanvasElement(),I.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(u,S){return this.setDimensions({width:u},S)},setHeight:function(u,S){return this.setDimensions({height:u},S)},setDimensions:function(u,S){var C;S=S||{};for(var A in u)C=u[A],S.cssOnly||(this._setBackstoreDimension(A,u[A]),C+="px",this.hasLostContext=!0),S.backstoreOnly||this._setCssDimension(A,C);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),S.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(u,S){return this.lowerCanvasEl[u]=S,this.upperCanvasEl&&(this.upperCanvasEl[u]=S),this.cacheCanvasEl&&(this.cacheCanvasEl[u]=S),this[u]=S,this},_setCssDimension:function(u,S){return this.lowerCanvasEl.style[u]=S,this.upperCanvasEl&&(this.upperCanvasEl.style[u]=S),this.wrapperEl&&(this.wrapperEl.style[u]=S),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(u){var S=this._activeObject,C=this.backgroundImage,A=this.overlayImage,O,j,Y;for(this.viewportTransform=u,j=0,Y=this._objects.length;j<Y;j++)O=this._objects[j],O.group||O.setCoords(!0);return S&&S.setCoords(),C&&C.setCoords(!0),A&&A.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(u,S){var C=u,A=this.viewportTransform.slice(0);u=h(u,l(this.viewportTransform)),A[0]=S,A[3]=S;var O=h(u,A);return A[4]+=C.x-O.x,A[5]+=C.y-O.y,this.setViewportTransform(A)},setZoom:function(u){return this.zoomToPoint(new I.Point(0,0),u),this},absolutePan:function(u){var S=this.viewportTransform.slice(0);return S[4]=-u.x,S[5]=-u.y,this.setViewportTransform(S)},relativePan:function(u){return this.absolutePan(new I.Point(-u.x-this.viewportTransform[4],-u.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(u){this.stateful&&u.setupState(),u._set("canvas",this),u.setCoords(),this.fire("object:added",{target:u}),u.fire("added")},_onObjectRemoved:function(u){this.fire("object:removed",{target:u}),u.fire("removed"),delete u.canvas},clearContext:function(u){return u.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var u=this.contextContainer;return this.renderCanvas(u,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=I.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var u={},S=this.width,C=this.height,A=l(this.viewportTransform);return u.tl=h({x:0,y:0},A),u.br=h({x:S,y:C},A),u.tr=new I.Point(u.br.x,u.tl.y),u.bl=new I.Point(u.tl.x,u.br.y),this.vptCoords=u,u},cancelRequestedRender:function(){this.isRendering&&(I.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(u,S){var C=this.viewportTransform,A=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(u),I.util.setImageSmoothing(u,this.imageSmoothingEnabled),this.fire("before:render",{ctx:u}),this._renderBackground(u),u.save(),u.transform(C[0],C[1],C[2],C[3],C[4],C[5]),this._renderObjects(u,S),u.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(u),A&&(A.canvas=this,A.shouldCache(),A._transformDone=!0,A.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(u)),this._renderOverlay(u),this.controlsAboveOverlay&&this.interactive&&this.drawControls(u),this.fire("after:render",{ctx:u})},drawClipPathOnCanvas:function(u){var S=this.viewportTransform,C=this.clipPath;u.save(),u.transform(S[0],S[1],S[2],S[3],S[4],S[5]),u.globalCompositeOperation="destination-in",C.transform(u),u.scale(1/C.zoomX,1/C.zoomY),u.drawImage(C._cacheCanvas,-C.cacheTranslationX,-C.cacheTranslationY),u.restore()},_renderObjects:function(u,S){var C,A;for(C=0,A=S.length;C<A;++C)S[C]&&S[C].render(u)},_renderBackgroundOrOverlay:function(u,S){var C=this[S+"Color"],A=this[S+"Image"],O=this.viewportTransform,j=this[S+"Vpt"];if(!(!C&&!A)){if(C){u.save(),u.beginPath(),u.moveTo(0,0),u.lineTo(this.width,0),u.lineTo(this.width,this.height),u.lineTo(0,this.height),u.closePath(),u.fillStyle=C.toLive?C.toLive(u,this):C,j&&u.transform(O[0],O[1],O[2],O[3],O[4],O[5]),u.transform(1,0,0,1,C.offsetX||0,C.offsetY||0);var Y=C.gradientTransform||C.patternTransform;Y&&u.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),u.fill(),u.restore()}A&&(u.save(),j&&u.transform(O[0],O[1],O[2],O[3],O[4],O[5]),A.render(u),u.restore())}},_renderBackground:function(u){this._renderBackgroundOrOverlay(u,"background")},_renderOverlay:function(u){this._renderBackgroundOrOverlay(u,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new I.Point(this.width/2,this.height/2)},centerObjectH:function(u){return this._centerObject(u,new I.Point(this.getCenterPoint().x,u.getCenterPoint().y))},centerObjectV:function(u){return this._centerObject(u,new I.Point(u.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(u){var S=this.getCenterPoint();return this._centerObject(u,S)},viewportCenterObject:function(u){var S=this.getVpCenter();return this._centerObject(u,S)},viewportCenterObjectH:function(u){var S=this.getVpCenter();return this._centerObject(u,new I.Point(S.x,u.getCenterPoint().y)),this},viewportCenterObjectV:function(u){var S=this.getVpCenter();return this._centerObject(u,new I.Point(u.getCenterPoint().x,S.y))},getVpCenter:function(){var u=this.getCenterPoint(),S=l(this.viewportTransform);return h(u,S)},_centerObject:function(u,S){return u.setPositionByOrigin(S,"center","center"),u.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(u){return this.toDatalessObject(u)},toObject:function(u){return this._toObjectMethod("toObject",u)},toDatalessObject:function(u){return this._toObjectMethod("toDatalessObject",u)},_toObjectMethod:function(u,S){var C=this.clipPath,A={version:I.version,objects:this._toObjects(u,S)};return C&&!C.excludeFromExport&&(A.clipPath=this._toObject(this.clipPath,u,S)),n(A,this.__serializeBgOverlay(u,S)),I.util.populateWithProperties(this,A,S),A},_toObjects:function(u,S){return this._objects.filter(function(C){return!C.excludeFromExport}).map(function(C){return this._toObject(C,u,S)},this)},_toObject:function(u,S,C){var A;this.includeDefaultValues||(A=u.includeDefaultValues,u.includeDefaultValues=!1);var O=u[S](C);return this.includeDefaultValues||(u.includeDefaultValues=A),O},__serializeBgOverlay:function(u,S){var C={},A=this.backgroundImage,O=this.overlayImage,j=this.backgroundColor,Y=this.overlayColor;return j&&j.toObject?j.excludeFromExport||(C.background=j.toObject(S)):j&&(C.background=j),Y&&Y.toObject?Y.excludeFromExport||(C.overlay=Y.toObject(S)):Y&&(C.overlay=Y),A&&!A.excludeFromExport&&(C.backgroundImage=this._toObject(A,u,S)),O&&!O.excludeFromExport&&(C.overlayImage=this._toObject(O,u,S)),C},svgViewportTransformation:!0,toSVG:function(u,S){u||(u={}),u.reviver=S;var C=[];return this._setSVGPreamble(C,u),this._setSVGHeader(C,u),this.clipPath&&C.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(C,"background"),this._setSVGBgOverlayImage(C,"backgroundImage",S),this._setSVGObjects(C,S),this.clipPath&&C.push(`</g>
`),this._setSVGBgOverlayColor(C,"overlay"),this._setSVGBgOverlayImage(C,"overlayImage",S),C.push("</svg>"),C.join("")},_setSVGPreamble:function(u,S){S.suppressPreamble||u.push('<?xml version="1.0" encoding="',S.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(u,S){var C=S.width||this.width,A=S.height||this.height,O,j='viewBox="0 0 '+this.width+" "+this.height+'" ',Y=I.Object.NUM_FRACTION_DIGITS;S.viewBox?j='viewBox="'+S.viewBox.x+" "+S.viewBox.y+" "+S.viewBox.width+" "+S.viewBox.height+'" ':this.svgViewportTransformation&&(O=this.viewportTransform,j='viewBox="'+v(-O[4]/O[0],Y)+" "+v(-O[5]/O[3],Y)+" "+v(this.width/O[0],Y)+" "+v(this.height/O[3],Y)+'" '),u.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',C,'" ','height="',A,'" ',j,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",I.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(S),`</defs>
`)},createSVGClipPathMarkup:function(u){var S=this.clipPath;return S?(S.clipPathId="CLIPPATH_"+I.Object.__uid++,'<clipPath id="'+S.clipPathId+`" >
`+this.clipPath.toClipPathSVG(u.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var u=this,S=["background","overlay"].map(function(C){var A=u[C+"Color"];if(A&&A.toLive){var O=u[C+"Vpt"],j=u.viewportTransform,Y={width:u.width/(O?j[0]:1),height:u.height/(O?j[3]:1)};return A.toSVG(Y,{additionalTransform:O?I.util.matrixToSVG(j):""})}});return S.join("")},createSVGFontFacesMarkup:function(){var u="",S={},C,A,O,j,Y,oe,ge,De,qe,lt=I.fontPaths,_t=[];for(this._objects.forEach(function st(yt){_t.push(yt),yt._objects&&yt._objects.forEach(st)}),De=0,qe=_t.length;De<qe;De++)if(C=_t[De],A=C.fontFamily,!(C.type.indexOf("text")===-1||S[A]||!lt[A])&&(S[A]=!0,!!C.styles)){O=C.styles;for(Y in O){j=O[Y];for(ge in j)oe=j[ge],A=oe.fontFamily,!S[A]&&lt[A]&&(S[A]=!0)}}for(var xt in S)u+=[`		@font-face {
`,"			font-family: '",xt,`';
`,"			src: url('",lt[xt],`');
`,`		}
`].join("");return u&&(u=['	<style type="text/css">',`<![CDATA[
`,u,"]]>",`</style>
`].join("")),u},_setSVGObjects:function(u,S){var C,A,O,j=this._objects;for(A=0,O=j.length;A<O;A++)C=j[A],!C.excludeFromExport&&this._setSVGObject(u,C,S)},_setSVGObject:function(u,S,C){u.push(S.toSVG(C))},_setSVGBgOverlayImage:function(u,S,C){this[S]&&!this[S].excludeFromExport&&this[S].toSVG&&u.push(this[S].toSVG(C))},_setSVGBgOverlayColor:function(u,S){var C=this[S+"Color"],A=this.viewportTransform,O=this.width,j=this.height;if(!!C)if(C.toLive){var Y=C.repeat,oe=I.util.invertTransform(A),ge=this[S+"Vpt"],De=ge?I.util.matrixToSVG(oe):"";u.push('<rect transform="'+De+" translate(",O/2,",",j/2,')"',' x="',C.offsetX-O/2,'" y="',C.offsetY-j/2,'" ','width="',Y==="repeat-y"||Y==="no-repeat"?C.source.width:O,'" height="',Y==="repeat-x"||Y==="no-repeat"?C.source.height:j,'" fill="url(#SVGID_'+C.id+')"',`></rect>
`)}else u.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',C,'"',`></rect>
`)},sendToBack:function(u){if(!u)return this;var S=this._activeObject,C,A,O;if(u===S&&u.type==="activeSelection")for(O=S._objects,C=O.length;C--;)A=O[C],x(this._objects,A),this._objects.unshift(A);else x(this._objects,u),this._objects.unshift(u);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(u){if(!u)return this;var S=this._activeObject,C,A,O;if(u===S&&u.type==="activeSelection")for(O=S._objects,C=0;C<O.length;C++)A=O[C],x(this._objects,A),this._objects.push(A);else x(this._objects,u),this._objects.push(u);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(u,S){if(!u)return this;var C=this._activeObject,A,O,j,Y,oe,ge=0;if(u===C&&u.type==="activeSelection")for(oe=C._objects,A=0;A<oe.length;A++)O=oe[A],j=this._objects.indexOf(O),j>0+ge&&(Y=j-1,x(this._objects,O),this._objects.splice(Y,0,O)),ge++;else j=this._objects.indexOf(u),j!==0&&(Y=this._findNewLowerIndex(u,j,S),x(this._objects,u),this._objects.splice(Y,0,u));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(u,S,C){var A,O;if(C)for(A=S,O=S-1;O>=0;--O){var j=u.intersectsWithObject(this._objects[O])||u.isContainedWithinObject(this._objects[O])||this._objects[O].isContainedWithinObject(u);if(j){A=O;break}}else A=S-1;return A},bringForward:function(u,S){if(!u)return this;var C=this._activeObject,A,O,j,Y,oe,ge=0;if(u===C&&u.type==="activeSelection")for(oe=C._objects,A=oe.length;A--;)O=oe[A],j=this._objects.indexOf(O),j<this._objects.length-1-ge&&(Y=j+1,x(this._objects,O),this._objects.splice(Y,0,O)),ge++;else j=this._objects.indexOf(u),j!==this._objects.length-1&&(Y=this._findNewUpperIndex(u,j,S),x(this._objects,u),this._objects.splice(Y,0,u));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(u,S,C){var A,O,j;if(C)for(A=S,O=S+1,j=this._objects.length;O<j;++O){var Y=u.intersectsWithObject(this._objects[O])||u.isContainedWithinObject(this._objects[O])||this._objects[O].isContainedWithinObject(u);if(Y){A=O;break}}else A=S+1;return A},moveTo:function(u,S){return x(this._objects,u),this._objects.splice(S,0,u),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(I.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(u){u.dispose&&u.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),I.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),I.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),n(I.StaticCanvas.prototype,I.Observable),n(I.StaticCanvas.prototype,I.Collection),n(I.StaticCanvas.prototype,I.DataURLExporter),n(I.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(u){var S=f();if(!S||!S.getContext)return null;var C=S.getContext("2d");if(!C)return null;switch(u){case"setLineDash":return typeof C.setLineDash<"u";default:return null}}}),I.StaticCanvas.prototype.toJSON=I.StaticCanvas.prototype.toObject,I.isLikelyNode&&(I.StaticCanvas.prototype.createPNGStream=function(){var u=c(this.lowerCanvasEl);return u&&u.createPNGStream()},I.StaticCanvas.prototype.createJPEGStream=function(u){var S=c(this.lowerCanvasEl);return S&&S.createJPEGStream(u)})}(),I.BaseBrush=I.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(n){n.strokeStyle=this.color,n.lineWidth=this.width,n.lineCap=this.strokeLineCap,n.miterLimit=this.strokeMiterLimit,n.lineJoin=this.strokeLineJoin,n.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(n){var g=this.canvas.viewportTransform;n.save(),n.transform(g[0],g[1],g[2],g[3],g[4],g[5])},_setShadow:function(){if(!!this.shadow){var n=this.canvas,g=this.shadow,x=n.contextTop,v=n.getZoom();n&&n._isRetinaScaling()&&(v*=I.devicePixelRatio),x.shadowColor=g.color,x.shadowBlur=g.blur*v,x.shadowOffsetX=g.offsetX*v,x.shadowOffsetY=g.offsetY*v}},needsFullRender:function(){var n=new I.Color(this.color);return n.getAlpha()<1||!!this.shadow},_resetShadow:function(){var n=this.canvas.contextTop;n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0},_isOutSideCanvas:function(n){return n.x<0||n.x>this.canvas.getWidth()||n.y<0||n.y>this.canvas.getHeight()}}),function(){I.PencilBrush=I.util.createClass(I.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(n){this.canvas=n,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(n,g,x){var v=g.midPointFrom(x);return n.quadraticCurveTo(g.x,g.y,v.x,v.y),v},onMouseDown:function(n,g){!this.canvas._isMainEvent(g.e)||(this.drawStraightLine=g.e[this.straightLineKey],this._prepareForDrawing(n),this._captureDrawingPath(n),this._render())},onMouseMove:function(n,g){if(!!this.canvas._isMainEvent(g.e)&&(this.drawStraightLine=g.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(n))&&this._captureDrawingPath(n)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var x=this._points,v=x.length,h=this.canvas.contextTop;this._saveAndTransform(h),this.oldEnd&&(h.beginPath(),h.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(h,x[v-2],x[v-1],!0),h.stroke(),h.restore()}},onMouseUp:function(n){return this.canvas._isMainEvent(n.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(n){var g=new I.Point(n.x,n.y);this._reset(),this._addPoint(g),this.canvas.contextTop.moveTo(g.x,g.y)},_addPoint:function(n){return this._points.length>1&&n.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(n),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(n){var g=new I.Point(n.x,n.y);return this._addPoint(g)},_render:function(n){var g,x,v=this._points[0],h=this._points[1];if(n=n||this.canvas.contextTop,this._saveAndTransform(n),n.beginPath(),this._points.length===2&&v.x===h.x&&v.y===h.y){var l=this.width/1e3;v=new I.Point(v.x,v.y),h=new I.Point(h.x,h.y),v.x-=l,h.x+=l}for(n.moveTo(v.x,v.y),g=1,x=this._points.length;g<x;g++)this._drawSegment(n,v,h),v=this._points[g],h=this._points[g+1];n.lineTo(v.x,v.y),n.stroke(),n.restore()},convertPointsToSVGPath:function(n){var g=this.width/1e3;return I.util.getSmoothPathFromPoints(n,g)},_isEmptySVGPath:function(n){var g=I.util.joinPath(n);return g==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(n){var g=new I.Path(n,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,g.shadow=new I.Shadow(this.shadow)),g},decimatePoints:function(n,g){if(n.length<=2)return n;var x=this.canvas.getZoom(),v=Math.pow(g/x,2),h,l=n.length-1,c=n[0],f=[c],_;for(h=1;h<l-1;h++)_=Math.pow(c.x-n[h].x,2)+Math.pow(c.y-n[h].y,2),_>=v&&(c=n[h],f.push(c));return f.push(n[l]),f},_finalizeAndAddPath:function(){var n=this.canvas.contextTop;n.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var g=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(g)){this.canvas.requestRenderAll();return}var x=this.createPath(g);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:x}),this.canvas.add(x),this.canvas.requestRenderAll(),x.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:x})}})}(),I.CircleBrush=I.util.createClass(I.BaseBrush,{width:10,initialize:function(n){this.canvas=n,this.points=[]},drawDot:function(n){var g=this.addPoint(n),x=this.canvas.contextTop;this._saveAndTransform(x),this.dot(x,g),x.restore()},dot:function(n,g){n.fillStyle=g.fill,n.beginPath(),n.arc(g.x,g.y,g.radius,0,Math.PI*2,!1),n.closePath(),n.fill()},onMouseDown:function(n){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(n)},_render:function(){var n=this.canvas.contextTop,g,x,v=this.points;for(this._saveAndTransform(n),g=0,x=v.length;g<x;g++)this.dot(n,v[g]);n.restore()},onMouseMove:function(n){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(n)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(n),this._render()):this.drawDot(n))},onMouseUp:function(){var n=this.canvas.renderOnAddRemove,g,x;this.canvas.renderOnAddRemove=!1;var v=[];for(g=0,x=this.points.length;g<x;g++){var h=this.points[g],l=new I.Circle({radius:h.radius,left:h.x,top:h.y,originX:"center",originY:"center",fill:h.fill});this.shadow&&(l.shadow=new I.Shadow(this.shadow)),v.push(l)}var c=new I.Group(v);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=n,this.canvas.requestRenderAll()},addPoint:function(n){var g=new I.Point(n.x,n.y),x=I.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,v=new I.Color(this.color).setAlpha(I.util.getRandomInt(0,100)/100).toRgba();return g.radius=x,g.fill=v,this.points.push(g),g}}),I.SprayBrush=I.util.createClass(I.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(n){this.canvas=n,this.sprayChunks=[]},onMouseDown:function(n){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(n),this.render(this.sprayChunkPoints)},onMouseMove:function(n){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(n)||(this.addSprayChunk(n),this.render(this.sprayChunkPoints))},onMouseUp:function(){var n=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var g=[],x=0,v=this.sprayChunks.length;x<v;x++)for(var h=this.sprayChunks[x],l=0,c=h.length;l<c;l++){var f=new I.Rect({width:h[l].width,height:h[l].width,left:h[l].x+1,top:h[l].y+1,originX:"center",originY:"center",fill:this.color});g.push(f)}this.optimizeOverlapping&&(g=this._getOptimizedRects(g));var _=new I.Group(g);this.shadow&&_.set("shadow",new I.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:_}),this.canvas.add(_),this.canvas.fire("path:created",{path:_}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=n,this.canvas.requestRenderAll()},_getOptimizedRects:function(n){var g={},x,v,h;for(v=0,h=n.length;v<h;v++)x=n[v].left+""+n[v].top,g[x]||(g[x]=n[v]);var l=[];for(x in g)l.push(g[x]);return l},render:function(n){var g=this.canvas.contextTop,x,v;for(g.fillStyle=this.color,this._saveAndTransform(g),x=0,v=n.length;x<v;x++){var h=n[x];typeof h.opacity<"u"&&(g.globalAlpha=h.opacity),g.fillRect(h.x,h.y,h.width,h.width)}g.restore()},_render:function(){var n=this.canvas.contextTop,g,x;for(n.fillStyle=this.color,this._saveAndTransform(n),g=0,x=this.sprayChunks.length;g<x;g++)this.render(this.sprayChunks[g]);n.restore()},addSprayChunk:function(n){this.sprayChunkPoints=[];var g,x,v,h=this.width/2,l;for(l=0;l<this.density;l++){g=I.util.getRandomInt(n.x-h,n.x+h),x=I.util.getRandomInt(n.y-h,n.y+h),this.dotWidthVariance?v=I.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):v=this.dotWidth;var c=new I.Point(g,x);c.width=v,this.randomOpacity&&(c.opacity=I.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),I.PatternBrush=I.util.createClass(I.PencilBrush,{getPatternSrc:function(){var n=20,g=5,x=I.util.createCanvasElement(),v=x.getContext("2d");return x.width=x.height=n+g,v.fillStyle=this.color,v.beginPath(),v.arc(n/2,n/2,n/2,0,Math.PI*2,!1),v.closePath(),v.fill(),x},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(n){return n.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(n){this.callSuper("_setBrushStyles",n),n.strokeStyle=this.getPattern(n)},createPath:function(n){var g=this.callSuper("createPath",n),x=g._getLeftTopCoords().scalarAdd(g.strokeWidth/2);return g.stroke=new I.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-x.x,offsetY:-x.y}),g}}),function(){var n=I.util.getPointer,g=I.util.degreesToRadians,x=I.util.isTouchEvent;I.Canvas=I.util.createClass(I.StaticCanvas,{initialize:function(h,l){l||(l={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(h,l),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=I.PencilBrush&&new I.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var h=this.getActiveObjects(),l,c,f;if(h.length>0&&!this.preserveObjectStacking){c=[],f=[];for(var _=0,u=this._objects.length;_<u;_++)l=this._objects[_],h.indexOf(l)===-1?c.push(l):f.push(l);h.length>1&&(this._activeObject._objects=f),c.push.apply(c,f)}else c=this._objects;return c},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var h=this.contextContainer;return this.renderCanvas(h,this._chooseObjectsToRender()),this},renderTopLayer:function(h){h.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(h),this.contextTopDirty=!0),h.restore()},renderTop:function(){var h=this.contextTop;return this.clearContext(h),this.renderTopLayer(h),this.fire("after:render"),this},_normalizePointer:function(h,l){var c=h.calcTransformMatrix(),f=I.util.invertTransform(c),_=this.restorePointerVpt(l);return I.util.transformPoint(_,f)},isTargetTransparent:function(h,l,c){if(h.shouldCache()&&h._cacheCanvas&&h!==this._activeObject){var f=this._normalizePointer(h,{x:l,y:c}),_=Math.max(h.cacheTranslationX+f.x*h.zoomX,0),u=Math.max(h.cacheTranslationY+f.y*h.zoomY,0),O=I.util.isTransparent(h._cacheContext,Math.round(_),Math.round(u),this.targetFindTolerance);return O}var S=this.contextCache,C=h.selectionBackgroundColor,A=this.viewportTransform;h.selectionBackgroundColor="",this.clearContext(S),S.save(),S.transform(A[0],A[1],A[2],A[3],A[4],A[5]),h.render(S),S.restore(),h.selectionBackgroundColor=C;var O=I.util.isTransparent(S,l,c,this.targetFindTolerance);return O},_isSelectionKeyPressed:function(h){var l=!1;return Array.isArray(this.selectionKey)?l=!!this.selectionKey.find(function(c){return h[c]===!0}):l=h[this.selectionKey],l},_shouldClearSelection:function(h,l){var c=this.getActiveObjects(),f=this._activeObject;return!l||l&&f&&c.length>1&&c.indexOf(l)===-1&&f!==l&&!this._isSelectionKeyPressed(h)||l&&!l.evented||l&&!l.selectable&&f&&f!==l},_shouldCenterTransform:function(h,l,c){if(!!h){var f;return l==="scale"||l==="scaleX"||l==="scaleY"||l==="resizing"?f=this.centeredScaling||h.centeredScaling:l==="rotate"&&(f=this.centeredRotation||h.centeredRotation),f?!c:c}},_getOriginFromCorner:function(h,l){var c={x:h.originX,y:h.originY};return l==="ml"||l==="tl"||l==="bl"?c.x="right":(l==="mr"||l==="tr"||l==="br")&&(c.x="left"),l==="tl"||l==="mt"||l==="tr"?c.y="bottom":(l==="bl"||l==="mb"||l==="br")&&(c.y="top"),c},_getActionFromCorner:function(h,l,c,f){if(!l||!h)return"drag";var _=f.controls[l];return _.getActionName(c,_,f)},_setupCurrentTransform:function(h,l,c){if(!!l){var f=this.getPointer(h),_=l.__corner,u=l.controls[_],S=c&&_?u.getActionHandler(h,l,u):I.controlsUtils.dragHandler,C=this._getActionFromCorner(c,_,h,l),A=this._getOriginFromCorner(l,_),O=h[this.centeredKey],j={target:l,action:C,actionHandler:S,corner:_,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,offsetX:f.x-l.left,offsetY:f.y-l.top,originX:A.x,originY:A.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,theta:g(l.angle),width:l.width*l.scaleX,shiftKey:h.shiftKey,altKey:O,original:I.util.saveObjectTransform(l)};this._shouldCenterTransform(l,C,O)&&(j.originX="center",j.originY="center"),j.original.originX=A.x,j.original.originY=A.y,this._currentTransform=j,this._beforeTransform(h)}},setCursor:function(h){this.upperCanvasEl.style.cursor=h},_drawSelection:function(h){var l=this._groupSelector,c=new I.Point(l.ex,l.ey),f=I.util.transformPoint(c,this.viewportTransform),_=new I.Point(l.ex+l.left,l.ey+l.top),u=I.util.transformPoint(_,this.viewportTransform),S=Math.min(f.x,u.x),C=Math.min(f.y,u.y),A=Math.max(f.x,u.x),O=Math.max(f.y,u.y),j=this.selectionLineWidth/2;this.selectionColor&&(h.fillStyle=this.selectionColor,h.fillRect(S,C,A-S,O-C)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(h.lineWidth=this.selectionLineWidth,h.strokeStyle=this.selectionBorderColor,S+=j,C+=j,A-=j,O-=j,I.Object.prototype._setLineDash.call(this,h,this.selectionDashArray),h.strokeRect(S,C,A-S,O-C))},findTarget:function(h,l){if(!this.skipTargetFind){var c=!0,f=this.getPointer(h,c),_=this._activeObject,u=this.getActiveObjects(),S,C,A=x(h),O=u.length>1&&!l||u.length===1;if(this.targets=[],O&&_._findTargetCorner(f,A)||u.length>1&&!l&&_===this._searchPossibleTargets([_],f))return _;if(u.length===1&&_===this._searchPossibleTargets([_],f))if(this.preserveObjectStacking)S=_,C=this.targets,this.targets=[];else return _;var j=this._searchPossibleTargets(this._objects,f);return h[this.altSelectionKey]&&j&&S&&j!==S&&(j=S,this.targets=C),j}},_checkTarget:function(h,l,c){if(l&&l.visible&&l.evented&&l.containsPoint(h))if((this.perPixelTargetFind||l.perPixelTargetFind)&&!l.isEditing){var f=this.isTargetTransparent(l,c.x,c.y);if(!f)return!0}else return!0},_searchPossibleTargets:function(h,l){for(var c,f=h.length,_;f--;){var u=h[f],S=u.group?this._normalizePointer(u.group,l):l;if(this._checkTarget(S,u,l)){c=h[f],c.subTargetCheck&&c instanceof I.Group&&(_=this._searchPossibleTargets(c._objects,l),_&&this.targets.push(_));break}}return c},restorePointerVpt:function(h){return I.util.transformPoint(h,I.util.invertTransform(this.viewportTransform))},getPointer:function(h,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var c=n(h),f=this.upperCanvasEl,_=f.getBoundingClientRect(),u=_.width||0,S=_.height||0,C;(!u||!S)&&("top"in _&&"bottom"in _&&(S=Math.abs(_.top-_.bottom)),"right"in _&&"left"in _&&(u=Math.abs(_.right-_.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,l||(c=this.restorePointerVpt(c));var A=this.getRetinaScaling();return A!==1&&(c.x/=A,c.y/=A),u===0||S===0?C={width:1,height:1}:C={width:f.width/u,height:f.height/S},{x:c.x*C.width,y:c.y*C.height}},_createUpperCanvas:function(){var h=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),l=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),I.util.addClass(c,"upper-canvas "+h),this.wrapperEl.appendChild(c),this._copyCanvasStyle(l,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=I.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),I.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),I.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(h){var l=this.width||h.width,c=this.height||h.height;I.util.setStyle(h,{position:"absolute",width:l+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),h.width=l,h.height=c,I.util.makeElementUnselectable(h)},_copyCanvasStyle:function(h,l){l.style.cssText=h.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var h=this._activeObject;return h?h.type==="activeSelection"&&h._objects?h._objects.slice(0):[h]:[]},_onObjectRemoved:function(h){h===this._activeObject&&(this.fire("before:selection:cleared",{target:h}),this._discardActiveObject(),this.fire("selection:cleared",{target:h}),h.fire("deselected")),h===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",h)},_fireSelectionEvents:function(h,l){var c=!1,f=this.getActiveObjects(),_=[],u=[];h.forEach(function(S){f.indexOf(S)===-1&&(c=!0,S.fire("deselected",{e:l,target:S}),u.push(S))}),f.forEach(function(S){h.indexOf(S)===-1&&(c=!0,S.fire("selected",{e:l,target:S}),_.push(S))}),h.length>0&&f.length>0?c&&this.fire("selection:updated",{e:l,selected:_,deselected:u}):f.length>0?this.fire("selection:created",{e:l,selected:_}):h.length>0&&this.fire("selection:cleared",{e:l,deselected:u})},setActiveObject:function(h,l){var c=this.getActiveObjects();return this._setActiveObject(h,l),this._fireSelectionEvents(c,l),this},_setActiveObject:function(h,l){return this._activeObject===h||!this._discardActiveObject(l,h)||h.onSelect({e:l})?!1:(this._activeObject=h,!0)},_discardActiveObject:function(h,l){var c=this._activeObject;if(c){if(c.onDeselect({e:h,object:l}))return!1;this._activeObject=null}return!0},discardActiveObject:function(h){var l=this.getActiveObjects(),c=this.getActiveObject();return l.length&&this.fire("before:selection:cleared",{target:c,e:h}),this._discardActiveObject(h),this._fireSelectionEvents(l,h),this},dispose:function(){var h=this.wrapperEl;return this.removeListeners(),h.removeChild(this.upperCanvasEl),h.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(l){I.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this)),h.parentNode&&h.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,I.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(h){var l=this._activeObject;l&&l._renderControls(h)},_toObject:function(h,l,c){var f=this._realizeGroupTransformOnObject(h),_=this.callSuper("_toObject",h,l,c);return this._unwindGroupTransformOnObject(h,f),_},_realizeGroupTransformOnObject:function(h){if(h.group&&h.group.type==="activeSelection"&&this._activeObject===h.group){var l=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return l.forEach(function(f){c[f]=h[f]}),I.util.addTransformToObject(h,this._activeObject.calcOwnMatrix()),c}else return null},_unwindGroupTransformOnObject:function(h,l){l&&h.set(l)},_setSVGObject:function(h,l,c){var f=this._realizeGroupTransformOnObject(l);this.callSuper("_setSVGObject",h,l,c),this._unwindGroupTransformOnObject(l,f)},setViewportTransform:function(h){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),I.StaticCanvas.prototype.setViewportTransform.call(this,h)}});for(var v in I.StaticCanvas)v!=="prototype"&&(I.Canvas[v]=I.StaticCanvas[v])}(),function(){var n=I.util.addListener,g=I.util.removeListener,x=3,v=2,h=1,l={passive:!1};function c(f,_){return f.button&&f.button===_-1}I.util.object.extend(I.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(n,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(f,_){var u=this.upperCanvasEl,S=this._getEventPrefix();f(I.window,"resize",this._onResize),f(u,S+"down",this._onMouseDown),f(u,S+"move",this._onMouseMove,l),f(u,S+"out",this._onMouseOut),f(u,S+"enter",this._onMouseEnter),f(u,"wheel",this._onMouseWheel),f(u,"contextmenu",this._onContextMenu),f(u,"dblclick",this._onDoubleClick),f(u,"dragover",this._onDragOver),f(u,"dragenter",this._onDragEnter),f(u,"dragleave",this._onDragLeave),f(u,"drop",this._onDrop),this.enablePointerEvents||f(u,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&_ in eventjs&&(eventjs[_](u,"gesture",this._onGesture),eventjs[_](u,"drag",this._onDrag),eventjs[_](u,"orientation",this._onOrientationChange),eventjs[_](u,"shake",this._onShake),eventjs[_](u,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(g,"remove");var f=this._getEventPrefix();g(I.document,f+"up",this._onMouseUp),g(I.document,"touchend",this._onTouchEnd,l),g(I.document,f+"move",this._onMouseMove,l),g(I.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(f,_){this.__onTransformGesture&&this.__onTransformGesture(f,_)},_onDrag:function(f,_){this.__onDrag&&this.__onDrag(f,_)},_onMouseWheel:function(f){this.__onMouseWheel(f)},_onMouseOut:function(f){var _=this._hoveredTarget;this.fire("mouse:out",{target:_,e:f}),this._hoveredTarget=null,_&&_.fire("mouseout",{e:f});var u=this;this._hoveredTargets.forEach(function(S){u.fire("mouse:out",{target:_,e:f}),S&&_.fire("mouseout",{e:f})}),this._hoveredTargets=[]},_onMouseEnter:function(f){!this._currentTransform&&!this.findTarget(f)&&(this.fire("mouse:over",{target:null,e:f}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(f,_){this.__onOrientationChange&&this.__onOrientationChange(f,_)},_onShake:function(f,_){this.__onShake&&this.__onShake(f,_)},_onLongPress:function(f,_){this.__onLongPress&&this.__onLongPress(f,_)},_onDragOver:function(f){f.preventDefault();var _=this._simpleEventHandler("dragover",f);this._fireEnterLeaveEvents(_,f)},_onDrop:function(f){return this._simpleEventHandler("drop:before",f),this._simpleEventHandler("drop",f)},_onContextMenu:function(f){return this.stopContextMenu&&(f.stopPropagation(),f.preventDefault()),!1},_onDoubleClick:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"dblclick"),this._resetTransformEventData(f)},getPointerId:function(f){var _=f.changedTouches;return _?_[0]&&_[0].identifier:this.enablePointerEvents?f.pointerId:-1},_isMainEvent:function(f){return f.isPrimary===!0?!0:f.isPrimary===!1?!1:f.type==="touchend"&&f.touches.length===0?!0:f.changedTouches?f.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(f){f.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),this._resetTransformEventData();var _=this.upperCanvasEl,u=this._getEventPrefix();n(I.document,"touchend",this._onTouchEnd,l),n(I.document,"touchmove",this._onMouseMove,l),g(_,u+"down",this._onMouseDown)},_onMouseDown:function(f){this.__onMouseDown(f),this._resetTransformEventData();var _=this.upperCanvasEl,u=this._getEventPrefix();g(_,u+"move",this._onMouseMove,l),n(I.document,u+"up",this._onMouseUp),n(I.document,u+"move",this._onMouseMove,l)},_onTouchEnd:function(f){if(!(f.touches.length>0)){this.__onMouseUp(f),this._resetTransformEventData(),this.mainTouchId=null;var _=this._getEventPrefix();g(I.document,"touchend",this._onTouchEnd,l),g(I.document,"touchmove",this._onMouseMove,l);var u=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){n(u.upperCanvasEl,_+"down",u._onMouseDown),u._willAddMouseDown=0},400)}},_onMouseUp:function(f){this.__onMouseUp(f),this._resetTransformEventData();var _=this.upperCanvasEl,u=this._getEventPrefix();this._isMainEvent(f)&&(g(I.document,u+"up",this._onMouseUp),g(I.document,u+"move",this._onMouseMove,l),n(_,u+"move",this._onMouseMove,l))},_onMouseMove:function(f){!this.allowTouchScrolling&&f.preventDefault&&f.preventDefault(),this.__onMouseMove(f)},_onResize:function(){this.calcOffset()},_shouldRender:function(f){var _=this._activeObject;return!!_!=!!f||_&&f&&_!==f?!0:(_&&_.isEditing,!1)},__onMouseUp:function(f){var _,u=this._currentTransform,S=this._groupSelector,C=!1,A=!S||S.left===0&&S.top===0;if(this._cacheTransformEventData(f),_=this._target,this._handleEvent(f,"up:before"),c(f,x)){this.fireRightClick&&this._handleEvent(f,"up",x,A);return}if(c(f,v)){this.fireMiddleClick&&this._handleEvent(f,"up",v,A),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(f);return}if(!!this._isMainEvent(f)){if(u&&(this._finalizeCurrentTransform(f),C=u.actionPerformed),!A){var O=_===this._activeObject;this._maybeGroupObjects(f),C||(C=this._shouldRender(_)||!O&&_===this._activeObject)}var j,Y;if(_){if(j=_._findTargetCorner(this.getPointer(f,!0),I.util.isTouchEvent(f)),_.selectable&&_!==this._activeObject&&_.activeOn==="up")this.setActiveObject(_,f),C=!0;else{var oe=_.controls[j],ge=oe&&oe.getMouseUpHandler(f,_,oe);ge&&(Y=this.getPointer(f),ge(f,u,Y.x,Y.y))}_.isMoving=!1}if(u&&(u.target!==_||u.corner!==j)){var De=u.target&&u.target.controls[u.corner],qe=De&&De.getMouseUpHandler(f,_,oe);Y=Y||this.getPointer(f),qe&&qe(f,u,Y.x,Y.y)}this._setCursorFromEvent(f,_),this._handleEvent(f,"up",h,A),this._groupSelector=null,this._currentTransform=null,_&&(_.__corner=0),C?this.requestRenderAll():A||this.renderTop()}},_simpleEventHandler:function(f,_){var u=this.findTarget(_),S=this.targets,C={e:_,target:u,subTargets:S};if(this.fire(f,C),u&&u.fire(f,C),!S)return u;for(var A=0;A<S.length;A++)S[A].fire(f,C);return u},_handleEvent:function(f,_,u,S){var C=this._target,A=this.targets||[],O={e:f,target:C,subTargets:A,button:u||h,isClick:S||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};_==="up"&&(O.currentTarget=this.findTarget(f),O.currentSubTargets=this.targets),this.fire("mouse:"+_,O),C&&C.fire("mouse"+_,O);for(var j=0;j<A.length;j++)A[j].fire("mouse"+_,O)},_finalizeCurrentTransform:function(f){var _=this._currentTransform,u=_.target,S={e:f,target:u,transform:_,action:_.action};u._scaling&&(u._scaling=!1),u.setCoords(),(_.actionPerformed||this.stateful&&u.hasStateChanged())&&this._fire("modified",S)},_onMouseDownInDrawingMode:function(f){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(f).requestRenderAll();var _=this.getPointer(f);this.freeDrawingBrush.onMouseDown(_,{e:f,pointer:_}),this._handleEvent(f,"down")},_onMouseMoveInDrawingMode:function(f){if(this._isCurrentlyDrawing){var _=this.getPointer(f);this.freeDrawingBrush.onMouseMove(_,{e:f,pointer:_})}this.setCursor(this.freeDrawingCursor),this._handleEvent(f,"move")},_onMouseUpInDrawingMode:function(f){var _=this.getPointer(f);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:f,pointer:_}),this._handleEvent(f,"up")},__onMouseDown:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"down:before");var _=this._target;if(c(f,x)){this.fireRightClick&&this._handleEvent(f,"down",x);return}if(c(f,v)){this.fireMiddleClick&&this._handleEvent(f,"down",v);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(f);return}if(!!this._isMainEvent(f)&&!this._currentTransform){var u=this._pointer;this._previousPointer=u;var S=this._shouldRender(_),C=this._shouldGroup(f,_);if(this._shouldClearSelection(f,_)?this.discardActiveObject(f):C&&(this._handleGrouping(f,_),_=this._activeObject),this.selection&&(!_||!_.selectable&&!_.isEditing&&_!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),_){var A=_===this._activeObject;_.selectable&&_.activeOn==="down"&&this.setActiveObject(_,f);var O=_._findTargetCorner(this.getPointer(f,!0),I.util.isTouchEvent(f));if(_.__corner=O,_===this._activeObject&&(O||!C)){this._setupCurrentTransform(f,_,A);var j=_.controls[O],u=this.getPointer(f),Y=j&&j.getMouseDownHandler(f,_,j);Y&&Y(f,this._currentTransform,u.x,u.y)}}this._handleEvent(f,"down"),(S||C)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(f){this._resetTransformEventData(),this._pointer=this.getPointer(f,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(f)||null},_beforeTransform:function(f){var _=this._currentTransform;this.stateful&&_.target.saveState(),this.fire("before:transform",{e:f,transform:_})},__onMouseMove:function(f){this._handleEvent(f,"move:before"),this._cacheTransformEventData(f);var _,u;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(f);return}if(!!this._isMainEvent(f)){var S=this._groupSelector;S?(u=this._absolutePointer,S.left=u.x-S.ex,S.top=u.y-S.ey,this.renderTop()):this._currentTransform?this._transformObject(f):(_=this.findTarget(f)||null,this._setCursorFromEvent(f,_),this._fireOverOutEvents(_,f)),this._handleEvent(f,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(f,_){var u=this._hoveredTarget,S=this._hoveredTargets,C=this.targets,A=Math.max(S.length,C.length);this.fireSyntheticInOutEvents(f,_,{oldTarget:u,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var O=0;O<A;O++)this.fireSyntheticInOutEvents(C[O],_,{oldTarget:S[O],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=f,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(f,_){var u=this._draggedoverTarget,S=this._hoveredTargets,C=this.targets,A=Math.max(S.length,C.length);this.fireSyntheticInOutEvents(f,_,{oldTarget:u,evtOut:"dragleave",evtIn:"dragenter"});for(var O=0;O<A;O++)this.fireSyntheticInOutEvents(C[O],_,{oldTarget:S[O],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=f},fireSyntheticInOutEvents:function(f,_,u){var S,C,A=u.oldTarget,O,j,Y=A!==f,oe=u.canvasEvtIn,ge=u.canvasEvtOut;Y&&(S={e:_,target:f,previousTarget:A},C={e:_,target:A,nextTarget:f}),j=f&&Y,O=A&&Y,O&&(ge&&this.fire(ge,C),A.fire(u.evtOut,C)),j&&(oe&&this.fire(oe,S),f.fire(u.evtIn,S))},__onMouseWheel:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"wheel"),this._resetTransformEventData()},_transformObject:function(f){var _=this.getPointer(f),u=this._currentTransform;u.reset=!1,u.shiftKey=f.shiftKey,u.altKey=f[this.centeredKey],this._performTransformAction(f,u,_),u.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(f,_,u){var S=u.x,C=u.y,A=_.action,O=!1,j=_.actionHandler;j&&(O=j(f,_,S,C)),A==="drag"&&O&&(_.target.isMoving=!0,this.setCursor(_.target.moveCursor||this.moveCursor)),_.actionPerformed=_.actionPerformed||O},_fire:I.controlsUtils.fireEvent,_setCursorFromEvent:function(f,_){if(!_)return this.setCursor(this.defaultCursor),!1;var u=_.hoverCursor||this.hoverCursor,S=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,C=(!S||!S.contains(_))&&_._findTargetCorner(this.getPointer(f,!0));C?this.setCursor(this.getCornerCursor(C,_,f)):(_.subTargetCheck&&this.targets.concat().reverse().map(function(A){u=A.hoverCursor||u}),this.setCursor(u))},getCornerCursor:function(f,_,u){var S=_.controls[f];return S.cursorStyleHandler(u,S,_)}})}(),function(){var n=Math.min,g=Math.max;I.util.object.extend(I.Canvas.prototype,{_shouldGroup:function(x,v){var h=this._activeObject;return h&&this._isSelectionKeyPressed(x)&&v&&v.selectable&&this.selection&&(h!==v||h.type==="activeSelection")&&!v.onSelect({e:x})},_handleGrouping:function(x,v){var h=this._activeObject;h.__corner||v===h&&(v=this.findTarget(x,!0),!v||!v.selectable)||(h&&h.type==="activeSelection"?this._updateActiveSelection(v,x):this._createActiveSelection(v,x))},_updateActiveSelection:function(x,v){var h=this._activeObject,l=h._objects.slice(0);h.contains(x)?(h.removeWithUpdate(x),this._hoveredTarget=x,this._hoveredTargets=this.targets.concat(),h.size()===1&&this._setActiveObject(h.item(0),v)):(h.addWithUpdate(x),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(l,v)},_createActiveSelection:function(x,v){var h=this.getActiveObjects(),l=this._createGroup(x);this._hoveredTarget=l,this._setActiveObject(l,v),this._fireSelectionEvents(h,v)},_createGroup:function(x){var v=this._objects,h=v.indexOf(this._activeObject)<v.indexOf(x),l=h?[this._activeObject,x]:[x,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new I.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(x){var v=this._collectObjects(x),h;v.length===1?this.setActiveObject(v[0],x):v.length>1&&(h=new I.ActiveSelection(v.reverse(),{canvas:this}),this.setActiveObject(h,x))},_collectObjects:function(x){for(var v=[],h,l=this._groupSelector.ex,c=this._groupSelector.ey,f=l+this._groupSelector.left,_=c+this._groupSelector.top,u=new I.Point(n(l,f),n(c,_)),S=new I.Point(g(l,f),g(c,_)),C=!this.selectionFullyContained,A=l===f&&c===_,O=this._objects.length;O--&&(h=this._objects[O],!(!(!h||!h.selectable||!h.visible)&&(C&&h.intersectsWithRect(u,S,!0)||h.isContainedWithinRect(u,S,!0)||C&&h.containsPoint(u,null,!0)||C&&h.containsPoint(S,null,!0))&&(v.push(h),A))););return v.length>1&&(v=v.filter(function(j){return!j.onSelect({e:x})})),v},_maybeGroupObjects:function(x){this.selection&&this._groupSelector&&this._groupSelectedObjects(x),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){I.util.object.extend(I.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var g=n.format||"png",x=n.quality||1,v=(n.multiplier||1)*(n.enableRetinaScaling?this.getRetinaScaling():1),h=this.toCanvasElement(v,n);return I.util.toDataURL(h,g,x)},toCanvasElement:function(n,g){n=n||1,g=g||{};var x=(g.width||this.width)*n,v=(g.height||this.height)*n,h=this.getZoom(),l=this.width,c=this.height,f=h*n,_=this.viewportTransform,u=(_[4]-(g.left||0))*n,S=(_[5]-(g.top||0))*n,C=this.interactive,A=[f,0,0,f,u,S],O=this.enableRetinaScaling,j=I.util.createCanvasElement(),Y=this.contextTop;return j.width=x,j.height=v,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=A,this.width=x,this.height=v,this.calcViewportBoundaries(),this.renderCanvas(j.getContext("2d"),this._objects),this.viewportTransform=_,this.width=l,this.height=c,this.calcViewportBoundaries(),this.interactive=C,this.enableRetinaScaling=O,this.contextTop=Y,j}})}(),I.util.object.extend(I.StaticCanvas.prototype,{loadFromJSON:function(n,g,x){if(!!n){var v=typeof n=="string"?JSON.parse(n):I.util.object.clone(n),h=this,l=v.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete v.clipPath,this._enlivenObjects(v.objects,function(f){h.clear(),h._setBgOverlay(v,function(){l?h._enlivenObjects([l],function(_){h.clipPath=_[0],h.__setupCanvas.call(h,v,f,c,g)}):h.__setupCanvas.call(h,v,f,c,g)})},x),this}},__setupCanvas:function(n,g,x,v){var h=this;g.forEach(function(l,c){h.insertAt(l,c)}),this.renderOnAddRemove=x,delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,this._setOptions(n),this.renderAll(),v&&v()},_setBgOverlay:function(n,g){var x={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!n.backgroundImage&&!n.overlayImage&&!n.background&&!n.overlay){g&&g();return}var v=function(){x.backgroundImage&&x.overlayImage&&x.backgroundColor&&x.overlayColor&&g&&g()};this.__setBgOverlay("backgroundImage",n.backgroundImage,x,v),this.__setBgOverlay("overlayImage",n.overlayImage,x,v),this.__setBgOverlay("backgroundColor",n.background,x,v),this.__setBgOverlay("overlayColor",n.overlay,x,v)},__setBgOverlay:function(n,g,x,v){var h=this;if(!g){x[n]=!0,v&&v();return}n==="backgroundImage"||n==="overlayImage"?I.util.enlivenObjects([g],function(l){h[n]=l[0],x[n]=!0,v&&v()}):this["set"+I.util.string.capitalize(n,!0)](g,function(){x[n]=!0,v&&v()})},_enlivenObjects:function(n,g,x){if(!n||n.length===0){g&&g([]);return}I.util.enlivenObjects(n,function(v){g&&g(v)},null,x)},_toDataURL:function(n,g){this.clone(function(x){g(x.toDataURL(n))})},_toDataURLWithMultiplier:function(n,g,x){this.clone(function(v){x(v.toDataURLWithMultiplier(n,g))})},clone:function(n,g){var x=JSON.stringify(this.toJSON(g));this.cloneWithoutData(function(v){v.loadFromJSON(x,function(){n&&n(v)})})},cloneWithoutData:function(n){var g=I.util.createCanvasElement();g.width=this.width,g.height=this.height;var x=new I.Canvas(g);this.backgroundImage?(x.setBackgroundImage(this.backgroundImage.src,function(){x.renderAll(),n&&n(x)}),x.backgroundImageOpacity=this.backgroundImageOpacity,x.backgroundImageStretch=this.backgroundImageStretch):n&&n(x)}}),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.util.object.clone,h=g.util.toFixed,l=g.util.string.capitalize,c=g.util.degreesToRadians,f=!g.isLikelyNode,_=2;g.Object||(g.Object=g.util.createClass(g.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:f,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(u){u&&this.setOptions(u)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=g.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(u){var S=g.perfLimitSizeTotal,C=u.width,A=u.height,O=g.maxCacheSideLimit,j=g.minCacheSideLimit;if(C<=O&&A<=O&&C*A<=S)return C<j&&(u.width=j),A<j&&(u.height=j),u;var Y=C/A,oe=g.util.limitDimsByArea(Y,S),ge=g.util.capValue,De=ge(j,oe.x,O),qe=ge(j,oe.y,O);return C>De&&(u.zoomX/=C/De,u.width=De,u.capped=!0),A>qe&&(u.zoomY/=A/qe,u.height=qe,u.capped=!0),u},_getCacheCanvasDimensions:function(){var u=this.getTotalObjectScaling(),S=this._getTransformedDimensions(0,0),C=S.x*u.scaleX/this.scaleX,A=S.y*u.scaleY/this.scaleY;return{width:C+_,height:A+_,zoomX:u.scaleX,zoomY:u.scaleY,x:C,y:A}},_updateCacheCanvas:function(){var u=this.canvas;if(this.noScaleCache&&u&&u._currentTransform){var S=u._currentTransform.target,C=u._currentTransform.action;if(this===S&&C.slice&&C.slice(0,5)==="scale")return!1}var A=this._cacheCanvas,O=this._limitCacheSize(this._getCacheCanvasDimensions()),j=g.minCacheSideLimit,Y=O.width,oe=O.height,ge,De,qe=O.zoomX,lt=O.zoomY,_t=Y!==this.cacheWidth||oe!==this.cacheHeight,xt=this.zoomX!==qe||this.zoomY!==lt,st=_t||xt,yt=0,it=0,Rt=!1;if(_t){var Pt=this._cacheCanvas.width,Q=this._cacheCanvas.height,se=Y>Pt||oe>Q,ue=(Y<Pt*.9||oe<Q*.9)&&Pt>j&&Q>j;Rt=se||ue,se&&!O.capped&&(Y>j||oe>j)&&(yt=Y*.1,it=oe*.1)}return this instanceof g.Text&&this.path&&(st=!0,Rt=!0,yt+=this.getHeightOfLine(0)*this.zoomX,it+=this.getHeightOfLine(0)*this.zoomY),st?(Rt?(A.width=Math.ceil(Y+yt),A.height=Math.ceil(oe+it)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,A.width,A.height)),ge=O.x/2,De=O.y/2,this.cacheTranslationX=Math.round(A.width/2-ge)+ge,this.cacheTranslationY=Math.round(A.height/2-De)+De,this.cacheWidth=Y,this.cacheHeight=oe,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(qe,lt),this.zoomX=qe,this.zoomY=lt,!0):!1},setOptions:function(u){this._setOptions(u),this._initGradient(u.fill,"fill"),this._initGradient(u.stroke,"stroke"),this._initPattern(u.fill,"fill"),this._initPattern(u.stroke,"stroke")},transform:function(u){var S=this.group&&!this.group._transformDone||this.group&&this.canvas&&u===this.canvas.contextTop,C=this.calcTransformMatrix(!S);u.transform(C[0],C[1],C[2],C[3],C[4],C[5])},toObject:function(u){var S=g.Object.NUM_FRACTION_DIGITS,C={type:this.type,version:g.version,originX:this.originX,originY:this.originY,left:h(this.left,S),top:h(this.top,S),width:h(this.width,S),height:h(this.height,S),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:h(this.strokeWidth,S),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:h(this.strokeMiterLimit,S),scaleX:h(this.scaleX,S),scaleY:h(this.scaleY,S),angle:h(this.angle,S),flipX:this.flipX,flipY:this.flipY,opacity:h(this.opacity,S),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:h(this.skewX,S),skewY:h(this.skewY,S)};return this.clipPath&&!this.clipPath.excludeFromExport&&(C.clipPath=this.clipPath.toObject(u),C.clipPath.inverted=this.clipPath.inverted,C.clipPath.absolutePositioned=this.clipPath.absolutePositioned),g.util.populateWithProperties(this,C,u),this.includeDefaultValues||(C=this._removeDefaultValues(C)),C},toDatalessObject:function(u){return this.toObject(u)},_removeDefaultValues:function(u){var S=g.util.getKlass(u.type).prototype,C=S.stateProperties;return C.forEach(function(A){A==="left"||A==="top"||(u[A]===S[A]&&delete u[A],Array.isArray(u[A])&&Array.isArray(S[A])&&u[A].length===0&&S[A].length===0&&delete u[A])}),u},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var u=g.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(u.scaleX),scaleY:Math.abs(u.scaleY)}},getTotalObjectScaling:function(){var u=this.getObjectScaling(),S=u.scaleX,C=u.scaleY;if(this.canvas){var A=this.canvas.getZoom(),O=this.canvas.getRetinaScaling();S*=A*O,C*=A*O}return{scaleX:S,scaleY:C}},getObjectOpacity:function(){var u=this.opacity;return this.group&&(u*=this.group.getObjectOpacity()),u},_set:function(u,S){var C=u==="scaleX"||u==="scaleY",A=this[u]!==S,O=!1;return C&&(S=this._constrainScale(S)),u==="scaleX"&&S<0?(this.flipX=!this.flipX,S*=-1):u==="scaleY"&&S<0?(this.flipY=!this.flipY,S*=-1):u==="shadow"&&S&&!(S instanceof g.Shadow)?S=new g.Shadow(S):u==="dirty"&&this.group&&this.group.set("dirty",S),this[u]=S,A&&(O=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(u)>-1?(this.dirty=!0,O&&this.group.set("dirty",!0)):O&&this.stateProperties.indexOf(u)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:g.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(u){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(u.save(),this._setupCompositeOperation(u),this.drawSelectionBackground(u),this.transform(u),this._setOpacity(u),this._setShadow(u,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(u)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(u),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),u.restore())},renderCache:function(u){u=u||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,u.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(u,S){if(u.save(),S.inverted?u.globalCompositeOperation="destination-out":u.globalCompositeOperation="destination-in",S.absolutePositioned){var C=g.util.invertTransform(this.calcTransformMatrix());u.transform(C[0],C[1],C[2],C[3],C[4],C[5])}S.transform(u),u.scale(1/S.zoomX,1/S.zoomY),u.drawImage(S._cacheCanvas,-S.cacheTranslationX,-S.cacheTranslationY),u.restore()},drawObject:function(u,S){var C=this.fill,A=this.stroke;S?(this.fill="black",this.stroke="",this._setClippingProperties(u)):this._renderBackground(u),this._render(u),this._drawClipPath(u,this.clipPath),this.fill=C,this.stroke=A},_drawClipPath:function(u,S){!S||(S.canvas=this.canvas,S.shouldCache(),S._transformDone=!0,S.renderCache({forClipping:!0}),this.drawClipPathOnCache(u,S))},drawCacheOnCanvas:function(u){u.scale(1/this.zoomX,1/this.zoomY),u.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(u){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!u&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!u){var S=this.cacheWidth/this.zoomX,C=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-S/2,-C/2,S,C)}return!0}return!1},_renderBackground:function(u){if(!!this.backgroundColor){var S=this._getNonTransformedDimensions();u.fillStyle=this.backgroundColor,u.fillRect(-S.x/2,-S.y/2,S.x,S.y),this._removeShadow(u)}},_setOpacity:function(u){this.group&&!this.group._transformDone?u.globalAlpha=this.getObjectOpacity():u.globalAlpha*=this.opacity},_setStrokeStyles:function(u,S){var C=S.stroke;C&&(u.lineWidth=S.strokeWidth,u.lineCap=S.strokeLineCap,u.lineDashOffset=S.strokeDashOffset,u.lineJoin=S.strokeLineJoin,u.miterLimit=S.strokeMiterLimit,C.toLive?C.gradientUnits==="percentage"||C.gradientTransform||C.patternTransform?this._applyPatternForTransformedGradient(u,C):(u.strokeStyle=C.toLive(u,this),this._applyPatternGradientTransform(u,C)):u.strokeStyle=S.stroke)},_setFillStyles:function(u,S){var C=S.fill;C&&(C.toLive?(u.fillStyle=C.toLive(u,this),this._applyPatternGradientTransform(u,S.fill)):u.fillStyle=C)},_setClippingProperties:function(u){u.globalAlpha=1,u.strokeStyle="transparent",u.fillStyle="#000000"},_setLineDash:function(u,S){!S||S.length===0||(1&S.length&&S.push.apply(S,S),u.setLineDash(S))},_renderControls:function(u,S){var C=this.getViewportTransform(),A=this.calcTransformMatrix(),O,j,Y;S=S||{},j=typeof S.hasBorders<"u"?S.hasBorders:this.hasBorders,Y=typeof S.hasControls<"u"?S.hasControls:this.hasControls,A=g.util.multiplyTransformMatrices(C,A),O=g.util.qrDecompose(A),u.save(),u.translate(O.translateX,O.translateY),u.lineWidth=1*this.borderScaleFactor,this.group||(u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(O.angle-=180),u.rotate(c(this.group?O.angle:this.angle)),S.forActiveSelection||this.group?j&&this.drawBordersInGroup(u,O,S):j&&this.drawBorders(u,S),Y&&this.drawControls(u,S),u.restore()},_setShadow:function(u){if(!!this.shadow){var S=this.shadow,C=this.canvas,A,O=C&&C.viewportTransform[0]||1,j=C&&C.viewportTransform[3]||1;S.nonScaling?A={scaleX:1,scaleY:1}:A=this.getObjectScaling(),C&&C._isRetinaScaling()&&(O*=g.devicePixelRatio,j*=g.devicePixelRatio),u.shadowColor=S.color,u.shadowBlur=S.blur*g.browserShadowBlurConstant*(O+j)*(A.scaleX+A.scaleY)/4,u.shadowOffsetX=S.offsetX*O*A.scaleX,u.shadowOffsetY=S.offsetY*j*A.scaleY}},_removeShadow:function(u){!this.shadow||(u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0)},_applyPatternGradientTransform:function(u,S){if(!S||!S.toLive)return{offsetX:0,offsetY:0};var C=S.gradientTransform||S.patternTransform,A=-this.width/2+S.offsetX||0,O=-this.height/2+S.offsetY||0;return S.gradientUnits==="percentage"?u.transform(this.width,0,0,this.height,A,O):u.transform(1,0,0,1,A,O),C&&u.transform(C[0],C[1],C[2],C[3],C[4],C[5]),{offsetX:A,offsetY:O}},_renderPaintInOrder:function(u){this.paintFirst==="stroke"?(this._renderStroke(u),this._renderFill(u)):(this._renderFill(u),this._renderStroke(u))},_render:function(){},_renderFill:function(u){!this.fill||(u.save(),this._setFillStyles(u,this),this.fillRule==="evenodd"?u.fill("evenodd"):u.fill(),u.restore())},_renderStroke:function(u){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(u),u.save(),this.strokeUniform&&this.group){var S=this.getObjectScaling();u.scale(1/S.scaleX,1/S.scaleY)}else this.strokeUniform&&u.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(u,this.strokeDashArray),this._setStrokeStyles(u,this),u.stroke(),u.restore()}},_applyPatternForTransformedGradient:function(u,S){var C=this._limitCacheSize(this._getCacheCanvasDimensions()),A=g.util.createCanvasElement(),O,j=this.canvas.getRetinaScaling(),Y=C.x/this.scaleX/j,oe=C.y/this.scaleY/j;A.width=Y,A.height=oe,O=A.getContext("2d"),O.beginPath(),O.moveTo(0,0),O.lineTo(Y,0),O.lineTo(Y,oe),O.lineTo(0,oe),O.closePath(),O.translate(Y/2,oe/2),O.scale(C.zoomX/this.scaleX/j,C.zoomY/this.scaleY/j),this._applyPatternGradientTransform(O,S),O.fillStyle=S.toLive(u),O.fill(),u.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),u.scale(j*this.scaleX/C.zoomX,j*this.scaleY/C.zoomY),u.strokeStyle=O.createPattern(A,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var u=g.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",u.scaleX),this.set("scaleY",u.scaleY),this.angle=u.angle,this.skewX=u.skewX,this.skewY=0}},_removeTransformMatrix:function(u){var S=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),S=g.util.transformPoint(S,this.transformMatrix)),this.transformMatrix=null,u&&(this.scaleX*=u.scaleX,this.scaleY*=u.scaleY,this.cropX=u.cropX,this.cropY=u.cropY,S.x+=u.offsetLeft,S.y+=u.offsetTop,this.width=u.width,this.height=u.height),this.setPositionByOrigin(S,"center","center")},clone:function(u,S){var C=this.toObject(S);this.constructor.fromObject?this.constructor.fromObject(C,u):g.Object._fromObject("Object",C,u)},cloneAsImage:function(u,S){var C=this.toCanvasElement(S);return u&&u(new g.Image(C)),this},toCanvasElement:function(u){u||(u={});var S=g.util,C=S.saveObjectTransform(this),A=this.group,O=this.shadow,j=Math.abs,Y=(u.multiplier||1)*(u.enableRetinaScaling?g.devicePixelRatio:1);delete this.group,u.withoutTransform&&S.resetObjectTransform(this),u.withoutShadow&&(this.shadow=null);var oe=g.util.createCanvasElement(),ge=this.getBoundingRect(!0,!0),De=this.shadow,qe,lt={x:0,y:0},_t,xt,st;De&&(_t=De.blur,De.nonScaling?qe={scaleX:1,scaleY:1}:qe=this.getObjectScaling(),lt.x=2*Math.round(j(De.offsetX)+_t)*j(qe.scaleX),lt.y=2*Math.round(j(De.offsetY)+_t)*j(qe.scaleY)),xt=ge.width+lt.x,st=ge.height+lt.y,oe.width=Math.ceil(xt),oe.height=Math.ceil(st);var yt=new g.StaticCanvas(oe,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});u.format==="jpeg"&&(yt.backgroundColor="#fff"),this.setPositionByOrigin(new g.Point(yt.width/2,yt.height/2),"center","center");var it=this.canvas;yt.add(this);var Rt=yt.toCanvasElement(Y||1,u);return this.shadow=O,this.set("canvas",it),A&&(this.group=A),this.set(C).setCoords(),yt._objects=[],yt.dispose(),yt=null,Rt},toDataURL:function(u){return u||(u={}),g.util.toDataURL(this.toCanvasElement(u),u.format||"png",u.quality||1)},isType:function(u){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===u},complexity:function(){return 1},toJSON:function(u){return this.toObject(u)},rotate:function(u){var S=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return S&&this._setOriginToCenter(),this.set("angle",u),S&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(u,S){S=S||this.canvas.getPointer(u);var C=new g.Point(S.x,S.y),A=this._getLeftTopCoords();return this.angle&&(C=g.util.rotatePoint(C,A,c(-this.angle))),{x:C.x-A.x,y:C.y-A.y}},_setupCompositeOperation:function(u){this.globalCompositeOperation&&(u.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){g.runningAnimations&&g.runningAnimations.cancelByTarget(this)}}),g.util.createAccessors&&g.util.createAccessors(g.Object),x(g.Object.prototype,g.Observable),g.Object.NUM_FRACTION_DIGITS=2,g.Object.ENLIVEN_PROPS=["clipPath"],g.Object._fromObject=function(u,S,C,A){var O=g[u];S=v(S,!0),g.util.enlivenPatterns([S.fill,S.stroke],function(j){typeof j[0]<"u"&&(S.fill=j[0]),typeof j[1]<"u"&&(S.stroke=j[1]),g.util.enlivenObjectEnlivables(S,S,function(){var Y=A?new O(S[A],S):new O(S);C&&C(Y)})})},g.Object.__uid=0)}(Fe),function(){var n=I.util.degreesToRadians,g={left:-.5,center:0,right:.5},x={top:-.5,center:0,bottom:.5};I.util.object.extend(I.Object.prototype,{translateToGivenOrigin:function(v,h,l,c,f){var _=v.x,u=v.y,S,C,A;return typeof h=="string"?h=g[h]:h-=.5,typeof c=="string"?c=g[c]:c-=.5,S=c-h,typeof l=="string"?l=x[l]:l-=.5,typeof f=="string"?f=x[f]:f-=.5,C=f-l,(S||C)&&(A=this._getTransformedDimensions(),_=v.x+S*A.x,u=v.y+C*A.y),new I.Point(_,u)},translateToCenterPoint:function(v,h,l){var c=this.translateToGivenOrigin(v,h,l,"center","center");return this.angle?I.util.rotatePoint(c,v,n(this.angle)):c},translateToOriginPoint:function(v,h,l){var c=this.translateToGivenOrigin(v,"center","center",h,l);return this.angle?I.util.rotatePoint(c,v,n(this.angle)):c},getCenterPoint:function(){var v=new I.Point(this.left,this.top);return this.translateToCenterPoint(v,this.originX,this.originY)},getPointByOrigin:function(v,h){var l=this.getCenterPoint();return this.translateToOriginPoint(l,v,h)},toLocalPoint:function(v,h,l){var c=this.getCenterPoint(),f,_;return typeof h<"u"&&typeof l<"u"?f=this.translateToGivenOrigin(c,"center","center",h,l):f=new I.Point(this.left,this.top),_=new I.Point(v.x,v.y),this.angle&&(_=I.util.rotatePoint(_,c,-n(this.angle))),_.subtractEquals(f)},setPositionByOrigin:function(v,h,l){var c=this.translateToCenterPoint(v,h,l),f=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",f.x),this.set("top",f.y)},adjustPosition:function(v){var h=n(this.angle),l=this.getScaledWidth(),c=I.util.cos(h)*l,f=I.util.sin(h)*l,_,u;typeof this.originX=="string"?_=g[this.originX]:_=this.originX-.5,typeof v=="string"?u=g[v]:u=v-.5,this.left+=c*(u-_),this.top+=f*(u-_),this.setCoords(),this.originX=v},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var v=this.getCenterPoint();this.originX="center",this.originY="center",this.left=v.x,this.top=v.y},_resetOrigin:function(){var v=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=v.x,this.top=v.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function n(l){return[new I.Point(l.tl.x,l.tl.y),new I.Point(l.tr.x,l.tr.y),new I.Point(l.br.x,l.br.y),new I.Point(l.bl.x,l.bl.y)]}var g=I.util,x=g.degreesToRadians,v=g.multiplyTransformMatrices,h=g.transformPoint;g.object.extend(I.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(l,c){return c?l?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),l?this.aCoords:this.lineCoords)},getCoords:function(l,c){return n(this._getCoords(l,c))},intersectsWithRect:function(l,c,f,_){var u=this.getCoords(f,_),S=I.Intersection.intersectPolygonRectangle(u,l,c);return S.status==="Intersection"},intersectsWithObject:function(l,c,f){var _=I.Intersection.intersectPolygonPolygon(this.getCoords(c,f),l.getCoords(c,f));return _.status==="Intersection"||l.isContainedWithinObject(this,c,f)||this.isContainedWithinObject(l,c,f)},isContainedWithinObject:function(l,c,f){for(var _=this.getCoords(c,f),u=c?l.aCoords:l.lineCoords,S=0,C=l._getImageLines(u);S<4;S++)if(!l.containsPoint(_[S],C))return!1;return!0},isContainedWithinRect:function(l,c,f,_){var u=this.getBoundingRect(f,_);return u.left>=l.x&&u.left+u.width<=c.x&&u.top>=l.y&&u.top+u.height<=c.y},containsPoint:function(l,S,f,_){var u=this._getCoords(f,_),S=S||this._getImageLines(u),C=this._findCrossPoints(l,S);return C!==0&&C%2===1},isOnScreen:function(l){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br,_=this.getCoords(!0,l);return _.some(function(u){return u.x<=f.x&&u.x>=c.x&&u.y<=f.y&&u.y>=c.y})||this.intersectsWithRect(c,f,!0,l)?!0:this._containsCenterOfCanvas(c,f,l)},_containsCenterOfCanvas:function(l,c,f){var _={x:(l.x+c.x)/2,y:(l.y+c.y)/2};return!!this.containsPoint(_,null,!0,f)},isPartiallyOnScreen:function(l){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br;if(this.intersectsWithRect(c,f,!0,l))return!0;var _=this.getCoords(!0,l).every(function(u){return(u.x>=f.x||u.x<=c.x)&&(u.y>=f.y||u.y<=c.y)});return _&&this._containsCenterOfCanvas(c,f,l)},_getImageLines:function(l){var c={topline:{o:l.tl,d:l.tr},rightline:{o:l.tr,d:l.br},bottomline:{o:l.br,d:l.bl},leftline:{o:l.bl,d:l.tl}};return c},_findCrossPoints:function(l,c){var f,_,u,S,C,A=0,O;for(var j in c)if(O=c[j],!(O.o.y<l.y&&O.d.y<l.y)&&!(O.o.y>=l.y&&O.d.y>=l.y)&&(O.o.x===O.d.x&&O.o.x>=l.x?C=O.o.x:(f=0,_=(O.d.y-O.o.y)/(O.d.x-O.o.x),u=l.y-f*l.x,S=O.o.y-_*O.o.x,C=-(u-S)/(f-_)),C>=l.x&&(A+=1),A===2))break;return A},getBoundingRect:function(l,c){var f=this.getCoords(l,c);return g.makeBoundingBoxFromPoints(f)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(l){return Math.abs(l)<this.minScaleLimit?l<0?-this.minScaleLimit:this.minScaleLimit:l===0?1e-4:l},scale:function(l){return this._set("scaleX",l),this._set("scaleY",l),this.setCoords()},scaleToWidth:function(l,c){var f=this.getBoundingRect(c).width/this.getScaledWidth();return this.scale(l/this.width/f)},scaleToHeight:function(l,c){var f=this.getBoundingRect(c).height/this.getScaledHeight();return this.scale(l/this.height/f)},calcLineCoords:function(){var l=this.getViewportTransform(),c=this.padding,f=x(this.angle),_=g.cos(f),u=g.sin(f),S=_*c,C=u*c,A=S+C,O=S-C,j=this.calcACoords(),Y={tl:h(j.tl,l),tr:h(j.tr,l),bl:h(j.bl,l),br:h(j.br,l)};return c&&(Y.tl.x-=O,Y.tl.y-=A,Y.tr.x+=A,Y.tr.y-=O,Y.bl.x-=A,Y.bl.y+=O,Y.br.x+=O,Y.br.y+=A),Y},calcOCoords:function(){var l=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),f=this.getViewportTransform(),_=v(f,c),u=v(_,l),u=v(u,[1/f[0],0,0,1/f[3],0,0]),S=this._calculateCurrentDimensions(),C={};return this.forEachControl(function(A,O,j){C[O]=A.positionHandler(S,u,j)}),C},calcACoords:function(){var l=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),f=v(c,l),_=this._getTransformedDimensions(),u=_.x/2,S=_.y/2;return{tl:h({x:-u,y:-S},f),tr:h({x:u,y:-S},f),bl:h({x:-u,y:S},f),br:h({x:u,y:S},f)}},setCoords:function(l){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),l?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return g.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var l=this.getCenterPoint();return[1,0,0,1,l.x,l.y]},transformMatrixKey:function(l){var c="_",f="";return!l&&this.group&&(f=this.group.transformMatrixKey(l)+c),f+this.top+c+this.left+c+this.scaleX+c+this.scaleY+c+this.skewX+c+this.skewY+c+this.angle+c+this.originX+c+this.originY+c+this.width+c+this.height+c+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(l){var c=this.calcOwnMatrix();if(l||!this.group)return c;var f=this.transformMatrixKey(l),_=this.matrixCache||(this.matrixCache={});return _.key===f?_.value:(this.group&&(c=v(this.group.calcTransformMatrix(!1),c)),_.key=f,_.value=c,c)},calcOwnMatrix:function(){var l=this.transformMatrixKey(!0),c=this.ownMatrixCache||(this.ownMatrixCache={});if(c.key===l)return c.value;var f=this._calcTranslateMatrix(),_={angle:this.angle,translateX:f[4],translateY:f[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return c.key=l,c.value=g.composeMatrix(_),c.value},_getNonTransformedDimensions:function(){var l=this.strokeWidth,c=this.width+l,f=this.height+l;return{x:c,y:f}},_getTransformedDimensions:function(l,c){typeof l>"u"&&(l=this.skewX),typeof c>"u"&&(c=this.skewY);var f,_,u,S=l===0&&c===0;if(this.strokeUniform?(_=this.width,u=this.height):(f=this._getNonTransformedDimensions(),_=f.x,u=f.y),S)return this._finalizeDimensions(_*this.scaleX,u*this.scaleY);var C=g.sizeAfterTransform(_,u,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:l,skewY:c});return this._finalizeDimensions(C.x,C.y)},_finalizeDimensions:function(l,c){return this.strokeUniform?{x:l+this.strokeWidth,y:c+this.strokeWidth}:{x:l,y:c}},_calculateCurrentDimensions:function(){var l=this.getViewportTransform(),c=this._getTransformedDimensions(),f=h(c,l,!0);return f.scalarAdd(2*this.padding)}})}(),I.util.object.extend(I.Object.prototype,{sendToBack:function(){return this.group?I.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?I.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?I.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas&&this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?I.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas&&this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group&&this.group.type!=="activeSelection"?I.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas&&this.canvas.moveTo(this,n),this}}),function(){function n(x,v){if(v){if(v.toLive)return x+": url(#SVGID_"+v.id+"); ";var h=new I.Color(v),l=x+": "+h.toRgb()+"; ",c=h.getAlpha();return c!==1&&(l+=x+"-opacity: "+c.toString()+"; "),l}else return x+": none; "}var g=I.util.toFixed;I.util.object.extend(I.Object.prototype,{getSvgStyles:function(x){var v=this.fillRule?this.fillRule:"nonzero",h=this.strokeWidth?this.strokeWidth:"0",l=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",f=this.strokeLineCap?this.strokeLineCap:"butt",_=this.strokeLineJoin?this.strokeLineJoin:"miter",u=this.strokeMiterLimit?this.strokeMiterLimit:"4",S=typeof this.opacity<"u"?this.opacity:"1",C=this.visible?"":" visibility: hidden;",A=x?"":this.getSvgFilter(),O=n("fill",this.fill),j=n("stroke",this.stroke);return[j,"stroke-width: ",h,"; ","stroke-dasharray: ",l,"; ","stroke-linecap: ",f,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",_,"; ","stroke-miterlimit: ",u,"; ",O,"fill-rule: ",v,"; ","opacity: ",S,";",A,C].join("")},getSvgSpanStyles:function(x,v){var h="; ",c=x.fontFamily?"font-family: "+(x.fontFamily.indexOf("'")===-1&&x.fontFamily.indexOf('"')===-1?"'"+x.fontFamily+"'":x.fontFamily)+h:"",l=x.strokeWidth?"stroke-width: "+x.strokeWidth+h:"",c=c,f=x.fontSize?"font-size: "+x.fontSize+"px"+h:"",_=x.fontStyle?"font-style: "+x.fontStyle+h:"",u=x.fontWeight?"font-weight: "+x.fontWeight+h:"",S=x.fill?n("fill",x.fill):"",C=x.stroke?n("stroke",x.stroke):"",A=this.getSvgTextDecoration(x),O=x.deltaY?"baseline-shift: "+-x.deltaY+"; ":"";return A&&(A="text-decoration: "+A+h),[C,l,c,f,_,u,A,S,O,v?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(x){return["overline","underline","line-through"].filter(function(v){return x[v.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(x,v){var h=x?this.calcTransformMatrix():this.calcOwnMatrix(),l='transform="'+I.util.matrixToSVG(h);return l+(v||"")+'" '},_setSVGBg:function(x){if(this.backgroundColor){var v=I.Object.NUM_FRACTION_DIGITS;x.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',g(-this.width/2,v),'" y="',g(-this.height/2,v),'" width="',g(this.width,v),'" height="',g(this.height,v),`"></rect>
`)}},toSVG:function(x){return this._createBaseSVGMarkup(this._toSVG(x),{reviver:x})},toClipPathSVG:function(x){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(x),{reviver:x})},_createBaseClipPathSVGMarkup:function(x,v){v=v||{};var h=v.reviver,l=v.additionalTransform||"",c=[this.getSvgTransform(!0,l),this.getSvgCommons()].join(""),f=x.indexOf("COMMON_PARTS");return x[f]=c,h?h(x.join("")):x.join("")},_createBaseSVGMarkup:function(x,v){v=v||{};var h=v.noStyle,l=v.reviver,c=h?"":'style="'+this.getSvgStyles()+'" ',f=v.withShadow?'style="'+this.getSvgFilter()+'" ':"",_=this.clipPath,u=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",S=_&&_.absolutePositioned,C=this.stroke,A=this.fill,O=this.shadow,j,Y=[],oe,ge=x.indexOf("COMMON_PARTS"),De=v.additionalTransform;return _&&(_.clipPathId="CLIPPATH_"+I.Object.__uid++,oe='<clipPath id="'+_.clipPathId+`" >
`+_.toClipPathSVG(l)+`</clipPath>
`),S&&Y.push("<g ",f,this.getSvgCommons(),` >
`),Y.push("<g ",this.getSvgTransform(!1),S?"":f+this.getSvgCommons(),` >
`),j=[c,u,h?"":this.addPaintOrder()," ",De?'transform="'+De+'" ':""].join(""),x[ge]=j,A&&A.toLive&&Y.push(A.toSVG(this)),C&&C.toLive&&Y.push(C.toSVG(this)),O&&Y.push(O.toSVG(this)),_&&Y.push(oe),Y.push(x.join("")),Y.push(`</g>
`),S&&Y.push(`</g>
`),l?l(Y.join("")):Y.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var n=I.util.object.extend,g="stateProperties";function x(h,l,c){var f={},_=!0;c.forEach(function(u){f[u]=h[u]}),n(h[l],f,_)}function v(h,l,c){if(h===l)return!0;if(Array.isArray(h)){if(!Array.isArray(l)||h.length!==l.length)return!1;for(var f=0,_=h.length;f<_;f++)if(!v(h[f],l[f]))return!1;return!0}else if(h&&typeof h=="object"){var u=Object.keys(h),S;if(!l||typeof l!="object"||!c&&u.length!==Object.keys(l).length)return!1;for(var f=0,_=u.length;f<_;f++)if(S=u[f],!(S==="canvas"||S==="group")&&!v(h[S],l[S]))return!1;return!0}}I.util.object.extend(I.Object.prototype,{hasStateChanged:function(h){h=h||g;var l="_"+h;return Object.keys(this[l]).length<this[h].length?!0:!v(this[l],this,!0)},saveState:function(h){var l=h&&h.propertySet||g,c="_"+l;return this[c]?(x(this,c,this[l]),h&&h.stateProperties&&x(this,c,h.stateProperties),this):this.setupState(h)},setupState:function(h){h=h||{};var l=h.propertySet||g;return h.propertySet=l,this["_"+l]={},this.saveState(h),this}})}(),function(){var n=I.util.degreesToRadians;I.util.object.extend(I.Object.prototype,{_findTargetCorner:function(g,x){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var v=g.x,h=g.y,l,c,f=Object.keys(this.oCoords),_=f.length-1,u;for(this.__corner=0;_>=0;_--)if(u=f[_],!!this.isControlVisible(u)&&(c=this._getImageLines(x?this.oCoords[u].touchCorner:this.oCoords[u].corner),l=this._findCrossPoints({x:v,y:h},c),l!==0&&l%2===1))return this.__corner=u,u;return!1},forEachControl:function(g){for(var x in this.controls)g(this.controls[x],x,this)},_setCornerCoords:function(){var g=this.oCoords;for(var x in g){var v=this.controls[x];g[x].corner=v.calcCornerCoords(this.angle,this.cornerSize,g[x].x,g[x].y,!1),g[x].touchCorner=v.calcCornerCoords(this.angle,this.touchCornerSize,g[x].x,g[x].y,!0)}},drawSelectionBackground:function(g){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;g.save();var x=this.getCenterPoint(),v=this._calculateCurrentDimensions(),h=this.canvas.viewportTransform;return g.translate(x.x,x.y),g.scale(1/h[0],1/h[3]),g.rotate(n(this.angle)),g.fillStyle=this.selectionBackgroundColor,g.fillRect(-v.x/2,-v.y/2,v.x,v.y),g.restore(),this},drawBorders:function(g,x){x=x||{};var v=this._calculateCurrentDimensions(),h=this.borderScaleFactor,l=v.x+h,c=v.y+h,f=typeof x.hasControls<"u"?x.hasControls:this.hasControls,_=!1;return g.save(),g.strokeStyle=x.borderColor||this.borderColor,this._setLineDash(g,x.borderDashArray||this.borderDashArray),g.strokeRect(-l/2,-c/2,l,c),f&&(g.beginPath(),this.forEachControl(function(u,S,C){u.withConnection&&u.getVisibility(C,S)&&(_=!0,g.moveTo(u.x*l,u.y*c),g.lineTo(u.x*l+u.offsetX,u.y*c+u.offsetY))}),_&&g.stroke()),g.restore(),this},drawBordersInGroup:function(g,x,v){v=v||{};var h=I.util.sizeAfterTransform(this.width,this.height,x),l=this.strokeWidth,c=this.strokeUniform,f=this.borderScaleFactor,_=h.x+l*(c?this.canvas.getZoom():x.scaleX)+f,u=h.y+l*(c?this.canvas.getZoom():x.scaleY)+f;return g.save(),this._setLineDash(g,v.borderDashArray||this.borderDashArray),g.strokeStyle=v.borderColor||this.borderColor,g.strokeRect(-_/2,-u/2,_,u),g.restore(),this},drawControls:function(g,x){x=x||{},g.save();var v=this.canvas.getRetinaScaling(),h,l;return g.setTransform(v,0,0,v,0,0),g.strokeStyle=g.fillStyle=x.cornerColor||this.cornerColor,this.transparentCorners||(g.strokeStyle=x.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(g,x.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(h=this.group.calcTransformMatrix()),this.forEachControl(function(c,f,_){l=_.oCoords[f],c.getVisibility(_,f)&&(h&&(l=I.util.transformPoint(l,h)),c.render(g,l.x,l.y,x,_))}),g.restore(),this},isControlVisible:function(g){return this.controls[g]&&this.controls[g].getVisibility(this,g)},setControlVisible:function(g,x){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[g]=x,this},setControlsVisibility:function(g){g||(g={});for(var x in g)this.setControlVisible(x,g[x]);return this},onDeselect:function(){},onSelect:function(){}})}(),I.util.object.extend(I.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,g){g=g||{};var x=function(){},v=g.onComplete||x,h=g.onChange||x,l=this;return I.util.animate({target:this,startValue:n.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){n.set("left",c),l.requestRenderAll(),h()},onComplete:function(){n.setCoords(),v()}})},fxCenterObjectV:function(n,g){g=g||{};var x=function(){},v=g.onComplete||x,h=g.onChange||x,l=this;return I.util.animate({target:this,startValue:n.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){n.set("top",c),l.requestRenderAll(),h()},onComplete:function(){n.setCoords(),v()}})},fxRemove:function(n,g){g=g||{};var x=function(){},v=g.onComplete||x,h=g.onChange||x,l=this;return I.util.animate({target:this,startValue:n.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){n.set("opacity",c),l.requestRenderAll(),h()},onComplete:function(){l.remove(n),v()}})}}),I.util.object.extend(I.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var n=[],g,x,v=[];for(g in arguments[0])n.push(g);for(var h=0,l=n.length;h<l;h++)g=n[h],x=h!==l-1,v.push(this._animate(g,arguments[0][g],arguments[1],x));return v}else return this._animate.apply(this,arguments)},_animate:function(n,g,x,v){var h=this,l;g=g.toString(),x?x=I.util.object.clone(x):x={},~n.indexOf(".")&&(l=n.split("."));var c=h.colorProperties.indexOf(n)>-1||l&&h.colorProperties.indexOf(l[1])>-1,f=l?this.get(l[0])[l[1]]:this.get(n);"from"in x||(x.from=f),c||(~g.indexOf("=")?g=f+parseFloat(g.replace("=","")):g=parseFloat(g));var _={target:this,startValue:x.from,endValue:g,byValue:x.by,easing:x.easing,duration:x.duration,abort:x.abort&&function(u,S,C){return x.abort.call(h,u,S,C)},onChange:function(u,S,C){l?h[l[0]][l[1]]=u:h.set(n,u),!v&&x.onChange&&x.onChange(u,S,C)},onComplete:function(u,S,C){v||(h.setCoords(),x.onComplete&&x.onComplete(u,S,C))}};return c?I.util.animateColor(_.startValue,_.endValue,_.duration,_):I.util.animate(_)}}),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.util.object.clone,h={x1:1,x2:1,y1:1,y2:1};if(g.Line){g.warn("fabric.Line is already defined");return}g.Line=g.util.createClass(g.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:g.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,f){c||(c=[0,0,0,0]),this.callSuper("initialize",f),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(f)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,f){return this.callSuper("_set",c,f),typeof h[c]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:l({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:l({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var f=this.calcLinePoints();c.moveTo(f.x1,f.y1),c.lineTo(f.x2,f.y2),c.lineWidth=this.strokeWidth;var _=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=_},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return x(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,_=c*this.width*.5,u=f*this.height*.5,S=c*this.width*-.5,C=f*this.height*-.5;return{x1:_,x2:S,y1:u,y2:C}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),g.Line.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),g.Line.fromElement=function(c,f,_){_=_||{};var u=g.parseAttributes(c,g.Line.ATTRIBUTE_NAMES),S=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];f(new g.Line(S,x(u,_)))},g.Line.fromObject=function(c,f){function _(S){delete S.points,f&&f(S)}var u=v(c,!0);u.points=[c.x1,c.y1,c.x2,c.y2],g.Object._fromObject("Line",u,_,"points")};function l(c,f){var _=c.origin,u=c.axis1,S=c.axis2,C=c.dimension,A=f.nearest,O=f.center,j=f.farthest;return function(){switch(this.get(_)){case A:return Math.min(this.get(u),this.get(S));case O:return Math.min(this.get(u),this.get(S))+.5*this.get(C);case j:return Math.max(this.get(u),this.get(S))}}}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.degreesToRadians;if(g.Circle){g.warn("fabric.Circle is already defined.");return}g.Circle=g.util.createClass(g.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:g.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(h,l){return this.callSuper("_set",h,l),h==="radius"&&this.setRadius(l),this},toObject:function(h){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(h))},_toSVG:function(){var h,l=0,c=0,f=(this.endAngle-this.startAngle)%360;if(f===0)h=["<circle ","COMMON_PARTS",'cx="'+l+'" cy="'+c+'" ','r="',this.radius,`" />
`];else{var _=x(this.startAngle),u=x(this.endAngle),S=this.radius,C=g.util.cos(_)*S,A=g.util.sin(_)*S,O=g.util.cos(u)*S,j=g.util.sin(u)*S,Y=f>180?"1":"0";h=['<path d="M '+C+" "+A," A "+S+" "+S," 0 ",+Y+" 1"," "+O+" "+j,'" ',"COMMON_PARTS",` />
`]}return h},_render:function(h){h.beginPath(),h.arc(0,0,this.radius,x(this.startAngle),x(this.endAngle),!1),this._renderPaintInOrder(h)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(h){return this.radius=h,this.set("width",h*2).set("height",h*2)}}),g.Circle.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),g.Circle.fromElement=function(h,l){var c=g.parseAttributes(h,g.Circle.ATTRIBUTE_NAMES);if(!v(c))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,l(new g.Circle(c))};function v(h){return"radius"in h&&h.radius>=0}g.Circle.fromObject=function(h,l){g.Object._fromObject("Circle",h,l)}}(Fe),function(n){var g=n.fabric||(n.fabric={});if(g.Triangle){g.warn("fabric.Triangle is already defined");return}g.Triangle=g.util.createClass(g.Object,{type:"triangle",width:100,height:100,_render:function(x){var v=this.width/2,h=this.height/2;x.beginPath(),x.moveTo(-v,h),x.lineTo(0,-h),x.lineTo(v,h),x.closePath(),this._renderPaintInOrder(x)},_toSVG:function(){var x=this.width/2,v=this.height/2,h=[-x+" "+v,"0 "+-v,x+" "+v].join(",");return["<polygon ","COMMON_PARTS",'points="',h,'" />']}}),g.Triangle.fromObject=function(x,v){return g.Object._fromObject("Triangle",x,v)}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=Math.PI*2;if(g.Ellipse){g.warn("fabric.Ellipse is already defined.");return}g.Ellipse=g.util.createClass(g.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:g.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(v){this.callSuper("initialize",v),this.set("rx",v&&v.rx||0),this.set("ry",v&&v.ry||0)},_set:function(v,h){switch(this.callSuper("_set",v,h),v){case"rx":this.rx=h,this.set("width",h*2);break;case"ry":this.ry=h,this.set("height",h*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(v){return this.callSuper("toObject",["rx","ry"].concat(v))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(v){v.beginPath(),v.save(),v.transform(1,0,0,this.ry/this.rx,0,0),v.arc(0,0,this.rx,0,x,!1),v.restore(),this._renderPaintInOrder(v)}}),g.Ellipse.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),g.Ellipse.fromElement=function(v,h){var l=g.parseAttributes(v,g.Ellipse.ATTRIBUTE_NAMES);l.left=(l.left||0)-l.rx,l.top=(l.top||0)-l.ry,h(new g.Ellipse(l))},g.Ellipse.fromObject=function(v,h){g.Object._fromObject("Ellipse",v,h)}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend;if(g.Rect){g.warn("fabric.Rect is already defined");return}g.Rect=g.util.createClass(g.Object,{stateProperties:g.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:g.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(v){this.callSuper("initialize",v),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(v){var h=this.rx?Math.min(this.rx,this.width/2):0,l=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,f=this.height,_=-this.width/2,u=-this.height/2,S=h!==0||l!==0,C=1-.5522847498;v.beginPath(),v.moveTo(_+h,u),v.lineTo(_+c-h,u),S&&v.bezierCurveTo(_+c-C*h,u,_+c,u+C*l,_+c,u+l),v.lineTo(_+c,u+f-l),S&&v.bezierCurveTo(_+c,u+f-C*l,_+c-C*h,u+f,_+c-h,u+f),v.lineTo(_+h,u+f),S&&v.bezierCurveTo(_+C*h,u+f,_,u+f-C*l,_,u+f-l),v.lineTo(_,u+l),S&&v.bezierCurveTo(_,u+C*l,_+C*h,u,_+h,u),v.closePath(),this._renderPaintInOrder(v)},toObject:function(v){return this.callSuper("toObject",["rx","ry"].concat(v))},_toSVG:function(){var v=-this.width/2,h=-this.height/2;return["<rect ","COMMON_PARTS",'x="',v,'" y="',h,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),g.Rect.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),g.Rect.fromElement=function(v,h,l){if(!v)return h(null);l=l||{};var c=g.parseAttributes(v,g.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var f=new g.Rect(x(l?g.util.object.clone(l):{},c));f.visible=f.visible&&f.width>0&&f.height>0,h(f)},g.Rect.fromObject=function(v,h){return g.Object._fromObject("Rect",v,h)}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.util.array.min,h=g.util.array.max,l=g.util.toFixed,c=g.util.projectStrokeOnPoints;if(g.Polyline){g.warn("fabric.Polyline is already defined");return}g.Polyline=g.util.createClass(g.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:g.Object.prototype.cacheProperties.concat("points"),initialize:function(f,_){_=_||{},this.points=f||[],this.callSuper("initialize",_),this._setPositionDimensions(_)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(f){var _=this._calcDimensions(f),u,S=this.exactBoundingBox?this.strokeWidth:0;this.width=_.width-S,this.height=_.height-S,f.fromSVG||(u=this.translateToGivenOrigin({x:_.left-this.strokeWidth/2+S/2,y:_.top-this.strokeWidth/2+S/2},"left","top",this.originX,this.originY)),typeof f.left>"u"&&(this.left=f.fromSVG?_.left:u.x),typeof f.top>"u"&&(this.top=f.fromSVG?_.top:u.y),this.pathOffset={x:_.left+this.width/2+S/2,y:_.top+this.height/2+S/2}},_calcDimensions:function(){var f=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,_=v(f,"x")||0,u=v(f,"y")||0,S=h(f,"x")||0,C=h(f,"y")||0,A=S-_,O=C-u;return{left:_,top:u,width:A,height:O}},toObject:function(f){return x(this.callSuper("toObject",f),{points:this.points.concat()})},_toSVG:function(){for(var f=[],_=this.pathOffset.x,u=this.pathOffset.y,S=g.Object.NUM_FRACTION_DIGITS,C=0,A=this.points.length;C<A;C++)f.push(l(this.points[C].x-_,S),",",l(this.points[C].y-u,S)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',f.join(""),`" />
`]},commonRender:function(f){var _,u=this.points.length,S=this.pathOffset.x,C=this.pathOffset.y;if(!u||isNaN(this.points[u-1].y))return!1;f.beginPath(),f.moveTo(this.points[0].x-S,this.points[0].y-C);for(var A=0;A<u;A++)_=this.points[A],f.lineTo(_.x-S,_.y-C);return!0},_render:function(f){!this.commonRender(f)||this._renderPaintInOrder(f)},complexity:function(){return this.get("points").length}}),g.Polyline.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat(),g.Polyline.fromElementGenerator=function(f){return function(_,u,S){if(!_)return u(null);S||(S={});var C=g.parsePointsAttribute(_.getAttribute("points")),A=g.parseAttributes(_,g[f].ATTRIBUTE_NAMES);A.fromSVG=!0,u(new g[f](C,x(A,S)))}},g.Polyline.fromElement=g.Polyline.fromElementGenerator("Polyline"),g.Polyline.fromObject=function(f,_){return g.Object._fromObject("Polyline",f,_,"points")}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.projectStrokeOnPoints;if(g.Polygon){g.warn("fabric.Polygon is already defined");return}g.Polygon=g.util.createClass(g.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return x(this.points,this)},_render:function(v){!this.commonRender(v)||(v.closePath(),this._renderPaintInOrder(v))}}),g.Polygon.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat(),g.Polygon.fromElement=g.Polyline.fromElementGenerator("Polygon"),g.Polygon.fromObject=function(v,h){g.Object._fromObject("Polygon",v,h,"points")}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.array.min,v=g.util.array.max,h=g.util.object.extend,l=g.util.object.clone,c=g.util.toFixed;if(g.Path){g.warn("fabric.Path is already defined");return}g.Path=g.util.createClass(g.Object,{type:"path",path:null,cacheProperties:g.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:g.Object.prototype.stateProperties.concat("path"),initialize:function(f,_){_=l(_||{}),delete _.path,this.callSuper("initialize",_),this._setPath(f||[],_)},_setPath:function(f,_){this.path=g.util.makePathSimpler(Array.isArray(f)?f:g.util.parsePath(f)),g.Polyline.prototype._setPositionDimensions.call(this,_||{})},_renderPathCommands:function(f){var _,u=0,S=0,C=0,A=0,O=0,j=0,Y=-this.pathOffset.x,oe=-this.pathOffset.y;f.beginPath();for(var ge=0,De=this.path.length;ge<De;++ge)switch(_=this.path[ge],_[0]){case"L":C=_[1],A=_[2],f.lineTo(C+Y,A+oe);break;case"M":C=_[1],A=_[2],u=C,S=A,f.moveTo(C+Y,A+oe);break;case"C":C=_[5],A=_[6],O=_[3],j=_[4],f.bezierCurveTo(_[1]+Y,_[2]+oe,O+Y,j+oe,C+Y,A+oe);break;case"Q":f.quadraticCurveTo(_[1]+Y,_[2]+oe,_[3]+Y,_[4]+oe),C=_[3],A=_[4],O=_[1],j=_[2];break;case"z":case"Z":C=u,A=S,f.closePath();break}},_render:function(f){this._renderPathCommands(f),this._renderPaintInOrder(f)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){return h(this.callSuper("toObject",f),{path:this.path.map(function(_){return _.slice()})})},toDatalessObject:function(f){var _=this.toObject(["sourcePath"].concat(f));return _.sourcePath&&delete _.path,_},_toSVG:function(){var f=g.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',f,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var f=g.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,f)+", "+c(-this.pathOffset.y,f)+")"},toClipPathSVG:function(f){var _=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:_})},toSVG:function(f){var _=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:_})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var f=[],_=[],u,S=0,C=0,A=0,O=0,j,Y=0,oe=this.path.length;Y<oe;++Y){switch(u=this.path[Y],u[0]){case"L":A=u[1],O=u[2],j=[];break;case"M":A=u[1],O=u[2],S=A,C=O,j=[];break;case"C":j=g.util.getBoundsOfCurve(A,O,u[1],u[2],u[3],u[4],u[5],u[6]),A=u[5],O=u[6];break;case"Q":j=g.util.getBoundsOfCurve(A,O,u[1],u[2],u[1],u[2],u[3],u[4]),A=u[3],O=u[4];break;case"z":case"Z":A=S,O=C;break}j.forEach(function(st){f.push(st.x),_.push(st.y)}),f.push(A),_.push(O)}var ge=x(f)||0,De=x(_)||0,qe=v(f)||0,lt=v(_)||0,_t=qe-ge,xt=lt-De;return{left:ge,top:De,width:_t,height:xt}}}),g.Path.fromObject=function(f,_){if(typeof f.sourcePath=="string"){var u=f.sourcePath;g.loadSVGFromURL(u,function(S){var C=S[0];C.setOptions(f),f.clipPath?g.util.enlivenObjects([f.clipPath],function(A){C.clipPath=A[0],_&&_(C)}):_&&_(C)})}else g.Object._fromObject("Path",f,_,"path")},g.Path.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat(["d"]),g.Path.fromElement=function(f,_,u){var S=g.parseAttributes(f,g.Path.ATTRIBUTE_NAMES);S.fromSVG=!0,_(new g.Path(S.d,h(S,u)))}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.array.min,v=g.util.array.max;g.Group||(g.Group=g.util.createClass(g.Object,g.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(h,l,c){l=l||{},this._objects=[],c&&this.callSuper("initialize",l),this._objects=h||[];for(var f=this._objects.length;f--;)this._objects[f].group=this;if(c)this._updateObjectsACoords();else{var _=l&&l.centerPoint;l.originX!==void 0&&(this.originX=l.originX),l.originY!==void 0&&(this.originY=l.originY),_||this._calcBounds(),this._updateObjectsCoords(_),delete l.centerPoint,this.callSuper("initialize",l)}this.setCoords()},_updateObjectsACoords:function(){for(var h=!0,l=this._objects.length;l--;)this._objects[l].setCoords(h)},_updateObjectsCoords:function(l){for(var l=l||this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],l)},_updateObjectCoords:function(h,l){var c=h.left,f=h.top,_=!0;h.set({left:c-l.x,top:f-l.y}),h.group=this,h.setCoords(_)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(h){var l=!!this.group;return this._restoreObjectsState(),g.util.resetObjectTransform(this),h&&(l&&g.util.removeTransformFromObject(h,this.group.calcTransformMatrix()),this._objects.push(h),h.group=this,h._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,l?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(h){return this._restoreObjectsState(),g.util.resetObjectTransform(this),this.remove(h),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(h){this.dirty=!0,h.group=this,h._set("canvas",this.canvas)},_onObjectRemoved:function(h){this.dirty=!0,delete h.group},_set:function(h,l){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(h,l);if(h==="canvas")for(;c--;)this._objects[c]._set(h,l);g.Object.prototype._set.call(this,h,l)},toObject:function(h){var l=this.includeDefaultValues,c=this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){var u=_.includeDefaultValues;_.includeDefaultValues=l;var S=_.toObject(h);return _.includeDefaultValues=u,S}),f=g.Object.prototype.toObject.call(this,h);return f.objects=c,f},toDatalessObject:function(h){var l,c=this.sourcePath;if(c)l=c;else{var f=this.includeDefaultValues;l=this._objects.map(function(u){var S=u.includeDefaultValues;u.includeDefaultValues=f;var C=u.toDatalessObject(h);return u.includeDefaultValues=S,C})}var _=g.Object.prototype.toDatalessObject.call(this,h);return _.objects=l,_},render:function(h){this._transformDone=!0,this.callSuper("render",h),this._transformDone=!1},shouldCache:function(){var h=g.Object.prototype.shouldCache.call(this);if(h){for(var l=0,c=this._objects.length;l<c;l++)if(this._objects[l].willDrawShadow())return this.ownCaching=!1,!1}return h},willDrawShadow:function(){if(g.Object.prototype.willDrawShadow.call(this))return!0;for(var h=0,l=this._objects.length;h<l;h++)if(this._objects[h].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(h){for(var l=0,c=this._objects.length;l<c;l++)this._objects[l].render(h);this._drawClipPath(h,this.clipPath)},isCacheDirty:function(h){if(this.callSuper("isCacheDirty",h))return!0;if(!this.statefullCache)return!1;for(var l=0,c=this._objects.length;l<c;l++)if(this._objects[l].isCacheDirty(!0)){if(this._cacheCanvas){var f=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-_/2,f,_)}return!0}return!1},_restoreObjectsState:function(){var h=this.calcOwnMatrix();return this._objects.forEach(function(l){g.util.addTransformToObject(l,h),delete l.group,l.setCoords()}),this},destroy:function(){return this._objects.forEach(function(h){h.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(h){h.dispose&&h.dispose()}),this._objects=[]},toActiveSelection:function(){if(!!this.canvas){var h=this._objects,l=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var f=new g.ActiveSelection([]);return f.set(c),f.type="activeSelection",l.remove(this),h.forEach(function(_){_.group=f,_.dirty=!0,l.add(_)}),f.canvas=l,f._objects=h,l._activeObject=f,f.setCoords(),f}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var h=!0;return this.forEachObject(function(l){l.setCoords(h)}),this},_calcBounds:function(h){for(var l=[],c=[],f,_,u,S=["tr","br","bl","tl"],C=0,A=this._objects.length,O,j=S.length;C<A;++C){for(f=this._objects[C],u=f.calcACoords(),O=0;O<j;O++)_=S[O],l.push(u[_].x),c.push(u[_].y);f.aCoords=u}this._getBounds(l,c,h)},_getBounds:function(h,l,c){var f=new g.Point(x(h),x(l)),_=new g.Point(v(h),v(l)),u=f.y||0,S=f.x||0,C=_.x-f.x||0,A=_.y-f.y||0;this.width=C,this.height=A,c||this.setPositionByOrigin({x:S,y:u},"left","top")},_toSVG:function(h){for(var l=["<g ","COMMON_PARTS",` >
`],c=0,f=this._objects.length;c<f;c++)l.push("		",this._objects[c].toSVG(h));return l.push(`</g>
`),l},getSvgStyles:function(){var h=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",l=this.visible?"":" visibility: hidden;";return[h,this.getSvgFilter(),l].join("")},toClipPathSVG:function(h){for(var l=[],c=0,f=this._objects.length;c<f;c++)l.push("	",this._objects[c].toClipPathSVG(h));return this._createBaseClipPathSVGMarkup(l,{reviver:h})}}),g.Group.fromObject=function(h,l){var c=h.objects,f=g.util.object.clone(h,!0);if(delete f.objects,typeof c=="string"){g.loadSVGFromURL(c,function(_){var u=g.util.groupSVGElements(_,h,c),S=f.clipPath;delete f.clipPath,u.set(f),S?g.util.enlivenObjects([S],function(C){u.clipPath=C[0],l&&l(u)}):l&&l(u)});return}g.util.enlivenObjects(c,function(_){g.util.enlivenObjectEnlivables(h,f,function(){l&&l(new g.Group(_,f,!0))})})})}(Fe),function(n){var g=n.fabric||(n.fabric={});g.ActiveSelection||(g.ActiveSelection=g.util.createClass(g.Group,{type:"activeSelection",initialize:function(x,v){v=v||{},this._objects=x||[];for(var h=this._objects.length;h--;)this._objects[h].group=this;v.originX&&(this.originX=v.originX),v.originY&&(this.originY=v.originY),this._calcBounds(),this._updateObjectsCoords(),g.Object.prototype.initialize.call(this,v),this.setCoords()},toGroup:function(){var x=this._objects.concat();this._objects=[];var v=g.Object.prototype.toObject.call(this),h=new g.Group([]);if(delete v.type,h.set(v),x.forEach(function(c){c.canvas.remove(c),c.group=h}),h._objects=x,!this.canvas)return h;var l=this.canvas;return l.add(h),l._activeObject=h,h.setCoords(),h},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(x,v,h){x.save(),x.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",x,v),h=h||{},typeof h.hasControls>"u"&&(h.hasControls=!1),h.forActiveSelection=!0;for(var l=0,c=this._objects.length;l<c;l++)this._objects[l]._renderControls(x,h);x.restore()}}),g.ActiveSelection.fromObject=function(x,v){g.util.enlivenObjects(x.objects,function(h){delete x.objects,v&&v(new g.ActiveSelection(h,x,!0))})})}(Fe),function(n){var g=I.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){I.warn("fabric.Image is already defined.");return}I.Image=I.util.createClass(I.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:I.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:I.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(x,v){v||(v={}),this.filters=[],this.cacheKey="texture"+I.Object.__uid++,this.callSuper("initialize",v),this._initElement(x,v)},getElement:function(){return this._element||{}},setElement:function(x,v){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=x,this._originalElement=x,this._initConfig(v),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(x){var v=I.filterBackend;v&&v.evictCachesForKey&&v.evictCachesForKey(x)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(x){I.util.cleanUpJsdomNode(this[x]),this[x]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var x=this.getElement();return{width:x.naturalWidth||x.width,height:x.naturalHeight||x.height}},_stroke:function(x){if(!(!this.stroke||this.strokeWidth===0)){var v=this.width/2,h=this.height/2;x.beginPath(),x.moveTo(-v,-h),x.lineTo(v,-h),x.lineTo(v,h),x.lineTo(-v,h),x.lineTo(-v,-h),x.closePath()}},toObject:function(x){var v=[];this.filters.forEach(function(l){l&&v.push(l.toObject())});var h=g(this.callSuper("toObject",["cropX","cropY"].concat(x)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:v});return this.resizeFilter&&(h.resizeFilter=this.resizeFilter.toObject()),h},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var x=[],v=[],h,l=this._element,c=-this.width/2,f=-this.height/2,_="",u="";if(!l)return[];if(this.hasCrop()){var S=I.Object.__uid++;x.push('<clipPath id="imageCrop_'+S+`">
`,'	<rect x="'+c+'" y="'+f+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),_=' clip-path="url(#imageCrop_'+S+')" '}if(this.imageSmoothing||(u='" image-rendering="optimizeSpeed'),v.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',f-this.cropY,'" width="',l.width||l.naturalWidth,'" height="',l.height||l.height,u,'"',_,`></image>
`),this.stroke||this.strokeDashArray){var C=this.fill;this.fill=null,h=["	<rect ",'x="',c,'" y="',f,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=C}return this.paintFirst!=="fill"?x=x.concat(h,v):x=x.concat(v,h),x},getSrc:function(x){var v=x?this._element:this._originalElement;return v?v.toDataURL?v.toDataURL():this.srcFromAttribute?v.getAttribute("src"):v.src:this.src||""},setSrc:function(x,v,h){return I.util.loadImage(x,function(l,c){this.setElement(l,h),this._setWidthHeight(),v&&v(this,c)},this,h&&h.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var x=this.resizeFilter,v=this.minimumScaleTrigger,h=this.getTotalObjectScaling(),l=h.scaleX,c=h.scaleY,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!x||l>v&&c>v){this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=l,this._lastScaleY=c;return}I.filterBackend||(I.filterBackend=I.initFilterBackend());var _=I.util.createCanvasElement(),u=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,S=f.width,C=f.height;_.width=S,_.height=C,this._element=_,this._lastScaleX=x.scaleX=l,this._lastScaleY=x.scaleY=c,I.filterBackend.applyFilters([x],f,S,C,this._element,u),this._filterScalingX=_.width/this._originalElement.width,this._filterScalingY=_.height/this._originalElement.height},applyFilters:function(x){if(x=x||this.filters||[],x=x.filter(function(f){return f&&!f.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),x.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var v=this._originalElement,h=v.naturalWidth||v.width,l=v.naturalHeight||v.height;if(this._element===this._originalElement){var c=I.util.createCanvasElement();c.width=h,c.height=l,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,h,l),this._lastScaleX=1,this._lastScaleY=1;return I.filterBackend||(I.filterBackend=I.initFilterBackend()),I.filterBackend.applyFilters(x,this._originalElement,h,l,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(x){I.util.setImageSmoothing(x,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(x),this._renderPaintInOrder(x)},drawCacheOnCanvas:function(x){I.util.setImageSmoothing(x,this.imageSmoothing),I.Object.prototype.drawCacheOnCanvas.call(this,x)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(x){var v=this._element;if(!!v){var h=this._filterScalingX,l=this._filterScalingY,c=this.width,f=this.height,_=Math.min,u=Math.max,S=u(this.cropX,0),C=u(this.cropY,0),A=v.naturalWidth||v.width,O=v.naturalHeight||v.height,j=S*h,Y=C*l,oe=_(c*h,A-j),ge=_(f*l,O-Y),De=-c/2,qe=-f/2,lt=_(c,A/h-S),_t=_(f,O/l-C);v&&x.drawImage(v,j,Y,oe,ge,De,qe,lt,_t)}},_needsResize:function(){var x=this.getTotalObjectScaling();return x.scaleX!==this._lastScaleX||x.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(x,v){this.setElement(I.util.getById(x),v),I.util.addClass(this.getElement(),I.Image.CSS_CANVAS)},_initConfig:function(x){x||(x={}),this.setOptions(x),this._setWidthHeight(x)},_initFilters:function(x,v){x&&x.length?I.util.enlivenObjects(x,function(h){v&&v(h)},"fabric.Image.filters"):v&&v()},_setWidthHeight:function(x){x||(x={});var v=this.getElement();this.width=x.width||v.naturalWidth||v.width||0,this.height=x.height||v.naturalHeight||v.height||0},parsePreserveAspectRatioAttribute:function(){var x=I.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),v=this._element.width,h=this._element.height,l=1,c=1,f=0,_=0,u=0,S=0,C,A=this.width,O=this.height,j={width:A,height:O};return x&&(x.alignX!=="none"||x.alignY!=="none")?(x.meetOrSlice==="meet"&&(l=c=I.util.findScaleToFit(this._element,j),C=(A-v*l)/2,x.alignX==="Min"&&(f=-C),x.alignX==="Max"&&(f=C),C=(O-h*c)/2,x.alignY==="Min"&&(_=-C),x.alignY==="Max"&&(_=C)),x.meetOrSlice==="slice"&&(l=c=I.util.findScaleToCover(this._element,j),C=v-A/l,x.alignX==="Mid"&&(u=C/2),x.alignX==="Max"&&(u=C),C=h-O/c,x.alignY==="Mid"&&(S=C/2),x.alignY==="Max"&&(S=C),v=A/l,h=O/c)):(l=A/v,c=O/h),{width:v,height:h,scaleX:l,scaleY:c,offsetLeft:f,offsetTop:_,cropX:u,cropY:S}}}),I.Image.CSS_CANVAS="canvas-img",I.Image.prototype.getSvgSrc=I.Image.prototype.getSrc,I.Image.fromObject=function(x,v){var h=I.util.object.clone(x);I.util.loadImage(h.src,function(l,c){if(c){v&&v(null,!0);return}I.Image.prototype._initFilters.call(h,h.filters,function(f){h.filters=f||[],I.Image.prototype._initFilters.call(h,[h.resizeFilter],function(_){h.resizeFilter=_[0],I.util.enlivenObjectEnlivables(h,h,function(){var u=new I.Image(l,h);v(u,!1)})})})},null,h.crossOrigin)},I.Image.fromURL=function(x,v,h){I.util.loadImage(x,function(l,c){v&&v(new I.Image(l,h),c)},null,h&&h.crossOrigin)},I.Image.ATTRIBUTE_NAMES=I.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),I.Image.fromElement=function(x,v,h){var l=I.parseAttributes(x,I.Image.ATTRIBUTE_NAMES);I.Image.fromURL(l["xlink:href"],v,g(h?I.util.object.clone(h):{},l))}}(Fe),I.util.object.extend(I.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.angle%360;return n>0?Math.round((n-1)/90)*90:Math.round(n/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(n){n=n||{};var g=function(){},x=n.onComplete||g,v=n.onChange||g,h=this;return I.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(l){h.rotate(l),v()},onComplete:function(){h.setCoords(),x()}})}}),I.util.object.extend(I.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function n(x,v){var h="precision "+v+` float;
void main(){}`,l=x.createShader(x.FRAGMENT_SHADER);return x.shaderSource(l,h),x.compileShader(l),!!x.getShaderParameter(l,x.COMPILE_STATUS)}I.isWebglSupported=function(x){if(I.isLikelyNode)return!1;x=x||I.WebglFilterBackend.prototype.tileSize;var v=document.createElement("canvas"),h=v.getContext("webgl")||v.getContext("experimental-webgl"),l=!1;if(h){I.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE),l=I.maxTextureSize>=x;for(var c=["highp","mediump","lowp"],f=0;f<3;f++)if(n(h,c[f])){I.webGlPrecision=c[f];break}}return this.isSupported=l,l},I.WebglFilterBackend=g;function g(x){x&&x.tileSize&&(this.tileSize=x.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}g.prototype={tileSize:2048,resources:{},setupGLContext:function(x,v){this.dispose(),this.createWebGLCanvas(x,v),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(x,v)},chooseFastestCopyGLTo2DMethod:function(x,v){var h=typeof window.performance<"u",l;try{new ImageData(1,1),l=!0}catch{l=!1}var c=typeof ArrayBuffer<"u",f=typeof Uint8ClampedArray<"u";if(!!(h&&l&&c&&f)){var _=I.util.createCanvasElement(),u=new ArrayBuffer(x*v*4);if(I.forceGLPutImageData){this.imageBuffer=u,this.copyGLTo2D=Mt;return}var S={imageBuffer:u,destinationWidth:x,destinationHeight:v,targetCanvas:_},C,A,O;_.width=x,_.height=v,C=window.performance.now(),At.call(S,this.gl,S),A=window.performance.now()-C,C=window.performance.now(),Mt.call(S,this.gl,S),O=window.performance.now()-C,A>O?(this.imageBuffer=u,this.copyGLTo2D=Mt):this.copyGLTo2D=At}},createWebGLCanvas:function(x,v){var h=I.util.createCanvasElement();h.width=x,h.height=v;var l={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=h.getContext("webgl",l);c||(c=h.getContext("experimental-webgl",l)),c&&(c.clearColor(0,0,0,0),this.canvas=h,this.gl=c)},applyFilters:function(x,v,h,l,c,f){var _=this.gl,u;f&&(u=this.getCachedTexture(f,v));var S={originalWidth:v.width||v.originalWidth,originalHeight:v.height||v.originalHeight,sourceWidth:h,sourceHeight:l,destinationWidth:h,destinationHeight:l,context:_,sourceTexture:this.createTexture(_,h,l,!u&&v),targetTexture:this.createTexture(_,h,l),originalTexture:u||this.createTexture(_,h,l,!u&&v),passes:x.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},C=_.createFramebuffer();return _.bindFramebuffer(_.FRAMEBUFFER,C),x.forEach(function(A){A&&A.applyTo(S)}),wt(S),this.copyGLTo2D(_,S),_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(S.sourceTexture),_.deleteTexture(S.targetTexture),_.deleteFramebuffer(C),c.getContext("2d").setTransform(1,0,0,1,0,0),S},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(x,v,h,l){var c=x.createTexture();return x.bindTexture(x.TEXTURE_2D,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),l?x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,l):x.texImage2D(x.TEXTURE_2D,0,x.RGBA,v,h,0,x.RGBA,x.UNSIGNED_BYTE,null),c},getCachedTexture:function(x,v){if(this.textureCache[x])return this.textureCache[x];var h=this.createTexture(this.gl,v.width,v.height,v);return this.textureCache[x]=h,h},evictCachesForKey:function(x){this.textureCache[x]&&(this.gl.deleteTexture(this.textureCache[x]),delete this.textureCache[x])},copyGLTo2D:At,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var x=this.gl,v={renderer:"",vendor:""};if(!x)return v;var h=x.getExtension("WEBGL_debug_renderer_info");if(h){var l=x.getParameter(h.UNMASKED_RENDERER_WEBGL),c=x.getParameter(h.UNMASKED_VENDOR_WEBGL);l&&(v.renderer=l.toLowerCase()),c&&(v.vendor=c.toLowerCase())}return this.gpuInfo=v,v}}}();function wt(n){var g=n.targetCanvas,x=g.width,v=g.height,h=n.destinationWidth,l=n.destinationHeight;(x!==h||v!==l)&&(g.width=h,g.height=l)}function At(n,g){var x=n.canvas,v=g.targetCanvas,h=v.getContext("2d");h.translate(0,v.height),h.scale(1,-1);var l=x.height-v.height;h.drawImage(x,0,l,v.width,v.height,0,0,v.width,v.height)}function Mt(n,g){var x=g.targetCanvas,v=x.getContext("2d"),h=g.destinationWidth,l=g.destinationHeight,c=h*l*4,f=new Uint8Array(this.imageBuffer,0,c),_=new Uint8ClampedArray(this.imageBuffer,0,c);n.readPixels(0,0,h,l,n.RGBA,n.UNSIGNED_BYTE,f);var u=new ImageData(_,h,l);v.putImageData(u,0,0)}(function(){var n=function(){};I.Canvas2dFilterBackend=g;function g(){}g.prototype={evictCachesForKey:n,dispose:n,clearWebGLCaches:n,resources:{},applyFilters:function(x,v,h,l,c){var f=c.getContext("2d");f.drawImage(v,0,0,h,l);var _=f.getImageData(0,0,h,l),u=f.getImageData(0,0,h,l),S={sourceWidth:h,sourceHeight:l,imageData:_,originalEl:v,originalImageData:u,canvasEl:c,ctx:f,filterBackend:this};return x.forEach(function(C){C.applyTo(S)}),(S.imageData.width!==h||S.imageData.height!==l)&&(c.width=S.imageData.width,c.height=S.imageData.height),f.putImageData(S.imageData,0,0),S}}})(),I.Image=I.Image||{},I.Image.filters=I.Image.filters||{},I.Image.filters.BaseFilter=I.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(n){n&&this.setOptions(n)},setOptions:function(n){for(var g in n)this[g]=n[g]},createProgram:function(n,g,x){g=g||this.fragmentSource,x=x||this.vertexSource,I.webGlPrecision!=="highp"&&(g=g.replace(/precision highp float/g,"precision "+I.webGlPrecision+" float"));var v=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(v,x),n.compileShader(v),!n.getShaderParameter(v,n.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+n.getShaderInfoLog(v));var h=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(h,g),n.compileShader(h),!n.getShaderParameter(h,n.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+n.getShaderInfoLog(h));var l=n.createProgram();if(n.attachShader(l,v),n.attachShader(l,h),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+n.getProgramInfoLog(l));var c=this.getAttributeLocations(n,l),f=this.getUniformLocations(n,l)||{};return f.uStepW=n.getUniformLocation(l,"uStepW"),f.uStepH=n.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:c,uniformLocations:f}},getAttributeLocations:function(n,g){return{aPosition:n.getAttribLocation(g,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(n,g,x){var v=g.aPosition,h=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,h),n.enableVertexAttribArray(v),n.vertexAttribPointer(v,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,x,n.STATIC_DRAW)},_setupFrameBuffer:function(n){var g=n.context,x,v;n.passes>1?(x=n.destinationWidth,v=n.destinationHeight,(n.sourceWidth!==x||n.sourceHeight!==v)&&(g.deleteTexture(n.targetTexture),n.targetTexture=n.filterBackend.createTexture(g,x,v)),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,n.targetTexture,0)):(g.bindFramebuffer(g.FRAMEBUFFER,null),g.finish())},_swapTextures:function(n){n.passes--,n.pass++;var g=n.targetTexture;n.targetTexture=n.sourceTexture,n.sourceTexture=g},isNeutralState:function(){var n=this.mainParameter,g=I.Image.filters[this.type].prototype;if(n)if(Array.isArray(g[n])){for(var x=g[n].length;x--;)if(this[n][x]!==g[n][x])return!1;return!0}else return g[n]===this[n];else return!1},applyTo:function(n){n.webgl?(this._setupFrameBuffer(n),this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},retrieveShader:function(n){return n.programCache.hasOwnProperty(this.type)||(n.programCache[this.type]=this.createProgram(n.context)),n.programCache[this.type]},applyToWebGL:function(n){var g=n.context,x=this.retrieveShader(n);n.pass===0&&n.originalTexture?g.bindTexture(g.TEXTURE_2D,n.originalTexture):g.bindTexture(g.TEXTURE_2D,n.sourceTexture),g.useProgram(x.program),this.sendAttributeData(g,x.attributeLocations,n.aPosition),g.uniform1f(x.uniformLocations.uStepW,1/n.sourceWidth),g.uniform1f(x.uniformLocations.uStepH,1/n.sourceHeight),this.sendUniformData(g,x.uniformLocations),g.viewport(0,0,n.destinationWidth,n.destinationHeight),g.drawArrays(g.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(n,g,x){n.activeTexture(x),n.bindTexture(n.TEXTURE_2D,g),n.activeTexture(n.TEXTURE0)},unbindAdditionalTexture:function(n,g){n.activeTexture(g),n.bindTexture(n.TEXTURE_2D,null),n.activeTexture(n.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(n){this[this.mainParameter]=n},sendUniformData:function(){},createHelpLayer:function(n){if(!n.helpLayer){var g=document.createElement("canvas");g.width=n.sourceWidth,g.height=n.sourceHeight,n.helpLayer=g}},toObject:function(){var n={type:this.type},g=this.mainParameter;return g&&(n[g]=this[g]),n},toJSON:function(){return this.toObject()}}),I.Image.filters.BaseFilter.fromObject=function(n,g){var x=new I.Image.filters[n.type](n);return g&&g(x),x},function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.ColorMatrix=v(x.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(h){this.callSuper("initialize",h),this.matrix=this.matrix.slice(0)},applyTo2d:function(h){var l=h.imageData,c=l.data,f=c.length,_=this.matrix,u,S,C,A,O,j=this.colorsOnly;for(O=0;O<f;O+=4)u=c[O],S=c[O+1],C=c[O+2],j?(c[O]=u*_[0]+S*_[1]+C*_[2]+_[4]*255,c[O+1]=u*_[5]+S*_[6]+C*_[7]+_[9]*255,c[O+2]=u*_[10]+S*_[11]+C*_[12]+_[14]*255):(A=c[O+3],c[O]=u*_[0]+S*_[1]+C*_[2]+A*_[3]+_[4]*255,c[O+1]=u*_[5]+S*_[6]+C*_[7]+A*_[8]+_[9]*255,c[O+2]=u*_[10]+S*_[11]+C*_[12]+A*_[13]+_[14]*255,c[O+3]=u*_[15]+S*_[16]+C*_[17]+A*_[18]+_[19]*255)},getUniformLocations:function(h,l){return{uColorMatrix:h.getUniformLocation(l,"uColorMatrix"),uConstants:h.getUniformLocation(l,"uConstants")}},sendUniformData:function(h,l){var c=this.matrix,f=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],_=[c[4],c[9],c[14],c[19]];h.uniformMatrix4fv(l.uColorMatrix,!1,f),h.uniform4fv(l.uConstants,_)}}),g.Image.filters.ColorMatrix.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Brightness=v(x.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(h){if(this.brightness!==0){var l=h.imageData,c=l.data,f,_=c.length,u=Math.round(this.brightness*255);for(f=0;f<_;f+=4)c[f]=c[f]+u,c[f+1]=c[f+1]+u,c[f+2]=c[f+2]+u}},getUniformLocations:function(h,l){return{uBrightness:h.getUniformLocation(l,"uBrightness")}},sendUniformData:function(h,l){h.uniform1f(l.uBrightness,this.brightness)}}),g.Image.filters.Brightness.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.Image.filters,h=g.util.createClass;v.Convolute=h(v.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(l){var c=Math.sqrt(this.matrix.length),f=this.type+"_"+c+"_"+(this.opaque?1:0),_=this.fragmentSource[f];return l.programCache.hasOwnProperty(f)||(l.programCache[f]=this.createProgram(l.context,_)),l.programCache[f]},applyTo2d:function(l){var c=l.imageData,f=c.data,_=this.matrix,u=Math.round(Math.sqrt(_.length)),S=Math.floor(u/2),C=c.width,A=c.height,O=l.ctx.createImageData(C,A),j=O.data,Y=this.opaque?1:0,oe,ge,De,qe,lt,_t,xt,st,yt,it,Rt,Pt,Q;for(Rt=0;Rt<A;Rt++)for(it=0;it<C;it++){for(lt=(Rt*C+it)*4,oe=0,ge=0,De=0,qe=0,Q=0;Q<u;Q++)for(Pt=0;Pt<u;Pt++)xt=Rt+Q-S,_t=it+Pt-S,!(xt<0||xt>=A||_t<0||_t>=C)&&(st=(xt*C+_t)*4,yt=_[Q*u+Pt],oe+=f[st]*yt,ge+=f[st+1]*yt,De+=f[st+2]*yt,Y||(qe+=f[st+3]*yt));j[lt]=oe,j[lt+1]=ge,j[lt+2]=De,Y?j[lt+3]=f[lt+3]:j[lt+3]=qe}l.imageData=O},getUniformLocations:function(l,c){return{uMatrix:l.getUniformLocation(c,"uMatrix"),uOpaque:l.getUniformLocation(c,"uOpaque"),uHalfSize:l.getUniformLocation(c,"uHalfSize"),uSize:l.getUniformLocation(c,"uSize")}},sendUniformData:function(l,c){l.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return x(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),g.Image.filters.Convolute.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Grayscale=v(x.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(h){var l=h.imageData,c=l.data,f,_=c.length,u,S=this.mode;for(f=0;f<_;f+=4)S==="average"?u=(c[f]+c[f+1]+c[f+2])/3:S==="lightness"?u=(Math.min(c[f],c[f+1],c[f+2])+Math.max(c[f],c[f+1],c[f+2]))/2:S==="luminosity"&&(u=.21*c[f]+.72*c[f+1]+.07*c[f+2]),c[f]=u,c[f+1]=u,c[f+2]=u},retrieveShader:function(h){var l=this.type+"_"+this.mode;if(!h.programCache.hasOwnProperty(l)){var c=this.fragmentSource[this.mode];h.programCache[l]=this.createProgram(h.context,c)}return h.programCache[l]},getUniformLocations:function(h,l){return{uMode:h.getUniformLocation(l,"uMode")}},sendUniformData:function(h,l){var c=1;h.uniform1i(l.uMode,c)},isNeutralState:function(){return!1}}),g.Image.filters.Grayscale.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Invert=v(x.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(h){var l=h.imageData,c=l.data,f,_=c.length;for(f=0;f<_;f+=4)c[f]=255-c[f],c[f+1]=255-c[f+1],c[f+2]=255-c[f+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(h,l){return{uInvert:h.getUniformLocation(l,"uInvert")}},sendUniformData:function(h,l){h.uniform1i(l.uInvert,this.invert)}}),g.Image.filters.Invert.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.Image.filters,h=g.util.createClass;v.Noise=h(v.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(l){if(this.noise!==0){var c=l.imageData,f=c.data,_,u=f.length,S=this.noise,C;for(_=0,u=f.length;_<u;_+=4)C=(.5-Math.random())*S,f[_]+=C,f[_+1]+=C,f[_+2]+=C}},getUniformLocations:function(l,c){return{uNoise:l.getUniformLocation(c,"uNoise"),uSeed:l.getUniformLocation(c,"uSeed")}},sendUniformData:function(l,c){l.uniform1f(c.uNoise,this.noise/255),l.uniform1f(c.uSeed,Math.random())},toObject:function(){return x(this.callSuper("toObject"),{noise:this.noise})}}),g.Image.filters.Noise.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Pixelate=v(x.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(h){var l=h.imageData,c=l.data,f=l.height,_=l.width,u,S,C,A,O,j,Y,oe,ge,De,qe;for(S=0;S<f;S+=this.blocksize)for(C=0;C<_;C+=this.blocksize)for(u=S*4*_+C*4,A=c[u],O=c[u+1],j=c[u+2],Y=c[u+3],De=Math.min(S+this.blocksize,f),qe=Math.min(C+this.blocksize,_),oe=S;oe<De;oe++)for(ge=C;ge<qe;ge++)u=oe*4*_+ge*4,c[u]=A,c[u+1]=O,c[u+2]=j,c[u+3]=Y},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(h,l){return{uBlocksize:h.getUniformLocation(l,"uBlocksize"),uStepW:h.getUniformLocation(l,"uStepW"),uStepH:h.getUniformLocation(l,"uStepH")}},sendUniformData:function(h,l){h.uniform1f(l.uBlocksize,this.blocksize)}}),g.Image.filters.Pixelate.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.extend,v=g.Image.filters,h=g.util.createClass;v.RemoveColor=h(v.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(l){var c=l.imageData,f=c.data,_,u=this.distance*255,S,C,A,O=new g.Color(this.color).getSource(),j=[O[0]-u,O[1]-u,O[2]-u],Y=[O[0]+u,O[1]+u,O[2]+u];for(_=0;_<f.length;_+=4)S=f[_],C=f[_+1],A=f[_+2],S>j[0]&&C>j[1]&&A>j[2]&&S<Y[0]&&C<Y[1]&&A<Y[2]&&(f[_+3]=0)},getUniformLocations:function(l,c){return{uLow:l.getUniformLocation(c,"uLow"),uHigh:l.getUniformLocation(c,"uHigh")}},sendUniformData:function(l,c){var f=new g.Color(this.color).getSource(),_=parseFloat(this.distance),u=[0+f[0]/255-_,0+f[1]/255-_,0+f[2]/255-_,1],S=[f[0]/255+_,f[1]/255+_,f[2]/255+_,1];l.uniform4fv(c.uLow,u),l.uniform4fv(c.uHigh,S)},toObject:function(){return x(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),g.Image.filters.RemoveColor.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass,h={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var l in h)x[l]=v(x.ColorMatrix,{type:l,matrix:h[l],mainParameter:!1,colorsOnly:!0}),g.Image.filters[l].fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric,x=g.Image.filters,v=g.util.createClass;x.BlendColor=v(x.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(h){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[h]+`}
}`},retrieveShader:function(h){var l=this.type+"_"+this.mode,c;return h.programCache.hasOwnProperty(l)||(c=this.buildSource(this.mode),h.programCache[l]=this.createProgram(h.context,c)),h.programCache[l]},applyTo2d:function(h){var l=h.imageData,c=l.data,f=c.length,_,u,S,C,A,O,j,Y=1-this.alpha;j=new g.Color(this.color).getSource(),_=j[0]*this.alpha,u=j[1]*this.alpha,S=j[2]*this.alpha;for(var oe=0;oe<f;oe+=4)switch(C=c[oe],A=c[oe+1],O=c[oe+2],this.mode){case"multiply":c[oe]=C*_/255,c[oe+1]=A*u/255,c[oe+2]=O*S/255;break;case"screen":c[oe]=255-(255-C)*(255-_)/255,c[oe+1]=255-(255-A)*(255-u)/255,c[oe+2]=255-(255-O)*(255-S)/255;break;case"add":c[oe]=C+_,c[oe+1]=A+u,c[oe+2]=O+S;break;case"diff":case"difference":c[oe]=Math.abs(C-_),c[oe+1]=Math.abs(A-u),c[oe+2]=Math.abs(O-S);break;case"subtract":c[oe]=C-_,c[oe+1]=A-u,c[oe+2]=O-S;break;case"darken":c[oe]=Math.min(C,_),c[oe+1]=Math.min(A,u),c[oe+2]=Math.min(O,S);break;case"lighten":c[oe]=Math.max(C,_),c[oe+1]=Math.max(A,u),c[oe+2]=Math.max(O,S);break;case"overlay":c[oe]=_<128?2*C*_/255:255-2*(255-C)*(255-_)/255,c[oe+1]=u<128?2*A*u/255:255-2*(255-A)*(255-u)/255,c[oe+2]=S<128?2*O*S/255:255-2*(255-O)*(255-S)/255;break;case"exclusion":c[oe]=_+C-2*_*C/255,c[oe+1]=u+A-2*u*A/255,c[oe+2]=S+O-2*S*O/255;break;case"tint":c[oe]=_+C*Y,c[oe+1]=u+A*Y,c[oe+2]=S+O*Y}},getUniformLocations:function(h,l){return{uColor:h.getUniformLocation(l,"uColor")}},sendUniformData:function(h,l){var c=new g.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,h.uniform4fv(l.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),g.Image.filters.BlendColor.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric,x=g.Image.filters,v=g.util.createClass;x.BlendImage=v(x.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(h){var l=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return h.programCache.hasOwnProperty(l)||(h.programCache[l]=this.createProgram(h.context,c)),h.programCache[l]},applyToWebGL:function(h){var l=h.context,c=this.createTexture(h.filterBackend,this.image);this.bindAdditionalTexture(l,c,l.TEXTURE1),this.callSuper("applyToWebGL",h),this.unbindAdditionalTexture(l,l.TEXTURE1)},createTexture:function(h,l){return h.getCachedTexture(l.cacheKey,l._element)},calculateMatrix:function(){var h=this.image,l=h._element.width,c=h._element.height;return[1/h.scaleX,0,0,0,1/h.scaleY,0,-h.left/l,-h.top/c,1]},applyTo2d:function(h){var l=h.imageData,c=h.filterBackend.resources,f=l.data,_=f.length,u=l.width,S=l.height,C,A,O,j,Y,oe,ge,De,qe,lt,_t=this.image,xt;c.blendImage||(c.blendImage=g.util.createCanvasElement()),qe=c.blendImage,lt=qe.getContext("2d"),qe.width!==u||qe.height!==S?(qe.width=u,qe.height=S):lt.clearRect(0,0,u,S),lt.setTransform(_t.scaleX,0,0,_t.scaleY,_t.left,_t.top),lt.drawImage(_t._element,0,0,u,S),xt=lt.getImageData(0,0,u,S).data;for(var st=0;st<_;st+=4)switch(Y=f[st],oe=f[st+1],ge=f[st+2],De=f[st+3],C=xt[st],A=xt[st+1],O=xt[st+2],j=xt[st+3],this.mode){case"multiply":f[st]=Y*C/255,f[st+1]=oe*A/255,f[st+2]=ge*O/255,f[st+3]=De*j/255;break;case"mask":f[st+3]=j;break}},getUniformLocations:function(h,l){return{uTransformMatrix:h.getUniformLocation(l,"uTransformMatrix"),uImage:h.getUniformLocation(l,"uImage")}},sendUniformData:function(h,l){var c=this.calculateMatrix();h.uniform1i(l.uImage,1),h.uniformMatrix3fv(l.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),g.Image.filters.BlendImage.fromObject=function(h,l){g.Image.fromObject(h.image,function(c){var f=g.util.object.clone(h);f.image=c,l(new g.Image.filters.BlendImage(f))})}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=Math.pow,v=Math.floor,h=Math.sqrt,l=Math.abs,c=Math.round,f=Math.sin,_=Math.ceil,u=g.Image.filters,S=g.util.createClass;u.Resize=S(u.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(C,A){return{uDelta:C.getUniformLocation(A,"uDelta"),uTaps:C.getUniformLocation(A,"uTaps")}},sendUniformData:function(C,A){C.uniform2fv(A.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),C.uniform1fv(A.uTaps,this.taps)},retrieveShader:function(C){var A=this.getFilterWindow(),O=this.type+"_"+A;if(!C.programCache.hasOwnProperty(O)){var j=this.generateShader(A);C.programCache[O]=this.createProgram(C.context,j)}return C.programCache[O]},getFilterWindow:function(){var C=this.tempScale;return Math.ceil(this.lanczosLobes/C)},getTaps:function(){for(var C=this.lanczosCreate(this.lanczosLobes),A=this.tempScale,O=this.getFilterWindow(),j=new Array(O),Y=1;Y<=O;Y++)j[Y-1]=C(Y*A);return j},generateShader:function(j){for(var A=new Array(j),O=this.fragmentSourceTOP,j,Y=1;Y<=j;Y++)A[Y-1]=Y+".0 * uDelta";return O+="uniform float uTaps["+j+`];
`,O+=`void main() {
`,O+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,O+=`  float sum = 1.0;
`,A.forEach(function(oe,ge){O+="  color += texture2D(uTexture, vTexCoord + "+oe+") * uTaps["+ge+`];
`,O+="  color += texture2D(uTexture, vTexCoord - "+oe+") * uTaps["+ge+`];
`,O+="  sum += 2.0 * uTaps["+ge+`];
`}),O+=`  gl_FragColor = color / sum;
`,O+="}",O},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(C){C.webgl?(C.passes++,this.width=C.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=C.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),C.destinationWidth=this.dW,this._setupFrameBuffer(C),this.applyToWebGL(C),this._swapTextures(C),C.sourceWidth=C.destinationWidth,this.height=C.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),C.destinationHeight=this.dH,this._setupFrameBuffer(C),this.applyToWebGL(C),this._swapTextures(C),C.sourceHeight=C.destinationHeight):this.applyTo2d(C)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(C){return function(A){if(A>=C||A<=-C)return 0;if(A<11920929e-14&&A>-11920929e-14)return 1;A*=Math.PI;var O=A/C;return f(A)/A*f(O)/O}},applyTo2d:function(C){var A=C.imageData,O=this.scaleX,j=this.scaleY;this.rcpScaleX=1/O,this.rcpScaleY=1/j;var Y=A.width,oe=A.height,ge=c(Y*O),De=c(oe*j),qe;this.resizeType==="sliceHack"?qe=this.sliceByTwo(C,Y,oe,ge,De):this.resizeType==="hermite"?qe=this.hermiteFastResize(C,Y,oe,ge,De):this.resizeType==="bilinear"?qe=this.bilinearFiltering(C,Y,oe,ge,De):this.resizeType==="lanczos"&&(qe=this.lanczosResize(C,Y,oe,ge,De)),C.imageData=qe},sliceByTwo:function(C,A,O,j,Y){var oe=C.imageData,ge=.5,De=!1,qe=!1,lt=A*ge,_t=O*ge,xt=g.filterBackend.resources,st,yt,it=0,Rt=0,Pt=A,Q=0;for(xt.sliceByTwo||(xt.sliceByTwo=document.createElement("canvas")),st=xt.sliceByTwo,(st.width<A*1.5||st.height<O)&&(st.width=A*1.5,st.height=O),yt=st.getContext("2d"),yt.clearRect(0,0,A*1.5,O),yt.putImageData(oe,0,0),j=v(j),Y=v(Y);!De||!qe;)A=lt,O=_t,j<v(lt*ge)?lt=v(lt*ge):(lt=j,De=!0),Y<v(_t*ge)?_t=v(_t*ge):(_t=Y,qe=!0),yt.drawImage(st,it,Rt,A,O,Pt,Q,lt,_t),it=Pt,Rt=Q,Q+=_t;return yt.getImageData(it,Rt,j,Y)},lanczosResize:function(C,A,O,j,Y){function oe(ue){var de,je,K,W,re,ye,Ae,be,Be,Ze,nt;for(Q.x=(ue+.5)*_t,se.x=v(Q.x),de=0;de<Y;de++){for(Q.y=(de+.5)*xt,se.y=v(Q.y),re=0,ye=0,Ae=0,be=0,Be=0,je=se.x-it;je<=se.x+it;je++)if(!(je<0||je>=A)){Ze=v(1e3*l(je-Q.x)),Pt[Ze]||(Pt[Ze]={});for(var Re=se.y-Rt;Re<=se.y+Rt;Re++)Re<0||Re>=O||(nt=v(1e3*l(Re-Q.y)),Pt[Ze][nt]||(Pt[Ze][nt]=lt(h(x(Ze*st,2)+x(nt*yt,2))/1e3)),K=Pt[Ze][nt],K>0&&(W=(Re*A+je)*4,re+=K,ye+=K*ge[W],Ae+=K*ge[W+1],be+=K*ge[W+2],Be+=K*ge[W+3]))}W=(de*j+ue)*4,qe[W]=ye/re,qe[W+1]=Ae/re,qe[W+2]=be/re,qe[W+3]=Be/re}return++ue<j?oe(ue):De}var ge=C.imageData.data,De=C.ctx.createImageData(j,Y),qe=De.data,lt=this.lanczosCreate(this.lanczosLobes),_t=this.rcpScaleX,xt=this.rcpScaleY,st=2/this.rcpScaleX,yt=2/this.rcpScaleY,it=_(_t*this.lanczosLobes/2),Rt=_(xt*this.lanczosLobes/2),Pt={},Q={},se={};return oe(0)},bilinearFiltering:function(C,A,O,j,Y){var oe,ge,De,qe,lt,_t,xt,st,yt,it,Rt,Pt,Q=0,se,ue=this.rcpScaleX,de=this.rcpScaleY,je=4*(A-1),K=C.imageData,W=K.data,re=C.ctx.createImageData(j,Y),ye=re.data;for(xt=0;xt<Y;xt++)for(st=0;st<j;st++)for(lt=v(ue*st),_t=v(de*xt),yt=ue*st-lt,it=de*xt-_t,se=4*(_t*A+lt),Rt=0;Rt<4;Rt++)oe=W[se+Rt],ge=W[se+4+Rt],De=W[se+je+Rt],qe=W[se+je+4+Rt],Pt=oe*(1-yt)*(1-it)+ge*yt*(1-it)+De*it*(1-yt)+qe*yt*it,ye[Q++]=Pt;return re},hermiteFastResize:function(C,A,O,j,Y){for(var oe=this.rcpScaleX,ge=this.rcpScaleY,De=_(oe/2),qe=_(ge/2),lt=C.imageData,_t=lt.data,xt=C.ctx.createImageData(j,Y),st=xt.data,yt=0;yt<Y;yt++)for(var it=0;it<j;it++){for(var Rt=(it+yt*j)*4,Pt=0,Q=0,se=0,ue=0,de=0,je=0,K=0,W=(yt+.5)*ge,re=v(yt*ge);re<(yt+1)*ge;re++)for(var ye=l(W-(re+.5))/qe,Ae=(it+.5)*oe,be=ye*ye,Be=v(it*oe);Be<(it+1)*oe;Be++){var Ze=l(Ae-(Be+.5))/De,nt=h(be+Ze*Ze);nt>1&&nt<-1||(Pt=2*nt*nt*nt-3*nt*nt+1,Pt>0&&(Ze=4*(Be+re*A),K+=Pt*_t[Ze+3],se+=Pt,_t[Ze+3]<255&&(Pt=Pt*_t[Ze+3]/250),ue+=Pt*_t[Ze],de+=Pt*_t[Ze+1],je+=Pt*_t[Ze+2],Q+=Pt))}st[Rt]=ue/Q,st[Rt+1]=de/Q,st[Rt+2]=je/Q,st[Rt+3]=K/se}return xt},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),g.Image.filters.Resize.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Contrast=v(x.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(h){if(this.contrast!==0){var l=h.imageData,c,_,f=l.data,_=f.length,u=Math.floor(this.contrast*255),S=259*(u+255)/(255*(259-u));for(c=0;c<_;c+=4)f[c]=S*(f[c]-128)+128,f[c+1]=S*(f[c+1]-128)+128,f[c+2]=S*(f[c+2]-128)+128}},getUniformLocations:function(h,l){return{uContrast:h.getUniformLocation(l,"uContrast")}},sendUniformData:function(h,l){h.uniform1f(l.uContrast,this.contrast)}}),g.Image.filters.Contrast.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Saturation=v(x.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(h){if(this.saturation!==0){var l=h.imageData,c=l.data,f=c.length,_=-this.saturation,u,S;for(u=0;u<f;u+=4)S=Math.max(c[u],c[u+1],c[u+2]),c[u]+=S!==c[u]?(S-c[u])*_:0,c[u+1]+=S!==c[u+1]?(S-c[u+1])*_:0,c[u+2]+=S!==c[u+2]?(S-c[u+2])*_:0}},getUniformLocations:function(h,l){return{uSaturation:h.getUniformLocation(l,"uSaturation")}},sendUniformData:function(h,l){h.uniform1f(l.uSaturation,-this.saturation)}}),g.Image.filters.Saturation.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Vibrance=v(x.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(h){if(this.vibrance!==0){var l=h.imageData,c=l.data,f=c.length,_=-this.vibrance,u,S,C,A;for(u=0;u<f;u+=4)S=Math.max(c[u],c[u+1],c[u+2]),C=(c[u]+c[u+1]+c[u+2])/3,A=Math.abs(S-C)*2/255*_,c[u]+=S!==c[u]?(S-c[u])*A:0,c[u+1]+=S!==c[u+1]?(S-c[u+1])*A:0,c[u+2]+=S!==c[u+2]?(S-c[u+2])*A:0}},getUniformLocations:function(h,l){return{uVibrance:h.getUniformLocation(l,"uVibrance")}},sendUniformData:function(h,l){h.uniform1f(l.uVibrance,-this.vibrance)}}),g.Image.filters.Vibrance.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Blur=v(x.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(h){h.webgl?(this.aspectRatio=h.sourceWidth/h.sourceHeight,h.passes++,this._setupFrameBuffer(h),this.horizontal=!0,this.applyToWebGL(h),this._swapTextures(h),this._setupFrameBuffer(h),this.horizontal=!1,this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},applyTo2d:function(h){h.imageData=this.simpleBlur(h)},simpleBlur:function(h){var l=h.filterBackend.resources,c,f,_=h.imageData.width,u=h.imageData.height;l.blurLayer1||(l.blurLayer1=g.util.createCanvasElement(),l.blurLayer2=g.util.createCanvasElement()),c=l.blurLayer1,f=l.blurLayer2,(c.width!==_||c.height!==u)&&(f.width=c.width=_,f.height=c.height=u);var S=c.getContext("2d"),C=f.getContext("2d"),A=15,O,j,Y,oe,ge=this.blur*.06*.5;for(S.putImageData(h.imageData,0,0),C.clearRect(0,0,_,u),oe=-A;oe<=A;oe++)O=(Math.random()-.5)/4,j=oe/A,Y=ge*j*_+O,C.globalAlpha=1-Math.abs(j),C.drawImage(c,Y,O),S.drawImage(f,0,0),C.globalAlpha=1,C.clearRect(0,0,f.width,f.height);for(oe=-A;oe<=A;oe++)O=(Math.random()-.5)/4,j=oe/A,Y=ge*j*u+O,C.globalAlpha=1-Math.abs(j),C.drawImage(c,O,Y),S.drawImage(f,0,0),C.globalAlpha=1,C.clearRect(0,0,f.width,f.height);h.ctx.drawImage(c,0,0);var De=h.ctx.getImageData(0,0,c.width,c.height);return S.globalAlpha=1,S.clearRect(0,0,c.width,c.height),De},getUniformLocations:function(h,l){return{delta:h.getUniformLocation(l,"uDelta")}},sendUniformData:function(h,l){var c=this.chooseRightDelta();h.uniform2fv(l.delta,c)},chooseRightDelta:function(){var h=1,l=[0,0],c;return this.horizontal?this.aspectRatio>1&&(h=1/this.aspectRatio):this.aspectRatio<1&&(h=this.aspectRatio),c=h*this.blur*.12,this.horizontal?l[0]=c:l[1]=c,l}}),x.Blur.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Gamma=v(x.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(h){this.gamma=[1,1,1],x.BaseFilter.prototype.initialize.call(this,h)},applyTo2d:function(h){var l=h.imageData,c=l.data,f=this.gamma,_=c.length,u=1/f[0],S=1/f[1],C=1/f[2],A;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),A=0,_=256;A<_;A++)this.rVals[A]=Math.pow(A/255,u)*255,this.gVals[A]=Math.pow(A/255,S)*255,this.bVals[A]=Math.pow(A/255,C)*255;for(A=0,_=c.length;A<_;A+=4)c[A]=this.rVals[c[A]],c[A+1]=this.gVals[c[A+1]],c[A+2]=this.bVals[c[A+2]]},getUniformLocations:function(h,l){return{uGamma:h.getUniformLocation(l,"uGamma")}},sendUniformData:function(h,l){h.uniform3fv(l.uGamma,this.gamma)}}),g.Image.filters.Gamma.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.Composed=v(x.BaseFilter,{type:"Composed",subFilters:[],initialize:function(h){this.callSuper("initialize",h),this.subFilters=this.subFilters.slice(0)},applyTo:function(h){h.passes+=this.subFilters.length-1,this.subFilters.forEach(function(l){l.applyTo(h)})},toObject:function(){return g.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(h){return h.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(h){return!h.isNeutralState()})}}),g.Image.filters.Composed.fromObject=function(h,l){var c=h.subFilters||[],f=c.map(function(u){return new g.Image.filters[u.type](u)}),_=new g.Image.filters.Composed({subFilters:f});return l&&l(_),_}}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.Image.filters,v=g.util.createClass;x.HueRotation=v(x.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var h=this.rotation*Math.PI,l=g.util.cos(h),c=g.util.sin(h),f=1/3,_=Math.sqrt(f)*c,u=1-l;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=l+u/3,this.matrix[1]=f*u-_,this.matrix[2]=f*u+_,this.matrix[5]=f*u+_,this.matrix[6]=l+f*u,this.matrix[7]=f*u-_,this.matrix[10]=f*u-_,this.matrix[11]=f*u+_,this.matrix[12]=l+f*u},isNeutralState:function(h){return this.calculateMatrix(),x.BaseFilter.prototype.isNeutralState.call(this,h)},applyTo:function(h){this.calculateMatrix(),x.BaseFilter.prototype.applyTo.call(this,h)}}),g.Image.filters.HueRotation.fromObject=g.Image.filters.BaseFilter.fromObject}(Fe),function(n){var g=n.fabric||(n.fabric={}),x=g.util.object.clone;if(g.Text){g.warn("fabric.Text is already defined");return}var v="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");g.Text=g.util.createClass(g.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:g.Object.prototype.stateProperties.concat(v),cacheProperties:g.Object.prototype.cacheProperties.concat(v),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(h,l){this.styles=l?l.styles||{}:{},this.text=h,this.__skipDimension=!0,this.callSuper("initialize",l),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var h=this.path;h&&(h.segmentsInfo=g.util.getPathSegmentsInfo(h.path))},getMeasuringContext:function(){return g._measuringContext||(g._measuringContext=this.canvas&&this.canvas.contextCache||g.util.createCanvasElement().getContext("2d")),g._measuringContext},_splitText:function(){var h=this._splitTextIntoLines(this.text);return this.textLines=h.lines,this._textLines=h.graphemeLines,this._unwrappedTextLines=h._unwrappedLines,this._text=h.graphemeText,h},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var h,l,c,f,_,u,S,C=0,A=this._textLines.length;C<A;C++)if(!(this.textAlign!=="justify"&&(C===A-1||this.isEndOfWrapping(C)))&&(f=0,_=this._textLines[C],l=this.getLineWidth(C),l<this.width&&(S=this.textLines[C].match(this._reSpacesAndTabs)))){c=S.length,h=(this.width-l)/c;for(var O=0,j=_.length;O<=j;O++)u=this.__charBounds[C][O],this._reSpaceAndTab.test(_[O])?(u.width+=h,u.kernedWidth+=h,u.left+=f,f+=h):u.left+=f}},isEndOfWrapping:function(h){return h===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var h=this.callSuper("_getCacheCanvasDimensions"),l=this.fontSize;return h.width+=l*h.zoomX,h.height+=l*h.zoomY,h},_render:function(h){var l=this.path;l&&!l.isNotVisible()&&l._render(h),this._setTextStyles(h),this._renderTextLinesBackground(h),this._renderTextDecoration(h,"underline"),this._renderText(h),this._renderTextDecoration(h,"overline"),this._renderTextDecoration(h,"linethrough")},_renderText:function(h){this.paintFirst==="stroke"?(this._renderTextStroke(h),this._renderTextFill(h)):(this._renderTextFill(h),this._renderTextStroke(h))},_setTextStyles:function(h,l,c){if(h.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":h.textBaseline="middle";break;case"ascender":h.textBaseline="top";break;case"descender":h.textBaseline="bottom";break}h.font=this._getFontDeclaration(l,c)},calcTextWidth:function(){for(var h=this.getLineWidth(0),l=1,c=this._textLines.length;l<c;l++){var f=this.getLineWidth(l);f>h&&(h=f)}return h},_renderTextLine:function(h,l,c,f,_,u){this._renderChars(h,l,c,f,_,u)},_renderTextLinesBackground:function(h){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var l,c,f=h.fillStyle,_,u,S=this._getLeftOffset(),C=this._getTopOffset(),A=0,O=0,j,Y,oe=this.path,ge,De=0,qe=this._textLines.length;De<qe;De++){if(l=this.getHeightOfLine(De),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",De)){C+=l;continue}_=this._textLines[De],c=this._getLineLeftOffset(De),O=0,A=0,u=this.getValueOfPropertyAt(De,0,"textBackgroundColor");for(var lt=0,_t=_.length;lt<_t;lt++)j=this.__charBounds[De][lt],Y=this.getValueOfPropertyAt(De,lt,"textBackgroundColor"),oe?(h.save(),h.translate(j.renderLeft,j.renderTop),h.rotate(j.angle),h.fillStyle=Y,Y&&h.fillRect(-j.width/2,-l/this.lineHeight*(1-this._fontSizeFraction),j.width,l/this.lineHeight),h.restore()):Y!==u?(ge=S+c+A,this.direction==="rtl"&&(ge=this.width-ge-O),h.fillStyle=u,u&&h.fillRect(ge,C,O,l/this.lineHeight),A=j.left,O=j.width,u=Y):O+=j.kernedWidth;Y&&!oe&&(ge=S+c+A,this.direction==="rtl"&&(ge=this.width-ge-O),h.fillStyle=Y,h.fillRect(ge,C,O,l/this.lineHeight)),C+=l}h.fillStyle=f,this._removeShadow(h)}},getFontCache:function(h){var l=h.fontFamily.toLowerCase();g.charWidthsCache[l]||(g.charWidthsCache[l]={});var c=g.charWidthsCache[l],f=h.fontStyle.toLowerCase()+"_"+(h.fontWeight+"").toLowerCase();return c[f]||(c[f]={}),c[f]},_measureChar:function(h,l,c,f){var _=this.getFontCache(l),u=this._getFontDeclaration(l),S=this._getFontDeclaration(f),C=c+h,A=u===S,O,j,Y,oe=l.fontSize/this.CACHE_FONT_SIZE,ge;if(c&&_[c]!==void 0&&(Y=_[c]),_[h]!==void 0&&(ge=O=_[h]),A&&_[C]!==void 0&&(j=_[C],ge=j-Y),O===void 0||Y===void 0||j===void 0){var De=this.getMeasuringContext();this._setTextStyles(De,l,!0)}return O===void 0&&(ge=O=De.measureText(h).width,_[h]=O),Y===void 0&&A&&c&&(Y=De.measureText(c).width,_[c]=Y),A&&j===void 0&&(j=De.measureText(C).width,_[C]=j,ge=j-Y),{width:O*oe,kernedWidth:ge*oe}},getHeightOfChar:function(h,l){return this.getValueOfPropertyAt(h,l,"fontSize")},measureLine:function(h){var l=this._measureLine(h);return this.charSpacing!==0&&(l.width-=this._getWidthOfCharSpacing()),l.width<0&&(l.width=0),l},_measureLine:function(h){var l=0,c,f,_=this._textLines[h],u,S,C=0,A=new Array(_.length),O=0,j,Y,oe=this.path,ge=this.pathSide==="right";for(this.__charBounds[h]=A,c=0;c<_.length;c++)f=_[c],S=this._getGraphemeBox(f,h,c,u),A[c]=S,l+=S.kernedWidth,u=f;if(A[c]={left:S?S.left+S.width:0,width:0,kernedWidth:0,height:this.fontSize},oe){switch(Y=oe.segmentsInfo[oe.segmentsInfo.length-1].length,j=g.util.getPointOnPath(oe.path,0,oe.segmentsInfo),j.x+=oe.pathOffset.x,j.y+=oe.pathOffset.y,this.textAlign){case"left":O=ge?Y-l:0;break;case"center":O=(Y-l)/2;break;case"right":O=ge?0:Y-l;break}for(O+=this.pathStartOffset*(ge?-1:1),c=ge?_.length-1:0;ge?c>=0:c<_.length;ge?c--:c++)S=A[c],O>Y?O%=Y:O<0&&(O+=Y),this._setGraphemeOnPath(O,S,j),O+=S.kernedWidth}return{width:l,numOfSpaces:C}},_setGraphemeOnPath:function(h,l,c){var f=h+l.kernedWidth/2,_=this.path,u=g.util.getPointOnPath(_.path,f,_.segmentsInfo);l.renderLeft=u.x-c.x,l.renderTop=u.y-c.y,l.angle=u.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(h,l,c,f,_){var u=this.getCompleteStyleDeclaration(l,c),S=f?this.getCompleteStyleDeclaration(l,c-1):{},C=this._measureChar(h,u,f,S),A=C.kernedWidth,O=C.width,j;this.charSpacing!==0&&(j=this._getWidthOfCharSpacing(),O+=j,A+=j);var Y={width:O,left:0,height:u.fontSize,kernedWidth:A,deltaY:u.deltaY};if(c>0&&!_){var oe=this.__charBounds[l][c-1];Y.left=oe.left+oe.width+C.kernedWidth-C.width}return Y},getHeightOfLine:function(h){if(this.__lineHeights[h])return this.__lineHeights[h];for(var l=this._textLines[h],c=this.getHeightOfChar(h,0),f=1,_=l.length;f<_;f++)c=Math.max(this.getHeightOfChar(h,f),c);return this.__lineHeights[h]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var h,l=0,c=0,f=this._textLines.length;c<f;c++)h=this.getHeightOfLine(c),l+=c===f-1?h/this.lineHeight:h;return l},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(h,l){h.save();for(var c=0,f=this._getLeftOffset(),_=this._getTopOffset(),u=0,S=this._textLines.length;u<S;u++){var C=this.getHeightOfLine(u),A=C/this.lineHeight,O=this._getLineLeftOffset(u);this._renderTextLine(l,h,this._textLines[u],f+O,_+c+A,u),c+=C}h.restore()},_renderTextFill:function(h){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(h,"fillText")},_renderTextStroke:function(h){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this._setLineDash(h,this.strokeDashArray),h.beginPath(),this._renderTextCommon(h,"strokeText"),h.closePath(),h.restore())},_renderChars:function(h,l,c,f,_,u){var S=this.getHeightOfLine(u),C=this.textAlign.indexOf("justify")!==-1,A,O,j="",Y,oe=0,ge,De=this.path,qe=!C&&this.charSpacing===0&&this.isEmptyStyles(u)&&!De,lt=this.direction==="ltr",_t=this.direction==="ltr"?1:-1,xt,st=l.canvas.getAttribute("dir");if(l.save(),st!==this.direction&&(l.canvas.setAttribute("dir",lt?"ltr":"rtl"),l.direction=lt?"ltr":"rtl",l.textAlign=lt?"left":"right"),_-=S*this._fontSizeFraction/this.lineHeight,qe){this._renderChar(h,l,u,0,c.join(""),f,_,S),l.restore();return}for(var yt=0,it=c.length-1;yt<=it;yt++)ge=yt===it||this.charSpacing||De,j+=c[yt],Y=this.__charBounds[u][yt],oe===0?(f+=_t*(Y.kernedWidth-Y.width),oe+=Y.width):oe+=Y.kernedWidth,C&&!ge&&this._reSpaceAndTab.test(c[yt])&&(ge=!0),ge||(A=A||this.getCompleteStyleDeclaration(u,yt),O=this.getCompleteStyleDeclaration(u,yt+1),ge=g.util.hasStyleChanged(A,O,!1)),ge&&(De?(l.save(),l.translate(Y.renderLeft,Y.renderTop),l.rotate(Y.angle),this._renderChar(h,l,u,yt,j,-oe/2,0,S),l.restore()):(xt=f,this._renderChar(h,l,u,yt,j,xt,_,S)),j="",A=O,f+=_t*oe,oe=0);l.restore()},_applyPatternGradientTransformText:function(h){var l=g.util.createCanvasElement(),c,f=this.width+this.strokeWidth,_=this.height+this.strokeWidth;return l.width=f,l.height=_,c=l.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.lineTo(f,0),c.lineTo(f,_),c.lineTo(0,_),c.closePath(),c.translate(f/2,_/2),c.fillStyle=h.toLive(c),this._applyPatternGradientTransform(c,h),c.fill(),c.createPattern(l,"no-repeat")},handleFiller:function(h,l,c){var f,_;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(f=-this.width/2,_=-this.height/2,h.translate(f,_),h[l]=this._applyPatternGradientTransformText(c),{offsetX:f,offsetY:_}):(h[l]=c.toLive(h,this),this._applyPatternGradientTransform(h,c)):(h[l]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(h,l){return h.lineWidth=l.strokeWidth,h.lineCap=this.strokeLineCap,h.lineDashOffset=this.strokeDashOffset,h.lineJoin=this.strokeLineJoin,h.miterLimit=this.strokeMiterLimit,this.handleFiller(h,"strokeStyle",l.stroke)},_setFillStyles:function(h,l){return this.handleFiller(h,"fillStyle",l.fill)},_renderChar:function(h,l,c,f,_,u,S){var C=this._getStyleDeclaration(c,f),A=this.getCompleteStyleDeclaration(c,f),O=h==="fillText"&&A.fill,j=h==="strokeText"&&A.stroke&&A.strokeWidth,Y,oe;!j&&!O||(l.save(),O&&(Y=this._setFillStyles(l,A)),j&&(oe=this._setStrokeStyles(l,A)),l.font=this._getFontDeclaration(A),C&&C.textBackgroundColor&&this._removeShadow(l),C&&C.deltaY&&(S+=C.deltaY),O&&l.fillText(_,u-Y.offsetX,S-Y.offsetY),j&&l.strokeText(_,u-oe.offsetX,S-oe.offsetY),l.restore())},setSuperscript:function(h,l){return this._setScript(h,l,this.superscript)},setSubscript:function(h,l){return this._setScript(h,l,this.subscript)},_setScript:function(h,l,c){var f=this.get2DCursorLocation(h,!0),_=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"fontSize"),u=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"deltaY"),S={fontSize:_*c.size,deltaY:u+_*c.baseline};return this.setSelectionStyles(S,h,l),this},_getLineLeftOffset:function(h){var l=this.getLineWidth(h),c=this.width-l,f=this.textAlign,_=this.direction,S,u=0,S=this.isEndOfWrapping(h);return f==="justify"||f==="justify-center"&&!S||f==="justify-right"&&!S||f==="justify-left"&&!S?0:(f==="center"&&(u=c/2),f==="right"&&(u=c),f==="justify-center"&&(u=c/2),f==="justify-right"&&(u=c),_==="rtl"&&(u-=c),u)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var h=this._forceClearCache;return h||(h=this.hasStateChanged("_dimensionAffectingProps")),h&&(this.dirty=!0,this._forceClearCache=!1),h},getLineWidth:function(h){if(this.__lineWidths[h]!==void 0)return this.__lineWidths[h];var l=this.measureLine(h),c=l.width;return this.__lineWidths[h]=c,c},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(h,l,c){var f=this._getStyleDeclaration(h,l);return f&&typeof f[c]<"u"?f[c]:this[c]},_renderTextDecoration:function(h,l){if(!(!this[l]&&!this.styleHas(l))){for(var c,f,_,u,S,C,A,O,j=this._getLeftOffset(),Y=this._getTopOffset(),oe,ge,De,qe,lt,_t,xt,st,yt=this.path,it=this._getWidthOfCharSpacing(),Rt=this.offsets[l],Pt=0,Q=this._textLines.length;Pt<Q;Pt++){if(c=this.getHeightOfLine(Pt),!this[l]&&!this.styleHas(l,Pt)){Y+=c;continue}A=this._textLines[Pt],_t=c/this.lineHeight,u=this._getLineLeftOffset(Pt),ge=0,De=0,O=this.getValueOfPropertyAt(Pt,0,l),st=this.getValueOfPropertyAt(Pt,0,"fill"),oe=Y+_t*(1-this._fontSizeFraction),f=this.getHeightOfChar(Pt,0),S=this.getValueOfPropertyAt(Pt,0,"deltaY");for(var se=0,ue=A.length;se<ue;se++)if(qe=this.__charBounds[Pt][se],lt=this.getValueOfPropertyAt(Pt,se,l),xt=this.getValueOfPropertyAt(Pt,se,"fill"),_=this.getHeightOfChar(Pt,se),C=this.getValueOfPropertyAt(Pt,se,"deltaY"),yt&&lt&&xt)h.save(),h.fillStyle=st,h.translate(qe.renderLeft,qe.renderTop),h.rotate(qe.angle),h.fillRect(-qe.kernedWidth/2,Rt*_+C,qe.kernedWidth,this.fontSize/15),h.restore();else if((lt!==O||xt!==st||_!==f||C!==S)&&De>0){var de=j+u+ge;this.direction==="rtl"&&(de=this.width-de-De),O&&st&&(h.fillStyle=st,h.fillRect(de,oe+Rt*f+S,De,this.fontSize/15)),ge=qe.left,De=qe.width,O=lt,st=xt,f=_,S=C}else De+=qe.kernedWidth;var de=j+u+ge;this.direction==="rtl"&&(de=this.width-de-De),h.fillStyle=xt,lt&&xt&&h.fillRect(de,oe+Rt*f+S,De-it,this.fontSize/15),Y+=c}this._removeShadow(h)}},_getFontDeclaration:function(h,l){var c=h||this,f=this.fontFamily,_=g.Text.genericFonts.indexOf(f.toLowerCase())>-1,u=f===void 0||f.indexOf("'")>-1||f.indexOf(",")>-1||f.indexOf('"')>-1||_?c.fontFamily:'"'+c.fontFamily+'"';return[g.isLikelyNode?c.fontWeight:c.fontStyle,g.isLikelyNode?c.fontStyle:c.fontWeight,l?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",u].join(" ")},render:function(h){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",h))},_splitTextIntoLines:function(h){for(var l=h.split(this._reNewline),c=new Array(l.length),f=[`
`],_=[],u=0;u<l.length;u++)c[u]=g.util.string.graphemeSplit(l[u]),_=_.concat(c[u],f);return _.pop(),{_unwrappedLines:c,lines:l,graphemeText:_,graphemeLines:c}},toObject:function(h){var l=v.concat(h),c=this.callSuper("toObject",l);return c.styles=g.util.stylesToArray(this.styles,this.text),c.path&&(c.path=this.path.toObject()),c},set:function(h,l){this.callSuper("set",h,l);var c=!1,f=!1;if(typeof h=="object")for(var _ in h)_==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(_)!==-1,f=f||_==="path";else c=this._dimensionAffectingProps.indexOf(h)!==-1,f=h==="path";return f&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),g.Text.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),g.Text.DEFAULT_SVG_FONT_SIZE=16,g.Text.fromElement=function(h,l,c){if(!h)return l(null);var f=g.parseAttributes(h,g.Text.ATTRIBUTE_NAMES),_=f.textAnchor||"left";if(c=g.util.object.extend(c?x(c):{},f),c.top=c.top||0,c.left=c.left||0,f.textDecoration){var u=f.textDecoration;u.indexOf("underline")!==-1&&(c.underline=!0),u.indexOf("overline")!==-1&&(c.overline=!0),u.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in f&&(c.left+=f.dx),"dy"in f&&(c.top+=f.dy),"fontSize"in c||(c.fontSize=g.Text.DEFAULT_SVG_FONT_SIZE);var S="";"textContent"in h?S=h.textContent:"firstChild"in h&&h.firstChild!==null&&"data"in h.firstChild&&h.firstChild.data!==null&&(S=h.firstChild.data),S=S.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var C=c.strokeWidth;c.strokeWidth=0;var A=new g.Text(S,c),O=A.getScaledHeight()/A.height,j=(A.height+A.strokeWidth)*A.lineHeight-A.height,Y=j*O,oe=A.getScaledHeight()+Y,ge=0;_==="center"&&(ge=A.getScaledWidth()/2),_==="right"&&(ge=A.getScaledWidth()),A.set({left:A.left-ge,top:A.top-(oe-A.fontSize*(.07+A._fontSizeFraction))/A.lineHeight,strokeWidth:typeof C<"u"?C:1}),l(A)},g.Text.fromObject=function(h,l){var c=x(h),f=h.path;return delete c.path,g.Object._fromObject("Text",c,function(_){_.styles=g.util.stylesFromArray(h.styles,h.text),f?g.Object._fromObject("Path",f,function(u){_.set("path",u),l(_)},"path"):l(_)},"text")},g.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],g.util.createAccessors&&g.util.createAccessors(g.Text)}(Fe),function(){I.util.object.extend(I.Text.prototype,{isEmptyStyles:function(n){if(!this.styles||typeof n<"u"&&!this.styles[n])return!0;var g=typeof n>"u"?this.styles:{line:this.styles[n]};for(var x in g)for(var v in g[x])for(var h in g[x][v])return!1;return!0},styleHas:function(n,g){if(!this.styles||!n||n===""||typeof g<"u"&&!this.styles[g])return!1;var x=typeof g>"u"?this.styles:{0:this.styles[g]};for(var v in x)for(var h in x[v])if(typeof x[v][h][n]<"u")return!0;return!1},cleanStyle:function(n){if(!this.styles||!n||n==="")return!1;var g=this.styles,x=0,v,h,l=!0,c=0,f;for(var _ in g){v=0;for(var u in g[_]){var f=g[_][u],S=f.hasOwnProperty(n);x++,S?(h?f[n]!==h&&(l=!1):h=f[n],f[n]===this[n]&&delete f[n]):l=!1,Object.keys(f).length!==0?v++:delete g[_][u]}v===0&&delete g[_]}for(var C=0;C<this._textLines.length;C++)c+=this._textLines[C].length;l&&x===c&&(this[n]=h,this.removeStyle(n))},removeStyle:function(n){if(!(!this.styles||!n||n==="")){var g=this.styles,x,v,h;for(v in g){x=g[v];for(h in x)delete x[h][n],Object.keys(x[h]).length===0&&delete x[h];Object.keys(x).length===0&&delete g[v]}}},_extendStyles:function(n,g){var x=this.get2DCursorLocation(n);this._getLineStyle(x.lineIndex)||this._setLineStyle(x.lineIndex),this._getStyleDeclaration(x.lineIndex,x.charIndex)||this._setStyleDeclaration(x.lineIndex,x.charIndex,{}),I.util.object.extend(this._getStyleDeclaration(x.lineIndex,x.charIndex),g)},get2DCursorLocation:function(n,g){typeof n>"u"&&(n=this.selectionStart);for(var x=g?this._unwrappedTextLines:this._textLines,v=x.length,h=0;h<v;h++){if(n<=x[h].length)return{lineIndex:h,charIndex:n};n-=x[h].length+this.missingNewlineOffset(h)}return{lineIndex:h-1,charIndex:x[h-1].length<n?x[h-1].length:n}},getSelectionStyles:function(n,g,x){typeof n>"u"&&(n=this.selectionStart||0),typeof g>"u"&&(g=this.selectionEnd||n);for(var v=[],h=n;h<g;h++)v.push(this.getStyleAtPosition(h,x));return v},getStyleAtPosition:function(n,g){var x=this.get2DCursorLocation(n),v=g?this.getCompleteStyleDeclaration(x.lineIndex,x.charIndex):this._getStyleDeclaration(x.lineIndex,x.charIndex);return v||{}},setSelectionStyles:function(n,g,x){typeof g>"u"&&(g=this.selectionStart||0),typeof x>"u"&&(x=this.selectionEnd||g);for(var v=g;v<x;v++)this._extendStyles(v,n);return this._forceClearCache=!0,this},_getStyleDeclaration:function(n,g){var x=this.styles&&this.styles[n];return x?x[g]:null},getCompleteStyleDeclaration:function(n,g){for(var x=this._getStyleDeclaration(n,g)||{},v={},h,l=0;l<this._styleProperties.length;l++)h=this._styleProperties[l],v[h]=typeof x[h]>"u"?this[h]:x[h];return v},_setStyleDeclaration:function(n,g,x){this.styles[n][g]=x},_deleteStyleDeclaration:function(n,g){delete this.styles[n][g]},_getLineStyle:function(n){return!!this.styles[n]},_setLineStyle:function(n){this.styles[n]={}},_deleteLineStyle:function(n){delete this.styles[n]}})}(),function(){function n(g){g.textDecoration&&(g.textDecoration.indexOf("underline")>-1&&(g.underline=!0),g.textDecoration.indexOf("line-through")>-1&&(g.linethrough=!0),g.textDecoration.indexOf("overline")>-1&&(g.overline=!0),delete g.textDecoration)}I.IText=I.util.createClass(I.Text,I.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(g,x){this.callSuper("initialize",g,x),this.initBehavior()},setSelectionStart:function(g){g=Math.max(g,0),this._updateAndFire("selectionStart",g)},setSelectionEnd:function(g){g=Math.min(g,this.text.length),this._updateAndFire("selectionEnd",g)},_updateAndFire:function(g,x){this[g]!==x&&(this._fireSelectionChanged(),this[g]=x),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(g){this.clearContextTop(),this.callSuper("render",g),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(g){this.callSuper("_render",g)},clearContextTop:function(g){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var x=this.canvas.contextTop,v=this.canvas.viewportTransform;x.save(),x.transform(v[0],v[1],v[2],v[3],v[4],v[5]),this.transform(x),this._clearTextArea(x),g||x.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var g=this._getCursorBoundaries(),x=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(g,x):this.renderSelection(g,x),x.restore()}},_clearTextArea:function(g){var x=this.width+4,v=this.height+4;g.clearRect(-x/2,-v/2,x,v)},_getCursorBoundaries:function(g){typeof g>"u"&&(g=this.selectionStart);var x=this._getLeftOffset(),v=this._getTopOffset(),h=this._getCursorBoundariesOffsets(g);return{left:x,top:v,leftOffset:h.left,topOffset:h.top}},_getCursorBoundariesOffsets:function(g){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var x,v,h,l=0,c=0,f,_=this.get2DCursorLocation(g);h=_.charIndex,v=_.lineIndex;for(var u=0;u<v;u++)l+=this.getHeightOfLine(u);x=this._getLineLeftOffset(v);var S=this.__charBounds[v][h];return S&&(c=S.left),this.charSpacing!==0&&h===this._textLines[v].length&&(c-=this._getWidthOfCharSpacing()),f={top:l,left:x+(c>0?c:0)},this.direction==="rtl"&&(f.left*=-1),this.cursorOffsetCache=f,this.cursorOffsetCache},renderCursor:function(g,x){var v=this.get2DCursorLocation(),h=v.lineIndex,l=v.charIndex>0?v.charIndex-1:0,c=this.getValueOfPropertyAt(h,l,"fontSize"),f=this.scaleX*this.canvas.getZoom(),_=this.cursorWidth/f,u=g.topOffset,S=this.getValueOfPropertyAt(h,l,"deltaY");u+=(1-this._fontSizeFraction)*this.getHeightOfLine(h)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(g,x),x.fillStyle=this.cursorColor||this.getValueOfPropertyAt(h,l,"fill"),x.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,x.fillRect(g.left+g.leftOffset-_/2,u+g.top+S,_,c)},renderSelection:function(g,x){for(var v=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,h=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,l=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(v),f=this.get2DCursorLocation(h),_=c.lineIndex,u=f.lineIndex,S=c.charIndex<0?0:c.charIndex,C=f.charIndex<0?0:f.charIndex,A=_;A<=u;A++){var O=this._getLineLeftOffset(A)||0,j=this.getHeightOfLine(A),Y=0,oe=0,ge=0;if(A===_&&(oe=this.__charBounds[_][S].left),A>=_&&A<u)ge=l&&!this.isEndOfWrapping(A)?this.width:this.getLineWidth(A)||5;else if(A===u)if(C===0)ge=this.__charBounds[u][C].left;else{var De=this._getWidthOfCharSpacing();ge=this.__charBounds[u][C-1].left+this.__charBounds[u][C-1].width-De}Y=j,(this.lineHeight<1||A===u&&this.lineHeight>1)&&(j/=this.lineHeight);var qe=g.left+O+oe,lt=ge-oe,_t=j,xt=0;this.inCompositionMode?(x.fillStyle=this.compositionColor||"black",_t=1,xt=j):x.fillStyle=this.selectionColor,this.direction==="rtl"&&(qe=this.width-qe-lt),x.fillRect(qe,g.top+g.topOffset+xt,lt,_t),g.topOffset+=Y}},getCurrentCharFontSize:function(){var g=this._getCurrentCharIndex();return this.getValueOfPropertyAt(g.l,g.c,"fontSize")},getCurrentCharColor:function(){var g=this._getCurrentCharIndex();return this.getValueOfPropertyAt(g.l,g.c,"fill")},_getCurrentCharIndex:function(){var g=this.get2DCursorLocation(this.selectionStart,!0),x=g.charIndex>0?g.charIndex-1:0;return{l:g.lineIndex,c:x}}}),I.IText.fromObject=function(g,x){var v=I.util.stylesFromArray(g.styles,g.text),h=Object.assign({},g,{styles:v});if(n(h),h.styles)for(var l in h.styles)for(var c in h.styles[l])n(h.styles[l][c]);I.Object._fromObject("IText",h,x,"text")}}(),function(){var n=I.util.object.clone;I.util.object.extend(I.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var g=this;this.on("added",function(){var x=g.canvas;x&&(x._hasITextHandlers||(x._hasITextHandlers=!0,g._initCanvasHandlers(x)),x._iTextInstances=x._iTextInstances||[],x._iTextInstances.push(g))})},initRemovedHandler:function(){var g=this;this.on("removed",function(){var x=g.canvas;x&&(x._iTextInstances=x._iTextInstances||[],I.util.removeFromArray(x._iTextInstances,g),x._iTextInstances.length===0&&(x._hasITextHandlers=!1,g._removeCanvasHandlers(x)))})},_initCanvasHandlers:function(g){g._mouseUpITextHandler=function(){g._iTextInstances&&g._iTextInstances.forEach(function(x){x.__isMousedown=!1})},g.on("mouse:up",g._mouseUpITextHandler)},_removeCanvasHandlers:function(g){g.off("mouse:up",g._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(g,x,v,h){var l;return l={isAborted:!1,abort:function(){this.isAborted=!0}},g.animate("_currentCursorOpacity",x,{duration:v,onComplete:function(){l.isAborted||g[h]()},onChange:function(){g.canvas&&g.selectionStart===g.selectionEnd&&g.renderCursorOrSelection()},abort:function(){return l.isAborted}}),l},_onTickComplete:function(){var g=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){g._currentTickCompleteState=g._animateCursor(g,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(g){var x=this,v=g?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){x._tick()},v)},abortCursorAnimation:function(){var g=this._currentTickState||this._currentTickCompleteState,x=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,g&&x&&x.clearContext(x.contextTop||x.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(g){var x=0,v=g-1;if(this._reSpace.test(this._text[v]))for(;this._reSpace.test(this._text[v]);)x++,v--;for(;/\S/.test(this._text[v])&&v>-1;)x++,v--;return g-x},findWordBoundaryRight:function(g){var x=0,v=g;if(this._reSpace.test(this._text[v]))for(;this._reSpace.test(this._text[v]);)x++,v++;for(;/\S/.test(this._text[v])&&v<this._text.length;)x++,v++;return g+x},findLineBoundaryLeft:function(g){for(var x=0,v=g-1;!/\n/.test(this._text[v])&&v>-1;)x++,v--;return g-x},findLineBoundaryRight:function(g){for(var x=0,v=g;!/\n/.test(this._text[v])&&v<this._text.length;)x++,v++;return g+x},searchWordBoundary:function(g,x){for(var v=this._text,h=this._reSpace.test(v[g])?g-1:g,l=v[h],c=I.reNonWord;!c.test(l)&&h>0&&h<v.length;)h+=x,l=v[h];return c.test(l)&&(h+=x===1?0:1),h},selectWord:function(g){g=g||this.selectionStart;var x=this.searchWordBoundary(g,-1),v=this.searchWordBoundary(g,1);this.selectionStart=x,this.selectionEnd=v,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(g){g=g||this.selectionStart;var x=this.findLineBoundaryLeft(g),v=this.findLineBoundaryRight(g);return this.selectionStart=x,this.selectionEnd=v,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(g){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(g),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(g){g._iTextInstances&&g._iTextInstances.forEach(function(x){x.selected=!1,x.isEditing&&x.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(g){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var x=this.getSelectionStartFromPointer(g.e),v=this.selectionStart,h=this.selectionEnd;(x!==this.__selectionStartOnMouseDown||v===h)&&(v===x||h===x)||(x>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=x):(this.selectionStart=x,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==v||this.selectionEnd!==h)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(g,x,v){var h=v.slice(0,g),l=I.util.string.graphemeSplit(h).length;if(g===x)return{selectionStart:l,selectionEnd:l};var c=v.slice(g,x),f=I.util.string.graphemeSplit(c).length;return{selectionStart:l,selectionEnd:l+f}},fromGraphemeToStringSelection:function(g,x,v){var h=v.slice(0,g),l=h.join("").length;if(g===x)return{selectionStart:l,selectionEnd:l};var c=v.slice(g,x),f=c.join("").length;return{selectionStart:l,selectionEnd:l+f}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var g=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=g.selectionStart,this.hiddenTextarea.selectionEnd=g.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=g.selectionEnd,this.inCompositionMode||(this.selectionStart=g.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var g=this._calcTextareaPosition();this.hiddenTextarea.style.left=g.left,this.hiddenTextarea.style.top=g.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var g=this.inCompositionMode?this.compositionStart:this.selectionStart,x=this._getCursorBoundaries(g),v=this.get2DCursorLocation(g),h=v.lineIndex,l=v.charIndex,c=this.getValueOfPropertyAt(h,l,"fontSize")*this.lineHeight,f=x.leftOffset,_=this.calcTransformMatrix(),u={x:x.left+f,y:x.top+x.topOffset+c},S=this.canvas.getRetinaScaling(),C=this.canvas.upperCanvasEl,A=C.width/S,O=C.height/S,j=A-c,Y=O-c,oe=C.clientWidth/A,ge=C.clientHeight/O;return u=I.util.transformPoint(u,_),u=I.util.transformPoint(u,this.canvas.viewportTransform),u.x*=oe,u.y*=ge,u.x<0&&(u.x=0),u.x>j&&(u.x=j),u.y<0&&(u.y=0),u.y>Y&&(u.y=Y),u.x+=this.canvas._offset.left,u.y+=this.canvas._offset.top,{left:u.x+"px",top:u.y+"px",fontSize:c+"px",charHeight:c}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var g=this._textBeforeEdit!==this.text,x=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,x&&(x.blur&&x.blur(),x.parentNode&&x.parentNode.removeChild(x)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),g&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),g&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var g in this.styles)this._textLines[g]||delete this.styles[g]},removeStyleFromTo:function(g,x){var v=this.get2DCursorLocation(g,!0),h=this.get2DCursorLocation(x,!0),l=v.lineIndex,c=v.charIndex,f=h.lineIndex,_=h.charIndex,u,S;if(l!==f){if(this.styles[l])for(u=c;u<this._unwrappedTextLines[l].length;u++)delete this.styles[l][u];if(this.styles[f])for(u=_;u<this._unwrappedTextLines[f].length;u++)S=this.styles[f][u],S&&(this.styles[l]||(this.styles[l]={}),this.styles[l][c+u-_]=S);for(u=l+1;u<=f;u++)delete this.styles[u];this.shiftLineStyles(f,l-f)}else if(this.styles[l]){S=this.styles[l];var C=_-c,A,O;for(u=c;u<_;u++)delete S[u];for(O in this.styles[l])A=parseInt(O,10),A>=_&&(S[A-C]=S[O],delete S[O])}},shiftLineStyles:function(g,x){var v=n(this.styles);for(var h in this.styles){var l=parseInt(h,10);l>g&&(this.styles[l+x]=v[l],v[l-x]||delete this.styles[l])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(g,x,v,h){var l,c={},f=!1,_=this._unwrappedTextLines[g].length===x;v||(v=1),this.shiftLineStyles(g,v),this.styles[g]&&(l=this.styles[g][x===0?x:x-1]);for(var u in this.styles[g]){var S=parseInt(u,10);S>=x&&(f=!0,c[S-x]=this.styles[g][u],_&&x===0||delete this.styles[g][u])}var C=!1;for(f&&!_&&(this.styles[g+v]=c,C=!0),C&&v--;v>0;)h&&h[v-1]?this.styles[g+v]={0:n(h[v-1])}:l?this.styles[g+v]={0:n(l)}:delete this.styles[g+v],v--;this._forceClearCache=!0},insertCharStyleObject:function(g,x,v,h){this.styles||(this.styles={});var l=this.styles[g],c=l?n(l):{};v||(v=1);for(var f in c){var _=parseInt(f,10);_>=x&&(l[_+v]=c[_],c[_-v]||delete l[_])}if(this._forceClearCache=!0,h){for(;v--;)!Object.keys(h[v]).length||(this.styles[g]||(this.styles[g]={}),this.styles[g][x+v]=n(h[v]));return}if(!!l)for(var u=l[x?x-1:1];u&&v--;)this.styles[g][x+v]=n(u)},insertNewStyleBlock:function(g,x,v){for(var h=this.get2DCursorLocation(x,!0),l=[0],c=0,f=0;f<g.length;f++)g[f]===`
`?(c++,l[c]=0):l[c]++;l[0]>0&&(this.insertCharStyleObject(h.lineIndex,h.charIndex,l[0],v),v=v&&v.slice(l[0]+1)),c&&this.insertNewlineStyleObject(h.lineIndex,h.charIndex+l[0],c);for(var f=1;f<c;f++)l[f]>0?this.insertCharStyleObject(h.lineIndex+f,0,l[f],v):v&&this.styles[h.lineIndex+f]&&v[0]&&(this.styles[h.lineIndex+f][0]=v[0]),v=v&&v.slice(l[f]+1);l[f]>0&&this.insertCharStyleObject(h.lineIndex+f,0,l[f],v)},setSelectionStartEndWithShift:function(g,x,v){v<=g?(x===g?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=g),this.selectionStart=v):v>g&&v<x?this._selectionDirection==="right"?this.selectionEnd=v:this.selectionStart=v:(x===g?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=x),this.selectionEnd=v)},setSelectionInBoundaries:function(){var g=this.text.length;this.selectionStart>g?this.selectionStart=g:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>g?this.selectionEnd=g:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),I.util.object.extend(I.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(n){if(!!this.canvas){this.__newClickTime=+new Date;var g=n.pointer;this.isTripleClick(g)&&(this.fire("tripleclick",n),this._stopEvent(n.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=g,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},_stopEvent:function(n){n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(n){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(n.e))},tripleClickHandler:function(n){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(n.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(n){!this.canvas||!this.editable||n.e.button&&n.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(n.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(n){!this.canvas||!this.editable||n.e.button&&n.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(n){if(this.__isMousedown=!1,!(!this.editable||this.group||n.transform&&n.transform.actionPerformed||n.e.button&&n.e.button!==1)){if(this.canvas){var g=this.canvas._activeObject;if(g&&g!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(n.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(n){var g=this.getSelectionStartFromPointer(n),x=this.selectionStart,v=this.selectionEnd;n.shiftKey?this.setSelectionStartEndWithShift(x,v,g):(this.selectionStart=g,this.selectionEnd=g),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(n){for(var g=this.getLocalPointer(n),x=0,v=0,h=0,l=0,c=0,f,_,u=0,S=this._textLines.length;u<S&&h<=g.y;u++)h+=this.getHeightOfLine(u)*this.scaleY,c=u,u>0&&(l+=this._textLines[u-1].length+this.missingNewlineOffset(u-1));f=this._getLineLeftOffset(c),v=f*this.scaleX,_=this._textLines[c],this.direction==="rtl"&&(g.x=this.width*this.scaleX-g.x+v);for(var C=0,A=_.length;C<A&&(x=v,v+=this.__charBounds[c][C].kernedWidth*this.scaleX,v<=g.x);C++)l++;return this._getNewSelectionStartFromOffset(g,x,v,l,A)},_getNewSelectionStartFromOffset:function(n,g,x,v,h){var l=n.x-g,c=x-n.x,f=c>l||c<0?0:1,_=v+f;return this.flipX&&(_=h-_),_>this._text.length&&(_=this._text.length),_}}),I.util.object.extend(I.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=I.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var n=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+n.top+"; left: "+n.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+n.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):I.document.body.appendChild(this.hiddenTextarea),I.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),I.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),I.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),I.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),I.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),I.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),I.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),I.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),I.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(I.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(n){if(!!this.isEditing){var g=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(n.keyCode in g)this[g[n.keyCode]](n);else if(n.keyCode in this.ctrlKeysMapDown&&(n.ctrlKey||n.metaKey))this[this.ctrlKeysMapDown[n.keyCode]](n);else return;n.stopImmediatePropagation(),n.preventDefault(),n.keyCode>=33&&n.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(n){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(n.keyCode in this.ctrlKeysMapUp&&(n.ctrlKey||n.metaKey))this[this.ctrlKeysMapUp[n.keyCode]](n);else return;n.stopImmediatePropagation(),n.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(n){var g=this.fromPaste;if(this.fromPaste=!1,n&&n.stopPropagation(),!!this.isEditing){var x=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,v=this._text.length,h=x.length,l,c,f=h-v,_=this.selectionStart,u=this.selectionEnd,S=_!==u,C,A,O;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var j=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),Y=_>j.selectionStart;S?(l=this._text.slice(_,u),f+=u-_):h<v&&(Y?l=this._text.slice(u+f,u):l=this._text.slice(_,_-f)),c=x.slice(j.selectionEnd-f,j.selectionEnd),l&&l.length&&(c.length&&(C=this.getSelectionStyles(_,_+1,!1),C=c.map(function(){return C[0]})),S?(A=_,O=u):Y?(A=u-l.length,O=u):(A=u,O=u+l.length),this.removeStyleFromTo(A,O)),c.length&&(g&&c.join("")===I.copiedText&&!I.disableStyleCopyPaste&&(C=I.copiedTextStyle),this.insertNewStyleBlock(c,_,C)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(n){this.compositionStart=n.target.selectionStart,this.compositionEnd=n.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(I.copiedText=this.getSelectedText(),I.disableStyleCopyPaste?I.copiedTextStyle=null:I.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(n){return n&&n.clipboardData||I.window.clipboardData},_getWidthBeforeCursor:function(n,g){var x=this._getLineLeftOffset(n),v;return g>0&&(v=this.__charBounds[n][g-1],x+=v.left+v.width),x},getDownCursorOffset:function(n,g){var x=this._getSelectionForOffset(n,g),v=this.get2DCursorLocation(x),h=v.lineIndex;if(h===this._textLines.length-1||n.metaKey||n.keyCode===34)return this._text.length-x;var l=v.charIndex,c=this._getWidthBeforeCursor(h,l),f=this._getIndexOnLine(h+1,c),_=this._textLines[h].slice(l);return _.length+f+1+this.missingNewlineOffset(h)},_getSelectionForOffset:function(n,g){return n.shiftKey&&this.selectionStart!==this.selectionEnd&&g?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(n,g){var x=this._getSelectionForOffset(n,g),v=this.get2DCursorLocation(x),h=v.lineIndex;if(h===0||n.metaKey||n.keyCode===33)return-x;var l=v.charIndex,c=this._getWidthBeforeCursor(h,l),f=this._getIndexOnLine(h-1,c),_=this._textLines[h].slice(0,l),u=this.missingNewlineOffset(h-1);return-this._textLines[h-1].length+f-_.length+(1-u)},_getIndexOnLine:function(n,g){for(var x=this._textLines[n],v=this._getLineLeftOffset(n),h=v,l=0,c,f,_=0,u=x.length;_<u;_++)if(c=this.__charBounds[n][_].width,h+=c,h>g){f=!0;var S=h-c,C=h,A=Math.abs(S-g),O=Math.abs(C-g);l=O<A?_:_-1;break}return f||(l=x.length-1),l},moveCursorDown:function(n){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",n)},moveCursorUp:function(n){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",n)},_moveCursorUpOrDown:function(n,g){var x="get"+n+"CursorOffset",v=this[x](g,this._selectionDirection==="right");g.shiftKey?this.moveCursorWithShift(v):this.moveCursorWithoutShift(v),v!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(n){var g=this._selectionDirection==="left"?this.selectionStart+n:this.selectionEnd+n;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,g),n!==0},moveCursorWithoutShift:function(n){return n<0?(this.selectionStart+=n,this.selectionEnd=this.selectionStart):(this.selectionEnd+=n,this.selectionStart=this.selectionEnd),n!==0},moveCursorLeft:function(n){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",n)},_move:function(n,g,x){var v;if(n.altKey)v=this["findWordBoundary"+x](this[g]);else if(n.metaKey||n.keyCode===35||n.keyCode===36)v=this["findLineBoundary"+x](this[g]);else return this[g]+=x==="Left"?-1:1,!0;if(typeof v<"u"&&this[g]!==v)return this[g]=v,!0},_moveLeft:function(n,g){return this._move(n,g,"Left")},_moveRight:function(n,g){return this._move(n,g,"Right")},moveCursorLeftWithoutShift:function(n){var g=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(g=this._moveLeft(n,"selectionStart")),this.selectionEnd=this.selectionStart,g},moveCursorLeftWithShift:function(n){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(n,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(n,"selectionStart")},moveCursorRight:function(n){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",n)},_moveCursorLeftOrRight:function(n,g){var x="moveCursor"+n+"With";this._currentCursorOpacity=1,g.shiftKey?x+="Shift":x+="outShift",this[x](g)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(n){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(n,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(n,"selectionEnd")},moveCursorRightWithoutShift:function(n){var g=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(g=this._moveRight(n,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,g},removeChars:function(n,g){typeof g>"u"&&(g=n+1),this.removeStyleFromTo(n,g),this._text.splice(n,g-n),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(n,g,x,v){typeof v>"u"&&(v=x),v>x&&this.removeStyleFromTo(x,v);var h=I.util.string.graphemeSplit(n);this.insertNewStyleBlock(h,x,g),this._text=[].concat(this._text.slice(0,x),h,this._text.slice(v)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var n=I.util.toFixed,g=/  +/g;I.util.object.extend(I.Text.prototype,{_toSVG:function(){var x=this._getSVGLeftTopOffsets(),v=this._getSVGTextAndBg(x.textTop,x.textLeft);return this._wrapSVGTextAndBg(v)},toSVG:function(x){return this._createBaseSVGMarkup(this._toSVG(),{reviver:x,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(x){var v=!0,h=this.getSvgTextDecoration(this);return[x.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",h?'text-decoration="'+h+'" ':"",'style="',this.getSvgStyles(v),'"',this.addPaintOrder()," >",x.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(x,v){var h=[],l=[],c=x,f;this._setSVGBg(l);for(var _=0,u=this._textLines.length;_<u;_++)f=this._getLineLeftOffset(_),(this.textBackgroundColor||this.styleHas("textBackgroundColor",_))&&this._setSVGTextLineBg(l,_,v+f,c),this._setSVGTextLineText(h,_,v+f,c),c+=this.getHeightOfLine(_);return{textSpans:h,textBgRects:l}},_createTextCharSpan:function(x,v,h,l){var c=x!==x.trim()||x.match(g),f=this.getSvgSpanStyles(v,c),_=f?'style="'+f+'"':"",u=v.deltaY,S="",C=I.Object.NUM_FRACTION_DIGITS;return u&&(S=' dy="'+n(u,C)+'" '),['<tspan x="',n(h,C),'" y="',n(l,C),'" ',S,_,">",I.util.string.escapeXml(x),"</tspan>"].join("")},_setSVGTextLineText:function(x,v,h,l){var c=this.getHeightOfLine(v),f=this.textAlign.indexOf("justify")!==-1,_,u,S="",C,A,O=0,j=this._textLines[v],Y;l+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var oe=0,ge=j.length-1;oe<=ge;oe++)Y=oe===ge||this.charSpacing,S+=j[oe],C=this.__charBounds[v][oe],O===0?(h+=C.kernedWidth-C.width,O+=C.width):O+=C.kernedWidth,f&&!Y&&this._reSpaceAndTab.test(j[oe])&&(Y=!0),Y||(_=_||this.getCompleteStyleDeclaration(v,oe),u=this.getCompleteStyleDeclaration(v,oe+1),Y=I.util.hasStyleChanged(_,u,!0)),Y&&(A=this._getStyleDeclaration(v,oe)||{},x.push(this._createTextCharSpan(S,A,h,l)),S="",_=u,h+=O,O=0)},_pushTextBgRect:function(x,v,h,l,c,f){var _=I.Object.NUM_FRACTION_DIGITS;x.push("		<rect ",this._getFillAttributes(v),' x="',n(h,_),'" y="',n(l,_),'" width="',n(c,_),'" height="',n(f,_),`"></rect>
`)},_setSVGTextLineBg:function(x,v,h,l){for(var c=this._textLines[v],f=this.getHeightOfLine(v)/this.lineHeight,_=0,u=0,S,C,A=this.getValueOfPropertyAt(v,0,"textBackgroundColor"),O=0,j=c.length;O<j;O++)S=this.__charBounds[v][O],C=this.getValueOfPropertyAt(v,O,"textBackgroundColor"),C!==A?(A&&this._pushTextBgRect(x,A,h+u,l,_,f),u=S.left,_=S.width,A=C):_+=S.kernedWidth;C&&this._pushTextBgRect(x,C,h+u,l,_,f)},_getFillAttributes:function(x){var v=x&&typeof x=="string"?new I.Color(x):"";return!v||!v.getSource()||v.getAlpha()===1?'fill="'+x+'"':'opacity="'+v.getAlpha()+'" fill="'+v.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(x){for(var v=0,h=0,l=0;l<x;l++)v+=this.getHeightOfLine(l);return h=this.getHeightOfLine(l),{lineTop:v,offset:(this._fontSizeMult-this._fontSizeFraction)*h/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(x){var v=I.Object.prototype.getSvgStyles.call(this,x);return v+" white-space: pre;"}})}(),function(n){var g=n.fabric||(n.fabric={});g.Textbox=g.util.createClass(g.IText,g.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:g.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(x){for(var v=0,h=0,l=0,c={},f=0;f<x.graphemeLines.length;f++)x.graphemeText[l]===`
`&&f>0?(h=0,l++,v++):!this.splitByGrapheme&&this._reSpaceAndTab.test(x.graphemeText[l])&&f>0&&(h++,l++),c[f]={line:v,offset:h},l+=x.graphemeLines[f].length,h+=x.graphemeLines[f].length;return c},styleHas:function(x,v){if(this._styleMap&&!this.isWrapping){var h=this._styleMap[v];h&&(v=h.line)}return g.Text.prototype.styleHas.call(this,x,v)},isEmptyStyles:function(x){if(!this.styles)return!0;var v=0,h=x+1,l,c,f=!1,_=this._styleMap[x],u=this._styleMap[x+1];_&&(x=_.line,v=_.offset),u&&(h=u.line,f=h===x,l=u.offset),c=typeof x>"u"?this.styles:{line:this.styles[x]};for(var S in c)for(var C in c[S])if(C>=v&&(!f||C<l))for(var A in c[S][C])return!1;return!0},_getStyleDeclaration:function(x,v){if(this._styleMap&&!this.isWrapping){var h=this._styleMap[x];if(!h)return null;x=h.line,v=h.offset+v}return this.callSuper("_getStyleDeclaration",x,v)},_setStyleDeclaration:function(x,v,h){var l=this._styleMap[x];x=l.line,v=l.offset+v,this.styles[x][v]=h},_deleteStyleDeclaration:function(x,v){var h=this._styleMap[x];x=h.line,v=h.offset+v,delete this.styles[x][v]},_getLineStyle:function(x){var v=this._styleMap[x];return!!this.styles[v.line]},_setLineStyle:function(x){var v=this._styleMap[x];this.styles[v.line]={}},_wrapText:function(x,v){var h=[],l;for(this.isWrapping=!0,l=0;l<x.length;l++)h=h.concat(this._wrapLine(x[l],l,v));return this.isWrapping=!1,h},_measureWord:function(x,v,h){var l=0,c,f=!0;h=h||0;for(var _=0,u=x.length;_<u;_++){var S=this._getGraphemeBox(x[_],v,_+h,c,f);l+=S.kernedWidth,c=x[_]}return l},_wrapLine:function(x,v,h,qe){var c=0,f=this.splitByGrapheme,_=[],u=[],S=f?g.util.string.graphemeSplit(x):x.split(this._wordJoiners),C="",A=0,O=f?"":" ",j=0,Y=0,oe=0,ge=!0,De=this._getWidthOfCharSpacing(),qe=qe||0;S.length===0&&S.push([]),h-=qe;for(var lt=0;lt<S.length;lt++)C=f?S[lt]:g.util.string.graphemeSplit(S[lt]),j=this._measureWord(C,v,A),A+=C.length,c+=Y+j-De,c>h&&!ge?(_.push(u),u=[],c=j,ge=!0):c+=De,!ge&&!f&&u.push(O),u=u.concat(C),Y=f?0:this._measureWord([O],v,A),A++,ge=!1,j>oe&&(oe=j);return lt&&_.push(u),oe+qe>this.dynamicMinWidth&&(this.dynamicMinWidth=oe-De+qe),_},isEndOfWrapping:function(x){return!this._styleMap[x+1]||this._styleMap[x+1].line!==this._styleMap[x].line},missingNewlineOffset:function(x){return this.splitByGrapheme?this.isEndOfWrapping(x)?1:0:1},_splitTextIntoLines:function(x){for(var v=g.Text.prototype._splitTextIntoLines.call(this,x),h=this._wrapText(v.lines,this.width),l=new Array(h.length),c=0;c<h.length;c++)l[c]=h[c].join("");return v.lines=l,v.graphemeLines=h,v},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var x={};for(var v in this._styleMap)this._textLines[v]&&(x[this._styleMap[v].line]=1);for(var v in this.styles)x[v]||delete this.styles[v]},toObject:function(x){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(x))}}),g.Textbox.fromObject=function(x,v){var h=g.util.stylesFromArray(x.styles,x.text),l=Object.assign({},x,{styles:h});return g.Object._fromObject("Textbox",l,v,"text")}}(Fe),function(){var n=I.controlsUtils,g=n.scaleSkewCursorStyleHandler,x=n.scaleCursorStyleHandler,v=n.scalingEqually,h=n.scalingYOrSkewingX,l=n.scalingXOrSkewingY,c=n.scaleOrSkewActionName,f=I.Object.prototype.controls;if(f.ml=new I.Control({x:-.5,y:0,cursorStyleHandler:g,actionHandler:l,getActionName:c}),f.mr=new I.Control({x:.5,y:0,cursorStyleHandler:g,actionHandler:l,getActionName:c}),f.mb=new I.Control({x:0,y:.5,cursorStyleHandler:g,actionHandler:h,getActionName:c}),f.mt=new I.Control({x:0,y:-.5,cursorStyleHandler:g,actionHandler:h,getActionName:c}),f.tl=new I.Control({x:-.5,y:-.5,cursorStyleHandler:x,actionHandler:v}),f.tr=new I.Control({x:.5,y:-.5,cursorStyleHandler:x,actionHandler:v}),f.bl=new I.Control({x:-.5,y:.5,cursorStyleHandler:x,actionHandler:v}),f.br=new I.Control({x:.5,y:.5,cursorStyleHandler:x,actionHandler:v}),f.mtr=new I.Control({x:0,y:-.5,actionHandler:n.rotationWithSnapping,cursorStyleHandler:n.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),I.Textbox){var _=I.Textbox.prototype.controls={};_.mtr=f.mtr,_.tr=f.tr,_.br=f.br,_.tl=f.tl,_.bl=f.bl,_.mt=f.mt,_.mb=f.mb,_.mr=new I.Control({x:.5,y:0,actionHandler:n.changeWidth,cursorStyleHandler:g,actionName:"resizing"}),_.ml=new I.Control({x:-.5,y:0,actionHandler:n.changeWidth,cursorStyleHandler:g,actionName:"resizing"})}}()})(dn);var Wc={exports:{}};(function(Fe,I){(function(pt,tt){Fe.exports=tt()})(Ia,function(){var pt,tt,wt;function At(n,g){if(!pt)pt=g;else if(!tt)tt=g;else{var x="var sharedChunk = {}; ("+pt+")(sharedChunk); ("+tt+")(sharedChunk);",v={};pt(v),wt=g(v),typeof window<"u"&&(wt.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}At(["exports"],function(n){var g=x;function x(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}function v(i,e,r,o){const p=new g(i,e,r,o);return function(y){return p.solve(y)}}x.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var p=this.sampleCurveX(r)-i;if(Math.abs(p)<e)return r;var y=this.sampleCurveDerivativeX(r);if(Math.abs(y)<1e-6)break;r-=p/y}var w=0,P=1;for(r=i,o=0;o<20&&(p=this.sampleCurveX(r),!(Math.abs(p-i)<e));o++)i>p?w=r:P=r,r=.5*(P-w)+w;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const h=v(.25,.1,.25,1);function l(i,e,r){return Math.min(r,Math.max(e,i))}function c(i,e,r){const o=r-e,p=((i-e)%o+o)%o+e;return p===e?r:p}function f(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let _=1;function u(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function S(i,e,r){const o={};for(const p in i)o[p]=e.call(r||this,i[p],p,i);return o}function C(i,e,r){const o={};for(const p in i)e.call(r||this,i[p],p,i)&&(o[p]=i[p]);return o}function A(i){return Array.isArray(i)?i.map(A):typeof i=="object"&&i?S(i,A):i}const O={};function j(i){O[i]||(typeof console<"u"&&console.warn(i),O[i]=!0)}function Y(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function oe(i){let e=0;for(let r,o,p=0,y=i.length,w=y-1;p<y;w=p++)r=i[p],o=i[w],e+=(o.x-r.x)*(r.y+o.y);return e}function ge(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function De(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,p,y)=>{const w=p||y;return e[o]=!w||w.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let qe,lt,_t=null;function xt(i){if(_t==null){const e=i.navigator?i.navigator.userAgent:null;_t=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return _t}function st(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(qe||(qe=document.createElement("a")),qe.href=i,qe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(lt==null&&(lt=matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)}};var it=Rt;function Rt(i,e){this.x=i,this.y=e}Rt.prototype={clone:function(){return new Rt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,e){var r=Math.cos(i),o=Math.sin(i),p=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Rt.convert=function(i){return i instanceof Rt?i:Array.isArray(i)?new Rt(i[0],i[1]):i};const Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Q="mapbox-tiles";let se,ue,de=500,je=50;function K(){typeof caches>"u"||se||(se=caches.open(Q))}let W=1/0;const re={supported:!1,testSupport:function(i){!be&&Ae&&(Be?Ze(i):ye=i)}};let ye,Ae,be=!1,Be=!1;function Ze(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Ae),i.isContextLost())return;re.supported=!0}catch{}i.deleteTexture(e),be=!0}typeof document<"u"&&(Ae=document.createElement("img"),Ae.onload=function(){ye&&Ze(ye),ye=null,Be=!0},Ae.onerror=function(){be=!0,ye=null},Ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(nt);class Re extends Error{constructor(e,r,o,p){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=p}}const we=ge()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Le(i,e){const r=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:we(),signal:r.signal});let p=!1,y=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),((w,P,k)=>{if(y)return;const F=Date.now();fetch(o).then(U=>U.ok?((N,$,Z)=>{(i.type==="arrayBuffer"?N.arrayBuffer():i.type==="json"?N.json():N.text()).then(J=>{y||($&&Z&&function(me,he,Me){if(K(),!se)return;const We={status:he.status,statusText:he.statusText,headers:new Headers};he.headers.forEach((Ne,ft)=>We.headers.set(ft,Ne));const Pe=De(he.headers.get("Cache-Control")||"");Pe["no-store"]||(Pe["max-age"]&&We.headers.set("Expires",new Date(Me+1e3*Pe["max-age"]).toUTCString()),new Date(We.headers.get("Expires")).getTime()-Me<42e4||function(Ne,ft){if(ue===void 0)try{new Response(new ReadableStream),ue=!0}catch{ue=!1}ue?ft(Ne.body):Ne.blob().then(ft)}(he,Ne=>{const ft=new Response(Ne,We);K(),se&&se.then(dt=>dt.put(function(Jt){const ni=Jt.indexOf("?");return ni<0?Jt:Jt.slice(0,ni)}(me.url),ft)).catch(dt=>j(dt.message))}))}(o,$,Z),p=!0,e(null,J,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(J=>{y||e(new Error(J.message))})})(U,null,F):U.blob().then(N=>e(new Re(U.status,U.statusText,i.url,N)))).catch(U=>{U.code!==20&&e(new Error(U.message))})})(),{cancel:()=>{y=!0,p||r.abort()}}}const Ke=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ge()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ge()){const o=i.url.substring(0,i.url.indexOf("://"));return(Pt.REGISTERED_PROTOCOLS[o]||Le)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(we())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Le(i,e);if(ge()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(o,p){const y=new XMLHttpRequest;y.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const w in o.headers)y.setRequestHeader(w,o.headers[w]);return o.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=o.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let w=y.response;if(o.type==="json")try{w=JSON.parse(y.response)}catch(P){return p(P)}p(null,w,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const w=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});p(new Re(y.status,y.statusText,o.url,w))}},y.send(o.body),{cancel:()=>y.abort()}}(i,e)},$e=function(i,e){return Ke(f(i,{type:"arrayBuffer"}),e)};function ut(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ht,Zt;Ht=[],Zt=0;const Je=function(i,e){if(re.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Zt>=Pt.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ht.push(y),y}Zt++;let r=!1;const o=()=>{if(!r)for(r=!0,Zt--;Ht.length&&Zt<Pt.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Ht.shift(),{requestParameters:w,callback:P,cancelled:k}=y;k||(y.cancel=Je(w,P).cancel)}},p=$e(i,(y,w,P,k)=>{o(),y?e(y):w&&function(F,U){typeof createImageBitmap=="function"?function(N,$){const Z=new Blob([new Uint8Array(N)],{type:"image/png"});createImageBitmap(Z).then(J=>{$(null,J)}).catch(J=>{$(new Error(`Could not load image because of ${J.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(F,U):function(N,$){const Z=new Image;Z.onload=()=>{$(null,Z),URL.revokeObjectURL(Z.src),Z.onload=null,window.requestAnimationFrame(()=>{Z.src=ct})},Z.onerror=()=>$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const J=new Blob([new Uint8Array(N)],{type:"image/png"});Z.src=N.byteLength?URL.createObjectURL(J):ct}(F,U)}(w,(F,U)=>{F!=null?e(F):U!=null&&e(null,U,{cacheControl:P,expires:k})})});return{cancel:()=>{p.cancel(),o()}}};function Gt(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Qt(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class mi{constructor(e,r={}){f(this,r),this.type=e}}class Di extends mi{constructor(e,r={}){super("error",f({error:e},r))}}class wi{on(e,r){return this._listeners=this._listeners||{},Gt(e,r,this._listeners),this}off(e,r){return Qt(e,r,this._listeners),Qt(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Gt(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new mi(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const p=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const P of p)P.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const P of y)Qt(o,P,this._oneTimeListeners),P.call(this,e);const w=this._eventedParent;w&&(f(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(e))}else e instanceof Di&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class vt{constructor(e,r,o,p){this.message=(e?`${e}: `:"")+o,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ri(i){const e=i.value;return e?[new vt(i.key,e,"constants have been deprecated as of v8")]:[]}function Ji(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}function si(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ei(i){if(Array.isArray(i))return i.map(Ei);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ei(i[r]);return e}return si(i)}class dr extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class fr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,p]of r)this.bindings[o]=p}concat(e){return new fr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Qi={kind:"null"},at={kind:"number"},bi={kind:"string"},xi={kind:"boolean"},br={kind:"color"},tn={kind:"object"},yi={kind:"value"},Oi={kind:"collator"},wr={kind:"formatted"},Vr={kind:"padding"},lr={kind:"resolvedImage"};function Dr(i,e){return{kind:"array",itemType:i,N:e}}function Xi(i){if(i.kind==="array"){const e=Xi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ls=[Qi,at,bi,xi,br,wr,tn,Dr(yi),Vr,lr];function Zr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Zr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of ls)if(!Zr(r,e))return null}}return`Expected ${Xi(i)} but found ${Xi(e)} instead.`}function cs(i,e){return e.some(r=>r.kind===i.kind)}function Wn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var $n,qn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ie(i){return(i=Math.round(i))<0?0:i>255?255:i}function B(i){return ie(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function G(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function ee(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{$n={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in qn)return qn[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=r.indexOf("("),p=r.indexOf(")");if(o!==-1&&p+1===r.length){var y=r.substr(0,o),w=r.substr(o+1,p-(o+1)).split(","),P=1;switch(y){case"rgba":if(w.length!==4)return null;P=G(w.pop());case"rgb":return w.length!==3?null:[B(w[0]),B(w[1]),B(w[2]),P];case"hsla":if(w.length!==4)return null;P=G(w.pop());case"hsl":if(w.length!==3)return null;var k=(parseFloat(w[0])%360+360)%360/360,F=G(w[1]),U=G(w[2]),N=U<=.5?U*(F+1):U+F-U*F,$=2*U-N;return[ie(255*ee($,N,k+1/3)),ie(255*ee($,N,k)),ie(255*ee($,N,k-1/3)),P];default:return null}}return null}}catch{}class te{constructor(e,r,o,p=1){this.r=e,this.g=r,this.b=o,this.a=p}static parse(e){if(!e)return;if(e instanceof te)return e;if(typeof e!="string")return;const r=$n(e);return r?new te(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,o,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(o)},${p})`}toArray(){const{r:e,g:r,b:o,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*o/p,p]}}te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);class fe{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Se{constructor(e,r,o,p,y){this.text=e,this.image=r,this.scale=o,this.fontStack=p,this.textColor=y}}class _e{constructor(e){this.sections=e}static fromString(e){return new _e([new Se(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof _e?e:_e.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class pe{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pe)return e;if(typeof e=="number")return new pe([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new pe(e)}}toString(){return JSON.stringify(this.values)}}class Ce{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ce({name:e,available:!1}):null}}function He(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gt(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof te||i instanceof fe||i instanceof _e||i instanceof pe||i instanceof Ce)return!0;if(Array.isArray(i)){for(const e of i)if(!gt(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!gt(i[e]))return!1;return!0}return!1}function Ye(i){if(i===null)return Qi;if(typeof i=="string")return bi;if(typeof i=="boolean")return xi;if(typeof i=="number")return at;if(i instanceof te)return br;if(i instanceof fe)return Oi;if(i instanceof _e)return wr;if(i instanceof pe)return Vr;if(i instanceof Ce)return lr;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const p=Ye(o);if(r){if(r===p)continue;r=yi;break}r=p}return Dr(r||yi,e)}return tn}function ei(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof te||i instanceof _e||i instanceof pe||i instanceof Ce?i.toString():JSON.stringify(i)}class ri{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!gt(e[1]))return r.error("invalid value");const o=e[1];let p=Ye(o);const y=r.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new ri(p,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class It{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const di={string:bi,number:at,boolean:xi,object:tn};class gi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,p=1;const y=e[0];if(y==="array"){let P,k;if(e.length>2){const F=e[1];if(typeof F!="string"||!(F in di)||F==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);P=di[F],p++}else P=yi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);k=e[2],p++}o=Dr(P,k)}else{if(!di[y])throw new Error(`Types doesn't contain name = ${y}`);o=di[y]}const w=[];for(;p<e.length;p++){const P=r.parse(e[p],p,yi);if(!P)return null;w.push(P)}return new gi(o,w)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!Zr(this.type,Ye(o)))return o;if(r===this.args.length-1)throw new It(`Expected value to be of type ${Xi(this.type)}, but found ${Xi(Ye(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Li={"to-boolean":xi,"to-color":br,"to-number":at,"to-string":bi};class vi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Li[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const p=Li[o],y=[];for(let w=1;w<e.length;w++){const P=r.parse(e[w],w,yi);if(!P)return null;y.push(P)}return new vi(p,y)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,o;for(const p of this.args){if(r=p.evaluate(e),o=null,r instanceof te)return r;if(typeof r=="string"){const y=e.parseColor(r);if(y)return y}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:He(r[0],r[1],r[2],r[3]),!o))return new te(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new It(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const o of this.args){r=o.evaluate(e);const p=pe.parse(r);if(p)return p}throw new It(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new It(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?_e.fromString(ei(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ce.fromString(ei(this.args[0].evaluate(e))):ei(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ti=["Unknown","Point","LineString","Polygon"];class Bi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=te.parse(e)),r}}class Si{constructor(e,r,o,p){this.name=e,this.type=r,this._evaluate=o,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],p=Si.definitions[o];if(!p)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,w=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,P=w.filter(([F])=>!Array.isArray(F)||F.length===e.length-1);let k=null;for(const[F,U]of P){k=new Te(r.registry,r.path,null,r.scope);const N=[];let $=!1;for(let Z=1;Z<e.length;Z++){const J=e[Z],me=Array.isArray(F)?F[Z-1]:F.type,he=k.parse(J,1+N.length,me);if(!he){$=!0;break}N.push(he)}if(!$)if(Array.isArray(F)&&F.length!==N.length)k.error(`Expected ${F.length} arguments, but found ${N.length} instead.`);else{for(let Z=0;Z<N.length;Z++){const J=Array.isArray(F)?F[Z]:F.type,me=N[Z];k.concat(Z+1).checkSubtype(J,me.type)}if(k.errors.length===0)return new Si(o,y,U,N)}}if(P.length===1)r.errors.push(...k.errors);else{const F=(P.length?P:w).map(([N])=>{return $=N,Array.isArray($)?`(${$.map(Xi).join(", ")})`:`(${Xi($.type)}...)`;var $}).join(" | "),U=[];for(let N=1;N<e.length;N++){const $=r.parse(e[N],1+U.length);if(!$)return null;U.push(Xi($.type))}r.error(`Expected arguments of type ${F}, but found (${U.join(", ")}) instead.`)}return null}static register(e,r){Si.definitions=r;for(const o in r)e[o]=Si}}class Mr{constructor(e,r,o){this.type=Oi,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const p=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,xi);if(!p)return null;const y=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,xi);if(!y)return null;let w=null;return o.locale&&(w=r.parse(o.locale,1,bi),!w)?null:new Mr(p,y,w)}evaluate(e){return new fe(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const cr=8192;function gr(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Kr(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function xs(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*cr),Math.round(o*p*cr)]}function Vi(i,e,r){const o=i[0]-e[0],p=i[1]-e[1],y=i[0]-r[0],w=i[1]-r[1];return o*w-y*p==0&&o*y<=0&&p*w<=0}function Yn(i,e){let r=!1;for(let w=0,P=e.length;w<P;w++){const k=e[w];for(let F=0,U=k.length;F<U-1;F++){if(Vi(i,k[F],k[F+1]))return!1;(p=k[F])[1]>(o=i)[1]!=(y=k[F+1])[1]>o[1]&&o[0]<(y[0]-p[0])*(o[1]-p[1])/(y[1]-p[1])+p[0]&&(r=!r)}}var o,p,y;return r}function mo(i,e){for(let r=0;r<e.length;r++)if(Yn(i,e[r]))return!0;return!1}function ca(i,e,r,o){const p=o[0]-r[0],y=o[1]-r[1],w=(i[0]-r[0])*y-p*(i[1]-r[1]),P=(e[0]-r[0])*y-p*(e[1]-r[1]);return w>0&&P<0||w<0&&P>0}function ha(i,e,r){for(const F of r)for(let U=0;U<F.length-1;++U)if((P=[(w=F[U+1])[0]-(y=F[U])[0],w[1]-y[1]])[0]*(k=[(p=e)[0]-(o=i)[0],p[1]-o[1]])[1]-P[1]*k[0]!=0&&ca(o,p,y,w)&&ca(y,w,o,p))return!0;var o,p,y,w,P,k;return!1}function Fo(i,e){for(let r=0;r<i.length;++r)if(!Yn(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(ha(i[r],i[r+1],e))return!1;return!0}function ua(i,e){for(let r=0;r<e.length;r++)if(Fo(i,e[r]))return!0;return!1}function go(i,e,r){const o=[];for(let p=0;p<i.length;p++){const y=[];for(let w=0;w<i[p].length;w++){const P=xs(i[p][w],r);gr(e,P),y.push(P)}o.push(y)}return o}function Ro(i,e,r){const o=[];for(let p=0;p<i.length;p++){const y=go(i[p],e,r);o.push(y)}return o}function da(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const p=.5*o;let y=i[0]-r[0]>p?-o:r[0]-i[0]>p?o:0;y===0&&(y=i[0]-r[2]>p?-o:r[2]-i[0]>p?o:0),i[0]+=y}gr(e,i)}function fa(i,e,r,o){const p=Math.pow(2,o.z)*cr,y=[o.x*cr,o.y*cr],w=[];for(const P of i)for(const k of P){const F=[k.x+y[0],k.y+y[1]];da(F,e,r,p),w.push(F)}return w}function Bo(i,e,r,o){const p=Math.pow(2,o.z)*cr,y=[o.x*cr,o.y*cr],w=[];for(const k of i){const F=[];for(const U of k){const N=[U.x+y[0],U.y+y[1]];gr(e,N),F.push(N)}w.push(F)}if(e[2]-e[0]<=p/2){(P=e)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const k of w)for(const F of k)da(F,e,r,p)}var P;return w}class T{constructor(e,r){this.type=xi,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gt(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let p=0;p<o.features.length;++p){const y=o.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new T(o,o.features[p].geometry)}else if(o.type==="Feature"){const p=o.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new T(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new T(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=r.canonicalID();if(o.type==="Polygon"){const P=go(o.coordinates,y,w),k=fa(r.geometry(),p,y,w);if(!Kr(p,y))return!1;for(const F of k)if(!Yn(F,P))return!1}if(o.type==="MultiPolygon"){const P=Ro(o.coordinates,y,w),k=fa(r.geometry(),p,y,w);if(!Kr(p,y))return!1;for(const F of k)if(!mo(F,P))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=r.canonicalID();if(o.type==="Polygon"){const P=go(o.coordinates,y,w),k=Bo(r.geometry(),p,y,w);if(!Kr(p,y))return!1;for(const F of k)if(!Fo(F,P))return!1}if(o.type==="MultiPolygon"){const P=Ro(o.coordinates,y,w),k=Bo(r.geometry(),p,y,w);if(!Kr(p,y))return!1;for(const F of k)if(!ua(F,P))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function z(i){if(i instanceof Si&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof T)return!1;let e=!0;return i.eachChild(r=>{e&&!z(r)&&(e=!1)}),e}function q(i){if(i instanceof Si&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!q(r)&&(e=!1)}),e}function ve(i,e){if(i instanceof Si&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!ve(o,e)&&(r=!1)}),r}class ze{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new ze(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Te{constructor(e,r=[],o,p=new fr,y=[]){this.registry=e,this.path=r,this.key=r.map(w=>`[${w}]`).join(""),this.scope=p,this.errors=y,this.expectedType=o}parse(e,r,o,p,y={}){return r?this.concat(r,o,p)._parse(e,y):this._parse(e,y)}_parse(e,r){function o(p,y,w){return w==="assert"?new gi(y,[p]):w==="coerce"?new vi(y,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let w=y.parse(e,this);if(!w)return null;if(this.expectedType){const P=this.expectedType,k=w.type;if(P.kind!=="string"&&P.kind!=="number"&&P.kind!=="boolean"&&P.kind!=="object"&&P.kind!=="array"||k.kind!=="value")if(P.kind!=="color"&&P.kind!=="formatted"&&P.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(P.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array"){if(this.checkSubtype(P,k))return null}else w=o(w,P,r.typeAnnotation||"coerce");else w=o(w,P,r.typeAnnotation||"coerce");else w=o(w,P,r.typeAnnotation||"assert")}if(!(w instanceof ri)&&w.type.kind!=="resolvedImage"&&ke(w)){const P=new Bi;try{w=new ri(w.type,w.evaluate(P))}catch(k){return this.error(k.message),null}}return w}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const p=typeof e=="number"?this.path.concat(e):this.path,y=o?this.scope.concat(o):this.scope;return new Te(this.registry,p,r||null,y,this.errors)}error(e,...r){const o=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new dr(o,e))}checkSubtype(e,r){const o=Zr(e,r);return o&&this.error(o),o}}function ke(i){if(i instanceof ze)return ke(i.boundExpression);if(i instanceof Si&&i.name==="error"||i instanceof Mr||i instanceof T)return!1;const e=i instanceof vi||i instanceof gi;let r=!0;return i.eachChild(o=>{r=e?r&&ke(o):r&&o instanceof ri}),!!r&&z(i)&&ve(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ct(i,e){const r=i.length-1;let o,p,y=0,w=r,P=0;for(;y<=w;)if(P=Math.floor((y+w)/2),o=i[P],p=i[P+1],o<=e){if(P===r||e<p)return P;y=P+1}else{if(!(o>e))throw new It("Input is not a number.");w=P-1}return 0}class bt{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[p,y]of o)this.labels.push(p),this.outputs.push(y)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,at);if(!o)return null;const p=[];let y=null;r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let w=1;w<e.length;w+=2){const P=w===1?-1/0:e[w],k=e[w+1],F=w,U=w+1;if(typeof P!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(p.length&&p[p.length-1][0]>=P)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const N=r.parse(k,U,y);if(!N)return null;y=y||N.type,p.push([P,N])}return new bt(y,o,p)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return o[0].evaluate(e);const y=r.length;return p>=r[y-1]?o[y-1].evaluate(e):o[Ct(r,p)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Tt(i,e,r){return i*(1-r)+e*r}var Ve=Object.freeze({__proto__:null,number:Tt,color:function(i,e,r){return new te(Tt(i.r,e.r,r),Tt(i.g,e.g,r),Tt(i.b,e.b,r),Tt(i.a,e.a,r))},array:function(i,e,r){return i.map((o,p)=>Tt(o,e[p],r))},padding:function(i,e,r){const o=i.values,p=e.values;return new pe([Tt(o[0],p[0],r),Tt(o[1],p[1],r),Tt(o[2],p[2],r),Tt(o[3],p[3],r)])}});const Dt=.95047,qt=1.08883,li=4/29,_i=6/29,Sr=3*_i*_i,mt=Math.PI/180,ti=180/Math.PI;function qi(i){return i>.008856451679035631?Math.pow(i,1/3):i/Sr+li}function $i(i){return i>_i?i*i*i:Sr*(i-li)}function hr(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ci(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ai(i){const e=ci(i.r),r=ci(i.g),o=ci(i.b),p=qi((.4124564*e+.3575761*r+.1804375*o)/Dt),y=qi((.2126729*e+.7151522*r+.072175*o)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-qi((.0193339*e+.119192*r+.9503041*o)/qt)),alpha:i.a}}function Hn(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*$i(e),r=Dt*$i(r),o=qt*$i(o),new te(hr(3.2404542*r-1.5371385*e-.4985314*o),hr(-.969266*r+1.8760108*e+.041556*o),hr(.0556434*r-.2040259*e+1.0572252*o),i.alpha)}function Wi(i,e,r){const o=e-i;return i+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const Jr={forward:Ai,reverse:Hn,interpolate:function(i,e,r){return{l:Tt(i.l,e.l,r),a:Tt(i.a,e.a,r),b:Tt(i.b,e.b,r),alpha:Tt(i.alpha,e.alpha,r)}}},Or={forward:function(i){const{l:e,a:r,b:o}=Ai(i),p=Math.atan2(o,r)*ti;return{h:p<0?p+360:p,c:Math.sqrt(r*r+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*mt,r=i.c;return Hn({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Wi(i.h,e.h,r),c:Tt(i.c,e.c,r),l:Tt(i.l,e.l,r),alpha:Tt(i.alpha,e.alpha,r)}}};var _o=Object.freeze({__proto__:null,lab:Jr,hcl:Or});class rn{constructor(e,r,o,p,y){this.type=e,this.operator=r,this.interpolation=o,this.input=p,this.labels=[],this.outputs=[];for(const[w,P]of y)this.labels.push(w),this.outputs.push(P)}static interpolationFactor(e,r,o,p){let y=0;if(e.name==="exponential")y=xn(r,e.base,o,p);else if(e.name==="linear")y=xn(r,1,o,p);else if(e.name==="cubic-bezier"){const w=e.controlPoints;y=new g(w[0],w[1],w[2],w[3]).solve(xn(r,1,o,p))}return y}static parse(e,r){let[o,p,y,...w]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const F=p[1];if(typeof F!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:F}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const F=p.slice(1);if(F.length!==4||F.some(U=>typeof U!="number"||U<0||U>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:F}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(y=r.parse(y,2,at),!y)return null;const P=[];let k=null;o==="interpolate-hcl"||o==="interpolate-lab"?k=br:r.expectedType&&r.expectedType.kind!=="value"&&(k=r.expectedType);for(let F=0;F<w.length;F+=2){const U=w[F],N=w[F+1],$=F+3,Z=F+4;if(typeof U!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(P.length&&P[P.length-1][0]>=U)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const J=r.parse(N,Z,k);if(!J)return null;k=k||J.type,P.push([U,J])}return k.kind==="number"||k.kind==="color"||k.kind==="padding"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new rn(k,o,p,y,P):r.error(`Type ${Xi(k)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return o[0].evaluate(e);const y=r.length;if(p>=r[y-1])return o[y-1].evaluate(e);const w=Ct(r,p),P=rn.interpolationFactor(this.interpolation,p,r[w],r[w+1]),k=o[w].evaluate(e),F=o[w+1].evaluate(e);return this.operator==="interpolate"?Ve[this.type.kind.toLowerCase()](k,F,P):this.operator==="interpolate-hcl"?Or.reverse(Or.interpolate(Or.forward(k),Or.forward(F),P)):Jr.reverse(Jr.interpolate(Jr.forward(k),Jr.forward(F),P))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function xn(i,e,r,o){const p=o-r,y=i-r;return p===0?0:e===1?y/p:(Math.pow(e,y)-1)/(Math.pow(e,p)-1)}class Hs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const p=r.expectedType;p&&p.kind!=="value"&&(o=p);const y=[];for(const P of e.slice(1)){const k=r.parse(P,1+y.length,o,void 0,{typeAnnotation:"omit"});if(!k)return null;o=o||k.type,y.push(k)}if(!o)throw new Error("No output type");const w=p&&y.some(P=>Zr(p,P.type));return new Hs(w?yi:o,y)}evaluate(e){let r,o=null,p=0;for(const y of this.args)if(p++,o=y.evaluate(e),o&&o instanceof Ce&&!o.available&&(r||(r=o.name),o=null,p===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Zs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let y=1;y<e.length-1;y+=2){const w=e[y];if(typeof w!="string")return r.error(`Expected string, but found ${typeof w} instead.`,y);if(/[^a-zA-Z0-9_]/.test(w))return r.error("Variable names must contain only alphanumeric characters or '_'.",y);const P=r.parse(e[y+1],y+1);if(!P)return null;o.push([w,P])}const p=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return p?new Zs(o,p):null}outputDefined(){return this.result.outputDefined()}}class Uo{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,at),p=r.parse(e[2],2,Dr(r.expectedType||yi));return o&&p?new Uo(p.type.itemType,o,p):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new It(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new It(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new It(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class yo{constructor(e,r){this.type=xi,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,yi),p=r.parse(e[2],2,yi);return o&&p?cs(o.type,[xi,bi,at,Qi,yi])?new yo(o,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Wn(r,["boolean","string","number","null"]))throw new It(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(Ye(r))} instead.`);if(!Wn(o,["string","array"]))throw new It(`Expected second argument to be of type array or string, but found ${Xi(Ye(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class bs{constructor(e,r,o){this.type=at,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,yi),p=r.parse(e[2],2,yi);if(!o||!p)return null;if(!cs(o.type,[xi,bi,at,Qi,yi]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(o.type)} instead`);if(e.length===4){const y=r.parse(e[3],3,at);return y?new bs(o,p,y):null}return new bs(o,p)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Wn(r,["boolean","string","number","null"]))throw new It(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(Ye(r))} instead.`);if(!Wn(o,["string","array"]))throw new It(`Expected second argument to be of type array or string, but found ${Xi(Ye(o))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return o.indexOf(r,p)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class vo{constructor(e,r,o,p,y,w){this.inputType=e,this.type=r,this.input=o,this.cases=p,this.outputs=y,this.otherwise=w}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const y={},w=[];for(let F=2;F<e.length-1;F+=2){let U=e[F];const N=e[F+1];Array.isArray(U)||(U=[U]);const $=r.concat(F);if(U.length===0)return $.error("Expected at least one branch label.");for(const J of U){if(typeof J!="number"&&typeof J!="string")return $.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return $.error("Numeric branch labels must be integer values.");if(o){if($.checkSubtype(o,Ye(J)))return null}else o=Ye(J);if(y[String(J)]!==void 0)return $.error("Branch labels must be unique.");y[String(J)]=w.length}const Z=r.parse(N,F,p);if(!Z)return null;p=p||Z.type,w.push(Z)}const P=r.parse(e[1],1,yi);if(!P)return null;const k=r.parse(e[e.length-1],e.length-1,p);return k?P.type.kind!=="value"&&r.concat(1).checkSubtype(o,P.type)?null:new vo(o,p,P,y,w,k):null}evaluate(e){const r=this.input.evaluate(e);return(Ye(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class xo{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const p=[];for(let w=1;w<e.length-1;w+=2){const P=r.parse(e[w],w,xi);if(!P)return null;const k=r.parse(e[w+1],w+1,o);if(!k)return null;p.push([P,k]),o=o||k.type}const y=r.parse(e[e.length-1],e.length-1,o);if(!y)return null;if(!o)throw new Error("Can't infer output type");return new xo(o,p,y)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class bo{constructor(e,r,o,p){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,yi),p=r.parse(e[2],2,at);if(!o||!p)return null;if(!cs(o.type,[Dr(yi),bi,yi]))return r.error(`Expected first argument to be of type array or string, but found ${Xi(o.type)} instead`);if(e.length===4){const y=r.parse(e[3],3,at);return y?new bo(o.type,o,p,y):null}return new bo(o.type,o,p)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Wn(r,["string","array"]))throw new It(`Expected first argument to be of type array or string, but found ${Xi(Ye(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return r.slice(o,p)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function hs(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jo(i,e,r,o){return o.compare(e,r)===0}function ks(i,e,r){const o=i!=="=="&&i!=="!=";return class Au{constructor(y,w,P){this.type=xi,this.lhs=y,this.rhs=w,this.collator=P,this.hasUntypedArgument=y.type.kind==="value"||w.type.kind==="value"}static parse(y,w){if(y.length!==3&&y.length!==4)return w.error("Expected two or three arguments.");const P=y[0];let k=w.parse(y[1],1,yi);if(!k)return null;if(!hs(P,k.type))return w.concat(1).error(`"${P}" comparisons are not supported for type '${Xi(k.type)}'.`);let F=w.parse(y[2],2,yi);if(!F)return null;if(!hs(P,F.type))return w.concat(2).error(`"${P}" comparisons are not supported for type '${Xi(F.type)}'.`);if(k.type.kind!==F.type.kind&&k.type.kind!=="value"&&F.type.kind!=="value")return w.error(`Cannot compare types '${Xi(k.type)}' and '${Xi(F.type)}'.`);o&&(k.type.kind==="value"&&F.type.kind!=="value"?k=new gi(F.type,[k]):k.type.kind!=="value"&&F.type.kind==="value"&&(F=new gi(k.type,[F])));let U=null;if(y.length===4){if(k.type.kind!=="string"&&F.type.kind!=="string"&&k.type.kind!=="value"&&F.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(U=w.parse(y[3],3,Oi),!U)return null}return new Au(k,F,U)}evaluate(y){const w=this.lhs.evaluate(y),P=this.rhs.evaluate(y);if(o&&this.hasUntypedArgument){const k=Ye(w),F=Ye(P);if(k.kind!==F.kind||k.kind!=="string"&&k.kind!=="number")throw new It(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${k.kind}, ${F.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const k=Ye(w),F=Ye(P);if(k.kind!=="string"||F.kind!=="string")return e(y,w,P)}return this.collator?r(y,w,P,this.collator.evaluate(y)):e(y,w,P)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Oa=ks("==",function(i,e,r){return e===r},jo),Vo=ks("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!jo(0,e,r,o)}),Ks=ks("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),No=ks(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),Go=ks("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),Xo=ks(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class ws{constructor(e,r,o,p,y){this.type=bi,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,at);if(!o)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=r.parse(p.locale,1,bi),!y))return null;let w=null;if(p.currency&&(w=r.parse(p.currency,1,bi),!w))return null;let P=null;if(p["min-fraction-digits"]&&(P=r.parse(p["min-fraction-digits"],1,at),!P))return null;let k=null;return p["max-fraction-digits"]&&(k=r.parse(p["max-fraction-digits"],1,at),!k)?null:new ws(o,y,w,P,k)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class wo{constructor(e){this.type=wr,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const p=[];let y=!1;for(let w=1;w<=e.length-1;++w){const P=e[w];if(y&&typeof P=="object"&&!Array.isArray(P)){y=!1;let k=null;if(P["font-scale"]&&(k=r.parse(P["font-scale"],1,at),!k))return null;let F=null;if(P["text-font"]&&(F=r.parse(P["text-font"],1,Dr(bi)),!F))return null;let U=null;if(P["text-color"]&&(U=r.parse(P["text-color"],1,br),!U))return null;const N=p[p.length-1];N.scale=k,N.font=F,N.textColor=U}else{const k=r.parse(e[w],1,yi);if(!k)return null;const F=k.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:k,scale:null,font:null,textColor:null})}}return new wo(p)}evaluate(e){return new _e(this.sections.map(r=>{const o=r.content.evaluate(e);return Ye(o)===lr?new Se("",o,null,null,null):new Se(ei(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Wo{constructor(e){this.type=lr,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,bi);return o?new Wo(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=Ce.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class $o{constructor(e){this.type=at,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Xi(o.type)} instead.`):new $o(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new It(`Expected value to be of type string or array, but found ${Xi(Ye(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ds={"==":Oa,"!=":Vo,">":No,"<":Ks,">=":Xo,"<=":Go,array:gi,at:Uo,boolean:gi,case:xo,coalesce:Hs,collator:Mr,format:wo,image:Wo,in:yo,"index-of":bs,interpolate:rn,"interpolate-hcl":rn,"interpolate-lab":rn,length:$o,let:Zs,literal:ri,match:vo,number:gi,"number-format":ws,object:gi,slice:bo,step:bt,string:gi,"to-boolean":vi,"to-color":vi,"to-number":vi,"to-string":vi,var:ze,within:T};function pa(i,[e,r,o,p]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const y=p?p.evaluate(i):1,w=He(e,r,o,y);if(w)throw new It(w);return new te(e/255*y,r/255*y,o/255*y,y)}function qo(i,e){return i in e}function Os(i,e){const r=e[i];return r===void 0?null:r}function fn(i){return{type:i}}function zn(i){return{result:"success",value:i}}function bn(i){return{result:"error",value:i}}function er(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Zn(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Mi(i){return!!i.expression&&i.expression.interpolated}function Ui(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Yi(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ar(i){return i}function Ls(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",p=o||!(o||i.property!==void 0),y=i.type||(Mi(e)?"exponential":"interval");if(r||e.type==="padding"){const F=r?te.parse:pe.parse;(i=Ji({},i)).stops&&(i.stops=i.stops.map(U=>[U[0],F(U[1])])),i.default=F(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!_o[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let w,P,k;if(y==="exponential")w=Yo;else if(y==="interval")w=ma;else if(y==="categorical"){w=La,P=Object.create(null);for(const F of i.stops)P[F[0]]=F[1];k=typeof i.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);w=So}if(o){const F={},U=[];for(let Z=0;Z<i.stops.length;Z++){const J=i.stops[Z],me=J[0].zoom;F[me]===void 0&&(F[me]={zoom:me,type:i.type,property:i.property,default:i.default,stops:[]},U.push(me)),F[me].stops.push([J[0].value,J[1]])}const N=[];for(const Z of U)N.push([F[Z].zoom,Ls(F[Z],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:rn.interpolationFactor.bind(void 0,$),zoomStops:N.map(Z=>Z[0]),evaluate:({zoom:Z},J)=>Yo({stops:N,base:i.base},e,Z).evaluate(Z,J)}}if(p){const F=y==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:rn.interpolationFactor.bind(void 0,F),zoomStops:i.stops.map(U=>U[0]),evaluate:({zoom:U})=>w(i,e,U,P,k)}}return{kind:"source",evaluate(F,U){const N=U&&U.properties?U.properties[i.property]:void 0;return N===void 0?zs(i.default,e.default):w(i,e,N,P,k)}}}function zs(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function La(i,e,r,o,p){return zs(typeof r===p?o[r]:void 0,i.default,e.default)}function ma(i,e,r){if(Ui(r)!=="number")return zs(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const p=Ct(i.stops.map(y=>y[0]),r);return i.stops[p][1]}function Yo(i,e,r){const o=i.base!==void 0?i.base:1;if(Ui(r)!=="number")return zs(i.default,e.default);const p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];const y=Ct(i.stops.map(U=>U[0]),r),w=function(U,N,$,Z){const J=Z-$,me=U-$;return J===0?0:N===1?me/J:(Math.pow(N,me)-1)/(Math.pow(N,J)-1)}(r,o,i.stops[y][0],i.stops[y+1][0]),P=i.stops[y][1],k=i.stops[y+1][1];let F=Ve[e.type]||ar;if(i.colorSpace&&i.colorSpace!=="rgb"){const U=_o[i.colorSpace];F=(N,$)=>U.reverse(U.interpolate(U.forward(N),U.forward($),w))}return typeof P.evaluate=="function"?{evaluate(...U){const N=P.evaluate.apply(void 0,U),$=k.evaluate.apply(void 0,U);if(N!==void 0&&$!==void 0)return F(N,$,w)}}:F(P,k,w)}function So(i,e,r){switch(e.type){case"color":r=te.parse(r);break;case"formatted":r=_e.fromString(r.toString());break;case"resolvedImage":r=Ce.fromString(r.toString());break;case"padding":r=pe.parse(r);break;default:Ui(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return zs(r,i.default,e.default)}Si.register(Ds,{error:[{kind:"error"},[bi],(i,[e])=>{throw new It(e.evaluate(i))}],typeof:[bi,[yi],(i,[e])=>Xi(Ye(e.evaluate(i)))],"to-rgba":[Dr(at,4),[br],(i,[e])=>e.evaluate(i).toArray()],rgb:[br,[at,at,at],pa],rgba:[br,[at,at,at,at],pa],has:{type:xi,overloads:[[[bi],(i,[e])=>qo(e.evaluate(i),i.properties())],[[bi,tn],(i,[e,r])=>qo(e.evaluate(i),r.evaluate(i))]]},get:{type:yi,overloads:[[[bi],(i,[e])=>Os(e.evaluate(i),i.properties())],[[bi,tn],(i,[e,r])=>Os(e.evaluate(i),r.evaluate(i))]]},"feature-state":[yi,[bi],(i,[e])=>Os(e.evaluate(i),i.featureState||{})],properties:[tn,[],i=>i.properties()],"geometry-type":[bi,[],i=>i.geometryType()],id:[yi,[],i=>i.id()],zoom:[at,[],i=>i.globals.zoom],"heatmap-density":[at,[],i=>i.globals.heatmapDensity||0],"line-progress":[at,[],i=>i.globals.lineProgress||0],accumulated:[yi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[at,fn(at),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[at,fn(at),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:at,overloads:[[[at,at],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[at],(i,[e])=>-e.evaluate(i)]]},"/":[at,[at,at],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[at,[at,at],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[at,[at],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[at,[at],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[at,[at],(i,[e])=>Math.log(e.evaluate(i))],log2:[at,[at],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[at,[at],(i,[e])=>Math.sin(e.evaluate(i))],cos:[at,[at],(i,[e])=>Math.cos(e.evaluate(i))],tan:[at,[at],(i,[e])=>Math.tan(e.evaluate(i))],asin:[at,[at],(i,[e])=>Math.asin(e.evaluate(i))],acos:[at,[at],(i,[e])=>Math.acos(e.evaluate(i))],atan:[at,[at],(i,[e])=>Math.atan(e.evaluate(i))],min:[at,fn(at),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[at,fn(at),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[at,[at],(i,[e])=>Math.abs(e.evaluate(i))],round:[at,[at],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[at,[at],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[at,[at],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[xi,[bi,yi],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[xi,[yi],(i,[e])=>i.id()===e.value],"filter-type-==":[xi,[bi],(i,[e])=>i.geometryType()===e.value],"filter-<":[xi,[bi,yi],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o<p}],"filter-id-<":[xi,[yi],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[xi,[bi,yi],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o>p}],"filter-id->":[xi,[yi],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[xi,[bi,yi],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o<=p}],"filter-id-<=":[xi,[yi],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[xi,[bi,yi],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o>=p}],"filter-id->=":[xi,[yi],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[xi,[yi],(i,[e])=>e.value in i.properties()],"filter-has-id":[xi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[xi,[Dr(bi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[xi,[Dr(yi)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[xi,[bi,Dr(yi)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[xi,[bi,Dr(yi)],(i,[e,r])=>function(o,p,y,w){for(;y<=w;){const P=y+w>>1;if(p[P]===o)return!0;p[P]>o?w=P-1:y=P+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:xi,overloads:[[[xi,xi],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[fn(xi),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:xi,overloads:[[[xi,xi],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[fn(xi),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[xi,[xi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[xi,[bi],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[bi,[bi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[bi,[bi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[bi,fn(yi),(i,e)=>e.map(r=>ei(r.evaluate(i))).join("")],"resolved-locale":[bi,[Oi],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Kn{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Bi,this._defaultValue=r?function(o){return o.type==="color"&&Yi(o.default)?new te(0,0,0,0):o.type==="color"?te.parse(o.default)||null:o.type==="padding"?pe.parse(o.default)||null:o.default===void 0?null:o.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,p,y,w){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,p,y,w){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new It(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function Js(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ds}function wn(i,e){const r=new Te(Ds,[],e?function(p){const y={color:br,string:bi,number:at,enum:bi,boolean:xi,formatted:wr,padding:Vr,resolvedImage:lr};return p.type==="array"?Dr(y[p.value]||yi,p.length):y[p.type]}(e):void 0),o=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?zn(new Kn(o,e)):bn(r.errors)}class Qs{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!q(r.expression)}evaluateWithoutErrorHandling(e,r,o,p,y,w){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,p,y,w)}evaluate(e,r,o,p,y,w){return this._styleExpression.evaluate(e,r,o,p,y,w)}}class Jn{constructor(e,r,o,p){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!q(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,o,p,y,w){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,p,y,w)}evaluate(e,r,o,p,y,w){return this._styleExpression.evaluate(e,r,o,p,y,w)}interpolationFactor(e,r,o){return this.interpolationType?rn.interpolationFactor(this.interpolationType,e,r,o):0}}function Ho(i,e){const r=wn(i,e);if(r.result==="error")return r;const o=r.value.expression,p=z(o);if(!p&&!er(e))return bn([new dr("","data expressions not supported")]);const y=ve(o,["zoom"]);if(!y&&!Zn(e))return bn([new dr("","zoom expressions not supported")]);const w=Ss(o);return w||y?w instanceof dr?bn([w]):w instanceof rn&&!Mi(e)?bn([new dr("",'"interpolate" expressions cannot be used with this property')]):zn(w?new Jn(p?"camera":"composite",r.value,w.labels,w instanceof rn?w.interpolation:void 0):new Qs(p?"constant":"source",r.value)):bn([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Co{constructor(e,r){this._parameters=e,this._specification=r,Ji(this,Ls(this._parameters,this._specification))}static deserialize(e){return new Co(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ss(i){let e=null;if(i instanceof Zs)e=Ss(i.result);else if(i instanceof Hs){for(const r of i.args)if(e=Ss(r),e)break}else(i instanceof bt||i instanceof rn)&&i.input instanceof Si&&i.input.name==="zoom"&&(e=i);return e instanceof dr||i.eachChild(r=>{const o=Ss(r);o instanceof dr?e=o:!e&&o?e=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function pn(i){const e=i.key,r=i.value,o=i.valueSpec||{},p=i.objectElementValidators||{},y=i.style,w=i.styleSpec;let P=[];const k=Ui(r);if(k!=="object")return[new vt(e,r,`object expected, ${k} found`)];for(const F in r){const U=F.split(".")[0],N=o[U]||o["*"];let $;if(p[U])$=p[U];else if(o[U])$=mn;else if(p["*"])$=p["*"];else{if(!o["*"]){P.push(new vt(e,r[F],`unknown property "${F}"`));continue}$=mn}P=P.concat($({key:(e&&`${e}.`)+F,value:r[F],valueSpec:N,style:y,styleSpec:w,object:r,objectKey:F},r))}for(const F in o)p[F]||o[F].required&&o[F].default===void 0&&r[F]===void 0&&P.push(new vt(e,r,`missing required property "${F}"`));return P}function Zo(i){const e=i.value,r=i.valueSpec,o=i.style,p=i.styleSpec,y=i.key,w=i.arrayElementValidator||mn;if(Ui(e)!=="array")return[new vt(y,e,`array expected, ${Ui(e)} found`)];if(r.length&&e.length!==r.length)return[new vt(y,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new vt(y,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let P={type:r.value,values:r.values};p.$version<7&&(P.function=r.function),Ui(r.value)==="object"&&(P=r.value);let k=[];for(let F=0;F<e.length;F++)k=k.concat(w({array:e,arrayIndex:F,value:e[F],valueSpec:P,style:o,styleSpec:p,key:`${y}[${F}]`}));return k}function To(i){const e=i.key,r=i.value,o=i.valueSpec;let p=Ui(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new vt(e,r,`number expected, ${p} found`)]:"minimum"in o&&r<o.minimum?[new vt(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new vt(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Ko(i){const e=i.valueSpec,r=si(i.value.type);let o,p,y,w={};const P=r!=="categorical"&&i.value.property===void 0,k=!P,F=Ui(i.value.stops)==="array"&&Ui(i.value.stops[0])==="array"&&Ui(i.value.stops[0][0])==="object",U=pn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new vt(Z.key,Z.value,'identity function may not have a "stops" property')];let J=[];const me=Z.value;return J=J.concat(Zo({key:Z.key,value:me,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:N})),Ui(me)==="array"&&me.length===0&&J.push(new vt(Z.key,me,"array must have at least one stop")),J},default:function(Z){return mn({key:Z.key,value:Z.value,valueSpec:e,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&P&&U.push(new vt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||U.push(new vt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Mi(i.valueSpec)&&U.push(new vt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(k&&!er(i.valueSpec)?U.push(new vt(i.key,i.value,"property functions not supported")):P&&!Zn(i.valueSpec)&&U.push(new vt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!F||i.value.property!==void 0||U.push(new vt(i.key,i.value,'"property" property is required')),U;function N(Z){let J=[];const me=Z.value,he=Z.key;if(Ui(me)!=="array")return[new vt(he,me,`array expected, ${Ui(me)} found`)];if(me.length!==2)return[new vt(he,me,`array length 2 expected, length ${me.length} found`)];if(F){if(Ui(me[0])!=="object")return[new vt(he,me,`object expected, ${Ui(me[0])} found`)];if(me[0].zoom===void 0)return[new vt(he,me,"object stop key must have zoom")];if(me[0].value===void 0)return[new vt(he,me,"object stop key must have value")];if(y&&y>si(me[0].zoom))return[new vt(he,me[0].zoom,"stop zoom values must appear in ascending order")];si(me[0].zoom)!==y&&(y=si(me[0].zoom),p=void 0,w={}),J=J.concat(pn({key:`${he}[0]`,value:me[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:To,value:$}}))}else J=J.concat($({key:`${he}[0]`,value:me[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},me));return Js(Ei(me[1]))?J.concat([new vt(`${he}[1]`,me[1],"expressions are not allowed in function stops.")]):J.concat(mn({key:`${he}[1]`,value:me[1],valueSpec:e,style:Z.style,styleSpec:Z.styleSpec}))}function $(Z,J){const me=Ui(Z.value),he=si(Z.value),Me=Z.value!==null?Z.value:J;if(o){if(me!==o)return[new vt(Z.key,Me,`${me} stop domain type must match previous stop domain type ${o}`)]}else o=me;if(me!=="number"&&me!=="string"&&me!=="boolean")return[new vt(Z.key,Me,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&r!=="categorical"){let We=`number expected, ${me} found`;return er(e)&&r===void 0&&(We+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vt(Z.key,Me,We)]}return r!=="categorical"||me!=="number"||isFinite(he)&&Math.floor(he)===he?r!=="categorical"&&me==="number"&&p!==void 0&&he<p?[new vt(Z.key,Me,"stop domain values must appear in ascending order")]:(p=he,r==="categorical"&&he in w?[new vt(Z.key,Me,"stop domain values must be unique")]:(w[he]=!0,[])):[new vt(Z.key,Me,`integer expected, found ${he}`)]}}function In(i){const e=(i.expressionContext==="property"?Ho:wn)(Ei(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new vt(`${i.key}${o.key}`,i.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new vt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!q(r))return[new vt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!q(r))return[new vt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ve(r,["zoom","feature-state"]))return[new vt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!z(r))return[new vt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fs(i){const e=i.key,r=i.value,o=i.valueSpec,p=[];return Array.isArray(o.values)?o.values.indexOf(si(r))===-1&&p.push(new vt(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(si(r))===-1&&p.push(new vt(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Rs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Rs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ie={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function et(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Rs(i)||(i=tr(i));const e=wn(i,Ie);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,p)=>e.value.evaluate(r,o,{},p),needGeometry:fi(i)}}function Ft(i,e){return i<e?-1:i>e?1:0}function fi(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(fi(i[e]))return!0;return!1}function tr(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?zi(i[1],i[2],"=="):e==="!="?Nr(zi(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?zi(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(tr))):e==="all"?["all"].concat(i.slice(1).map(tr)):e==="none"?["all"].concat(i.slice(1).map(tr).map(Nr)):e==="in"?ur(i[1],i.slice(2)):e==="!in"?Nr(ur(i[1],i.slice(2))):e==="has"?pr(i[1]):e==="!has"?Nr(pr(i[1])):e!=="within"||i;var r}function zi(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function ur(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Ft)]]:["filter-in-small",i,["literal",e]]}}function pr(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Nr(i){return["!",i]}function _r(i){return Rs(Ei(i.value))?In(Ji({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Pr(i)}function Pr(i){const e=i.value,r=i.key;if(Ui(e)!=="array")return[new vt(r,e,`array expected, ${Ui(e)} found`)];const o=i.styleSpec;let p,y=[];if(e.length<1)return[new vt(r,e,"filter array must have at least 1 element")];switch(y=y.concat(Fs({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),si(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&si(e[1])==="$type"&&y.push(new vt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&y.push(new vt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Ui(e[1]),p!=="string"&&y.push(new vt(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let w=2;w<e.length;w++)p=Ui(e[w]),si(e[1])==="$type"?y=y.concat(Fs({key:`${r}[${w}]`,value:e[w],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new vt(`${r}[${w}]`,e[w],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let w=1;w<e.length;w++)y=y.concat(Pr({key:`${r}[${w}]`,value:e[w],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Ui(e[1]),e.length!==2?y.push(new vt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new vt(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Ui(e[1]),e.length!==2?y.push(new vt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&y.push(new vt(`${r}[1]`,e[1],`object expected, ${p} found`))}return y}function nn(i,e){const r=i.key,o=i.style,p=i.styleSpec,y=i.value,w=i.objectKey,P=p[`${e}_${i.layerType}`];if(!P)return[];const k=w.match(/^(.*)-transition$/);if(e==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return mn({key:r,value:y,valueSpec:p.transition,style:o,styleSpec:p});const F=i.valueSpec||P[w];if(!F)return[new vt(r,y,`unknown property "${w}"`)];let U;if(Ui(y)==="string"&&er(F)&&!F.tokens&&(U=/^{([^}]+)}$/.exec(y)))return[new vt(r,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const N=[];return i.layerType==="symbol"&&(w==="text-field"&&o&&!o.glyphs&&N.push(new vt(r,y,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Yi(Ei(y))&&si(y.type)==="identity"&&N.push(new vt(r,y,'"text-font" does not support identity functions'))),N.concat(mn({key:i.key,value:y,valueSpec:F,style:o,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:w}))}function Fn(i){return nn(i,"paint")}function Gr(i){return nn(i,"layout")}function Rn(i){let e=[];const r=i.value,o=i.key,p=i.style,y=i.styleSpec;r.type||r.ref||e.push(new vt(o,r,'either "type" or "ref" is required'));let w=si(r.type);const P=si(r.ref);if(r.id){const k=si(r.id);for(let F=0;F<i.arrayIndex;F++){const U=p.layers[F];si(U.id)===k&&e.push(new vt(o,r.id,`duplicate layer id "${r.id}", previously used at line ${U.id.__line__}`))}}if("ref"in r){let k;["type","source","source-layer","filter","layout"].forEach(F=>{F in r&&e.push(new vt(o,r[F],`"${F}" is prohibited for ref layers`))}),p.layers.forEach(F=>{si(F.id)===P&&(k=F)}),k?k.ref?e.push(new vt(o,r.ref,"ref cannot reference another ref layer")):w=si(k.type):e.push(new vt(o,r.ref,`ref layer "${P}" not found`))}else if(w!=="background")if(r.source){const k=p.sources&&p.sources[r.source],F=k&&si(k.type);k?F==="vector"&&w==="raster"?e.push(new vt(o,r.source,`layer "${r.id}" requires a raster source`)):F==="raster"&&w!=="raster"?e.push(new vt(o,r.source,`layer "${r.id}" requires a vector source`)):F!=="vector"||r["source-layer"]?F==="raster-dem"&&w!=="hillshade"?e.push(new vt(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!r.paint||!r.paint["line-gradient"]||F==="geojson"&&k.lineMetrics||e.push(new vt(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new vt(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new vt(o,r.source,`source "${r.source}" not found`))}else e.push(new vt(o,r,'missing required property "source"'));return e=e.concat(pn({key:o,value:r,valueSpec:y.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>mn({key:`${o}.type`,value:r.type,valueSpec:y.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:_r,layout:k=>pn({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":F=>Gr(Ji({layerType:w},F))}}),paint:k=>pn({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":F=>Fn(Ji({layerType:w},F))}})}})),e}function An(i){const e=i.value,r=i.key,o=Ui(e);return o!=="string"?[new vt(r,e,`string expected, ${o} found`)]:[]}const eo={promoteId:function({key:i,value:e}){if(Ui(e)==="string")return An({key:i,value:e});{const r=[];for(const o in e)r.push(...An({key:`${i}.${o}`,value:e[o]}));return r}}};function Bn(i){const e=i.value,r=i.key,o=i.styleSpec,p=i.style;if(!e.type)return[new vt(r,e,'"type" is required')];const y=si(e.type);let w;switch(y){case"vector":case"raster":case"raster-dem":return w=pn({key:r,value:e,valueSpec:o[`source_${y.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:eo}),w;case"geojson":if(w=pn({key:r,value:e,valueSpec:o.source_geojson,style:p,styleSpec:o,objectElementValidators:eo}),e.cluster)for(const P in e.clusterProperties){const[k,F]=e.clusterProperties[P],U=typeof k=="string"?[k,["accumulated"],["get",P]]:k;w.push(...In({key:`${r}.${P}.map`,value:F,expressionContext:"cluster-map"})),w.push(...In({key:`${r}.${P}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return w;case"video":return pn({key:r,value:e,valueSpec:o.source_video,style:p,styleSpec:o});case"image":return pn({key:r,value:e,valueSpec:o.source_image,style:p,styleSpec:o});case"canvas":return[new vt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:o})}}function Qn(i){const e=i.value,r=i.styleSpec,o=r.light,p=i.style;let y=[];const w=Ui(e);if(e===void 0)return y;if(w!=="object")return y=y.concat([new vt("light",e,`object expected, ${w} found`)]),y;for(const P in e){const k=P.match(/^(.*)-transition$/);y=y.concat(k&&o[k[1]]&&o[k[1]].transition?mn({key:P,value:e[P],valueSpec:r.transition,style:p,styleSpec:r}):o[P]?mn({key:P,value:e[P],valueSpec:o[P],style:p,styleSpec:r}):[new vt(P,e[P],`unknown property "${P}"`)])}return y}function sn(i){const e=i.value,r=i.styleSpec,o=r.terrain,p=i.style;let y=[];const w=Ui(e);if(e===void 0)return y;if(w!=="object")return y=y.concat([new vt("terrain",e,`object expected, ${w} found`)]),y;for(const P in e)y=y.concat(o[P]?mn({key:P,value:e[P],valueSpec:o[P],style:p,styleSpec:r}):[new vt(P,e[P],`unknown property "${P}"`)]);return y}const to={"*":()=>[],array:Zo,boolean:function(i){const e=i.value,r=i.key,o=Ui(e);return o!=="boolean"?[new vt(r,e,`boolean expected, ${o} found`)]:[]},number:To,color:function(i){const e=i.key,r=i.value,o=Ui(r);return o!=="string"?[new vt(e,r,`color expected, ${o} found`)]:$n(r)===null?[new vt(e,r,`color expected, "${r}" found`)]:[]},constants:Ri,enum:Fs,filter:_r,function:Ko,layer:Rn,object:pn,source:Bn,light:Qn,terrain:sn,string:An,formatted:function(i){return An(i).length===0?[]:In(i)},resolvedImage:function(i){return An(i).length===0?[]:In(i)},padding:function(i){const e=i.key,r=i.value;if(Ui(r)==="array"){if(r.length<1||r.length>4)return[new vt(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let p=[];for(let y=0;y<r.length;y++)p=p.concat(mn({key:`${e}[${y}]`,value:r[y],valueSpec:o}));return p}return To({key:e,value:r,valueSpec:{}})}};function mn(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return r.expression&&Yi(si(e))?Ko(i):r.expression&&Js(Ei(e))?In(i):r.type&&to[r.type]?to[r.type](i):pn(Ji({},i,{valueSpec:r.type?o[r.type]:r}))}function sr(i){const e=i.value,r=i.key,o=An(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new vt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new vt(r,e,'"glyphs" url must include a "{range}" token'))),o}function ji(i,e=Ge){let r=[];return r=r.concat(mn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:sr,"*":()=>[]}})),i.constants&&(r=r.concat(Ri({key:"constants",value:i.constants,style:i,styleSpec:e}))),io(r)}function io(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Xr(i){return function(...e){return io(i.apply(this,e))}}ji.source=Xr(Bn),ji.light=Xr(Qn),ji.terrain=Xr(sn),ji.layer=Xr(Rn),ji.filter=Xr(_r),ji.paintProperty=Xr(Fn),ji.layoutProperty=Xr(Gr);const Cs=ji,on=Cs.light,es=Cs.paintProperty,us=Cs.layoutProperty;function ds(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new Di(new Error(o.message))),r=!0;return r}class fs{constructor(e,r,o){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const w=new Int32Array(this.arrayBuffer);e=w[0],this.d=(r=w[1])+2*(o=w[2]);for(let k=0;k<this.d*this.d;k++){const F=w[3+k],U=w[3+k+1];p.push(F===U?null:w.subarray(F,U))}const P=w[3+p.length+1];this.keys=w.subarray(w[3+p.length],P),this.bboxes=w.subarray(P),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let w=0;w<this.d*this.d;w++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const y=o/r*e;this.min=-y,this.max=e+y}insert(e,r,o,p,y){this._forEachCell(r,o,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,p,y,w){this.cells[y].push(w)}query(e,r,o,p,y){const w=this.min,P=this.max;if(e<=w&&r<=w&&P<=o&&P<=p&&!y)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(e,r,o,p,this._queryCell,k,{},y),k}}_queryCell(e,r,o,p,y,w,P,k){const F=this.cells[y];if(F!==null){const U=this.keys,N=this.bboxes;for(let $=0;$<F.length;$++){const Z=F[$];if(P[Z]===void 0){const J=4*Z;(k?k(N[J+0],N[J+1],N[J+2],N[J+3]):e<=N[J+2]&&r<=N[J+3]&&o>=N[J+0]&&p>=N[J+1])?(P[Z]=!0,w.push(U[Z])):P[Z]=!1}}}}_forEachCell(e,r,o,p,y,w,P,k){const F=this._convertToCellCoord(e),U=this._convertToCellCoord(r),N=this._convertToCellCoord(o),$=this._convertToCellCoord(p);for(let Z=F;Z<=N;Z++)for(let J=U;J<=$;J++){const me=this.d*J+Z;if((!k||k(this._convertFromCellCoord(Z),this._convertFromCellCoord(J),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(J+1)))&&y.call(this,e,r,o,p,me,w,P,k))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let w=0;w<this.cells.length;w++)o+=this.cells[w].length;const p=new Int32Array(r+o+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=r;for(let w=0;w<e.length;w++){const P=e[w];p[3+w]=y,p.set(P,y),y+=P.length}return p[3+e.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+e.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new fs(e.buffer)}}const an={};function Ut(i,e,r={}){if(an[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),an[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ut("Object",Object),Ut("TransferableGridIndex",fs),Ut("Color",te),Ut("Error",Error),Ut("AJAXError",Re),Ut("ResolvedImage",Ce),Ut("StylePropertyFunction",Co),Ut("StyleExpression",Kn,{omit:["_evaluator"]}),Ut("ZoomDependentExpression",Jn),Ut("ZoomConstantExpression",Qs),Ut("CompoundExpression",Si,{omit:["_evaluate"]});for(const i in Ds)Ds[i]._classRegistryKey||Ut(`Expression_${i}`,Ds[i]);function Jo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Un(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Jo(i)||st(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(Un(o,e));return r}if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!an[o])throw new Error(`${o} is not registered.`);const p=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in i){if(!i.hasOwnProperty(y)||an[o].omit.indexOf(y)>=0)continue;const w=i[y];p[y]=an[o].shallow.indexOf(y)>=0?w:Un(w,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(p.$name=o),p}throw new Error("can't serialize object of type "+typeof i)}function jn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Jo(i)||st(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(jn);if(typeof i=="object"){const e=i.$name||"Object";if(!an[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=an[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const y=i[p];o[p]=an[e].shallow.indexOf(p)>=0?y:jn(y)}return o}throw new Error("can't deserialize object of type "+typeof i)}class Bs{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Ot={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function ro(i){for(const e of i)if(za(e.charCodeAt(0)))return!0;return!1}function Eo(i){for(const e of i)if(!Us(e.charCodeAt(0)))return!1;return!0}function Us(i){return!(Ot.Arabic(i)||Ot["Arabic Supplement"](i)||Ot["Arabic Extended-A"](i)||Ot["Arabic Presentation Forms-A"](i)||Ot["Arabic Presentation Forms-B"](i))}function za(i){return!(i!==746&&i!==747&&(i<4352||!(Ot["Bopomofo Extended"](i)||Ot.Bopomofo(i)||Ot["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ot["CJK Compatibility Ideographs"](i)||Ot["CJK Compatibility"](i)||Ot["CJK Radicals Supplement"](i)||Ot["CJK Strokes"](i)||!(!Ot["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ot["CJK Unified Ideographs Extension A"](i)||Ot["CJK Unified Ideographs"](i)||Ot["Enclosed CJK Letters and Months"](i)||Ot["Hangul Compatibility Jamo"](i)||Ot["Hangul Jamo Extended-A"](i)||Ot["Hangul Jamo Extended-B"](i)||Ot["Hangul Jamo"](i)||Ot["Hangul Syllables"](i)||Ot.Hiragana(i)||Ot["Ideographic Description Characters"](i)||Ot.Kanbun(i)||Ot["Kangxi Radicals"](i)||Ot["Katakana Phonetic Extensions"](i)||Ot.Katakana(i)&&i!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ot["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ot["Unified Canadian Aboriginal Syllabics"](i)||Ot["Unified Canadian Aboriginal Syllabics Extended"](i)||Ot["Vertical Forms"](i)||Ot["Yijing Hexagram Symbols"](i)||Ot["Yi Syllables"](i)||Ot["Yi Radicals"](i))))}function yl(i){return!(za(i)||function(e){return!!(Ot["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ot["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ot["Letterlike Symbols"](e)||Ot["Number Forms"](e)||Ot["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ot["Control Pictures"](e)&&e!==9251||Ot["Optical Character Recognition"](e)||Ot["Enclosed Alphanumerics"](e)||Ot["Geometric Shapes"](e)||Ot["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ot["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ot["CJK Symbols and Punctuation"](e)||Ot.Katakana(e)||Ot["Private Use Area"](e)||Ot["CJK Compatibility Forms"](e)||Ot["Small Form Variants"](e)||Ot["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function vl(i){return i>=1424&&i<=2303||Ot["Arabic Presentation Forms-A"](i)||Ot["Arabic Presentation Forms-B"](i)}function Jl(i,e){return!(!e&&vl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ot.Khmer(i))}function xl(i){for(const e of i)if(vl(e.charCodeAt(0)))return!0;return!1}const Fa="deferred",Ra="loading",Ba="loaded";let Ua=null,Sn="unavailable",js=null;const bl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Sn="error"),Ua&&Ua(i)};function Po(){ja.fire(new mi("pluginStateChange",{pluginStatus:Sn,pluginURL:js}))}const ja=new wi,Qo=function(){return Sn},wl=function(){if(Sn!==Fa||!js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Sn=Ra,Po(),js&&$e({url:js},i=>{i?bl(i):(Sn=Ba,Po())})},Vn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Sn===Ba||Vn.applyArabicShaping!=null,isLoading:()=>Sn===Ra,setState(i){if(!ge())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Sn=i.pluginStatus,js=i.pluginURL},isParsed(){if(!ge())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Vn.applyArabicShaping!=null&&Vn.processBidirectionalText!=null&&Vn.processStyledBidirectionalText!=null},getPluginURL(){if(!ge())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return js}};class yr{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bs,this.transition={})}isSupportedScript(e){return function(r,o){for(const p of r)if(!Jl(p.charCodeAt(0),o))return!1;return!0}(e,Vn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class ea{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,p){if(Yi(o))return new Co(o,p);if(Js(o)){const y=Ho(o,p);if(y.result==="error")throw new Error(y.value.map(w=>`${w.key}: ${w.message}`).join(", "));return y.value}{let y=o;return p.type==="color"&&typeof o=="string"?y=te.parse(o):p.type!=="padding"||typeof o!="number"&&!Array.isArray(o)||(y=pe.parse(o)),{kind:"constant",evaluate:()=>y}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class ga{constructor(e){this.property=e,this.value=new ea(e,void 0)}transitioned(e,r){return new Cl(this.property,this.value,r,f({},e.transition,this.transition),e.now)}untransitioned(){return new Cl(this.property,this.value,null,{},0)}}class Sl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return A(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ga(this._values[e].property)),this._values[e].value=new ea(this._values[e].property,r===null?void 0:A(r))}getTransition(e){return A(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ga(this._values[e].property)),this._values[e].transition=A(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){const o=new Tl(this._properties);for(const p of Object.keys(this._values))o._values[p]=this._values[p].transitioned(e,r._values[p]);return o}untransitioned(){const e=new Tl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Cl{constructor(e,r,o,p,y){this.property=e,this.value=r,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const p=e.now||0,y=this.value.possiblyEvaluate(e,r,o),w=this.prior;if(w){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return w.possiblyEvaluate(e,r,o);{const P=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(e,r,o),y,function(k){if(k<=0)return 0;if(k>=1)return 1;const F=k*k,U=F*k;return 4*(k<.5?U:3*(k-F)+U-.75)}(P))}}return y}}class Tl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const p=new ta(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,r,o);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ql{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return A(this._values[e].value)}setValue(e,r){this._values[e]=new ea(this._values[e].property,r===null?void 0:A(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const p=new ta(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,r,o);return p}}class ps{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,p){return this.property.evaluate(this.value,this.parameters,e,r,o,p)}}class ta{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class oi{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const p=Ve[this.specification.type];return p?p(e,r,o):e}}class pi{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,p){return new ps(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,p)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ps(this,{kind:"constant",value:void 0},e.parameters);const p=Ve[this.specification.type];return p?new ps(this,{kind:"constant",value:p(e.value.value,r.value.value,o)},e.parameters):e}evaluate(e,r,o,p,y,w){return e.kind==="constant"?e.value:e.evaluate(r,o,p,y,w)}}class Io extends pi{possiblyEvaluate(e,r,o,p){if(e.value===void 0)return new ps(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const y=e.expression.evaluate(r,null,{},o,p),w=e.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,P=this._calculate(w,w,w,r);return new ps(this,{kind:"constant",value:P},r)}if(e.expression.kind==="camera"){const y=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ps(this,{kind:"constant",value:y},r)}return new ps(this,e.expression,r)}evaluate(e,r,o,p,y,w){if(e.kind==="source"){const P=e.evaluate(r,o,p,y,w);return this._calculate(P,P,P,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,p),e.evaluate({zoom:Math.floor(r.zoom)},o,p),e.evaluate({zoom:Math.floor(r.zoom)+1},o,p),r):e.value}_calculate(e,r,o,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Va{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const y=e.expression.evaluate(r,null,{},o,p);return this._calculate(y,y,y,r)}return this._calculate(e.expression.evaluate(new yr(Math.floor(r.zoom-1),r)),e.expression.evaluate(new yr(Math.floor(r.zoom),r)),e.expression.evaluate(new yr(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Vs{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,p){return!!e.expression.evaluate(r,null,{},o,p)}interpolate(){return!1}}class Qr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new ea(o,void 0),y=this.defaultTransitionablePropertyValues[r]=new ga(o);this.defaultTransitioningPropertyValues[r]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}Ut("DataDrivenProperty",pi),Ut("DataConstantProperty",oi),Ut("CrossFadedDataDrivenProperty",Io),Ut("CrossFadedProperty",Va),Ut("ColorRampProperty",Vs);const Ns="-transition";class ms extends wi{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ql(r.layout)),r.paint)){this._transitionablePaint=new Sl(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ta(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,o={}){r!=null&&this._validate(us,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Ns)?this._transitionablePaint.getTransition(e.slice(0,-Ns.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(es,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Ns))return this._transitionablePaint.setTransition(e.slice(0,-Ns.length),r||void 0),!1;{const p=this._transitionablePaint._values[e],y=p.property.specification["property-type"]==="cross-faded-data-driven",w=p.value.isDataDriven(),P=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const k=this._transitionablePaint._values[e].value;return k.isDataDriven()||w||y||this._handleOverridablePaintPropertyUpdate(e,P,k)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),C(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,p,y={}){return(!y||y.validate!==!1)&&ds(this,e.call(Cs,{key:r,layerType:this.type,objectKey:o,value:p,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ps&&er(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const El={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gs{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ir{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Lr(i,e=1){let r=0,o=0;return{members:i.map(p=>{const y=El[p.type].BYTES_PER_ELEMENT,w=r=Na(r,Math.max(e,y)),P=p.components||1;return o=Math.max(o,y),r+=y*P,{name:p.name,type:p.type,components:P,offset:w}}),size:Na(r,Math.max(o,e)),alignment:e}}function Na(i,e){return Math.ceil(i/e)*e}class no extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const p=2*e;return this.int16[p+0]=r,this.int16[p+1]=o,e}}no.prototype.bytesPerElement=4,Ut("StructArrayLayout2i4",no);class d extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,p)}emplace(e,r,o,p,y){const w=4*e;return this.int16[w+0]=r,this.int16[w+1]=o,this.int16[w+2]=p,this.int16[w+3]=y,e}}d.prototype.bytesPerElement=8,Ut("StructArrayLayout4i8",d);class t extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,o,p,y,w)}emplace(e,r,o,p,y,w,P){const k=6*e;return this.int16[k+0]=r,this.int16[k+1]=o,this.int16[k+2]=p,this.int16[k+3]=y,this.int16[k+4]=w,this.int16[k+5]=P,e}}t.prototype.bytesPerElement=12,Ut("StructArrayLayout2i4i12",t);class s extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,o,p,y,w)}emplace(e,r,o,p,y,w,P){const k=4*e,F=8*e;return this.int16[k+0]=r,this.int16[k+1]=o,this.uint8[F+4]=p,this.uint8[F+5]=y,this.uint8[F+6]=w,this.uint8[F+7]=P,e}}s.prototype.bytesPerElement=8,Ut("StructArrayLayout2i4ub8",s);class a extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const p=2*e;return this.float32[p+0]=r,this.float32[p+1]=o,e}}a.prototype.bytesPerElement=8,Ut("StructArrayLayout2f8",a);class m extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w,P,k,F,U){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,o,p,y,w,P,k,F,U)}emplace(e,r,o,p,y,w,P,k,F,U,N){const $=10*e;return this.uint16[$+0]=r,this.uint16[$+1]=o,this.uint16[$+2]=p,this.uint16[$+3]=y,this.uint16[$+4]=w,this.uint16[$+5]=P,this.uint16[$+6]=k,this.uint16[$+7]=F,this.uint16[$+8]=U,this.uint16[$+9]=N,e}}m.prototype.bytesPerElement=20,Ut("StructArrayLayout10ui20",m);class b extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w,P,k,F,U,N,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,o,p,y,w,P,k,F,U,N,$)}emplace(e,r,o,p,y,w,P,k,F,U,N,$,Z){const J=12*e;return this.int16[J+0]=r,this.int16[J+1]=o,this.int16[J+2]=p,this.int16[J+3]=y,this.uint16[J+4]=w,this.uint16[J+5]=P,this.uint16[J+6]=k,this.uint16[J+7]=F,this.int16[J+8]=U,this.int16[J+9]=N,this.int16[J+10]=$,this.int16[J+11]=Z,e}}b.prototype.bytesPerElement=24,Ut("StructArrayLayout4i4ui4i24",b);class E extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const y=3*e;return this.float32[y+0]=r,this.float32[y+1]=o,this.float32[y+2]=p,e}}E.prototype.bytesPerElement=12,Ut("StructArrayLayout3f12",E);class D extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}D.prototype.bytesPerElement=4,Ut("StructArrayLayout1ul4",D);class L extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w,P,k,F){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,o,p,y,w,P,k,F)}emplace(e,r,o,p,y,w,P,k,F,U){const N=10*e,$=5*e;return this.int16[N+0]=r,this.int16[N+1]=o,this.int16[N+2]=p,this.int16[N+3]=y,this.int16[N+4]=w,this.int16[N+5]=P,this.uint32[$+3]=k,this.uint16[N+8]=F,this.uint16[N+9]=U,e}}L.prototype.bytesPerElement=20,Ut("StructArrayLayout6i1ul2ui20",L);class R extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,o,p,y,w)}emplace(e,r,o,p,y,w,P){const k=6*e;return this.int16[k+0]=r,this.int16[k+1]=o,this.int16[k+2]=p,this.int16[k+3]=y,this.int16[k+4]=w,this.int16[k+5]=P,e}}R.prototype.bytesPerElement=12,Ut("StructArrayLayout2i2i2i12",R);class V extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,o,p,y)}emplace(e,r,o,p,y,w){const P=4*e,k=8*e;return this.float32[P+0]=r,this.float32[P+1]=o,this.float32[P+2]=p,this.int16[k+6]=y,this.int16[k+7]=w,e}}V.prototype.bytesPerElement=16,Ut("StructArrayLayout2f1f2i16",V);class X extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,p)}emplace(e,r,o,p,y){const w=12*e,P=3*e;return this.uint8[w+0]=r,this.uint8[w+1]=o,this.float32[P+1]=p,this.float32[P+2]=y,e}}X.prototype.bytesPerElement=12,Ut("StructArrayLayout2ub2f12",X);class H extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const y=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=o,this.uint16[y+2]=p,e}}H.prototype.bytesPerElement=6,Ut("StructArrayLayout3ui6",H);class le extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me,he,Me){const We=this.length;return this.resize(We+1),this.emplace(We,e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me,he,Me)}emplace(e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me,he,Me,We){const Pe=24*e,Ne=12*e,ft=48*e;return this.int16[Pe+0]=r,this.int16[Pe+1]=o,this.uint16[Pe+2]=p,this.uint16[Pe+3]=y,this.uint32[Ne+2]=w,this.uint32[Ne+3]=P,this.uint32[Ne+4]=k,this.uint16[Pe+10]=F,this.uint16[Pe+11]=U,this.uint16[Pe+12]=N,this.float32[Ne+7]=$,this.float32[Ne+8]=Z,this.uint8[ft+36]=J,this.uint8[ft+37]=me,this.uint8[ft+38]=he,this.uint32[Ne+10]=Me,this.int16[Pe+22]=We,e}}le.prototype.bytesPerElement=48,Ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",le);class ne extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me,he,Me,We,Pe,Ne,ft,dt,Jt,ni,jt,zt,kt,Vt){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me,he,Me,We,Pe,Ne,ft,dt,Jt,ni,jt,zt,kt,Vt)}emplace(e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me,he,Me,We,Pe,Ne,ft,dt,Jt,ni,jt,zt,kt,Vt,Bt){const Et=34*e,ui=17*e;return this.int16[Et+0]=r,this.int16[Et+1]=o,this.int16[Et+2]=p,this.int16[Et+3]=y,this.int16[Et+4]=w,this.int16[Et+5]=P,this.int16[Et+6]=k,this.int16[Et+7]=F,this.uint16[Et+8]=U,this.uint16[Et+9]=N,this.uint16[Et+10]=$,this.uint16[Et+11]=Z,this.uint16[Et+12]=J,this.uint16[Et+13]=me,this.uint16[Et+14]=he,this.uint16[Et+15]=Me,this.uint16[Et+16]=We,this.uint16[Et+17]=Pe,this.uint16[Et+18]=Ne,this.uint16[Et+19]=ft,this.uint16[Et+20]=dt,this.uint16[Et+21]=Jt,this.uint16[Et+22]=ni,this.uint32[ui+12]=jt,this.float32[ui+13]=zt,this.float32[ui+14]=kt,this.float32[ui+15]=Vt,this.float32[ui+16]=Bt,e}}ne.prototype.bytesPerElement=68,Ut("StructArrayLayout8i15ui1ul4f68",ne);class ae extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ae.prototype.bytesPerElement=4,Ut("StructArrayLayout1f4",ae);class xe extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const y=3*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=p,e}}xe.prototype.bytesPerElement=6,Ut("StructArrayLayout3i6",xe);class Ee extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const y=4*e;return this.uint32[2*e+0]=r,this.uint16[y+2]=o,this.uint16[y+3]=p,e}}Ee.prototype.bytesPerElement=8,Ut("StructArrayLayout1ul2ui8",Ee);class Oe extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=o,e}}Oe.prototype.bytesPerElement=4,Ut("StructArrayLayout2ui4",Oe);class ce extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ce.prototype.bytesPerElement=2,Ut("StructArrayLayout1ui2",ce);class Xe extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,p)}emplace(e,r,o,p,y){const w=4*e;return this.float32[w+0]=r,this.float32[w+1]=o,this.float32[w+2]=p,this.float32[w+3]=y,e}}Xe.prototype.bytesPerElement=16,Ut("StructArrayLayout4f16",Xe);class Ue extends Gs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new it(this.anchorPointX,this.anchorPointY)}}Ue.prototype.size=20;class rt extends L{get(e){return new Ue(this,e)}}Ut("CollisionBoxArray",rt);class ot extends Gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ot.prototype.size=48;class St extends le{get(e){return new ot(this,e)}}Ut("PlacedSymbolArray",St);class Qe extends Gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Qe.prototype.size=68;class Xt extends ne{get(e){return new Qe(this,e)}}Ut("SymbolInstanceArray",Xt);class Lt extends ae{getoffsetX(e){return this.float32[1*e+0]}}Ut("GlyphOffsetArray",Lt);class Kt extends xe{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ut("SymbolLineVertexArray",Kt);class Ci extends Gs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ci.prototype.size=8;class Pi extends Ee{get(e){return new Ci(this,e)}}Ut("FeatureIndexArray",Pi);class hi extends no{}class ir extends no{}class rr extends no{}class Ni extends t{}class Gi extends s{}class nr extends a{}class Wr extends m{}class gs extends b{}class ts extends E{}class _s extends D{}class Xs extends R{}class Nn extends X{}class Cn extends H{}class Ts extends Oe{}const _a=Lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rr}=_a;class ki{constructor(e=[]){this.segments=e}prepareSegment(e,r,o,p){let y=this.segments[this.segments.length-1];return e>ki.MAX_VERTEX_ARRAY_LENGTH&&j(`Max vertices per segment is ${ki.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>ki.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,p){return new ki([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:p,vaos:{},sortKey:0}])}}function Hi(i,e){return 256*(i=l(Math.floor(i),0,255))+l(Math.floor(e),0,255)}ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut("SegmentVector",ki);const $r=Lr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var qr={exports:{}},vr={exports:{}};vr.exports=function(i,e){var r,o,p,y,w,P,k,F;for(o=i.length-(r=3&i.length),p=e,w=3432918353,P=461845907,F=0;F<o;)k=255&i.charCodeAt(F)|(255&i.charCodeAt(++F))<<8|(255&i.charCodeAt(++F))<<16|(255&i.charCodeAt(++F))<<24,++F,p=27492+(65535&(y=5*(65535&(p=(p^=k=(65535&(k=(k=(65535&k)*w+(((k>>>16)*w&65535)<<16)&4294967295)<<15|k>>>17))*P+(((k>>>16)*P&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(k=0,r){case 3:k^=(255&i.charCodeAt(F+2))<<16;case 2:k^=(255&i.charCodeAt(F+1))<<8;case 1:p^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(F)))*w+(((k>>>16)*w&65535)<<16)&4294967295)<<15|k>>>17))*P+(((k>>>16)*P&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Gn={exports:{}};Gn.exports=function(i,e){for(var r,o=i.length,p=e^o,y=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++y;switch(o){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var so=vr.exports,Ga=Gn.exports;qr.exports=so,qr.exports.murmur3=so,qr.exports.murmur2=Ga;class Ao{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,p){this.ids.push(Pl(e)),this.positions.push(r,o,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Pl(e);let o=0,p=this.ids.length-1;for(;o<p;){const w=o+p>>1;this.ids[w]>=r?p=w:o=w+1}const y=[];for(;this.ids[o]===r;)y.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return y}static serialize(e,r){const o=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Xa(o,p,0,o.length-1),r&&r.push(o.buffer,p.buffer),{ids:o,positions:p}}static deserialize(e){const r=new Ao;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Pl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:qr.exports(String(i))}function Xa(i,e,r,o){for(;r<o;){const p=i[r+o>>1];let y=r-1,w=o+1;for(;;){do y++;while(i[y]<p);do w--;while(i[w]>p);if(y>=w)break;Ws(i,y,w),Ws(e,3*y,3*w),Ws(e,3*y+1,3*w+1),Ws(e,3*y+2,3*w+2)}w-r<o-w?(Xa(i,e,r,w),r=w+1):(Xa(i,e,w+1,o),o=w)}}function Ws(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}Ut("FeaturePositionMap",Ao);class oo{constructor(e,r){this.gl=e.gl,this.location=r}}class ao extends oo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ya extends oo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Zc extends oo{constructor(e,r){super(e,r),this.current=te.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Lu=new Float32Array(16);function ec(i){return[Hi(255*i.r,255*i.g),Hi(255*i.b,255*i.a)]}class Wa{constructor(e,r,o){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Zc(e,r):new ao(e,r)}}class va{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,p){const y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&e.set(y)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new ya(e,r):new ao(e,r)}}class lo{constructor(e,r,o,p){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,o,p,y){const w=this.paintVertexArray.length,P=this.expression.evaluate(new yr(0),r,{},p,[],y);this.paintVertexArray.resize(e),this._setPaintValue(w,e,P)}updatePaintArray(e,r,o,p){const y=this.expression.evaluate({zoom:0},o,p);this._setPaintValue(e,r,y)}_setPaintValue(e,r,o){if(this.type==="color"){const p=ec(o);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Es{constructor(e,r,o,p,y,w){this.expression=e,this.uniformNames=r.map(P=>`u_${P}_t`),this.type=o,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=r.map(P=>({name:`a_${P}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(e,r,o,p,y){const w=this.expression.evaluate(new yr(this.zoom),r,{},p,[],y),P=this.expression.evaluate(new yr(this.zoom+1),r,{},p,[],y),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,w,P)}updatePaintArray(e,r,o,p){const y=this.expression.evaluate({zoom:this.zoom},o,p),w=this.expression.evaluate({zoom:this.zoom+1},o,p);this._setPaintValue(e,r,y,w)}_setPaintValue(e,r,o,p){if(this.type==="color"){const y=ec(o),w=ec(p);for(let P=e;P<r;P++)this.paintVertexArray.emplace(P,y[0],y[1],w[0],w[1])}else{for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,o,p);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=l(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,r,o){return new ao(e,r)}}class Mo{constructor(e,r,o,p,y,w){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=p,this.layerId=w,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,r,o){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,p,y){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],y)}_setPaintValues(e,r,o,p){if(!p||!o)return;const{min:y,mid:w,max:P}=o,k=p[y],F=p[w],U=p[P];if(k&&F&&U)for(let N=e;N<r;N++)this.zoomInPaintVertexArray.emplace(N,F.tl[0],F.tl[1],F.br[0],F.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],F.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,F.tl[0],F.tl[1],F.br[0],F.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],F.pixelRatio,U.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,$r.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,$r.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Kc{constructor(e,r,o){this.binders={},this._buffers=[];const p=[];for(const y in e.paint._values){if(!o(y))continue;const w=e.paint.get(y);if(!(w instanceof ps&&er(w.property.specification)))continue;const P=zu(y,e.type),k=w.value,F=w.property.specification.type,U=w.property.useIntegerZoom,N=w.property.specification["property-type"],$=N==="cross-faded"||N==="cross-faded-data-driven";if(k.kind==="constant")this.binders[y]=$?new va(k.value,P):new Wa(k.value,P,F),p.push(`/u_${y}`);else if(k.kind==="source"||$){const Z=Jc(y,F,"source");this.binders[y]=$?new Mo(k,F,U,r,Z,e.id):new lo(k,P,F,Z),p.push(`/a_${y}`)}else{const Z=Jc(y,F,"composite");this.binders[y]=new Es(k,P,F,U,r,Z),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof lo||r instanceof Es?r.maxValue:0}populatePaintArrays(e,r,o,p,y){for(const w in this.binders){const P=this.binders[w];(P instanceof lo||P instanceof Es||P instanceof Mo)&&P.populatePaintArray(e,r,o,p,y)}}setConstantPatternPositions(e,r){for(const o in this.binders){const p=this.binders[o];p instanceof va&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,p,y){let w=!1;for(const P in e){const k=r.getPositions(P);for(const F of k){const U=o.feature(F.index);for(const N in this.binders){const $=this.binders[N];if(($ instanceof lo||$ instanceof Es||$ instanceof Mo)&&$.expression.isStateDependent===!0){const Z=p.paint.get(N);$.expression=Z.value,$.updatePaintArray(F.start,F.end,U,e[P],y),w=!0}}}}return w}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Wa||o instanceof va)&&e.push(...o.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof lo||o instanceof Es)for(let p=0;p<o.paintVertexAttributes.length;p++)e.push(o.paintVertexAttributes[p].name);else if(o instanceof Mo)for(let p=0;p<$r.members.length;p++)e.push($r.members[p].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Wa||o instanceof va||o instanceof Es)for(const p of o.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof Wa||y instanceof va||y instanceof Es){for(const w of y.uniformNames)if(r[w]){const P=y.getBinding(e,r[w],w);o.push({name:w,property:p,binding:P})}}}return o}setUniforms(e,r,o,p){for(const{name:y,property:w,binding:P}of r)this.binders[w].setUniform(P,p,o.get(w),y)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof Mo){const p=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(o instanceof lo||o instanceof Es)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof lo||o instanceof Es||o instanceof Mo)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof lo||r instanceof Es||r instanceof Mo)&&r.destroy()}}}class ia{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new Kc(p,r,o);this.needsUpload=!1,this._featureMap=new Ao,this._bufferOffset=0}populatePaintArrays(e,r,o,p,y,w){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,r,p,y,w);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,p){for(const y of o)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,r,y,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function zu(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Jc(i,e,r){const o={color:{source:a,composite:Xe},number:{source:ae,composite:a}},p=function(y){return{"line-pattern":{source:Wr,composite:Wr},"fill-pattern":{source:Wr,composite:Wr},"fill-extrusion-pattern":{source:Wr,composite:Wr}}[y]}(i);return p&&p[r]||o[e][r]}Ut("ConstantBinder",Wa),Ut("CrossFadedConstantBinder",va),Ut("SourceExpressionBinder",lo),Ut("CrossFadedCompositeBinder",Mo),Ut("CompositeExpressionBinder",Es),Ut("ProgramConfiguration",Kc,{omit:["_buffers"]}),Ut("ProgramConfigurationSet",ia);var Br=8192;const tc=Math.pow(2,14)-1,Qc=-tc-1;function ra(i){const e=Br/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const p=r[o];for(let y=0;y<p.length;y++){const w=p[y],P=Math.round(w.x*e),k=Math.round(w.y*e);w.x=l(P,Qc,tc),w.y=l(k,Qc,tc),(P<w.x||P>w.x+1||k<w.y||k>w.y+1)&&j("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function na(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ra(i):[]}}function Il(i,e,r,o,p){i.emplaceBack(2*e+(o+1)/2,2*r+(p+1)/2)}class ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ir,this.indexArray=new Cn,this.segments=new ki,this.programConfigurations=new ia(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const p=this.layers[0],y=[];let w=null,P=!1;p.type==="circle"&&(w=p.layout.get("circle-sort-key"),P=!w.isConstant());for(const{feature:k,id:F,index:U,sourceLayerIndex:N}of e){const $=this.layers[0]._featureFilter.needGeometry,Z=na(k,$);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),Z,o))continue;const J=P?w.evaluate(Z,{},o):void 0,me={id:F,properties:k.properties,type:k.type,sourceLayerIndex:N,index:U,geometry:$?Z.geometry:ra(k),patterns:{},sortKey:J};y.push(me)}P&&y.sort((k,F)=>k.sortKey-F.sortKey);for(const k of y){const{geometry:F,index:U,sourceLayerIndex:N}=k,$=e[U].feature;this.addFeature(k,F,U,o),r.featureIndex.insert($,F,U,N,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,p){for(const y of r)for(const w of y){const P=w.x,k=w.y;if(P<0||P>=Br||k<0||k>=Br)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=F.vertexLength;Il(this.layoutVertexArray,P,k,-1,-1),Il(this.layoutVertexArray,P,k,1,-1),Il(this.layoutVertexArray,P,k,1,1),Il(this.layoutVertexArray,P,k,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},p)}}function eh(i,e){for(let r=0;r<i.length;r++)if(xa(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(xa(i,e[r]))return!0;return!!rc(i,e)}function Fu(i,e,r){return!!xa(i,e)||!!nc(e,i,r)}function th(i,e){if(i.length===1)return rh(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let p=0;p<o.length;p++)if(xa(i,o[p]))return!0}for(let r=0;r<i.length;r++)if(rh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(rc(i,e[r]))return!0;return!1}function Ru(i,e,r){if(i.length>1){if(rc(i,e))return!0;for(let o=0;o<e.length;o++)if(nc(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(nc(i[o],e,r))return!0;return!1}function rc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],p=i[r+1];for(let y=0;y<e.length-1;y++)if(Bu(o,p,e[y],e[y+1]))return!0}return!1}function Bu(i,e,r,o){return Y(i,r,o)!==Y(e,r,o)&&Y(i,e,r)!==Y(i,e,o)}function nc(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let p=1;p<e.length;p++)if(ih(i,e[p-1],e[p])<o)return!0;return!1}function ih(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function rh(i,e){let r,o,p,y=!1;for(let w=0;w<i.length;w++){r=i[w];for(let P=0,k=r.length-1;P<r.length;k=P++)o=r[P],p=r[k],o.y>e.y!=p.y>e.y&&e.x<(p.x-o.x)*(e.y-o.y)/(p.y-o.y)+o.x&&(y=!y)}return y}function xa(i,e){let r=!1;for(let o=0,p=i.length-1;o<i.length;p=o++){const y=i[o],w=i[p];y.y>e.y!=w.y>e.y&&e.x<(w.x-y.x)*(e.y-y.y)/(w.y-y.y)+y.x&&(r=!r)}return r}function Uu(i,e,r){const o=r[0],p=r[2];if(i.x<o.x&&e.x<o.x||i.x>p.x&&e.x>p.x||i.y<o.y&&e.y<o.y||i.y>p.y&&e.y>p.y)return!1;const y=Y(i,e,r[0]);return y!==Y(i,e,r[1])||y!==Y(i,e,r[2])||y!==Y(i,e,r[3])}function $a(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Al(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ml(i,e,r,o,p){if(!e[0]&&!e[1])return i;const y=it.convert(e)._mult(p);r==="viewport"&&y._rotate(-o);const w=[];for(let P=0;P<i.length;P++)w.push(i[P].sub(y));return w}Ut("CircleBucket",ic,{omit:["layers"]});const ju=new Qr({"circle-sort-key":new pi(Ge.layout_circle["circle-sort-key"])});var Vu={paint:new Qr({"circle-radius":new pi(Ge.paint_circle["circle-radius"]),"circle-color":new pi(Ge.paint_circle["circle-color"]),"circle-blur":new pi(Ge.paint_circle["circle-blur"]),"circle-opacity":new pi(Ge.paint_circle["circle-opacity"]),"circle-translate":new oi(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new oi(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new oi(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new oi(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pi(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pi(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pi(Ge.paint_circle["circle-stroke-opacity"])}),layout:ju},Tn=1e-6,En=typeof Float32Array<"u"?Float32Array:Array;function nh(){var i=new En(9);return En!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function sc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function sh(i,e,r){var o=e[0],p=e[1],y=e[2],w=e[3],P=e[4],k=e[5],F=e[6],U=e[7],N=e[8],$=e[9],Z=e[10],J=e[11],me=e[12],he=e[13],Me=e[14],We=e[15],Pe=r[0],Ne=r[1],ft=r[2],dt=r[3];return i[0]=Pe*o+Ne*P+ft*N+dt*me,i[1]=Pe*p+Ne*k+ft*$+dt*he,i[2]=Pe*y+Ne*F+ft*Z+dt*Me,i[3]=Pe*w+Ne*U+ft*J+dt*We,i[4]=(Pe=r[4])*o+(Ne=r[5])*P+(ft=r[6])*N+(dt=r[7])*me,i[5]=Pe*p+Ne*k+ft*$+dt*he,i[6]=Pe*y+Ne*F+ft*Z+dt*Me,i[7]=Pe*w+Ne*U+ft*J+dt*We,i[8]=(Pe=r[8])*o+(Ne=r[9])*P+(ft=r[10])*N+(dt=r[11])*me,i[9]=Pe*p+Ne*k+ft*$+dt*he,i[10]=Pe*y+Ne*F+ft*Z+dt*Me,i[11]=Pe*w+Ne*U+ft*J+dt*We,i[12]=(Pe=r[12])*o+(Ne=r[13])*P+(ft=r[14])*N+(dt=r[15])*me,i[13]=Pe*p+Ne*k+ft*$+dt*he,i[14]=Pe*y+Ne*F+ft*Z+dt*Me,i[15]=Pe*w+Ne*U+ft*J+dt*We,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var qa,Nu=sh;function oh(){var i=new En(3);return En!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function ah(i,e,r){var o=new En(3);return o[0]=i,o[1]=e,o[2]=r,o}function kl(i,e,r){var o=e[0],p=e[1],y=e[2],w=e[3];return i[0]=r[0]*o+r[4]*p+r[8]*y+r[12]*w,i[1]=r[1]*o+r[5]*p+r[9]*y+r[13]*w,i[2]=r[2]*o+r[6]*p+r[10]*y+r[14]*w,i[3]=r[3]*o+r[7]*p+r[11]*y+r[15]*w,i}function lh(){var i=new En(4);return En!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ch(i,e){const r=kl([],[i.x,i.y,0,1],e);return new it(r[0]/r[3],r[1]/r[3])}oh(),qa=new En(4),En!=Float32Array&&(qa[0]=0,qa[1]=0,qa[2]=0,qa[3]=0),oh(),ah(1,0,0),ah(0,1,0),lh(),lh(),nh(),function(){var i;i=new En(2),En!=Float32Array&&(i[0]=0,i[1]=0)}();class hh extends ic{}Ut("HeatmapBucket",hh,{omit:["layers"]});var Gu={paint:new Qr({"heatmap-radius":new pi(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pi(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new oi(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vs(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new oi(Ge.paint_heatmap["heatmap-opacity"])})};function oc(i,{width:e,height:r},o,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*r*o}`)}else p=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=p,i}function uh(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const p=oc({},{width:e,height:r},o);ac(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=p.data}function ac(i,e,r,o,p,y){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||o.x>e.width-p.width||o.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const w=i.data,P=e.data;if(w===P)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<p.height;k++){const F=((r.y+k)*i.width+r.x)*y,U=((o.y+k)*e.width+o.x)*y;for(let N=0;N<p.width*y;N++)P[U+N]=w[F+N]}return e}class Ya{constructor(e,r){oc(this,e,1,r)}resize(e){uh(this,e,1)}clone(){return new Ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,p,y){ac(e,r,o,p,y,1)}}class is{constructor(e,r){oc(this,e,4,r)}resize(e){uh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,p,y){ac(e,r,o,p,y,4)}}function dh(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,p=i.image||new is({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const y=(w,P,k)=>{e[i.evaluationKey]=k;const F=i.expression.evaluate(e);p.data[w+P+0]=Math.floor(255*F.r/F.a),p.data[w+P+1]=Math.floor(255*F.g/F.a),p.data[w+P+2]=Math.floor(255*F.b/F.a),p.data[w+P+3]=Math.floor(255*F.a)};if(i.clips)for(let w=0,P=0;w<o;++w,P+=4*r)for(let k=0,F=0;k<r;k++,F+=4){const U=k/(r-1),{start:N,end:$}=i.clips[w];y(P,F,N*(1-U)+$*U)}else for(let w=0,P=0;w<r;w++,P+=4)y(0,P,w/(r-1));return p}Ut("AlphaImage",Ya),Ut("RGBAImage",is);var Xu={paint:new Qr({"hillshade-illumination-direction":new oi(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new oi(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new oi(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new oi(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new oi(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new oi(Ge.paint_hillshade["hillshade-accent-color"])})};const Wu=Lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:$u}=Wu;var Dl={exports:{}};function Ol(i,e,r){r=r||2;var o,p,y,w,P,k,F,U=e&&e.length,N=U?e[0]*r:i.length,$=fh(i,0,N,r,!0),Z=[];if(!$||$.next===$.prev)return Z;if(U&&($=function(me,he,Me,We){var Pe,Ne,ft,dt=[];for(Pe=0,Ne=he.length;Pe<Ne;Pe++)(ft=fh(me,he[Pe]*We,Pe<Ne-1?he[Pe+1]*We:me.length,We,!1))===ft.next&&(ft.steiner=!0),dt.push(ed(ft));for(dt.sort(Ku),Pe=0;Pe<dt.length;Pe++)Me=Ju(dt[Pe],Me);return Me}(i,e,$,r)),i.length>80*r){o=y=i[0],p=w=i[1];for(var J=r;J<N;J+=r)(P=i[J])<o&&(o=P),(k=i[J+1])<p&&(p=k),P>y&&(y=P),k>w&&(w=k);F=(F=Math.max(y-o,w-p))!==0?32767/F:0}return Ha($,Z,r,o,p,F,0),Z}function fh(i,e,r,o,p){var y,w;if(p===hc(i,e,r,o)>0)for(y=e;y<r;y+=o)w=gh(y,i[y],i[y+1],w);else for(y=r-o;y>=e;y-=o)w=gh(y,i[y],i[y+1],w);return w&&Ll(w,w.next)&&(Ka(w),w=w.next),w}function sa(i,e){if(!i)return i;e||(e=i);var r,o=i;do if(r=!1,o.steiner||!Ll(o,o.next)&&kr(o.prev,o,o.next)!==0)o=o.next;else{if(Ka(o),(o=e=o.prev)===o.next)break;r=!0}while(r||o!==e);return e}function Ha(i,e,r,o,p,y,w){if(i){!w&&y&&function(U,N,$,Z){var J=U;do J.z===0&&(J.z=lc(J.x,J.y,N,$,Z)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==U);J.prevZ.nextZ=null,J.prevZ=null,function(me){var he,Me,We,Pe,Ne,ft,dt,Jt,ni=1;do{for(Me=me,me=null,Ne=null,ft=0;Me;){for(ft++,We=Me,dt=0,he=0;he<ni&&(dt++,We=We.nextZ);he++);for(Jt=ni;dt>0||Jt>0&&We;)dt!==0&&(Jt===0||!We||Me.z<=We.z)?(Pe=Me,Me=Me.nextZ,dt--):(Pe=We,We=We.nextZ,Jt--),Ne?Ne.nextZ=Pe:me=Pe,Pe.prevZ=Ne,Ne=Pe;Me=We}Ne.nextZ=null,ni*=2}while(ft>1)}(J)}(i,o,p,y);for(var P,k,F=i;i.prev!==i.next;)if(P=i.prev,k=i.next,y?Yu(i,o,p,y):qu(i))e.push(P.i/r|0),e.push(i.i/r|0),e.push(k.i/r|0),Ka(i),i=k.next,F=k.next;else if((i=k)===F){w?w===1?Ha(i=Hu(sa(i),e,r),e,r,o,p,y,2):w===2&&Zu(i,e,r,o,p,y):Ha(sa(i),e,r,o,p,y,1);break}}}function qu(i){var e=i.prev,r=i,o=i.next;if(kr(e,r,o)>=0)return!1;for(var p=e.x,y=r.x,w=o.x,P=e.y,k=r.y,F=o.y,U=p<y?p<w?p:w:y<w?y:w,N=P<k?P<F?P:F:k<F?k:F,$=p>y?p>w?p:w:y>w?y:w,Z=P>k?P>F?P:F:k>F?k:F,J=o.next;J!==e;){if(J.x>=U&&J.x<=$&&J.y>=N&&J.y<=Z&&ba(p,P,y,k,w,F,J.x,J.y)&&kr(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function Yu(i,e,r,o){var p=i.prev,y=i,w=i.next;if(kr(p,y,w)>=0)return!1;for(var P=p.x,k=y.x,F=w.x,U=p.y,N=y.y,$=w.y,Z=P<k?P<F?P:F:k<F?k:F,J=U<N?U<$?U:$:N<$?N:$,me=P>k?P>F?P:F:k>F?k:F,he=U>N?U>$?U:$:N>$?N:$,Me=lc(Z,J,e,r,o),We=lc(me,he,e,r,o),Pe=i.prevZ,Ne=i.nextZ;Pe&&Pe.z>=Me&&Ne&&Ne.z<=We;){if(Pe.x>=Z&&Pe.x<=me&&Pe.y>=J&&Pe.y<=he&&Pe!==p&&Pe!==w&&ba(P,U,k,N,F,$,Pe.x,Pe.y)&&kr(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ne.x>=Z&&Ne.x<=me&&Ne.y>=J&&Ne.y<=he&&Ne!==p&&Ne!==w&&ba(P,U,k,N,F,$,Ne.x,Ne.y)&&kr(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;Pe&&Pe.z>=Me;){if(Pe.x>=Z&&Pe.x<=me&&Pe.y>=J&&Pe.y<=he&&Pe!==p&&Pe!==w&&ba(P,U,k,N,F,$,Pe.x,Pe.y)&&kr(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ne&&Ne.z<=We;){if(Ne.x>=Z&&Ne.x<=me&&Ne.y>=J&&Ne.y<=he&&Ne!==p&&Ne!==w&&ba(P,U,k,N,F,$,Ne.x,Ne.y)&&kr(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function Hu(i,e,r){var o=i;do{var p=o.prev,y=o.next.next;!Ll(p,y)&&ph(p,o,o.next,y)&&Za(p,y)&&Za(y,p)&&(e.push(p.i/r|0),e.push(o.i/r|0),e.push(y.i/r|0),Ka(o),Ka(o.next),o=i=y),o=o.next}while(o!==i);return sa(o)}function Zu(i,e,r,o,p,y){var w=i;do{for(var P=w.next.next;P!==w.prev;){if(w.i!==P.i&&td(w,P)){var k=mh(w,P);return w=sa(w,w.next),k=sa(k,k.next),Ha(w,e,r,o,p,y,0),void Ha(k,e,r,o,p,y,0)}P=P.next}w=w.next}while(w!==i)}function Ku(i,e){return i.x-e.x}function Ju(i,e){var r=function(p,y){var w,P=y,k=p.x,F=p.y,U=-1/0;do{if(F<=P.y&&F>=P.next.y&&P.next.y!==P.y){var N=P.x+(F-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(N<=k&&N>U&&(U=N,w=P.x<P.next.x?P:P.next,N===k))return w}P=P.next}while(P!==y);if(!w)return null;var $,Z=w,J=w.x,me=w.y,he=1/0;P=w;do k>=P.x&&P.x>=J&&k!==P.x&&ba(F<me?k:U,F,J,me,F<me?U:k,F,P.x,P.y)&&($=Math.abs(F-P.y)/(k-P.x),Za(P,p)&&($<he||$===he&&(P.x>w.x||P.x===w.x&&Qu(w,P)))&&(w=P,he=$)),P=P.next;while(P!==Z);return w}(i,e);if(!r)return e;var o=mh(r,i);return sa(o,o.next),sa(r,r.next)}function Qu(i,e){return kr(i.prev,i,e.prev)<0&&kr(e.next,i,i.next)<0}function lc(i,e,r,o,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ed(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ba(i,e,r,o,p,y,w,P){return(p-w)*(e-P)>=(i-w)*(y-P)&&(i-w)*(o-P)>=(r-w)*(e-P)&&(r-w)*(y-P)>=(p-w)*(o-P)}function td(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==o.i&&p.next.i!==o.i&&ph(p,p.next,r,o))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(Za(i,e)&&Za(e,i)&&function(r,o){var p=r,y=!1,w=(r.x+o.x)/2,P=(r.y+o.y)/2;do p.y>P!=p.next.y>P&&p.next.y!==p.y&&w<(p.next.x-p.x)*(P-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==r);return y}(i,e)&&(kr(i.prev,i,e.prev)||kr(i,e.prev,e))||Ll(i,e)&&kr(i.prev,i,i.next)>0&&kr(e.prev,e,e.next)>0)}function kr(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ll(i,e){return i.x===e.x&&i.y===e.y}function ph(i,e,r,o){var p=Fl(kr(i,e,r)),y=Fl(kr(i,e,o)),w=Fl(kr(r,o,i)),P=Fl(kr(r,o,e));return p!==y&&w!==P||!(p!==0||!zl(i,r,e))||!(y!==0||!zl(i,o,e))||!(w!==0||!zl(r,i,o))||!(P!==0||!zl(r,e,o))}function zl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Fl(i){return i>0?1:i<0?-1:0}function Za(i,e){return kr(i.prev,i,i.next)<0?kr(i,e,i.next)>=0&&kr(i,i.prev,e)>=0:kr(i,e,i.prev)<0||kr(i,i.next,e)<0}function mh(i,e){var r=new cc(i.i,i.x,i.y),o=new cc(e.i,e.x,e.y),p=i.next,y=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,o.next=r,r.prev=o,y.next=o,o.prev=y,o}function gh(i,e,r,o){var p=new cc(i,e,r);return o?(p.next=o.next,p.prev=o,o.next.prev=p,o.next=p):(p.prev=p,p.next=p),p}function Ka(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function cc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hc(i,e,r,o){for(var p=0,y=e,w=r-o;y<r;y+=o)p+=(i[w]-i[y])*(i[y+1]+i[w+1]),w=y;return p}function id(i,e,r,o,p){_h(i,e,r||0,o||i.length-1,p||rd)}function _h(i,e,r,o,p){for(;o>r;){if(o-r>600){var y=o-r+1,w=e-r+1,P=Math.log(y),k=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*k*(y-k)/y)*(w-y/2<0?-1:1);_h(i,e,Math.max(r,Math.floor(e-w*k/y+F)),Math.min(o,Math.floor(e+(y-w)*k/y+F)),p)}var U=i[e],N=r,$=o;for(Ja(i,r,e),p(i[o],U)>0&&Ja(i,r,o);N<$;){for(Ja(i,N,$),N++,$--;p(i[N],U)<0;)N++;for(;p(i[$],U)>0;)$--}p(i[r],U)===0?Ja(i,r,$):Ja(i,++$,o),$<=e&&(r=$+1),e<=$&&(o=$-1)}}function Ja(i,e,r){var o=i[e];i[e]=i[r],i[r]=o}function rd(i,e){return i<e?-1:i>e?1:0}function uc(i,e){const r=i.length;if(r<=1)return[i];const o=[];let p,y;for(let w=0;w<r;w++){const P=oe(i[w]);P!==0&&(i[w].area=Math.abs(P),y===void 0&&(y=P<0),y===P<0?(p&&o.push(p),p=[i[w]]):p.push(i[w]))}if(p&&o.push(p),e>1)for(let w=0;w<o.length;w++)o[w].length<=e||(id(o[w],e,1,o[w].length-1,nd),o[w]=o[w].slice(0,e));return o}function nd(i,e){return e.area-i.area}function dc(i,e,r){const o=r.patternDependencies;let p=!1;for(const y of e){const w=y.paint.get(`${i}-pattern`);w.isConstant()||(p=!0);const P=w.constantOr(null);P&&(p=!0,o[P.to]=!0,o[P.from]=!0)}return p}function fc(i,e,r,o,p){const y=p.patternDependencies;for(const w of e){const P=w.paint.get(`${i}-pattern`).value;if(P.kind!=="constant"){let k=P.evaluate({zoom:o-1},r,{},p.availableImages),F=P.evaluate({zoom:o},r,{},p.availableImages),U=P.evaluate({zoom:o+1},r,{},p.availableImages);k=k&&k.name?k.name:k,F=F&&F.name?F.name:F,U=U&&U.name?U.name:U,y[k]=!0,y[F]=!0,y[U]=!0,r.patterns[w.id]={min:k,mid:F,max:U}}}return r}Dl.exports=Ol,Dl.exports.default=Ol,Ol.deviation=function(i,e,r,o){var p=e&&e.length,y=Math.abs(hc(i,0,p?e[0]*r:i.length,r));if(p)for(var w=0,P=e.length;w<P;w++)y-=Math.abs(hc(i,e[w]*r,w<P-1?e[w+1]*r:i.length,r));var k=0;for(w=0;w<o.length;w+=3){var F=o[w]*r,U=o[w+1]*r,N=o[w+2]*r;k+=Math.abs((i[F]-i[N])*(i[U+1]-i[F+1])-(i[F]-i[U])*(i[N+1]-i[F+1]))}return y===0&&k===0?0:Math.abs((k-y)/y)},Ol.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},o=0,p=0;p<i.length;p++){for(var y=0;y<i[p].length;y++)for(var w=0;w<e;w++)r.vertices.push(i[p][y][w]);p>0&&r.holes.push(o+=i[p-1].length)}return r};class pc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rr,this.indexArray=new Cn,this.indexArray2=new Ts,this.programConfigurations=new ia(e.layers,e.zoom),this.segments=new ki,this.segments2=new ki,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=dc("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),w=[];for(const{feature:P,id:k,index:F,sourceLayerIndex:U}of e){const N=this.layers[0]._featureFilter.needGeometry,$=na(P,N);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),$,o))continue;const Z=y?p.evaluate($,{},o,r.availableImages):void 0,J={id:k,properties:P.properties,type:P.type,sourceLayerIndex:U,index:F,geometry:N?$.geometry:ra(P),patterns:{},sortKey:Z};w.push(J)}y&&w.sort((P,k)=>P.sortKey-k.sortKey);for(const P of w){const{geometry:k,index:F,sourceLayerIndex:U}=P;if(this.hasPattern){const N=fc("fill",this.layers,P,this.zoom,r);this.patternFeatures.push(N)}else this.addFeature(P,k,F,o,{});r.featureIndex.insert(e[F].feature,k,F,U,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$u),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,p,y){for(const w of uc(r,500)){let P=0;for(const Z of w)P+=Z.length;const k=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),F=k.vertexLength,U=[],N=[];for(const Z of w){if(Z.length===0)continue;Z!==w[0]&&N.push(U.length/2);const J=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),me=J.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(me+Z.length-1,me),U.push(Z[0].x),U.push(Z[0].y);for(let he=1;he<Z.length;he++)this.layoutVertexArray.emplaceBack(Z[he].x,Z[he].y),this.indexArray2.emplaceBack(me+he-1,me+he),U.push(Z[he].x),U.push(Z[he].y);J.vertexLength+=Z.length,J.primitiveLength+=Z.length}const $=Dl.exports(U,N);for(let Z=0;Z<$.length;Z+=3)this.indexArray.emplaceBack(F+$[Z],F+$[Z+1],F+$[Z+2]);k.vertexLength+=P,k.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,y,p)}}Ut("FillBucket",pc,{omit:["layers","patternFeatures"]});const sd=new Qr({"fill-sort-key":new pi(Ge.layout_fill["fill-sort-key"])});var od={paint:new Qr({"fill-antialias":new oi(Ge.paint_fill["fill-antialias"]),"fill-opacity":new pi(Ge.paint_fill["fill-opacity"]),"fill-color":new pi(Ge.paint_fill["fill-color"]),"fill-outline-color":new pi(Ge.paint_fill["fill-outline-color"]),"fill-translate":new oi(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new oi(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Io(Ge.paint_fill["fill-pattern"])}),layout:sd};const ad=Lr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ld=Lr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cd}=ad;var ko={},hd=it,yh=wa;function wa(i,e,r,o,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=p,i.readFields(ud,this,e)}function ud(i,e,r){i==1?e.id=r.readVarint():i==2?function(o,p){for(var y=o.readVarint()+o.pos;o.pos<y;){var w=p._keys[o.readVarint()],P=p._values[o.readVarint()];p.properties[w]=P}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function dd(i){for(var e,r,o=0,p=0,y=i.length,w=y-1;p<y;w=p++)o+=((r=i[w]).x-(e=i[p]).x)*(e.y+r.y);return o}wa.types=["Unknown","Point","LineString","Polygon"],wa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,o=1,p=0,y=0,w=0,P=[];i.pos<r;){if(p<=0){var k=i.readVarint();o=7&k,p=k>>3}if(p--,o===1||o===2)y+=i.readSVarint(),w+=i.readSVarint(),o===1&&(e&&P.push(e),e=[]),e.push(new hd(y,w));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&P.push(e),P},wa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,o=0,p=0,y=0,w=1/0,P=-1/0,k=1/0,F=-1/0;i.pos<e;){if(o<=0){var U=i.readVarint();r=7&U,o=U>>3}if(o--,r===1||r===2)(p+=i.readSVarint())<w&&(w=p),p>P&&(P=p),(y+=i.readSVarint())<k&&(k=y),y>F&&(F=y);else if(r!==7)throw new Error("unknown command "+r)}return[w,k,P,F]},wa.prototype.toGeoJSON=function(i,e,r){var o,p,y=this.extent*Math.pow(2,r),w=this.extent*i,P=this.extent*e,k=this.loadGeometry(),F=wa.types[this.type];function U(Z){for(var J=0;J<Z.length;J++){var me=Z[J];Z[J]=[360*(me.x+w)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(me.y+P)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(o=0;o<k.length;o++)N[o]=k[o][0];U(k=N);break;case 2:for(o=0;o<k.length;o++)U(k[o]);break;case 3:for(k=function(Z){var J=Z.length;if(J<=1)return[Z];for(var me,he,Me=[],We=0;We<J;We++){var Pe=dd(Z[We]);Pe!==0&&(he===void 0&&(he=Pe<0),he===Pe<0?(me&&Me.push(me),me=[Z[We]]):me.push(Z[We]))}return me&&Me.push(me),Me}(k),o=0;o<k.length;o++)for(p=0;p<k[o].length;p++)U(k[o][p])}k.length===1?k=k[0]:F="Multi"+F;var $={type:"Feature",geometry:{type:F,coordinates:k},properties:this.properties};return"id"in this&&($.id=this.id),$};var fd=yh,vh=xh;function xh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(pd,this,e),this.length=this._features.length}function pd(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(o){for(var p=null,y=o.readVarint()+o.pos;o.pos<y;){var w=o.readVarint()>>3;p=w===1?o.readString():w===2?o.readFloat():w===3?o.readDouble():w===4?o.readVarint64():w===5?o.readVarint():w===6?o.readSVarint():w===7?o.readBoolean():null}return p}(r))}xh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new fd(this._pbf,e,this.extent,this._keys,this._values)};var md=vh;function gd(i,e,r){if(i===3){var o=new md(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}ko.VectorTile=function(i,e){this.layers=i.readFields(gd,{},e)},ko.VectorTileFeature=yh,ko.VectorTileLayer=vh;const _d=ko.VectorTileFeature.types,mc=Math.pow(2,13);function Qa(i,e,r,o,p,y,w,P){i.emplaceBack(e,r,2*Math.floor(o*mc)+w,p*mc*2,y*mc*2,Math.round(P))}class gc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ni,this.centroidVertexArray=new hi,this.indexArray=new Cn,this.programConfigurations=new ia(e.layers,e.zoom),this.segments=new ki,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=dc("fill-extrusion",this.layers,r);for(const{feature:p,id:y,index:w,sourceLayerIndex:P}of e){const k=this.layers[0]._featureFilter.needGeometry,F=na(p,k);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),F,o))continue;const U={id:y,sourceLayerIndex:P,index:w,geometry:k?F.geometry:ra(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(fc("fill-extrusion",this.layers,U,this.zoom,r)):this.addFeature(U,U.geometry,w,o,{}),r.featureIndex.insert(p,U.geometry,w,P,this.index,!0)}}addFeatures(e,r,o){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,r,o)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ld.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,p,y){const w={x:0,y:0,vertexCount:0};for(const P of uc(r,500)){let k=0;for(const J of P)k+=J.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const J of P){if(J.length===0||vd(J))continue;let me=0;for(let he=0;he<J.length;he++){const Me=J[he];if(he>=1){const We=J[he-1];if(!yd(Me,We)){F.vertexLength+4>ki.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Pe=Me.sub(We)._perp()._unit(),Ne=We.dist(Me);me+Ne>32768&&(me=0),Qa(this.layoutVertexArray,Me.x,Me.y,Pe.x,Pe.y,0,0,me),Qa(this.layoutVertexArray,Me.x,Me.y,Pe.x,Pe.y,0,1,me),w.x+=2*Me.x,w.y+=2*Me.y,w.vertexCount+=2,me+=Ne,Qa(this.layoutVertexArray,We.x,We.y,Pe.x,Pe.y,0,0,me),Qa(this.layoutVertexArray,We.x,We.y,Pe.x,Pe.y,0,1,me),w.x+=2*We.x,w.y+=2*We.y,w.vertexCount+=2;const ft=F.vertexLength;this.indexArray.emplaceBack(ft,ft+2,ft+1),this.indexArray.emplaceBack(ft+1,ft+2,ft+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+k>ki.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),_d[e.type]!=="Polygon")continue;const U=[],N=[],$=F.vertexLength;for(const J of P)if(J.length!==0){J!==P[0]&&N.push(U.length/2);for(let me=0;me<J.length;me++){const he=J[me];Qa(this.layoutVertexArray,he.x,he.y,0,0,1,1,0),w.x+=he.x,w.y+=he.y,w.vertexCount+=1,U.push(he.x),U.push(he.y)}}const Z=Dl.exports(U,N);for(let J=0;J<Z.length;J+=3)this.indexArray.emplaceBack($+Z[J],$+Z[J+2],$+Z[J+1]);F.primitiveLength+=Z.length/3,F.vertexLength+=k}for(let P=0;P<w.vertexCount;P++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,y,p)}}function yd(i,e){return i.x===e.x&&(i.x<0||i.x>Br)||i.y===e.y&&(i.y<0||i.y>Br)}function vd(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Br)||i.every(e=>e.y<0)||i.every(e=>e.y>Br)}Ut("FillExtrusionBucket",gc,{omit:["layers","features"]});var xd={paint:new Qr({"fill-extrusion-opacity":new oi(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pi(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new oi(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new oi(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Io(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pi(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pi(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new oi(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function el(i,e){return i.x*e.x+i.y*e.y}function bh(i,e){if(i.length===1){let r=0;const o=e[r++];let p;for(;!p||o.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){const y=e[r],w=i[0],P=p.sub(o),k=y.sub(o),F=w.sub(o),U=el(P,P),N=el(P,k),$=el(k,k),Z=el(F,P),J=el(F,k),me=U*$-N*N,he=($*Z-N*J)/me,Me=(U*J-N*Z)/me,We=o.z*(1-he-Me)+p.z*he+y.z*Me;if(isFinite(We))return We}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const bd=Lr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wd}=bd,Sd=Lr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Cd}=Sd,Td=ko.VectorTileFeature.types,Ed=Math.cos(Math.PI/180*37.5),wh=Math.pow(2,14)/.5;class _c{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Gi,this.layoutVertexArray2=new nr,this.indexArray=new Cn,this.programConfigurations=new ia(e.layers,e.zoom),this.segments=new ki,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=dc("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),w=[];for(const{feature:P,id:k,index:F,sourceLayerIndex:U}of e){const N=this.layers[0]._featureFilter.needGeometry,$=na(P,N);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),$,o))continue;const Z=y?p.evaluate($,{},o):void 0,J={id:k,properties:P.properties,type:P.type,sourceLayerIndex:U,index:F,geometry:N?$.geometry:ra(P),patterns:{},sortKey:Z};w.push(J)}y&&w.sort((P,k)=>P.sortKey-k.sortKey);for(const P of w){const{geometry:k,index:F,sourceLayerIndex:U}=P;if(this.hasPattern){const N=fc("line",this.layers,P,this.zoom,r);this.patternFeatures.push(N)}else this.addFeature(P,k,F,o,{});r.featureIndex.insert(e[F].feature,k,F,U,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,p,y){const w=this.layers[0].layout,P=w.get("line-join").evaluate(e,{}),k=w.get("line-cap"),F=w.get("line-miter-limit"),U=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const N of r)this.addLine(N,e,P,k,F,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,y,p)}addLine(e,r,o,p,y,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Me=0;Me<e.length-1;Me++)this.totalDistance+=e[Me].dist(e[Me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=Td[r.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let F=0;for(;F<k-1&&e[F].equals(e[F+1]);)F++;if(k<(P?3:2))return;o==="bevel"&&(y=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,N=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let $,Z,J,me,he;this.e1=this.e2=-1,P&&($=e[k-2],he=e[F].sub($)._unit()._perp());for(let Me=F;Me<k;Me++){if(J=Me===k-1?P?e[F+1]:void 0:e[Me+1],J&&e[Me].equals(J))continue;he&&(me=he),$&&(Z=$),$=e[Me],he=J?J.sub($)._unit()._perp():me,me=me||he;let We=me.add(he);We.x===0&&We.y===0||We._unit();const Pe=me.x*he.x+me.y*he.y,Ne=We.x*he.x+We.y*he.y,ft=Ne!==0?1/Ne:1/0,dt=2*Math.sqrt(2-2*Ne),Jt=Ne<Ed&&Z&&J,ni=me.x*he.y-me.y*he.x>0;if(Jt&&Me>F){const kt=$.dist(Z);if(kt>2*U){const Vt=$.sub($.sub(Z)._mult(U/kt)._round());this.updateDistance(Z,Vt),this.addCurrentVertex(Vt,me,0,0,N),Z=Vt}}const jt=Z&&J;let zt=jt?o:P?"butt":p;if(jt&&zt==="round"&&(ft<w?zt="miter":ft<=2&&(zt="fakeround")),zt==="miter"&&ft>y&&(zt="bevel"),zt==="bevel"&&(ft>2&&(zt="flipbevel"),ft<y&&(zt="miter")),Z&&this.updateDistance(Z,$),zt==="miter")We._mult(ft),this.addCurrentVertex($,We,0,0,N);else if(zt==="flipbevel"){if(ft>100)We=he.mult(-1);else{const kt=ft*me.add(he).mag()/me.sub(he).mag();We._perp()._mult(kt*(ni?-1:1))}this.addCurrentVertex($,We,0,0,N),this.addCurrentVertex($,We.mult(-1),0,0,N)}else if(zt==="bevel"||zt==="fakeround"){const kt=-Math.sqrt(ft*ft-1),Vt=ni?kt:0,Bt=ni?0:kt;if(Z&&this.addCurrentVertex($,me,Vt,Bt,N),zt==="fakeround"){const Et=Math.round(180*dt/Math.PI/20);for(let ui=1;ui<Et;ui++){let ai=ui/Et;if(ai!==.5){const mr=ai-.5;ai+=ai*mr*(ai-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*mr*mr+(.848013+Pe*(.215638*Pe-1.06021)))}const Ii=he.sub(me)._mult(ai)._add(me)._unit()._mult(ni?-1:1);this.addHalfVertex($,Ii.x,Ii.y,!1,ni,0,N)}}J&&this.addCurrentVertex($,he,-Vt,-Bt,N)}else if(zt==="butt")this.addCurrentVertex($,We,0,0,N);else if(zt==="square"){const kt=Z?1:-1;this.addCurrentVertex($,We,kt,kt,N)}else zt==="round"&&(Z&&(this.addCurrentVertex($,me,0,0,N),this.addCurrentVertex($,me,1,1,N,!0)),J&&(this.addCurrentVertex($,he,-1,-1,N,!0),this.addCurrentVertex($,he,0,0,N)));if(Jt&&Me<k-1){const kt=$.dist(J);if(kt>2*U){const Vt=$.add(J.sub($)._mult(U/kt)._round());this.updateDistance($,Vt),this.addCurrentVertex(Vt,he,0,0,N),$=Vt}}}}addCurrentVertex(e,r,o,p,y,w=!1){const P=r.y*p-r.x,k=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,w,!1,o,y),this.addHalfVertex(e,P,k,w,!0,-p,y),this.distance>wh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,o,p,y,w))}addHalfVertex({x:e,y:r},o,p,y,w,P,k){const F=.5*(this.lineClips?this.scaledDistance*(wh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(r<<1)+(w?1:0),Math.round(63*o)+128,Math.round(63*p)+128,1+(P===0?0:P<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const U=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),k.primitiveLength++),w?this.e2=U:this.e1=U}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ut("LineBucket",_c,{omit:["layers","patternFeatures"]});const Pd=new Qr({"line-cap":new oi(Ge.layout_line["line-cap"]),"line-join":new pi(Ge.layout_line["line-join"]),"line-miter-limit":new oi(Ge.layout_line["line-miter-limit"]),"line-round-limit":new oi(Ge.layout_line["line-round-limit"]),"line-sort-key":new pi(Ge.layout_line["line-sort-key"])});var Sh={paint:new Qr({"line-opacity":new pi(Ge.paint_line["line-opacity"]),"line-color":new pi(Ge.paint_line["line-color"]),"line-translate":new oi(Ge.paint_line["line-translate"]),"line-translate-anchor":new oi(Ge.paint_line["line-translate-anchor"]),"line-width":new pi(Ge.paint_line["line-width"]),"line-gap-width":new pi(Ge.paint_line["line-gap-width"]),"line-offset":new pi(Ge.paint_line["line-offset"]),"line-blur":new pi(Ge.paint_line["line-blur"]),"line-dasharray":new Va(Ge.paint_line["line-dasharray"]),"line-pattern":new Io(Ge.paint_line["line-pattern"]),"line-gradient":new Vs(Ge.paint_line["line-gradient"])}),layout:Pd};const Ch=new class extends pi{possiblyEvaluate(i,e){return e=new yr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,o){return e=f({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,o)}}(Sh.paint.properties["line-width"].specification);function Th(i,e){return e>0?e+2*i:i}Ch.useIntegerZoom=!0;const Id=Lr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ad=Lr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Lr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Md=Lr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Lr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Eh=Lr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kd=Lr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Dd(i,e,r){return i.sections.forEach(o=>{o.text=function(p,y,w){const P=y.layout.get("text-transform").evaluate(w,{});return P==="uppercase"?p=p.toLocaleUpperCase():P==="lowercase"&&(p=p.toLocaleLowerCase()),Vn.applyArabicShaping&&(p=Vn.applyArabicShaping(p)),p}(o.text,e,r)}),i}Lr([{name:"triangle",components:3,type:"Uint16"}]),Lr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Lr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Lr([{type:"Float32",name:"offsetX"}]),Lr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const tl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var en=24,yc=or,Ph=function(i,e,r,o,p){var y,w,P=8*p-o-1,k=(1<<P)-1,F=k>>1,U=-7,N=r?p-1:0,$=r?-1:1,Z=i[e+N];for(N+=$,y=Z&(1<<-U)-1,Z>>=-U,U+=P;U>0;y=256*y+i[e+N],N+=$,U-=8);for(w=y&(1<<-U)-1,y>>=-U,U+=o;U>0;w=256*w+i[e+N],N+=$,U-=8);if(y===0)y=1-F;else{if(y===k)return w?NaN:1/0*(Z?-1:1);w+=Math.pow(2,o),y-=F}return(Z?-1:1)*w*Math.pow(2,y-o)},Ih=function(i,e,r,o,p,y){var w,P,k,F=8*y-p-1,U=(1<<F)-1,N=U>>1,$=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=o?0:y-1,J=o?1:-1,me=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(P=isNaN(e)?1:0,w=U):(w=Math.floor(Math.log(e)/Math.LN2),e*(k=Math.pow(2,-w))<1&&(w--,k*=2),(e+=w+N>=1?$/k:$*Math.pow(2,1-N))*k>=2&&(w++,k/=2),w+N>=U?(P=0,w=U):w+N>=1?(P=(e*k-1)*Math.pow(2,p),w+=N):(P=e*Math.pow(2,N-1)*Math.pow(2,p),w=0));p>=8;i[r+Z]=255&P,Z+=J,P/=256,p-=8);for(w=w<<p|P,F+=p;F>0;i[r+Z]=255&w,Z+=J,w/=256,F-=8);i[r+Z-J]|=128*me};function or(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}or.Varint=0,or.Fixed64=1,or.Bytes=2,or.Fixed32=5;var Do,vc=4294967296,Ah=1/vc,Mh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function co(i){return i.type===or.Bytes?i.readVarint()+i.pos:i.pos+1}function Sa(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function kh(i,e,r){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(var p=r.pos-1;p>=i;p--)r.buf[p+o]=r.buf[p]}function Od(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Ld(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function zd(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Fd(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Rd(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Bd(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Ud(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function jd(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Vd(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Rl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ca(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Dh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Nd(i,e,r){i===1&&r.readMessage(Gd,e)}function Gd(i,e,r){if(i===3){const{id:o,bitmap:p,width:y,height:w,left:P,top:k,advance:F}=r.readMessage(Xd,{});e.push({id:o,bitmap:new Ya({width:y+6,height:w+6},p),metrics:{width:y,height:w,left:P,top:k,advance:F}})}}function Xd(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Oh(i){let e=0,r=0;for(const w of i)e+=w.w*w.h,r=Math.max(r,w.w);i.sort((w,P)=>P.h-w.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let p=0,y=0;for(const w of i)for(let P=o.length-1;P>=0;P--){const k=o[P];if(!(w.w>k.w||w.h>k.h)){if(w.x=k.x,w.y=k.y,y=Math.max(y,w.y+w.h),p=Math.max(p,w.x+w.w),w.w===k.w&&w.h===k.h){const F=o.pop();P<o.length&&(o[P]=F)}else w.h===k.h?(k.x+=w.w,k.w-=w.w):w.w===k.w?(k.y+=w.h,k.h-=w.h):(o.push({x:k.x+w.w,y:k.y,w:k.w-w.w,h:w.h}),k.y+=w.h,k.h-=w.h);break}}return{w:p,h:y,fill:e/(p*y)||0}}or.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),p=o>>3,y=this.pos;this.type=7&o,i(p,e,this),this.pos===y&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Rl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Dh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Rl(this.buf,this.pos)+Rl(this.buf,this.pos+4)*vc;return this.pos+=8,i},readSFixed64:function(){var i=Rl(this.buf,this.pos)+Dh(this.buf,this.pos+4)*vc;return this.pos+=8,i},readFloat:function(){var i=Ph(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ph(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,o=this.buf;return e=127&(r=o[this.pos++]),r<128?e:(e|=(127&(r=o[this.pos++]))<<7,r<128?e:(e|=(127&(r=o[this.pos++]))<<14,r<128?e:(e|=(127&(r=o[this.pos++]))<<21,r<128?e:function(p,y,w){var P,k,F=w.buf;if(P=(112&(k=F[w.pos++]))>>4,k<128||(P|=(127&(k=F[w.pos++]))<<3,k<128)||(P|=(127&(k=F[w.pos++]))<<10,k<128)||(P|=(127&(k=F[w.pos++]))<<17,k<128)||(P|=(127&(k=F[w.pos++]))<<24,k<128)||(P|=(1&(k=F[w.pos++]))<<31,k<128))return Sa(p,P,y);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Mh?function(r,o,p){return Mh.decode(r.subarray(o,p))}(this.buf,e,i):function(r,o,p){for(var y="",w=o;w<p;){var P,k,F,U=r[w],N=null,$=U>239?4:U>223?3:U>191?2:1;if(w+$>p)break;$===1?U<128&&(N=U):$===2?(192&(P=r[w+1]))==128&&(N=(31&U)<<6|63&P)<=127&&(N=null):$===3?(k=r[w+2],(192&(P=r[w+1]))==128&&(192&k)==128&&((N=(15&U)<<12|(63&P)<<6|63&k)<=2047||N>=55296&&N<=57343)&&(N=null)):$===4&&(k=r[w+2],F=r[w+3],(192&(P=r[w+1]))==128&&(192&k)==128&&(192&F)==128&&((N=(15&U)<<18|(63&P)<<12|(63&k)<<6|63&F)<=65535||N>=1114112)&&(N=null)),N===null?(N=65533,$=1):N>65535&&(N-=65536,y+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),y+=String.fromCharCode(N),w+=$}return y}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==or.Bytes)return i.push(this.readVarint(e));var r=co(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==or.Bytes)return i.push(this.readSVarint());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==or.Bytes)return i.push(this.readBoolean());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==or.Bytes)return i.push(this.readFloat());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==or.Bytes)return i.push(this.readDouble());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==or.Bytes)return i.push(this.readFixed32());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==or.Bytes)return i.push(this.readSFixed32());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==or.Bytes)return i.push(this.readFixed64());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==or.Bytes)return i.push(this.readSFixed64());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===or.Varint)for(;this.buf[this.pos++]>127;);else if(e===or.Bytes)this.pos=this.readVarint()+this.pos;else if(e===or.Fixed32)this.pos+=4;else{if(e!==or.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ca(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ca(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ca(this.buf,-1&i,this.pos),Ca(this.buf,Math.floor(i*Ah),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ca(this.buf,-1&i,this.pos),Ca(this.buf,Math.floor(i*Ah),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var o,p;if(e>=0?(o=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,w,P){P.buf[P.pos++]=127&y|128,y>>>=7,P.buf[P.pos++]=127&y|128,y>>>=7,P.buf[P.pos++]=127&y|128,y>>>=7,P.buf[P.pos++]=127&y|128,P.buf[P.pos]=127&(y>>>=7)}(o,0,r),function(y,w){var P=(7&y)<<4;w.buf[w.pos++]|=P|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,p,y){for(var w,P,k=0;k<p.length;k++){if((w=p.charCodeAt(k))>55295&&w<57344){if(!P){w>56319||k+1===p.length?(o[y++]=239,o[y++]=191,o[y++]=189):P=w;continue}if(w<56320){o[y++]=239,o[y++]=191,o[y++]=189,P=w;continue}w=P-55296<<10|w-56320|65536,P=null}else P&&(o[y++]=239,o[y++]=191,o[y++]=189,P=null);w<128?o[y++]=w:(w<2048?o[y++]=w>>6|192:(w<65536?o[y++]=w>>12|224:(o[y++]=w>>18|240,o[y++]=w>>12&63|128),o[y++]=w>>6&63|128),o[y++]=63&w|128)}return y}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&kh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Ih(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ih(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var o=this.pos-r;o>=128&&kh(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,r){this.writeTag(i,or.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Od,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ld,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Rd,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,zd,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Fd,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Bd,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Ud,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,jd,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Vd,e)},writeBytesField:function(i,e){this.writeTag(i,or.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,or.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,or.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,or.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,or.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,or.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,or.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,or.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,or.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,or.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class xc{constructor(e,{pixelRatio:r,version:o,stretchX:p,stretchY:y,content:w}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=y,this.content=w,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lh{constructor(e,r){const o={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,o,y),this.addImages(r,p,y);const{w,h:P}=Oh(y),k=new is({width:w||1,height:P||1});for(const F in e){const U=e[F],N=o[F].paddedRect;is.copy(U.data,k,{x:0,y:0},{x:N.x+1,y:N.y+1},U.data)}for(const F in r){const U=r[F],N=p[F].paddedRect,$=N.x+1,Z=N.y+1,J=U.data.width,me=U.data.height;is.copy(U.data,k,{x:0,y:0},{x:$,y:Z},U.data),is.copy(U.data,k,{x:0,y:me-1},{x:$,y:Z-1},{width:J,height:1}),is.copy(U.data,k,{x:0,y:0},{x:$,y:Z+me},{width:J,height:1}),is.copy(U.data,k,{x:J-1,y:0},{x:$-1,y:Z},{width:1,height:me}),is.copy(U.data,k,{x:0,y:0},{x:$+J,y:Z},{width:1,height:me})}this.image=k,this.iconPositions=o,this.patternPositions=p}addImages(e,r,o){for(const p in e){const y=e[p],w={x:0,y:0,w:y.data.width+2,h:y.data.height+2};o.push(w),r[p]=new xc(w,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,y]=e.tl;o.update(r.data,void 0,{x:p,y})}}Ut("ImagePosition",xc),Ut("ImageAtlas",Lh),n.WritingMode=void 0,(Do=n.WritingMode||(n.WritingMode={}))[Do.none=0]="none",Do[Do.horizontal=1]="horizontal",Do[Do.vertical=2]="vertical",Do[Do.horizontalOnly=3]="horizontalOnly";const Bl=-17;class il{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const o=new il;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new il;return r.imageName=e,r}}class Ta{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new Ta;for(let p=0;p<e.sections.length;p++){const y=e.sections[p];y.image?o.addImageSection(y):o.addTextSection(y,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const p=e.charCodeAt(o+1)||null,y=e.charCodeAt(o-1)||null;r+=p&&yl(p)&&!tl[e[o+1]]||y&&yl(y)&&!tl[e[o-1]]||!tl[e[o]]?e[o]:tl[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&jl[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&jl[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Ta;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(il.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void j("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(il.forImage(r)),this.sectionIndex.push(this.sections.length-1)):j("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ul(i,e,r,o,p,y,w,P,k,F,U,N,$,Z,J,me){const he=Ta.fromFeature(i,p);let Me;N===n.WritingMode.vertical&&he.verticalizePunctuation();const{processBidirectionalText:We,processStyledBidirectionalText:Pe}=Vn;if(We&&he.sections.length===1){Me=[];const dt=We(he.toString(),bc(he,F,y,e,o,Z,J));for(const Jt of dt){const ni=new Ta;ni.text=Jt,ni.sections=he.sections;for(let jt=0;jt<Jt.length;jt++)ni.sectionIndex.push(0);Me.push(ni)}}else if(Pe){Me=[];const dt=Pe(he.text,he.sectionIndex,bc(he,F,y,e,o,Z,J));for(const Jt of dt){const ni=new Ta;ni.text=Jt[0],ni.sectionIndex=Jt[1],ni.sections=he.sections,Me.push(ni)}}else Me=function(dt,Jt){const ni=[],jt=dt.text;let zt=0;for(const kt of Jt)ni.push(dt.substring(zt,kt)),zt=kt;return zt<jt.length&&ni.push(dt.substring(zt,jt.length)),ni}(he,bc(he,F,y,e,o,Z,J));const Ne=[],ft={positionedLines:Ne,text:he.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(dt,Jt,ni,jt,zt,kt,Vt,Bt,Et,ui,ai,Ii){let mr=0,xr=Bl,Ur=0,ns=0;const ln=Bt==="right"?1:Bt==="left"?0:.5;let zr=0;for(const Fr of zt){Fr.trim();const hn=Fr.getMaxScale(),_n=(hn-1)*en,Pn={positionedGlyphs:[],lineOffset:0};dt.positionedLines[zr]=Pn;const kn=Pn.positionedGlyphs;let Dn=0;if(!Fr.length()){xr+=kt,++zr;continue}for(let Hr=0;Hr<Fr.length();Hr++){const Fi=Fr.getSection(Hr),Xn=Fr.getSectionIndex(Hr),un=Fr.getCharCode(Hr);let yn=0,ys=null,Ps=null,Is=null,uo=en;const vs=!(Et===n.WritingMode.horizontal||!ai&&!za(un)||ai&&(jl[un]||(Yr=un,Ot.Arabic(Yr)||Ot["Arabic Supplement"](Yr)||Ot["Arabic Extended-A"](Yr)||Ot["Arabic Presentation Forms-A"](Yr)||Ot["Arabic Presentation Forms-B"](Yr))));if(Fi.imageName){const ss=jt[Fi.imageName];if(!ss)continue;Is=Fi.imageName,dt.iconsInText=dt.iconsInText||!0,Ps=ss.paddedRect;const On=ss.displaySize;Fi.scale=Fi.scale*en/Ii,ys={width:On[0],height:On[1],left:1,top:-3,advance:vs?On[1]:On[0]},yn=_n+(en-On[1]*Fi.scale),uo=ys.advance;const fo=vs?On[0]*Fi.scale-en*hn:On[1]*Fi.scale-en*hn;fo>0&&fo>Dn&&(Dn=fo)}else{const ss=ni[Fi.fontStack],On=ss&&ss[un];if(On&&On.rect)Ps=On.rect,ys=On.metrics;else{const fo=Jt[Fi.fontStack],sl=fo&&fo[un];if(!sl)continue;ys=sl.metrics}yn=(hn-Fi.scale)*en}vs?(dt.verticalizable=!0,kn.push({glyph:un,imageName:Is,x:mr,y:xr+yn,vertical:vs,scale:Fi.scale,fontStack:Fi.fontStack,sectionIndex:Xn,metrics:ys,rect:Ps}),mr+=uo*Fi.scale+ui):(kn.push({glyph:un,imageName:Is,x:mr,y:xr+yn,vertical:vs,scale:Fi.scale,fontStack:Fi.fontStack,sectionIndex:Xn,metrics:ys,rect:Ps}),mr+=ys.advance*Fi.scale+ui)}kn.length!==0&&(Ur=Math.max(mr-ui,Ur),qd(kn,0,kn.length-1,ln,Dn)),mr=0;const Cr=kt*hn+Dn;Pn.lineOffset=Math.max(Dn,_n),xr+=Cr,ns=Math.max(Cr,ns),++zr}var Yr;const cn=xr-Bl,{horizontalAlign:gn,verticalAlign:Mn}=wc(Vt);(function(Fr,hn,_n,Pn,kn,Dn,Cr,Hr,Fi){const Xn=(hn-_n)*kn;let un=0;un=Dn!==Cr?-Hr*Pn-Bl:(-Pn*Fi+.5)*Cr;for(const yn of Fr)for(const ys of yn.positionedGlyphs)ys.x+=Xn,ys.y+=un})(dt.positionedLines,ln,gn,Mn,Ur,ns,kt,cn,zt.length),dt.top+=-Mn*cn,dt.bottom=dt.top+cn,dt.left+=-gn*Ur,dt.right=dt.left+Ur}(ft,e,r,o,Me,w,P,k,N,F,$,me),!function(dt){for(const Jt of dt)if(Jt.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&ft}const jl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zh(i,e,r,o,p,y){if(e.imageName){const w=o[e.imageName];return w?w.displaySize[0]*e.scale*en/y+p:0}{const w=r[e.fontStack],P=w&&w[i];return P?P.metrics.advance*e.scale+p:0}}function Fh(i,e,r,o){const p=Math.pow(i-e,2);return o?i<e?p/2:2*p:p+Math.abs(r)*r}function $d(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Rh(i,e,r,o,p,y){let w=null,P=Fh(e,r,p,y);for(const k of o){const F=Fh(e-k.x,r,p,y)+k.badness;F<=P&&(w=k,P=F)}return{index:i,x:e,priorBreak:w,badness:P}}function Bh(i){return i?Bh(i.priorBreak).concat(i.index):[]}function bc(i,e,r,o,p,y,w){if(y!=="point")return[];if(!i)return[];const P=[],k=function($,Z,J,me,he,Me){let We=0;for(let Pe=0;Pe<$.length();Pe++){const Ne=$.getSection(Pe);We+=zh($.getCharCode(Pe),Ne,me,he,Z,Me)}return We/Math.max(1,Math.ceil(We/J))}(i,e,r,o,p,w),F=i.text.indexOf("\u200B")>=0;let U=0;for(let $=0;$<i.length();$++){const Z=i.getSection($),J=i.getCharCode($);if(jl[J]||(U+=zh(J,Z,o,p,e,w)),$<i.length()-1){const me=!((N=J)<11904||!(Ot["Bopomofo Extended"](N)||Ot.Bopomofo(N)||Ot["CJK Compatibility Forms"](N)||Ot["CJK Compatibility Ideographs"](N)||Ot["CJK Compatibility"](N)||Ot["CJK Radicals Supplement"](N)||Ot["CJK Strokes"](N)||Ot["CJK Symbols and Punctuation"](N)||Ot["CJK Unified Ideographs Extension A"](N)||Ot["CJK Unified Ideographs"](N)||Ot["Enclosed CJK Letters and Months"](N)||Ot["Halfwidth and Fullwidth Forms"](N)||Ot.Hiragana(N)||Ot["Ideographic Description Characters"](N)||Ot["Kangxi Radicals"](N)||Ot["Katakana Phonetic Extensions"](N)||Ot.Katakana(N)||Ot["Vertical Forms"](N)||Ot["Yi Radicals"](N)||Ot["Yi Syllables"](N)));(Wd[J]||me||Z.imageName)&&P.push(Rh($+1,U,k,P,$d(J,i.getCharCode($+1),me&&F),!1))}}var N;return Bh(Rh(i.length(),U,k,P,0,!0))}function wc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function qd(i,e,r,o,p){if(!o&&!p)return;const y=i[r],w=(i[r].x+y.metrics.advance*y.scale)*o;for(let P=e;P<=r;P++)i[P].x-=w,i[P].y+=p}function Yd(i,e,r){const{horizontalAlign:o,verticalAlign:p}=wc(r),y=e[0]-i.displaySize[0]*o,w=e[1]-i.displaySize[1]*p;return{image:i,top:w,bottom:w+i.displaySize[1],left:y,right:y+i.displaySize[0]}}function Uh(i,e,r,o,p,y){const w=i.image;let P;if(w.content){const he=w.content,Me=w.pixelRatio||1;P=[he[0]/Me,he[1]/Me,w.displaySize[0]-he[2]/Me,w.displaySize[1]-he[3]/Me]}const k=e.left*y,F=e.right*y;let U,N,$,Z;r==="width"||r==="both"?(Z=p[0]+k-o[3],N=p[0]+F+o[1]):(Z=p[0]+(k+F-w.displaySize[0])/2,N=Z+w.displaySize[0]);const J=e.top*y,me=e.bottom*y;return r==="height"||r==="both"?(U=p[1]+J-o[0],$=p[1]+me+o[2]):(U=p[1]+(J+me-w.displaySize[1])/2,$=U+w.displaySize[1]),{image:w,top:U,right:N,bottom:$,left:Z,collisionPadding:P}}const ho=128;function jh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new yr(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:p}=r;let y=0;for(;y<o.length&&o[y]<=i;)y++;y=Math.max(0,y-1);let w=y;for(;w<o.length&&o[w]<i+1;)w++;w=Math.min(o.length-1,w);const P=o[y],k=o[w];return r.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:p}:{kind:"camera",minZoom:P,maxZoom:k,minSize:r.evaluate(new yr(P)),maxSize:r.evaluate(new yr(k)),interpolationType:p}}}class Oo extends it{constructor(e,r,o,p){super(e,r),this.angle=o,p!==void 0&&(this.segment=p)}clone(){return new Oo(this.x,this.y,this.angle,this.segment)}}function Vh(i,e,r,o,p){if(e.segment===void 0)return!0;let y=e,w=e.segment+1,P=0;for(;P>-r/2;){if(w--,w<0)return!1;P-=i[w].dist(y),y=i[w]}P+=i[w].dist(i[w+1]),w++;const k=[];let F=0;for(;P<r/2;){const U=i[w],N=i[w+1];if(!N)return!1;let $=i[w-1].angleTo(U)-U.angleTo(N);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:$}),F+=$;P-k[0].distance>o;)F-=k.shift().angleDelta;if(F>p)return!1;w++,P+=U.dist(N)}return!0}function Nh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Gh(i,e,r){return i?.6*e*r:0}function Xh(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Hd(i,e,r,o,p,y){const w=Gh(r,p,y),P=Xh(r,o)*y;let k=0;const F=Nh(i)/2;for(let U=0;U<i.length-1;U++){const N=i[U],$=i[U+1],Z=N.dist($);if(k+Z>F){const J=(F-k)/Z,me=Tt(N.x,$.x,J),he=Tt(N.y,$.y,J),Me=new Oo(me,he,$.angleTo(N),U);return Me._round(),!w||Vh(i,Me,P,w,e)?Me:void 0}k+=Z}}function Zd(i,e,r,o,p,y,w,P,k){const F=Gh(o,y,w),U=Xh(o,p),N=U*w,$=i[0].x===0||i[0].x===k||i[0].y===0||i[0].y===k;return e-N<e/4&&(e=N+e/4),Wh(i,$?e/2*P%e:(U/2+2*y)*w*P%e,e,F,r,N,$,!1,k)}function Wh(i,e,r,o,p,y,w,P,k){const F=y/2,U=Nh(i);let N=0,$=e-r,Z=[];for(let J=0;J<i.length-1;J++){const me=i[J],he=i[J+1],Me=me.dist(he),We=he.angleTo(me);for(;$+r<N+Me;){$+=r;const Pe=($-N)/Me,Ne=Tt(me.x,he.x,Pe),ft=Tt(me.y,he.y,Pe);if(Ne>=0&&Ne<k&&ft>=0&&ft<k&&$-F>=0&&$+F<=U){const dt=new Oo(Ne,ft,We,J);dt._round(),o&&!Vh(i,dt,y,o,p)||Z.push(dt)}}N+=Me}return P||Z.length||w||(Z=Wh(i,N/2,r,o,p,y,w,!0,k)),Z}function $h(i,e,r,o,p){const y=[];for(let w=0;w<i.length;w++){const P=i[w];let k;for(let F=0;F<P.length-1;F++){let U=P[F],N=P[F+1];U.x<e&&N.x<e||(U.x<e?U=new it(e,U.y+(e-U.x)/(N.x-U.x)*(N.y-U.y))._round():N.x<e&&(N=new it(e,U.y+(e-U.x)/(N.x-U.x)*(N.y-U.y))._round()),U.y<r&&N.y<r||(U.y<r?U=new it(U.x+(r-U.y)/(N.y-U.y)*(N.x-U.x),r)._round():N.y<r&&(N=new it(U.x+(r-U.y)/(N.y-U.y)*(N.x-U.x),r)._round()),U.x>=o&&N.x>=o||(U.x>=o?U=new it(o,U.y+(o-U.x)/(N.x-U.x)*(N.y-U.y))._round():N.x>=o&&(N=new it(o,U.y+(o-U.x)/(N.x-U.x)*(N.y-U.y))._round()),U.y>=p&&N.y>=p||(U.y>=p?U=new it(U.x+(p-U.y)/(N.y-U.y)*(N.x-U.x),p)._round():N.y>=p&&(N=new it(U.x+(p-U.y)/(N.y-U.y)*(N.x-U.x),p)._round()),k&&U.equals(k[k.length-1])||(k=[U],y.push(k)),k.push(N)))))}}return y}function qh(i,e,r,o){const p=[],y=i.image,w=y.pixelRatio,P=y.paddedRect.w-2,k=y.paddedRect.h-2,F=i.right-i.left,U=i.bottom-i.top,N=y.stretchX||[[0,P]],$=y.stretchY||[[0,k]],Z=(kt,Vt)=>kt+Vt[1]-Vt[0],J=N.reduce(Z,0),me=$.reduce(Z,0),he=P-J,Me=k-me;let We=0,Pe=J,Ne=0,ft=me,dt=0,Jt=he,ni=0,jt=Me;if(y.content&&o){const kt=y.content;We=Vl(N,0,kt[0]),Ne=Vl($,0,kt[1]),Pe=Vl(N,kt[0],kt[2]),ft=Vl($,kt[1],kt[3]),dt=kt[0]-We,ni=kt[1]-Ne,Jt=kt[2]-kt[0]-Pe,jt=kt[3]-kt[1]-ft}const zt=(kt,Vt,Bt,Et)=>{const ui=Nl(kt.stretch-We,Pe,F,i.left),ai=Gl(kt.fixed-dt,Jt,kt.stretch,J),Ii=Nl(Vt.stretch-Ne,ft,U,i.top),mr=Gl(Vt.fixed-ni,jt,Vt.stretch,me),xr=Nl(Bt.stretch-We,Pe,F,i.left),Ur=Gl(Bt.fixed-dt,Jt,Bt.stretch,J),ns=Nl(Et.stretch-Ne,ft,U,i.top),ln=Gl(Et.fixed-ni,jt,Et.stretch,me),zr=new it(ui,Ii),Yr=new it(xr,Ii),cn=new it(xr,ns),gn=new it(ui,ns),Mn=new it(ai/w,mr/w),Fr=new it(Ur/w,ln/w),hn=e*Math.PI/180;if(hn){const kn=Math.sin(hn),Dn=Math.cos(hn),Cr=[Dn,-kn,kn,Dn];zr._matMult(Cr),Yr._matMult(Cr),gn._matMult(Cr),cn._matMult(Cr)}const _n=kt.stretch+kt.fixed,Pn=Vt.stretch+Vt.fixed;return{tl:zr,tr:Yr,bl:gn,br:cn,tex:{x:y.paddedRect.x+1+_n,y:y.paddedRect.y+1+Pn,w:Bt.stretch+Bt.fixed-_n,h:Et.stretch+Et.fixed-Pn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mn,pixelOffsetBR:Fr,minFontScaleX:Jt/w/F,minFontScaleY:jt/w/U,isSDF:r}};if(o&&(y.stretchX||y.stretchY)){const kt=Yh(N,he,J),Vt=Yh($,Me,me);for(let Bt=0;Bt<kt.length-1;Bt++){const Et=kt[Bt],ui=kt[Bt+1];for(let ai=0;ai<Vt.length-1;ai++)p.push(zt(Et,Vt[ai],ui,Vt[ai+1]))}}else p.push(zt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return p}function Vl(i,e,r){let o=0;for(const p of i)o+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return o}function Yh(i,e,r){const o=[{fixed:-1,stretch:0}];for(const[p,y]of i){const w=o[o.length-1];o.push({fixed:p-w.stretch,stretch:w.stretch}),o.push({fixed:p-w.stretch,stretch:w.stretch+(y-p)})}return o.push({fixed:e+1,stretch:r}),o}function Nl(i,e,r,o){return i/e*r+o}function Gl(i,e,r,o){return i-e*r/o}Ut("Anchor",Oo);class Xl{constructor(e,r,o,p,y,w,P,k,F,U){if(this.boxStartIndex=e.length,F){let N=w.top,$=w.bottom;const Z=w.collisionPadding;Z&&(N-=Z[1],$+=Z[3]);let J=$-N;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{let N=w.top*P-k[0],$=w.bottom*P+k[2],Z=w.left*P-k[3],J=w.right*P+k[1];const me=w.collisionPadding;if(me&&(Z-=me[0]*P,N-=me[1]*P,J+=me[2]*P,$+=me[3]*P),U){const he=new it(Z,N),Me=new it(J,N),We=new it(Z,$),Pe=new it(J,$),Ne=U*Math.PI/180;he._rotate(Ne),Me._rotate(Ne),We._rotate(Ne),Pe._rotate(Ne),Z=Math.min(he.x,Me.x,We.x,Pe.x),J=Math.max(he.x,Me.x,We.x,Pe.x),N=Math.min(he.y,Me.y,We.y,Pe.y),$=Math.max(he.y,Me.y,We.y,Pe.y)}e.emplaceBack(r.x,r.y,Z,N,J,$,o,p,y)}this.boxEndIndex=e.length}}class Kd{constructor(e=[],r=Jd){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,p=r[e];for(;e>0;){const y=e-1>>1,w=r[y];if(o(p,w)>=0)break;r[e]=w,e=y}r[e]=p}_down(e){const{data:r,compare:o}=this,p=this.length>>1,y=r[e];for(;e<p;){let w=1+(e<<1),P=r[w];const k=w+1;if(k<this.length&&o(r[k],P)<0&&(w=k,P=r[k]),o(P,y)>=0)break;r[e]=P,e=w}r[e]=y}}function Jd(i,e){return i<e?-1:i>e?1:0}function Qd(i,e=1,r=!1){let o=1/0,p=1/0,y=-1/0,w=-1/0;const P=i[0];for(let Z=0;Z<P.length;Z++){const J=P[Z];(!Z||J.x<o)&&(o=J.x),(!Z||J.y<p)&&(p=J.y),(!Z||J.x>y)&&(y=J.x),(!Z||J.y>w)&&(w=J.y)}const k=Math.min(y-o,w-p);let F=k/2;const U=new Kd([],ef);if(k===0)return new it(o,p);for(let Z=o;Z<y;Z+=k)for(let J=p;J<w;J+=k)U.push(new Ea(Z+F,J+F,F,i));let N=function(Z){let J=0,me=0,he=0;const Me=Z[0];for(let We=0,Pe=Me.length,Ne=Pe-1;We<Pe;Ne=We++){const ft=Me[We],dt=Me[Ne],Jt=ft.x*dt.y-dt.x*ft.y;me+=(ft.x+dt.x)*Jt,he+=(ft.y+dt.y)*Jt,J+=3*Jt}return new Ea(me/J,he/J,0,Z)}(i),$=U.length;for(;U.length;){const Z=U.pop();(Z.d>N.d||!N.d)&&(N=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,$)),Z.max-N.d<=e||(F=Z.h/2,U.push(new Ea(Z.p.x-F,Z.p.y-F,F,i)),U.push(new Ea(Z.p.x+F,Z.p.y-F,F,i)),U.push(new Ea(Z.p.x-F,Z.p.y+F,F,i)),U.push(new Ea(Z.p.x+F,Z.p.y+F,F,i)),$+=4)}return r&&(console.log(`num probes: ${$}`),console.log(`best distance: ${N.d}`)),N.p}function ef(i,e){return e.max-i.max}function Ea(i,e,r,o){this.p=new it(i,e),this.h=r,this.d=function(p,y){let w=!1,P=1/0;for(let k=0;k<y.length;k++){const F=y[k];for(let U=0,N=F.length,$=N-1;U<N;$=U++){const Z=F[U],J=F[$];Z.y>p.y!=J.y>p.y&&p.x<(J.x-Z.x)*(p.y-Z.y)/(J.y-Z.y)+Z.x&&(w=!w),P=Math.min(P,ih(p,Z,J))}}return(w?1:-1)*Math.sqrt(P)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Sc=Number.POSITIVE_INFINITY;function Hh(i,e){return e[1]!==Sc?function(r,o,p){let y=0,w=0;switch(o=Math.abs(o),p=Math.abs(p),r){case"top-right":case"top-left":case"top":w=p-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-p}switch(r){case"top-right":case"bottom-right":case"right":y=-o;break;case"top-left":case"bottom-left":case"left":y=o}return[y,w]}(i,e[0],e[1]):function(r,o){let p=0,y=0;o<0&&(o=0);const w=o/Math.sqrt(2);switch(r){case"top-right":case"top-left":y=w-7;break;case"bottom-right":case"bottom-left":y=7-w;break;case"bottom":y=7-o;break;case"top":y=o-7}switch(r){case"top-right":case"bottom-right":p=-w;break;case"top-left":case"bottom-left":p=w;break;case"left":p=o;break;case"right":p=-o}return[p,y]}(i,e[0])}function Cc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tf(i,e,r,o,p,y,w,P,k,F,U){let N=y.textMaxSize.evaluate(e,{});N===void 0&&(N=w);const $=i.layers[0].layout,Z=$.get("icon-offset").evaluate(e,{},U),J=Kh(r.horizontal),me=w/24,he=i.tilePixelRatio*me,Me=i.tilePixelRatio*N/24,We=i.tilePixelRatio*P,Pe=i.tilePixelRatio*$.get("symbol-spacing"),Ne=$.get("text-padding")*i.tilePixelRatio,ft=function(Et,ui,ai,Ii=1){const mr=Et.get("icon-padding").evaluate(ui,{},ai),xr=mr&&mr.values;return[xr[0]*Ii,xr[1]*Ii,xr[2]*Ii,xr[3]*Ii]}($,e,U,i.tilePixelRatio),dt=$.get("text-max-angle")/180*Math.PI,Jt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",ni=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",jt=$.get("symbol-placement"),zt=Pe/2,kt=$.get("icon-text-fit");let Vt;o&&kt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Vt=Uh(o,r.vertical,kt,$.get("icon-text-fit-padding"),Z,me)),J&&(o=Uh(o,J,kt,$.get("icon-text-fit-padding"),Z,me)));const Bt=(Et,ui)=>{ui.x<0||ui.x>=Br||ui.y<0||ui.y>=Br||function(ai,Ii,mr,xr,Ur,ns,ln,zr,Yr,cn,gn,Mn,Fr,hn,_n,Pn,kn,Dn,Cr,Hr,Fi,Xn,un,yn,ys){const Ps=ai.addToLineVertexArray(Ii,mr);let Is,uo,vs,ss,On=0,fo=0,sl=0,fu=0,Lc=-1,zc=-1;const po={};let pu=qr.exports(""),Fc=0,Rc=0;if(zr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fc,Rc]=zr.layout.get("text-offset").evaluate(Fi,{},yn).map(Ln=>Ln*en):(Fc=zr.layout.get("text-radial-offset").evaluate(Fi,{},yn)*en,Rc=Sc),ai.allowVerticalPlacement&&xr.vertical){const Ln=zr.layout.get("text-rotate").evaluate(Fi,{},yn)+90;vs=new Xl(Yr,Ii,cn,gn,Mn,xr.vertical,Fr,hn,_n,Ln),ln&&(ss=new Xl(Yr,Ii,cn,gn,Mn,ln,kn,Dn,_n,Ln))}if(Ur){const Ln=zr.layout.get("icon-rotate").evaluate(Fi,{}),$s=zr.layout.get("icon-text-fit")!=="none",ol=qh(Ur,Ln,un,$s),al=ln?qh(ln,Ln,un,$s):void 0;uo=new Xl(Yr,Ii,cn,gn,Mn,Ur,kn,Dn,!1,Ln),On=4*ol.length;const _u=ai.iconSizeData;let aa=null;_u.kind==="source"?(aa=[ho*zr.layout.get("icon-size").evaluate(Fi,{})],aa[0]>Lo&&j(`${ai.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):_u.kind==="composite"&&(aa=[ho*Xn.compositeIconSizes[0].evaluate(Fi,{},yn),ho*Xn.compositeIconSizes[1].evaluate(Fi,{},yn)],(aa[0]>Lo||aa[1]>Lo)&&j(`${ai.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ai.addSymbols(ai.icon,ol,aa,Hr,Cr,Fi,n.WritingMode.none,Ii,Ps.lineStartIndex,Ps.lineLength,-1,yn),Lc=ai.icon.placedSymbolArray.length-1,al&&(fo=4*al.length,ai.addSymbols(ai.icon,al,aa,Hr,Cr,Fi,n.WritingMode.vertical,Ii,Ps.lineStartIndex,Ps.lineLength,-1,yn),zc=ai.icon.placedSymbolArray.length-1)}const mu=Object.keys(xr.horizontal);for(const Ln of mu){const $s=xr.horizontal[Ln];if(!Is){pu=qr.exports($s.text);const al=zr.layout.get("text-rotate").evaluate(Fi,{},yn);Is=new Xl(Yr,Ii,cn,gn,Mn,$s,Fr,hn,_n,al)}const ol=$s.positionedLines.length===1;if(sl+=Zh(ai,Ii,$s,ns,zr,_n,Fi,Pn,Ps,xr.vertical?n.WritingMode.horizontal:n.WritingMode.horizontalOnly,ol?mu:[Ln],po,Lc,Xn,yn),ol)break}xr.vertical&&(fu+=Zh(ai,Ii,xr.vertical,ns,zr,_n,Fi,Pn,Ps,n.WritingMode.vertical,["vertical"],po,zc,Xn,yn));const mf=Is?Is.boxStartIndex:ai.collisionBoxArray.length,gf=Is?Is.boxEndIndex:ai.collisionBoxArray.length,_f=vs?vs.boxStartIndex:ai.collisionBoxArray.length,yf=vs?vs.boxEndIndex:ai.collisionBoxArray.length,vf=uo?uo.boxStartIndex:ai.collisionBoxArray.length,xf=uo?uo.boxEndIndex:ai.collisionBoxArray.length,bf=ss?ss.boxStartIndex:ai.collisionBoxArray.length,wf=ss?ss.boxEndIndex:ai.collisionBoxArray.length;let As=-1;const Hl=(Ln,$s)=>Ln&&Ln.circleDiameter?Math.max(Ln.circleDiameter,$s):$s;As=Hl(Is,As),As=Hl(vs,As),As=Hl(uo,As),As=Hl(ss,As);const gu=As>-1?1:0;gu&&(As*=ys/en),ai.glyphOffsetArray.length>=Pa.MAX_GLYPHS&&j("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&ai.addToSortKeyRanges(ai.symbolInstances.length,Fi.sortKey),ai.symbolInstances.emplaceBack(Ii.x,Ii.y,po.right>=0?po.right:-1,po.center>=0?po.center:-1,po.left>=0?po.left:-1,po.vertical||-1,Lc,zc,pu,mf,gf,_f,yf,vf,xf,bf,wf,cn,sl,fu,On,fo,gu,0,Fr,Fc,Rc,As)}(i,ui,Et,r,o,p,Vt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,he,[Ne,Ne,Ne,Ne],Jt,k,We,ft,ni,Z,e,y,F,U,w)};if(jt==="line")for(const Et of $h(e.geometry,0,0,Br,Br)){const ui=Zd(Et,Pe,dt,r.vertical||J,o,24,Me,i.overscaling,Br);for(const ai of ui){const Ii=J;Ii&&rf(i,Ii.text,zt,ai)||Bt(Et,ai)}}else if(jt==="line-center"){for(const Et of e.geometry)if(Et.length>1){const ui=Hd(Et,dt,r.vertical||J,o,24,Me);ui&&Bt(Et,ui)}}else if(e.type==="Polygon")for(const Et of uc(e.geometry,0)){const ui=Qd(Et,16);Bt(Et[0],new Oo(ui.x,ui.y,0))}else if(e.type==="LineString")for(const Et of e.geometry)Bt(Et,new Oo(Et[0].x,Et[0].y,0));else if(e.type==="Point")for(const Et of e.geometry)for(const ui of Et)Bt([ui],new Oo(ui.x,ui.y,0))}const Lo=32640;function Zh(i,e,r,o,p,y,w,P,k,F,U,N,$,Z,J){const me=function(We,Pe,Ne,ft,dt,Jt,ni,jt){const zt=ft.layout.get("text-rotate").evaluate(Jt,{})*Math.PI/180,kt=[];for(const Vt of Pe.positionedLines)for(const Bt of Vt.positionedGlyphs){if(!Bt.rect)continue;const Et=Bt.rect||{};let ui=4,ai=!0,Ii=1,mr=0;const xr=(dt||jt)&&Bt.vertical,Ur=Bt.metrics.advance*Bt.scale/2;if(jt&&Pe.verticalizable){const Cr=(Bt.scale-1)*en,Hr=(en-Bt.metrics.width*Bt.scale)/2;mr=Vt.lineOffset/2-(Bt.imageName?-Hr:Cr)}if(Bt.imageName){const Cr=ni[Bt.imageName];ai=Cr.sdf,Ii=Cr.pixelRatio,ui=1/Ii}const ns=dt?[Bt.x+Ur,Bt.y]:[0,0];let ln=dt?[0,0]:[Bt.x+Ur+Ne[0],Bt.y+Ne[1]-mr],zr=[0,0];xr&&(zr=ln,ln=[0,0]);const Yr=(Bt.metrics.left-ui)*Bt.scale-Ur+ln[0],cn=(-Bt.metrics.top-ui)*Bt.scale+ln[1],gn=Yr+Et.w*Bt.scale/Ii,Mn=cn+Et.h*Bt.scale/Ii,Fr=new it(Yr,cn),hn=new it(gn,cn),_n=new it(Yr,Mn),Pn=new it(gn,Mn);if(xr){const Cr=new it(-Ur,Ur-Bl),Hr=-Math.PI/2,Fi=12-Ur,Xn=new it(22-Fi,-(Bt.imageName?Fi:0)),un=new it(...zr);Fr._rotateAround(Hr,Cr)._add(Xn)._add(un),hn._rotateAround(Hr,Cr)._add(Xn)._add(un),_n._rotateAround(Hr,Cr)._add(Xn)._add(un),Pn._rotateAround(Hr,Cr)._add(Xn)._add(un)}if(zt){const Cr=Math.sin(zt),Hr=Math.cos(zt),Fi=[Hr,-Cr,Cr,Hr];Fr._matMult(Fi),hn._matMult(Fi),_n._matMult(Fi),Pn._matMult(Fi)}const kn=new it(0,0),Dn=new it(0,0);kt.push({tl:Fr,tr:hn,bl:_n,br:Pn,tex:Et,writingMode:Pe.writingMode,glyphOffset:ns,sectionIndex:Bt.sectionIndex,isSDF:ai,pixelOffsetTL:kn,pixelOffsetBR:Dn,minFontScaleX:0,minFontScaleY:0})}return kt}(0,r,P,p,y,w,o,i.allowVerticalPlacement),he=i.textSizeData;let Me=null;he.kind==="source"?(Me=[ho*p.layout.get("text-size").evaluate(w,{})],Me[0]>Lo&&j(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):he.kind==="composite"&&(Me=[ho*Z.compositeTextSizes[0].evaluate(w,{},J),ho*Z.compositeTextSizes[1].evaluate(w,{},J)],(Me[0]>Lo||Me[1]>Lo)&&j(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,me,Me,P,y,w,F,e,k.lineStartIndex,k.lineLength,$,J);for(const We of U)N[We]=i.text.placedSymbolArray.length-1;return 4*me.length}function Kh(i){for(const e in i)return i[e];return null}function rf(i,e,r,o){const p=i.compareText;if(e in p){const y=p[e];for(let w=y.length-1;w>=0;w--)if(o.dist(y[w])<r)return!0}else p[e]=[];return p[e].push(o),!1}const nf=ko.VectorTileFeature.types,sf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wl(i,e,r,o,p,y,w,P,k,F,U,N,$){const Z=P?Math.min(Lo,Math.round(P[0])):0,J=P?Math.min(Lo,Math.round(P[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*p),y,w,(Z<<1)+(k?1:0),J,16*F,16*U,256*N,256*$)}function Tc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function of(i){for(const e of i.sections)if(xl(e.text))return!0;return!1}class Ec{constructor(e){this.layoutVertexArray=new gs,this.indexArray=new Cn,this.programConfigurations=e,this.segments=new ki,this.dynamicLayoutVertexArray=new ts,this.opacityVertexArray=new _s,this.placedSymbolArray=new St}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,p){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Id.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ad.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sf,!0),this.opacityVertexBuffer.itemSize=1),(o||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ut("SymbolBuffers",Ec);class Pc{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new ki,this.collisionVertexArray=new Nn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Md.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ut("CollisionBuffers",Pc);class Pa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(w=>w.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sc([]),this.placementViewportMatrix=sc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jh(this.zoom,r["text-size"]),this.iconSizeData=jh(this.zoom,r["icon-size"]);const o=this.layers[0].layout,p=o.get("symbol-sort-key"),y=o.get("symbol-z-order");this.canOverlap=Ac(o,"text-overlap","text-allow-overlap")!=="never"||Ac(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(w=>n.WritingMode[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=e.sourceID}createArrays(){this.text=new Ec(new ia(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ec(new ia(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Lt,this.lineVertexArray=new Kt,this.symbolInstances=new Xt}calculateGlyphDependencies(e,r,o,p,y){for(let w=0;w<e.length;w++)if(r[e.charCodeAt(w)]=!0,(o||p)&&y){const P=tl[e.charAt(w)];P&&(r[P.charCodeAt(0)]=!0)}}populate(e,r,o){const p=this.layers[0],y=p.layout,w=y.get("text-font"),P=y.get("text-field"),k=y.get("icon-image"),F=(P.value.kind!=="constant"||P.value.value instanceof _e&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),U=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,N=y.get("symbol-sort-key");if(this.features=[],!F&&!U)return;const $=r.iconDependencies,Z=r.glyphDependencies,J=r.availableImages,me=new yr(this.zoom);for(const{feature:he,id:Me,index:We,sourceLayerIndex:Pe}of e){const Ne=p._featureFilter.needGeometry,ft=na(he,Ne);if(!p._featureFilter.filter(me,ft,o))continue;let dt,Jt;if(Ne||(ft.geometry=ra(he)),F){const jt=p.getValueAndResolveTokens("text-field",ft,o,J),zt=_e.factory(jt);of(zt)&&(this.hasRTLText=!0),(!this.hasRTLText||Qo()==="unavailable"||this.hasRTLText&&Vn.isParsed())&&(dt=Dd(zt,p,ft))}if(U){const jt=p.getValueAndResolveTokens("icon-image",ft,o,J);Jt=jt instanceof Ce?jt:Ce.fromString(jt)}if(!dt&&!Jt)continue;const ni=this.sortFeaturesByKey?N.evaluate(ft,{},o):void 0;if(this.features.push({id:Me,text:dt,icon:Jt,index:We,sourceLayerIndex:Pe,geometry:ft.geometry,properties:he.properties,type:nf[he.type],sortKey:ni}),Jt&&($[Jt.name]=!0),dt){const jt=w.evaluate(ft,{},o).join(","),zt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.WritingMode.vertical)>=0;for(const kt of dt.sections)if(kt.image)$[kt.image.name]=!0;else{const Vt=ro(dt.toString()),Bt=kt.fontStack||jt,Et=Z[Bt]=Z[Bt]||{};this.calculateGlyphDependencies(kt.text,Et,zt,this.allowVerticalPlacement,Vt)}}}y.get("symbol-placement")==="line"&&(this.features=function(he){const Me={},We={},Pe=[];let Ne=0;function ft(jt){Pe.push(he[jt]),Ne++}function dt(jt,zt,kt){const Vt=We[jt];return delete We[jt],We[zt]=Vt,Pe[Vt].geometry[0].pop(),Pe[Vt].geometry[0]=Pe[Vt].geometry[0].concat(kt[0]),Vt}function Jt(jt,zt,kt){const Vt=Me[zt];return delete Me[zt],Me[jt]=Vt,Pe[Vt].geometry[0].shift(),Pe[Vt].geometry[0]=kt[0].concat(Pe[Vt].geometry[0]),Vt}function ni(jt,zt,kt){const Vt=kt?zt[0][zt[0].length-1]:zt[0][0];return`${jt}:${Vt.x}:${Vt.y}`}for(let jt=0;jt<he.length;jt++){const zt=he[jt],kt=zt.geometry,Vt=zt.text?zt.text.toString():null;if(!Vt){ft(jt);continue}const Bt=ni(Vt,kt),Et=ni(Vt,kt,!0);if(Bt in We&&Et in Me&&We[Bt]!==Me[Et]){const ui=Jt(Bt,Et,kt),ai=dt(Bt,Et,Pe[ui].geometry);delete Me[Bt],delete We[Et],We[ni(Vt,Pe[ai].geometry,!0)]=ai,Pe[ui].geometry=null}else Bt in We?dt(Bt,Et,kt):Et in Me?Jt(Bt,Et,kt):(ft(jt),Me[Bt]=Ne-1,We[Et]=Ne-1)}return Pe.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((he,Me)=>he.sortKey-Me.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(r[e.segment+1]),y=e.dist(r[e.segment]);const w={};for(let P=e.segment+1;P<r.length;P++)w[P]={x:r[P].x,y:r[P].y,tileUnitDistanceFromAnchor:p},P<r.length-1&&(p+=r[P+1].dist(r[P]));for(let P=e.segment||0;P>=0;P--)w[P]={x:r[P].x,y:r[P].y,tileUnitDistanceFromAnchor:y},P>0&&(y+=r[P-1].dist(r[P]));for(let P=0;P<r.length;P++){const k=w[P];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,p,y,w,P,k,F,U,N,$){const Z=e.indexArray,J=e.layoutVertexArray,me=e.segments.prepareSegment(4*r.length,J,Z,this.canOverlap?w.sortKey:void 0),he=this.glyphOffsetArray.length,Me=me.vertexLength,We=this.allowVerticalPlacement&&P===n.WritingMode.vertical?Math.PI/2:0,Pe=w.text&&w.text.sections;for(let Ne=0;Ne<r.length;Ne++){const{tl:ft,tr:dt,bl:Jt,br:ni,tex:jt,pixelOffsetTL:zt,pixelOffsetBR:kt,minFontScaleX:Vt,minFontScaleY:Bt,glyphOffset:Et,isSDF:ui,sectionIndex:ai}=r[Ne],Ii=me.vertexLength,mr=Et[1];Wl(J,k.x,k.y,ft.x,mr+ft.y,jt.x,jt.y,o,ui,zt.x,zt.y,Vt,Bt),Wl(J,k.x,k.y,dt.x,mr+dt.y,jt.x+jt.w,jt.y,o,ui,kt.x,zt.y,Vt,Bt),Wl(J,k.x,k.y,Jt.x,mr+Jt.y,jt.x,jt.y+jt.h,o,ui,zt.x,kt.y,Vt,Bt),Wl(J,k.x,k.y,ni.x,mr+ni.y,jt.x+jt.w,jt.y+jt.h,o,ui,kt.x,kt.y,Vt,Bt),Tc(e.dynamicLayoutVertexArray,k,We),Z.emplaceBack(Ii,Ii+1,Ii+2),Z.emplaceBack(Ii+1,Ii+2,Ii+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),Ne!==r.length-1&&ai===r[Ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,w,w.index,{},$,Pe&&Pe[ai])}e.placedSymbolArray.emplaceBack(k.x,k.y,he,this.glyphOffsetArray.length-he,Me,F,U,k.segment,o?o[0]:0,o?o[1]:0,p[0],p[1],P,0,!1,0,N)}_addCollisionDebugVertex(e,r,o,p,y,w){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,p,y,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(e,r,o,p,y,w,P){const k=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),F=k.vertexLength,U=y.layoutVertexArray,N=y.collisionVertexArray,$=P.anchorX,Z=P.anchorY;this._addCollisionDebugVertex(U,N,w,$,Z,new it(e,r)),this._addCollisionDebugVertex(U,N,w,$,Z,new it(o,r)),this._addCollisionDebugVertex(U,N,w,$,Z,new it(o,p)),this._addCollisionDebugVertex(U,N,w,$,Z,new it(e,p)),k.vertexLength+=4;const J=y.indexArray;J.emplaceBack(F,F+1),J.emplaceBack(F+1,F+2),J.emplaceBack(F+2,F+3),J.emplaceBack(F+3,F),k.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,p){for(let y=e;y<r;y++){const w=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,p?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pc(Xs,Eh.members,Ts),this.iconCollisionBox=new Pc(Xs,Eh.members,Ts);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,p,y,w,P,k,F){const U={};for(let N=r;N<o;N++){const $=e.get(N);U.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.textFeatureIndex=$.featureIndex;break}for(let N=p;N<y;N++){const $=e.get(N);U.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.verticalTextFeatureIndex=$.featureIndex;break}for(let N=w;N<P;N++){const $=e.get(N);U.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.iconFeatureIndex=$.featureIndex;break}for(let N=k;N<F;N++){const $=e.get(N);U.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.verticalIconFeatureIndex=$.featureIndex;break}return U}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),p=o.vertexStartIndex+4*o.numGlyphs;for(let y=o.vertexStartIndex;y<p;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),p=[],y=[],w=[];for(let P=0;P<this.symbolInstances.length;++P){w.push(P);const k=this.symbolInstances.get(P);p.push(0|Math.round(r*k.anchorX+o*k.anchorY)),y.push(k.featureIndex)}return w.sort((P,k)=>p[P]-p[k]||y[k]-y[P]),w}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((p,y,w)=>{p>=0&&w.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ut("SymbolBucket",Pa,{omit:["layers","collisionBoxArray","features","compareText"]}),Pa.MAX_GLYPHS=65535,Pa.addDynamicAttributes=Tc;const af=new Qr({"symbol-placement":new oi(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new oi(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new oi(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pi(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new oi(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new oi(Ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new oi(Ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new oi(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new oi(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new oi(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new pi(Ge.layout_symbol["icon-size"]),"icon-text-fit":new oi(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new oi(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new pi(Ge.layout_symbol["icon-image"]),"icon-rotate":new pi(Ge.layout_symbol["icon-rotate"]),"icon-padding":new pi(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new oi(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new pi(Ge.layout_symbol["icon-offset"]),"icon-anchor":new pi(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new oi(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new oi(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new oi(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new pi(Ge.layout_symbol["text-field"]),"text-font":new pi(Ge.layout_symbol["text-font"]),"text-size":new pi(Ge.layout_symbol["text-size"]),"text-max-width":new pi(Ge.layout_symbol["text-max-width"]),"text-line-height":new oi(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new pi(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new pi(Ge.layout_symbol["text-justify"]),"text-radial-offset":new pi(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new oi(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new pi(Ge.layout_symbol["text-anchor"]),"text-max-angle":new oi(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new oi(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new pi(Ge.layout_symbol["text-rotate"]),"text-padding":new oi(Ge.layout_symbol["text-padding"]),"text-keep-upright":new oi(Ge.layout_symbol["text-keep-upright"]),"text-transform":new pi(Ge.layout_symbol["text-transform"]),"text-offset":new pi(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new oi(Ge.layout_symbol["text-allow-overlap"]),"text-overlap":new oi(Ge.layout_symbol["text-overlap"]),"text-ignore-placement":new oi(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new oi(Ge.layout_symbol["text-optional"])});var Ic={paint:new Qr({"icon-opacity":new pi(Ge.paint_symbol["icon-opacity"]),"icon-color":new pi(Ge.paint_symbol["icon-color"]),"icon-halo-color":new pi(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new pi(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pi(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new oi(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new oi(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new pi(Ge.paint_symbol["text-opacity"]),"text-color":new pi(Ge.paint_symbol["text-color"],{runtimeType:br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new pi(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new pi(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new pi(Ge.paint_symbol["text-halo-blur"]),"text-translate":new oi(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new oi(Ge.paint_symbol["text-translate-anchor"])}),layout:af};class Jh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Qi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut("FormatSectionOverride",Jh,{omit:["defaultValue"]});class $l extends ms{constructor(e){super(e,Ic)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const p=[];for(const y of o)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,p){const y=this.layout.get(e).evaluate(r,{},o,p),w=this._unevaluatedLayout._values[e];return w.isDataDriven()||Js(w.value)||!y?y:function(P,k){return k.replace(/{([^{}]+)}/g,(F,U)=>U in P?String(P[U]):"")}(r.properties,y)}createBucket(e){return new Pa(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Ic.paint.overridableProperties){if(!$l.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new Jh(r),p=new Kn(o,r.property.specification);let y=null;y=r.value.kind==="constant"||r.value.kind==="source"?new Qs("source",p):new Jn("composite",p,r.value.zoomStops),this.paint._values[e]=new ps(r.property,y,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&$l.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),p=Ic.paint.properties[r];let y=!1;const w=P=>{for(const k of P)if(p.overrides&&p.overrides.hasOverride(k))return void(y=!0)};if(o.value.kind==="constant"&&o.value.value instanceof _e)w(o.value.value.sections);else if(o.value.kind==="source"){const P=F=>{y||(F instanceof ri&&Ye(F.value)===wr?w(F.value.sections):F instanceof wo?w(F.sections):F.eachChild(P))},k=o.value;k._styleExpression&&P(k._styleExpression.expression)}return y}}function Ac(i,e,r){let o="never";const p=i.get(e);return p?o=p:i.get(r)&&(o="always"),o}var lf={paint:new Qr({"background-color":new oi(Ge.paint_background["background-color"]),"background-pattern":new Va(Ge.paint_background["background-pattern"]),"background-opacity":new oi(Ge.paint_background["background-opacity"])})},cf={paint:new Qr({"raster-opacity":new oi(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new oi(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new oi(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new oi(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new oi(Ge.paint_raster["raster-saturation"]),"raster-contrast":new oi(Ge.paint_raster["raster-contrast"]),"raster-resampling":new oi(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new oi(Ge.paint_raster["raster-fade-duration"])})};class hf extends ms{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const uf={circle:class extends ms{constructor(i){super(i,Vu)}createBucket(i){return new ic(i)}queryRadius(i){const e=i;return $a("circle-radius",this,e)+$a("circle-stroke-width",this,e)+Al(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,o,p,y,w,P){const k=Ml(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,w),F=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),U=this.paint.get("circle-pitch-alignment")==="map",N=U?k:function(Z,J){return Z.map(me=>ch(me,J))}(k,P),$=U?F*w:F;for(const Z of o)for(const J of Z){const me=U?J:ch(J,P);let he=$;const Me=kl([],[J.x,J.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=Me[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=y.cameraToCenterDistance/Me[3]),Fu(N,me,he))return!0}return!1}},heatmap:class extends ms{constructor(i){super(i,Gu),this._updateColorRamp()}createBucket(i){return new hh(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ms{constructor(i){super(i,Xu)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ms{constructor(i){super(i,od)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new pc(i)}queryRadius(){return Al(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,o,p,y,w){return th(Ml(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,w),o)}isTileClipped(){return!0}},"fill-extrusion":class extends ms{constructor(i){super(i,xd)}createBucket(i){return new gc(i)}queryRadius(){return Al(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,o,p,y,w,P){const k=Ml(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,w),F=this.paint.get("fill-extrusion-height").evaluate(e,r),U=this.paint.get("fill-extrusion-base").evaluate(e,r),N=function(Z,J,me,he){const Me=[];for(const We of Z){const Pe=[We.x,We.y,0,1];kl(Pe,Pe,J),Me.push(new it(Pe[0]/Pe[3],Pe[1]/Pe[3]))}return Me}(k,P),$=function(Z,J,me,he){const Me=[],We=[],Pe=he[8]*J,Ne=he[9]*J,ft=he[10]*J,dt=he[11]*J,Jt=he[8]*me,ni=he[9]*me,jt=he[10]*me,zt=he[11]*me;for(const kt of Z){const Vt=[],Bt=[];for(const Et of kt){const ui=Et.x,ai=Et.y,Ii=he[0]*ui+he[4]*ai+he[12],mr=he[1]*ui+he[5]*ai+he[13],xr=he[2]*ui+he[6]*ai+he[14],Ur=he[3]*ui+he[7]*ai+he[15],ns=xr+ft,ln=Ur+dt,zr=Ii+Jt,Yr=mr+ni,cn=xr+jt,gn=Ur+zt,Mn=new it((Ii+Pe)/ln,(mr+Ne)/ln);Mn.z=ns/ln,Vt.push(Mn);const Fr=new it(zr/gn,Yr/gn);Fr.z=cn/gn,Bt.push(Fr)}Me.push(Vt),We.push(Bt)}return[Me,We]}(o,U,F,P);return function(Z,J,me){let he=1/0;th(me,J)&&(he=bh(me,J[0]));for(let Me=0;Me<J.length;Me++){const We=J[Me],Pe=Z[Me];for(let Ne=0;Ne<We.length-1;Ne++){const ft=We[Ne],dt=[ft,We[Ne+1],Pe[Ne+1],Pe[Ne],ft];eh(me,dt)&&(he=Math.min(he,bh(me,dt)))}}return he!==1/0&&he}($[0],$[1],N)}},line:class extends ms{constructor(i){super(i,Sh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof bt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Ch.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new _c(i)}queryRadius(i){const e=i,r=Th($a("line-width",this,e),$a("line-gap-width",this,e)),o=$a("line-offset",this,e);return r/2+Math.abs(o)+Al(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,o,p,y,w){const P=Ml(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,w),k=w/2*Th(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),F=this.paint.get("line-offset").evaluate(e,r);return F&&(o=function(U,N){const $=[];for(let Z=0;Z<U.length;Z++){const J=U[Z],me=[];for(let he=0;he<J.length;he++){const Me=J[he-1],We=J[he],Pe=J[he+1],Ne=he===0?new it(0,0):We.sub(Me)._unit()._perp(),ft=he===J.length-1?new it(0,0):Pe.sub(We)._unit()._perp(),dt=Ne._add(ft)._unit(),Jt=dt.x*ft.x+dt.y*ft.y;Jt!==0&&dt._mult(1/Jt),me.push(dt._mult(N)._add(We))}$.push(me)}return $}(o,F*w)),function(U,N,$){for(let Z=0;Z<N.length;Z++){const J=N[Z];if(U.length>=3){for(let me=0;me<J.length;me++)if(xa(U,J[me]))return!0}if(Ru(U,J,$))return!0}return!1}(P,o,k)}isTileClipped(){return!0}},symbol:$l,background:class extends ms{constructor(i){super(i,lf)}},raster:class extends ms{constructor(i){super(i,cf)}}};class df{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Qh=63710088e-1;class Ar{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ar(c(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,p=e.lat*r,y=Math.sin(o)*Math.sin(p)+Math.cos(o)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return Qh*Math.acos(Math.min(y,1))}toBounds(e=0){const r=360*e/40075017,o=r/Math.cos(Math.PI/180*this.lat);return new oa(new Ar(this.lng-o,this.lat-r),new Ar(this.lng+o,this.lat+r))}static convert(e){if(e instanceof Ar)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ar(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ar(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class oa{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ar?new Ar(e.lng,e.lat):Ar.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ar?new Ar(e.lng,e.lat):Ar.convert(e),this}extend(e){const r=this._sw,o=this._ne;let p,y;if(e instanceof Ar)p=e,y=e;else{if(!(e instanceof oa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(oa.convert(e)):this.extend(Ar.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return r||o?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),o.lng=Math.max(y.lng,o.lng),o.lat=Math.max(y.lat,o.lat)):(this._sw=new Ar(p.lng,p.lat),this._ne=new Ar(y.lng,y.lat)),this}getCenter(){return new Ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ar(this.getWest(),this.getNorth())}getSouthEast(){return new Ar(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=Ar.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&p}static convert(e){return e instanceof oa?e:e&&new oa(e)}}const eu=2*Math.PI*Qh;function tu(i){return eu*Math.cos(i*Math.PI/180)}function iu(i){return(180+i)/360}function ru(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function nu(i,e){return i/tu(e)}function Mc(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class ql{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Ar.convert(e);return new ql(iu(o.lng),ru(o.lat),nu(r,o.lat))}toLngLat(){return new Ar(360*this.x-180,Mc(this.y))}toAltitude(){return this.z*tu(Mc(this.y))}meterInMercatorCoordinateUnits(){return 1/eu*(e=Mc(this.y),1/Math.cos(e*Math.PI/180));var e}}function su(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class kc{constructor(e,r,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=rl(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const p=(w=this.y,P=this.z,k=su(256*(y=this.x),256*(w=Math.pow(2,P)-w-1),P),F=su(256*(y+1),256*(w+1),P),k[0]+","+k[1]+","+F[0]+","+F[1]);var y,w,P,k,F;const U=function(N,$,Z){let J,me="";for(let he=N;he>0;he--)J=1<<he-1,me+=($&J?1:0)+(Z&J?2:0);return me}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,U).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new it((e.x*r-this.x)*Br,(e.y*r-this.y)*Br)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ou{constructor(e,r){this.wrap=e,this.canonical=r,this.key=rl(e,r.z,r.z,r.x,r.y)}}class rs{constructor(e,r,o,p,y){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new kc(o,+p,+y),this.key=rl(r,e,o,p,y)}clone(){return new rs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new rs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rs(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?rl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):rl(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new rs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,p=2*this.canonical.y;return[new rs(r,this.wrap,r,o,p),new rs(r,this.wrap,r,o+1,p),new rs(r,this.wrap,r,o,p+1),new rs(r,this.wrap,r,o+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ou(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ql(e.x-this.wrap,e.y))}}function rl(i,e,r,o,p){(i*=2)<0&&(i=-1*i-1);const y=1<<r;return(y*y*i+y*p+o).toString(36)+r.toString(36)+e.toString(36)}Ut("CanonicalTileID",kc),Ut("OverscaledTileID",rs,{omit:["posMatrix"]});class au{constructor(e,r,o){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void j(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=o||"mapbox";for(let y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<p;y++)for(let w=0;w<p;w++){const P=this.get(y,w);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,r){const o=new Uint8Array(this.data.buffer),p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[p],o[p+1],o[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,o){return(256*e*256+256*r+o)/10-1e4}_unpackTerrarium(e,r,o){return 256*e+r+o/256-32768}getPixels(){return new is({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,y=r*this.dim+this.dim,w=o*this.dim,P=o*this.dim+this.dim;switch(r){case-1:p=y-1;break;case 1:y=p+1}switch(o){case-1:w=P-1;break;case 1:P=w+1}const k=-r*this.dim,F=-o*this.dim;for(let U=w;U<P;U++)for(let N=p;N<y;N++)this.data[this._idx(N,U)]=e.data[this._idx(N+k,U+F)]}}Ut("DEMData",au);class lu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class cu{constructor(e,r,o,p,y){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=p,this.properties=e.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class hu{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fs(Br,16,0),this.grid3D=new fs(Br,16,0),this.featureIndexArray=new Pi,this.promoteId=r}insert(e,r,o,p,y,w){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,p,y);const k=w?this.grid3D:this.grid;for(let F=0;F<r.length;F++){const U=r[F],N=[1/0,1/0,-1/0,-1/0];for(let $=0;$<U.length;$++){const Z=U[$];N[0]=Math.min(N[0],Z.x),N[1]=Math.min(N[1],Z.y),N[2]=Math.max(N[2],Z.x),N[3]=Math.max(N[3],Z.y)}N[0]<Br&&N[1]<Br&&N[2]>=0&&N[3]>=0&&k.insert(P,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ko.VectorTile(new yc(this.rawTileData)).layers,this.sourceLayerCoder=new lu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,p){this.loadVTLayers();const y=e.params||{},w=Br/e.tileSize/e.scale,P=et(y.filter),k=e.queryGeometry,F=e.queryPadding*w,U=du(k),N=this.grid.query(U.minX-F,U.minY-F,U.maxX+F,U.maxY+F),$=du(e.cameraQueryGeometry),Z=this.grid3D.query($.minX-F,$.minY-F,$.maxX+F,$.maxY+F,(he,Me,We,Pe)=>function(Ne,ft,dt,Jt,ni){for(const zt of Ne)if(ft<=zt.x&&dt<=zt.y&&Jt>=zt.x&&ni>=zt.y)return!0;const jt=[new it(ft,dt),new it(ft,ni),new it(Jt,ni),new it(Jt,dt)];if(Ne.length>2){for(const zt of jt)if(xa(Ne,zt))return!0}for(let zt=0;zt<Ne.length-1;zt++)if(Uu(Ne[zt],Ne[zt+1],jt))return!0;return!1}(e.cameraQueryGeometry,he-F,Me-F,We+F,Pe+F));for(const he of Z)N.push(he);N.sort(ff);const J={};let me;for(let he=0;he<N.length;he++){const Me=N[he];if(Me===me)continue;me=Me;const We=this.featureIndexArray.get(Me);let Pe=null;this.loadMatchingFeature(J,We.bucketIndex,We.sourceLayerIndex,We.featureIndex,P,y.layers,y.availableImages,r,o,p,(Ne,ft,dt)=>(Pe||(Pe=ra(Ne)),ft.queryIntersectsFeature(k,Ne,dt,Pe,this.z,e.transform,w,e.pixelPosMatrix)))}return J}loadMatchingFeature(e,r,o,p,y,w,P,k,F,U,N){const $=this.bucketLayerIDs[r];if(w&&!function(he,Me){for(let We=0;We<he.length;We++)if(Me.indexOf(he[We])>=0)return!0;return!1}(w,$))return;const Z=this.sourceLayerCoder.decode(o),J=this.vtLayers[Z].feature(p);if(y.needGeometry){const he=na(J,!0);if(!y.filter(new yr(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!y.filter(new yr(this.tileID.overscaledZ),J))return;const me=this.getId(J,Z);for(let he=0;he<$.length;he++){const Me=$[he];if(w&&w.indexOf(Me)<0)continue;const We=k[Me];if(!We)continue;let Pe={};me&&U&&(Pe=U.getState(We.sourceLayer||"_geojsonTileLayer",me));const Ne=f({},F[Me]);Ne.paint=uu(Ne.paint,We.paint,J,Pe,P),Ne.layout=uu(Ne.layout,We.layout,J,Pe,P);const ft=!N||N(J,We,Pe);if(!ft)continue;const dt=new cu(J,this.z,this.x,this.y,me);dt.layer=Ne;let Jt=e[Me];Jt===void 0&&(Jt=e[Me]=[]),Jt.push({featureIndex:p,feature:dt,intersectionZ:ft})}}lookupSymbolFeatures(e,r,o,p,y,w,P,k){const F={};this.loadVTLayers();const U=et(y);for(const N of e)this.loadMatchingFeature(F,o,p,N,U,w,P,k,r);return F}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function uu(i,e,r,o,p){return S(i,(y,w)=>{const P=e instanceof ta?e.get(w):null;return P&&P.evaluate?P.evaluate(r,o,p):P})}function du(i){let e=1/0,r=1/0,o=-1/0,p=-1/0;for(const y of i)e=Math.min(e,y.x),r=Math.min(r,y.y),o=Math.max(o,y.x),p=Math.max(p,y.y);return{minX:e,minY:r,maxX:o,maxY:p}}function ff(i,e){return e-i}var Dc;Ut("FeatureIndex",hu,{omit:["rawTileData","sourceLayerCoder"]}),n.PerformanceMarkers=void 0,(Dc=n.PerformanceMarkers||(n.PerformanceMarkers={})).create="create",Dc.load="load",Dc.fullLoad="fullLoad";let Yl=null,nl=[];const Oc=1e3/30,pf={mark(i){performance.mark(i)},frame(i){const e=i;Yl!=null&&nl.push(e-Yl),Yl=e},clearMetrics(){Yl=null,nl=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in n.PerformanceMarkers)performance.clearMarks(n.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",n.PerformanceMarkers.create,n.PerformanceMarkers.load),performance.measure("fullLoadTime",n.PerformanceMarkers.create,n.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=nl.length,o=1/(nl.reduce((y,w)=>y+w,0)/r/1e3),p=nl.filter(y=>y>Oc).reduce((y,w)=>y+(w-Oc)/Oc,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:p/(r+p)*100}}};n.AJAXError=Re,n.ARRAY_TYPE=En,n.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},u(["receive","process"],this),this.invoker=new df(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ge()?i:window}send(i,e,r,o,p=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[y]=r);const w=xt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!r,targetMapId:o,mustQueue:p,sourceMapId:this.mapId,data:Un(e,w)},w),{cancel:()=>{r&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const o=this.cancelCallbacks[r];delete this.cancelCallbacks[r],o&&o()}else ge()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(jn(e.error)):r(null,jn(e.data)))}else{let r=!1;const o=xt(this.globalScope)?void 0:[],p=e.hasCallback?(P,k)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:P?Un(P):null,data:Un(k,o)},o)}:P=>{r=!0};let y=null;const w=jn(e.data);if(this.parent[e.type])y=this.parent[e.type](e.sourceMapId,w,p);else if(this.parent.getWorkerSource){const P=e.type.split(".");y=this.parent.getWorkerSource(e.sourceMapId,P[0],w.source)[P[1]](w,p)}else p(new Error(`Could not find function ${e.type}`));!r&&y&&y.cancel&&(this.cancelCallbacks[i]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.AlphaImage=Ya,n.CanonicalTileID=kc,n.CollisionBoxArray=rt,n.CollisionCircleLayoutArray=class extends V{},n.Color=te,n.DEMData=au,n.DataConstantProperty=oi,n.DictionaryCoder=lu,n.EXTENT=Br,n.ErrorEvent=Di,n.EvaluationParameters=yr,n.Event=mi,n.Evented=wi,n.FeatureIndex=hu,n.FillBucket=pc,n.FillExtrusionBucket=gc,n.GeoJSONFeature=cu,n.ImageAtlas=Lh,n.ImagePosition=xc,n.LineBucket=_c,n.LineStripIndexArray=class extends ce{},n.LngLat=Ar,n.LngLatBounds=oa,n.MercatorCoordinate=ql,n.ONE_EM=en,n.OverscaledTileID=rs,n.PerformanceUtils=pf,n.PosArray=hi,n.Properties=Qr,n.QuadTriangleArray=class extends H{},n.RGBAImage=is,n.RasterBoundsArray=class extends d{},n.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},n.ResourceType=nt,n.SegmentVector=ki,n.SymbolBucket=Pa,n.Transitionable=Sl,n.TriangleIndexArray=Cn,n.Uniform1f=ao,n.Uniform1i=class extends oo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},n.Uniform2f=class extends oo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},n.Uniform3f=class extends oo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},n.Uniform4f=ya,n.UniformColor=Zc,n.UniformMatrix4f=class extends oo{constructor(i,e){super(i,e),this.current=Lu}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},n.UnwrappedTileID=ou,n.ValidationError=vt,n.ZoomHistory=Bs,n.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},n.addDynamicAttributes=Tc,n.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let o=i.length;const p=new Array(i.length);let y=null;i.forEach((w,P)=>{e(w,(k,F)=>{k&&(y=k),p[P]=F,--o==0&&r(y,p)})})},n.bezier=v,n.bindAll=u,n.cacheEntryPossiblyAdded=function(i){W++,W>je&&(i.getActor().send("enforceCacheSizeLimit",de),W=0)},n.clamp=l,n.clearTileCache=function(i){const e=caches.delete(Q);i&&e.catch(i).then(()=>i())},n.clipLine=$h,n.clone=function(i){var e=new En(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},n.clone$1=A,n.clone$2=function(i){var e=new En(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},n.collisionCircleLayout=kd,n.config=Pt,n.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},n.create=function(){var i=new En(16);return En!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},n.create$1=nh,n.createExpression=wn,n.createFilter=et,n.createLayout=Lr,n.createStyleLayer=function(i){return i.type==="custom"?new hf(i):new uf[i.type](i)},n.cross=function(i,e,r){var o=e[0],p=e[1],y=e[2],w=r[0],P=r[1],k=r[2];return i[0]=p*k-y*P,i[1]=y*w-o*k,i[2]=o*P-p*w,i},n.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},n.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},n.ease=h,n.emitValidationErrors=ds,n.enforceCacheSizeLimit=function(i){K(),se&&se.then(e=>{e.keys().then(r=>{for(let o=0;o<r.length-i;o++)e.delete(r[o])})})},n.equals=function(i,e){var r=i[0],o=i[1],p=i[2],y=i[3],w=i[4],P=i[5],k=i[6],F=i[7],U=i[8],N=i[9],$=i[10],Z=i[11],J=i[12],me=i[13],he=i[14],Me=i[15],We=e[0],Pe=e[1],Ne=e[2],ft=e[3],dt=e[4],Jt=e[5],ni=e[6],jt=e[7],zt=e[8],kt=e[9],Vt=e[10],Bt=e[11],Et=e[12],ui=e[13],ai=e[14],Ii=e[15];return Math.abs(r-We)<=Tn*Math.max(1,Math.abs(r),Math.abs(We))&&Math.abs(o-Pe)<=Tn*Math.max(1,Math.abs(o),Math.abs(Pe))&&Math.abs(p-Ne)<=Tn*Math.max(1,Math.abs(p),Math.abs(Ne))&&Math.abs(y-ft)<=Tn*Math.max(1,Math.abs(y),Math.abs(ft))&&Math.abs(w-dt)<=Tn*Math.max(1,Math.abs(w),Math.abs(dt))&&Math.abs(P-Jt)<=Tn*Math.max(1,Math.abs(P),Math.abs(Jt))&&Math.abs(k-ni)<=Tn*Math.max(1,Math.abs(k),Math.abs(ni))&&Math.abs(F-jt)<=Tn*Math.max(1,Math.abs(F),Math.abs(jt))&&Math.abs(U-zt)<=Tn*Math.max(1,Math.abs(U),Math.abs(zt))&&Math.abs(N-kt)<=Tn*Math.max(1,Math.abs(N),Math.abs(kt))&&Math.abs($-Vt)<=Tn*Math.max(1,Math.abs($),Math.abs(Vt))&&Math.abs(Z-Bt)<=Tn*Math.max(1,Math.abs(Z),Math.abs(Bt))&&Math.abs(J-Et)<=Tn*Math.max(1,Math.abs(J),Math.abs(Et))&&Math.abs(me-ui)<=Tn*Math.max(1,Math.abs(me),Math.abs(ui))&&Math.abs(he-ai)<=Tn*Math.max(1,Math.abs(he),Math.abs(ai))&&Math.abs(Me-Ii)<=Tn*Math.max(1,Math.abs(Me),Math.abs(Ii))},n.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:p}){return i.kind==="source"?o/ho:i.kind==="composite"?Tt(o/ho,p/ho,r):e},n.evaluateSizeForZoom=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:w}=i,P=p?l(rn.interpolationFactor(p,e,y,w),0,1):0;i.kind==="camera"?o=Tt(i.minSize,i.maxSize,P):r=P}return{uSizeT:r,uSize:o}},n.evaluateVariableOffset=Hh,n.evented=ja,n.exported=yt,n.exported$1=re,n.extend=f,n.filterObject=C,n.fromRotation=function(i,e){var r=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=r,i[2]=0,i[3]=-r,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},n.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.getAnchorAlignment=wc,n.getAnchorJustification=Cc,n.getArrayBuffer=$e,n.getImage=Je,n.getJSON=function(i,e){return Ke(f(i,{type:"json"}),e)},n.getOverlapMode=Ac,n.getRTLTextPluginStatus=Qo,n.getReferrer=we,n.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let o=0;o<i.length;o++){const p=window.document.createElement("source");ut(i[o])||(r.crossOrigin="Anonymous"),p.src=i[o],r.appendChild(p)}return{cancel:()=>{}}},n.identity=sc,n.invert=function(i,e){var r=e[0],o=e[1],p=e[2],y=e[3],w=e[4],P=e[5],k=e[6],F=e[7],U=e[8],N=e[9],$=e[10],Z=e[11],J=e[12],me=e[13],he=e[14],Me=e[15],We=r*P-o*w,Pe=r*k-p*w,Ne=r*F-y*w,ft=o*k-p*P,dt=o*F-y*P,Jt=p*F-y*k,ni=U*me-N*J,jt=U*he-$*J,zt=U*Me-Z*J,kt=N*he-$*me,Vt=N*Me-Z*me,Bt=$*Me-Z*he,Et=We*Bt-Pe*Vt+Ne*kt+ft*zt-dt*jt+Jt*ni;return Et?(i[0]=(P*Bt-k*Vt+F*kt)*(Et=1/Et),i[1]=(p*Vt-o*Bt-y*kt)*Et,i[2]=(me*Jt-he*dt+Me*ft)*Et,i[3]=($*dt-N*Jt-Z*ft)*Et,i[4]=(k*zt-w*Bt-F*jt)*Et,i[5]=(r*Bt-p*zt+y*jt)*Et,i[6]=(he*Ne-J*Jt-Me*Pe)*Et,i[7]=(U*Jt-$*Ne+Z*Pe)*Et,i[8]=(w*Vt-P*zt+F*ni)*Et,i[9]=(o*zt-r*Vt-y*ni)*Et,i[10]=(J*dt-me*Ne+Me*We)*Et,i[11]=(N*Ne-U*dt-Z*We)*Et,i[12]=(P*jt-w*kt-k*ni)*Et,i[13]=(r*kt-o*jt+p*ni)*Et,i[14]=(me*Pe-J*ft-he*We)*Et,i[15]=(U*ft-N*Pe+$*We)*Et,i):null},n.isImageBitmap=st,n.isSafari=xt,n.isWorker=ge,n.keysDifference=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},n.lazyLoadRTLTextPlugin=function(){Vn.isLoading()||Vn.isLoaded()||Qo()!=="deferred"||wl()},n.makeRequest=Ke,n.mapObject=S,n.mercatorXfromLng=iu,n.mercatorYfromLat=ru,n.mercatorZfromAltitude=nu,n.mul=Nu,n.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},n.multiply=sh,n.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},n.normalize=function(i,e){var r=e[0],o=e[1],p=e[2],y=r*r+o*o+p*p;return y>0&&(y=1/Math.sqrt(y)),i[0]=e[0]*y,i[1]=e[1]*y,i[2]=e[2]*y,i},n.number=Tt,n.ortho=function(i,e,r,o,p,y,w){var P=1/(e-r),k=1/(o-p),F=1/(y-w);return i[0]=-2*P,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*k,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*F,i[11]=0,i[12]=(e+r)*P,i[13]=(p+o)*k,i[14]=(w+y)*F,i[15]=1,i},n.parseCacheControl=De,n.parseGlyphPbf=function(i){return new yc(i).readFields(Nd,[])},n.pbf=yc,n.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Br/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new yr(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new yr(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new yr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:F}=i.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new yr(k),i.canonical),r["text-size"].possiblyEvaluate(new yr(F),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:F}=i.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new yr(k),i.canonical),r["icon-size"].possiblyEvaluate(new yr(F),i.canonical)]}const p=e.get("text-line-height")*en,y=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",w=e.get("text-keep-upright"),P=e.get("text-size");for(const k of i.bucket.features){const F=e.get("text-font").evaluate(k,{},i.canonical).join(","),U=P.evaluate(k,{},i.canonical),N=o.layoutTextSize.evaluate(k,{},i.canonical),$=o.layoutIconSize.evaluate(k,{},i.canonical),Z={horizontal:{},vertical:void 0},J=k.text;let me,he=[0,0];if(J){const Pe=J.toString(),Ne=e.get("text-letter-spacing").evaluate(k,{},i.canonical)*en,ft=Eo(Pe)?Ne:0,dt=e.get("text-anchor").evaluate(k,{},i.canonical),Jt=e.get("text-variable-anchor");if(!Jt){const Vt=e.get("text-radial-offset").evaluate(k,{},i.canonical);he=Vt?Hh(dt,[Vt*en,Sc]):e.get("text-offset").evaluate(k,{},i.canonical).map(Bt=>Bt*en)}let ni=y?"center":e.get("text-justify").evaluate(k,{},i.canonical);const jt=e.get("symbol-placement"),zt=jt==="point"?e.get("text-max-width").evaluate(k,{},i.canonical)*en:0,kt=()=>{i.bucket.allowVerticalPlacement&&ro(Pe)&&(Z.vertical=Ul(J,i.glyphMap,i.glyphPositions,i.imagePositions,F,zt,p,dt,"left",ft,he,n.WritingMode.vertical,!0,jt,N,U))};if(!y&&Jt){const Vt=ni==="auto"?Jt.map(Et=>Cc(Et)):[ni];let Bt=!1;for(let Et=0;Et<Vt.length;Et++){const ui=Vt[Et];if(!Z.horizontal[ui])if(Bt)Z.horizontal[ui]=Z.horizontal[0];else{const ai=Ul(J,i.glyphMap,i.glyphPositions,i.imagePositions,F,zt,p,"center",ui,ft,he,n.WritingMode.horizontal,!1,jt,N,U);ai&&(Z.horizontal[ui]=ai,Bt=ai.positionedLines.length===1)}}kt()}else{ni==="auto"&&(ni=Cc(dt));const Vt=Ul(J,i.glyphMap,i.glyphPositions,i.imagePositions,F,zt,p,dt,ni,ft,he,n.WritingMode.horizontal,!1,jt,N,U);Vt&&(Z.horizontal[ni]=Vt),kt(),ro(Pe)&&y&&w&&(Z.vertical=Ul(J,i.glyphMap,i.glyphPositions,i.imagePositions,F,zt,p,dt,ni,ft,he,n.WritingMode.vertical,!1,jt,N,U))}}let Me=!1;if(k.icon&&k.icon.name){const Pe=i.imageMap[k.icon.name];Pe&&(me=Yd(i.imagePositions[k.icon.name],e.get("icon-offset").evaluate(k,{},i.canonical),e.get("icon-anchor").evaluate(k,{},i.canonical)),Me=!!Pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Me:i.bucket.sdfIcons!==Me&&j("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const We=Kh(Z.horizontal)||Z.vertical;i.bucket.iconsInText=!!We&&We.iconsInText,(We||me)&&tf(i.bucket,k,Z,me,i.imageMap,o,N,$,he,Me,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},n.perspective=function(i,e,r,o,p){var y,w=1/Math.tan(e/2);return i[0]=w/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+o)*(y=1/(o-p)),i[14]=2*p*o*y):(i[10]=-1,i[14]=-2*o),i},n.pick=function(i,e){const r={};for(let o=0;o<e.length;o++){const p=e[o];p in i&&(r[p]=i[p])}return r},n.plugin=Vn,n.pointGeometry=it,n.polygonIntersectsPolygon=eh,n.potpack=Oh,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.register=Ut,n.registerForPluginStateChange=function(i){return i({pluginStatus:Sn,pluginURL:js}),ja.on("pluginStateChange",i),i},n.renderColorRamp=dh,n.rotateX=function(i,e,r){var o=Math.sin(r),p=Math.cos(r),y=e[4],w=e[5],P=e[6],k=e[7],F=e[8],U=e[9],N=e[10],$=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=y*p+F*o,i[5]=w*p+U*o,i[6]=P*p+N*o,i[7]=k*p+$*o,i[8]=F*p-y*o,i[9]=U*p-w*o,i[10]=N*p-P*o,i[11]=$*p-k*o,i},n.rotateZ=function(i,e,r){var o=Math.sin(r),p=Math.cos(r),y=e[0],w=e[1],P=e[2],k=e[3],F=e[4],U=e[5],N=e[6],$=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=y*p+F*o,i[1]=w*p+U*o,i[2]=P*p+N*o,i[3]=k*p+$*o,i[4]=F*p-y*o,i[5]=U*p-w*o,i[6]=N*p-P*o,i[7]=$*p-k*o,i},n.scale=function(i,e,r){var o=r[0],p=r[1],y=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*y,i[9]=e[9]*y,i[10]=e[10]*y,i[11]=e[11]*y,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},n.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},n.setCacheLimits=function(i,e){de=i,je=e},n.setRTLTextPlugin=function(i,e,r=!1){if(Sn===Fa||Sn===Ra||Sn===Ba)throw new Error("setRTLTextPlugin cannot be called multiple times.");js=yt.resolveURL(i),Sn=Fa,Ua=e,Po(),r||wl()},n.spec=Ge,n.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},n.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},n.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},n.toEvaluationFeature=na,n.transformMat3=function(i,e,r){var o=e[0],p=e[1],y=e[2];return i[0]=o*r[0]+p*r[3]+y*r[6],i[1]=o*r[1]+p*r[4]+y*r[7],i[2]=o*r[2]+p*r[5]+y*r[8],i},n.transformMat4=kl,n.transformMat4$1=function(i,e,r){var o=e[0],p=e[1];return i[0]=r[0]*o+r[4]*p+r[12],i[1]=r[1]*o+r[5]*p+r[13],i},n.translate=function(i,e,r){var o,p,y,w,P,k,F,U,N,$,Z,J,me=r[0],he=r[1],Me=r[2];return e===i?(i[12]=e[0]*me+e[4]*he+e[8]*Me+e[12],i[13]=e[1]*me+e[5]*he+e[9]*Me+e[13],i[14]=e[2]*me+e[6]*he+e[10]*Me+e[14],i[15]=e[3]*me+e[7]*he+e[11]*Me+e[15]):(p=e[1],y=e[2],w=e[3],P=e[4],k=e[5],F=e[6],U=e[7],N=e[8],$=e[9],Z=e[10],J=e[11],i[0]=o=e[0],i[1]=p,i[2]=y,i[3]=w,i[4]=P,i[5]=k,i[6]=F,i[7]=U,i[8]=N,i[9]=$,i[10]=Z,i[11]=J,i[12]=o*me+P*he+N*Me+e[12],i[13]=p*me+k*he+$*Me+e[13],i[14]=y*me+F*he+Z*Me+e[14],i[15]=w*me+U*he+J*Me+e[15]),i},n.triggerPluginCompletionEvent=bl,n.unicodeBlockLookup=Ot,n.uniqueId=function(){return _++},n.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateLight=on,n.validateStyle=Cs,n.vectorTile=ko,n.warnOnce=j,n.wrap=c}),At(["./shared"],function(n){function g(ie){const B=typeof ie;if(B==="number"||B==="boolean"||B==="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let te="[";for(const fe of ie)te+=`${g(fe)},`;return`${te}]`}const G=Object.keys(ie).sort();let ee="{";for(let te=0;te<G.length;te++)ee+=`${JSON.stringify(G[te])}:${g(ie[G[te]])},`;return`${ee}}`}function x(ie){let B="";for(const G of n.refProperties)B+=`/${g(ie[G])}`;return B}class v{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,G){for(const te of B){this._layerConfigs[te.id]=te;const fe=this._layers[te.id]=n.createStyleLayer(te);fe._featureFilter=n.createFilter(fe.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of G)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const ee=function(te,fe){const Se={};for(let pe=0;pe<te.length;pe++){const Ce=fe&&fe[te[pe].id]||x(te[pe]);fe&&(fe[te[pe].id]=Ce);let He=Se[Ce];He||(He=Se[Ce]=[]),He.push(te[pe])}const _e=[];for(const pe in Se)_e.push(Se[pe]);return _e}(Object.values(this._layerConfigs),this.keyCache);for(const te of ee){const fe=te.map(gt=>this._layers[gt.id]),Se=fe[0];if(Se.visibility==="none")continue;const _e=Se.source||"";let pe=this.familiesBySource[_e];pe||(pe=this.familiesBySource[_e]={});const Ce=Se.sourceLayer||"_geojsonTileLayer";let He=pe[Ce];He||(He=pe[Ce]=[]),He.push(fe)}}}class h{constructor(B){const G={},ee=[];for(const _e in B){const pe=B[_e],Ce=G[_e]={};for(const He in pe){const gt=pe[+He];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const Ye={x:0,y:0,w:gt.bitmap.width+2,h:gt.bitmap.height+2};ee.push(Ye),Ce[He]={rect:Ye,metrics:gt.metrics}}}const{w:te,h:fe}=n.potpack(ee),Se=new n.AlphaImage({width:te||1,height:fe||1});for(const _e in B){const pe=B[_e];for(const Ce in pe){const He=pe[+Ce];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const gt=G[_e][Ce].rect;n.AlphaImage.copy(He.bitmap,Se,{x:0,y:0},{x:gt.x+1,y:gt.y+1},He.bitmap)}}this.image=Se,this.positions=G}}n.register("GlyphAtlas",h);class l{constructor(B){this.tileID=new n.OverscaledTileID(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId}parse(B,G,ee,te,fe){this.status="parsing",this.data=B,this.collisionBoxArray=new n.CollisionBoxArray;const Se=new n.DictionaryCoder(Object.keys(B.layers).sort()),_e=new n.FeatureIndex(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const pe={},Ce={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},He=G.familiesBySource[this.source];for(const vi in He){const Ti=B.layers[vi];if(!Ti)continue;Ti.version===1&&n.warnOnce(`Vector tile source "${this.source}" layer "${vi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=Se.encode(vi),Si=[];for(let Mr=0;Mr<Ti.length;Mr++){const cr=Ti.feature(Mr),gr=_e.getId(cr,vi);Si.push({feature:cr,id:gr,index:Mr,sourceLayerIndex:Bi})}for(const Mr of He[vi]){const cr=Mr[0];cr.source!==this.source&&n.warnOnce(`layer.source = ${cr.source} does not equal this.source = ${this.source}`),cr.minzoom&&this.zoom<Math.floor(cr.minzoom)||cr.maxzoom&&this.zoom>=cr.maxzoom||cr.visibility!=="none"&&(c(Mr,this.zoom,ee),(pe[cr.id]=cr.createBucket({index:_e.bucketLayerIDs.length,layers:Mr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source})).populate(Si,Ce,this.tileID.canonical),_e.bucketLayerIDs.push(Mr.map(gr=>gr.id)))}}let gt,Ye,ei,ri;const It=n.mapObject(Ce.glyphDependencies,vi=>Object.keys(vi).map(Number));Object.keys(It).length?te.send("getGlyphs",{uid:this.uid,stacks:It},(vi,Ti)=>{gt||(gt=vi,Ye=Ti,Li.call(this))}):Ye={};const di=Object.keys(Ce.iconDependencies);di.length?te.send("getImages",{icons:di,source:this.source,tileID:this.tileID,type:"icons"},(vi,Ti)=>{gt||(gt=vi,ei=Ti,Li.call(this))}):ei={};const gi=Object.keys(Ce.patternDependencies);function Li(){if(gt)return fe(gt);if(Ye&&ei&&ri){const vi=new h(Ye),Ti=new n.ImageAtlas(ei,ri);for(const Bi in pe){const Si=pe[Bi];Si instanceof n.SymbolBucket?(c(Si.layers,this.zoom,ee),n.performSymbolLayout({bucket:Si,glyphMap:Ye,glyphPositions:vi.positions,imageMap:ei,imagePositions:Ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Si.hasPattern&&(Si instanceof n.LineBucket||Si instanceof n.FillBucket||Si instanceof n.FillExtrusionBucket)&&(c(Si.layers,this.zoom,ee),Si.addFeatures(Ce,this.tileID.canonical,Ti.patternPositions))}this.status="done",fe(null,{buckets:Object.values(pe).filter(Bi=>!Bi.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vi.image,imageAtlas:Ti,glyphMap:this.returnDependencies?Ye:null,iconMap:this.returnDependencies?ei:null,glyphPositions:this.returnDependencies?vi.positions:null})}}gi.length?te.send("getImages",{icons:gi,source:this.source,tileID:this.tileID,type:"patterns"},(vi,Ti)=>{gt||(gt=vi,ri=Ti,Li.call(this))}):ri={},Li.call(this)}}function c(ie,B,G){const ee=new n.EvaluationParameters(B);for(const te of ie)te.recalculate(ee,G)}function f(ie,B){const G=n.getArrayBuffer(ie.request,(ee,te,fe,Se)=>{ee?B(ee):te&&B(null,{vectorTile:new n.vectorTile.VectorTile(new n.pbf(te)),rawData:te,cacheControl:fe,expires:Se})});return()=>{G.cancel(),B()}}class _{constructor(B,G,ee,te){this.actor=B,this.layerIndex=G,this.availableImages=ee,this.loadVectorData=te||f,this.loading={},this.loaded={}}loadTile(B,G){const ee=B.uid;this.loading||(this.loading={});const te=!!(B&&B.request&&B.request.collectResourceTiming)&&new n.RequestPerformance(B.request),fe=this.loading[ee]=new l(B);fe.abort=this.loadVectorData(B,(Se,_e)=>{if(delete this.loading[ee],Se||!_e)return fe.status="done",this.loaded[ee]=fe,G(Se);const pe=_e.rawData,Ce={};_e.expires&&(Ce.expires=_e.expires),_e.cacheControl&&(Ce.cacheControl=_e.cacheControl);const He={};if(te){const gt=te.finish();gt&&(He.resourceTiming=JSON.parse(JSON.stringify(gt)))}fe.vectorTile=_e.vectorTile,fe.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,(gt,Ye)=>{if(gt||!Ye)return G(gt);G(null,n.extend({rawTileData:pe.slice(0)},Ye,Ce,He))}),this.loaded=this.loaded||{},this.loaded[ee]=fe})}reloadTile(B,G){const ee=this.loaded,te=B.uid,fe=this;if(ee&&ee[te]){const Se=ee[te];Se.showCollisionBoxes=B.showCollisionBoxes;const _e=(pe,Ce)=>{const He=Se.reloadCallback;He&&(delete Se.reloadCallback,Se.parse(Se.vectorTile,fe.layerIndex,this.availableImages,fe.actor,He)),G(pe,Ce)};Se.status==="parsing"?Se.reloadCallback=_e:Se.status==="done"&&(Se.vectorTile?Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,_e):_e())}}abortTile(B,G){const ee=this.loading,te=B.uid;ee&&ee[te]&&ee[te].abort&&(ee[te].abort(),delete ee[te]),G()}removeTile(B,G){const ee=this.loaded,te=B.uid;ee&&ee[te]&&delete ee[te],G()}}class u{constructor(){this.loaded={}}loadTile(B,G){const{uid:ee,encoding:te,rawImageData:fe}=B,Se=n.isImageBitmap(fe)?this.getImageData(fe):fe,_e=new n.DEMData(ee,Se,te);this.loaded=this.loaded||{},this.loaded[ee]=_e,G(null,_e)}getImageData(B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const G=this.offscreenCanvasContext.getImageData(-1,-1,B.width+2,B.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new n.RGBAImage({width:G.width,height:G.height},G.data)}removeTile(B){const G=this.loaded,ee=B.uid;G&&G[ee]&&delete G[ee]}}var S=function ie(B,G){var ee,te=B&&B.type;if(te==="FeatureCollection")for(ee=0;ee<B.features.length;ee++)ie(B.features[ee],G);else if(te==="GeometryCollection")for(ee=0;ee<B.geometries.length;ee++)ie(B.geometries[ee],G);else if(te==="Feature")ie(B.geometry,G);else if(te==="Polygon")C(B.coordinates,G);else if(te==="MultiPolygon")for(ee=0;ee<B.coordinates.length;ee++)C(B.coordinates[ee],G);return B};function C(ie,B){if(ie.length!==0){A(ie[0],B);for(var G=1;G<ie.length;G++)A(ie[G],!B)}}function A(ie,B){for(var G=0,ee=0,te=0,fe=ie.length,Se=fe-1;te<fe;Se=te++){var _e=(ie[te][0]-ie[Se][0])*(ie[Se][1]+ie[te][1]),pe=G+_e;ee+=Math.abs(G)>=Math.abs(_e)?G-pe+_e:_e-pe+G,G=pe}G+ee>=0!=!!B&&ie.reverse()}const O=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;class j{constructor(B){this._feature=B,this.extent=n.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const G of this._feature.geometry)B.push([new n.pointGeometry(G[0],G[1])]);return B}{const B=[];for(const G of this._feature.geometry){const ee=[];for(const te of G)ee.push(new n.pointGeometry(te[0],te[1]));B.push(ee)}return B}}toGeoJSON(B,G,ee){return O.call(this,B,G,ee)}}class Y{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=B.length,this._features=B}feature(B){return new j(this._features[B])}}var oe={exports:{}},ge=n.pointGeometry,De=n.vectorTile.VectorTileFeature,qe=lt;function lt(ie,B){this.options=B||{},this.features=ie,this.length=ie.length}function _t(ie,B){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=B||4096}lt.prototype.feature=function(ie){return new _t(this.features[ie],this.options.extent)},_t.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var B=0;B<ie.length;B++){for(var G=ie[B],ee=[],te=0;te<G.length;te++)ee.push(new ge(G[te][0],G[te][1]));this.geometry.push(ee)}return this.geometry},_t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,B=1/0,G=-1/0,ee=1/0,te=-1/0,fe=0;fe<ie.length;fe++)for(var Se=ie[fe],_e=0;_e<Se.length;_e++){var pe=Se[_e];B=Math.min(B,pe.x),G=Math.max(G,pe.x),ee=Math.min(ee,pe.y),te=Math.max(te,pe.y)}return[B,ee,G,te]},_t.prototype.toGeoJSON=De.prototype.toGeoJSON;var xt=n.pbf,st=qe;function yt(ie){var B=new xt;return function(G,ee){for(var te in G.layers)ee.writeMessage(3,it,G.layers[te])}(ie,B),B.finish()}function it(ie,B){var G;B.writeVarintField(15,ie.version||1),B.writeStringField(1,ie.name||""),B.writeVarintField(5,ie.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<ie.length;G++)ee.feature=ie.feature(G),B.writeMessage(2,Rt,ee);var te=ee.keys;for(G=0;G<te.length;G++)B.writeStringField(3,te[G]);var fe=ee.values;for(G=0;G<fe.length;G++)B.writeMessage(4,de,fe[G])}function Rt(ie,B){var G=ie.feature;G.id!==void 0&&B.writeVarintField(1,G.id),B.writeMessage(2,Pt,ie),B.writeVarintField(3,G.type),B.writeMessage(4,ue,G)}function Pt(ie,B){var G=ie.feature,ee=ie.keys,te=ie.values,fe=ie.keycache,Se=ie.valuecache;for(var _e in G.properties){var pe=G.properties[_e],Ce=fe[_e];if(pe!==null){Ce===void 0&&(ee.push(_e),fe[_e]=Ce=ee.length-1),B.writeVarint(Ce);var He=typeof pe;He!=="string"&&He!=="boolean"&&He!=="number"&&(pe=JSON.stringify(pe));var gt=He+":"+pe,Ye=Se[gt];Ye===void 0&&(te.push(pe),Se[gt]=Ye=te.length-1),B.writeVarint(Ye)}}}function Q(ie,B){return(B<<3)+(7&ie)}function se(ie){return ie<<1^ie>>31}function ue(ie,B){for(var G=ie.loadGeometry(),ee=ie.type,te=0,fe=0,Se=G.length,_e=0;_e<Se;_e++){var pe=G[_e],Ce=1;ee===1&&(Ce=pe.length),B.writeVarint(Q(1,Ce));for(var He=ee===3?pe.length-1:pe.length,gt=0;gt<He;gt++){gt===1&&ee!==1&&B.writeVarint(Q(2,He-1));var Ye=pe[gt].x-te,ei=pe[gt].y-fe;B.writeVarint(se(Ye)),B.writeVarint(se(ei)),te+=Ye,fe+=ei}ee===3&&B.writeVarint(Q(7,1))}}function de(ie,B){var G=typeof ie;G==="string"?B.writeStringField(1,ie):G==="boolean"?B.writeBooleanField(7,ie):G==="number"&&(ie%1!=0?B.writeDoubleField(3,ie):ie<0?B.writeSVarintField(6,ie):B.writeVarintField(5,ie))}function je(ie,B,G,ee,te,fe){if(te-ee<=G)return;const Se=ee+te>>1;K(ie,B,Se,ee,te,fe%2),je(ie,B,G,ee,Se-1,fe+1),je(ie,B,G,Se+1,te,fe+1)}function K(ie,B,G,ee,te,fe){for(;te>ee;){if(te-ee>600){const Ce=te-ee+1,He=G-ee+1,gt=Math.log(Ce),Ye=.5*Math.exp(2*gt/3),ei=.5*Math.sqrt(gt*Ye*(Ce-Ye)/Ce)*(He-Ce/2<0?-1:1);K(ie,B,G,Math.max(ee,Math.floor(G-He*Ye/Ce+ei)),Math.min(te,Math.floor(G+(Ce-He)*Ye/Ce+ei)),fe)}const Se=B[2*G+fe];let _e=ee,pe=te;for(W(ie,B,ee,G),B[2*te+fe]>Se&&W(ie,B,ee,te);_e<pe;){for(W(ie,B,_e,pe),_e++,pe--;B[2*_e+fe]<Se;)_e++;for(;B[2*pe+fe]>Se;)pe--}B[2*ee+fe]===Se?W(ie,B,ee,pe):(pe++,W(ie,B,pe,te)),pe<=G&&(ee=pe+1),G<=pe&&(te=pe-1)}}function W(ie,B,G,ee){re(ie,G,ee),re(B,2*G,2*ee),re(B,2*G+1,2*ee+1)}function re(ie,B,G){const ee=ie[B];ie[B]=ie[G],ie[G]=ee}function ye(ie,B,G,ee){const te=ie-G,fe=B-ee;return te*te+fe*fe}oe.exports=yt,oe.exports.fromVectorTileJs=yt,oe.exports.fromGeojsonVt=function(ie,B){B=B||{};var G={};for(var ee in ie)G[ee]=new st(ie[ee].features,B),G[ee].name=ee,G[ee].version=B.version,G[ee].extent=B.extent;return yt({layers:G})},oe.exports.GeoJSONWrapper=st;const Ae=ie=>ie[0],be=ie=>ie[1];class Be{constructor(B,G=Ae,ee=be,te=64,fe=Float64Array){this.nodeSize=te,this.points=B;const Se=B.length<65536?Uint16Array:Uint32Array,_e=this.ids=new Se(B.length),pe=this.coords=new fe(2*B.length);for(let Ce=0;Ce<B.length;Ce++)_e[Ce]=Ce,pe[2*Ce]=G(B[Ce]),pe[2*Ce+1]=ee(B[Ce]);je(_e,pe,te,0,_e.length-1,0)}range(B,G,ee,te){return function(fe,Se,_e,pe,Ce,He,gt){const Ye=[0,fe.length-1,0],ei=[];let ri,It;for(;Ye.length;){const di=Ye.pop(),gi=Ye.pop(),Li=Ye.pop();if(gi-Li<=gt){for(let Bi=Li;Bi<=gi;Bi++)ri=Se[2*Bi],It=Se[2*Bi+1],ri>=_e&&ri<=Ce&&It>=pe&&It<=He&&ei.push(fe[Bi]);continue}const vi=Math.floor((Li+gi)/2);ri=Se[2*vi],It=Se[2*vi+1],ri>=_e&&ri<=Ce&&It>=pe&&It<=He&&ei.push(fe[vi]);const Ti=(di+1)%2;(di===0?_e<=ri:pe<=It)&&(Ye.push(Li),Ye.push(vi-1),Ye.push(Ti)),(di===0?Ce>=ri:He>=It)&&(Ye.push(vi+1),Ye.push(gi),Ye.push(Ti))}return ei}(this.ids,this.coords,B,G,ee,te,this.nodeSize)}within(B,G,ee){return function(te,fe,Se,_e,pe,Ce){const He=[0,te.length-1,0],gt=[],Ye=pe*pe;for(;He.length;){const ei=He.pop(),ri=He.pop(),It=He.pop();if(ri-It<=Ce){for(let Ti=It;Ti<=ri;Ti++)ye(fe[2*Ti],fe[2*Ti+1],Se,_e)<=Ye&&gt.push(te[Ti]);continue}const di=Math.floor((It+ri)/2),gi=fe[2*di],Li=fe[2*di+1];ye(gi,Li,Se,_e)<=Ye&&gt.push(te[di]);const vi=(ei+1)%2;(ei===0?Se-pe<=gi:_e-pe<=Li)&&(He.push(It),He.push(di-1),He.push(vi)),(ei===0?Se+pe>=gi:_e+pe>=Li)&&(He.push(di+1),He.push(ri),He.push(vi))}return gt}(this.ids,this.coords,B,G,ee,this.nodeSize)}}const Ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},nt=Math.fround||(Re=new Float32Array(1),ie=>(Re[0]=+ie,Re[0]));var Re;class we{constructor(B){this.options=Je(Object.create(Ze),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:G,minZoom:ee,maxZoom:te,nodeSize:fe}=this.options;G&&console.time("total time");const Se=`prepare ${B.length} points`;G&&console.time(Se),this.points=B;let _e=[];for(let pe=0;pe<B.length;pe++)B[pe].geometry&&_e.push(Ke(B[pe],pe));this.trees[te+1]=new Be(_e,Gt,Qt,fe,Float32Array),G&&console.timeEnd(Se);for(let pe=te;pe>=ee;pe--){const Ce=+Date.now();_e=this._cluster(_e,pe),this.trees[pe]=new Be(_e,Gt,Qt,fe,Float32Array),G&&console.log("z%d: %d clusters in %dms",pe,_e.length,+Date.now()-Ce)}return G&&console.timeEnd("total time"),this}getClusters(B,G){let ee=((B[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,B[1]));let fe=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)ee=-180,fe=180;else if(ee>fe){const He=this.getClusters([ee,te,180,Se],G),gt=this.getClusters([-180,te,fe,Se],G);return He.concat(gt)}const _e=this.trees[this._limitZoom(G)],pe=_e.range(ct(ee),Ht(Se),ct(fe),Ht(te)),Ce=[];for(const He of pe){const gt=_e.points[He];Ce.push(gt.numPoints?$e(gt):this.points[gt.index])}return Ce}getChildren(B){const G=this._getOriginId(B),ee=this._getOriginZoom(B),te="No cluster with the specified id.",fe=this.trees[ee];if(!fe)throw new Error(te);const Se=fe.points[G];if(!Se)throw new Error(te);const _e=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),pe=fe.within(Se.x,Se.y,_e),Ce=[];for(const He of pe){const gt=fe.points[He];gt.parentId===B&&Ce.push(gt.numPoints?$e(gt):this.points[gt.index])}if(Ce.length===0)throw new Error(te);return Ce}getLeaves(B,G,ee){const te=[];return this._appendLeaves(te,B,G=G||10,ee=ee||0,0),te}getTile(B,G,ee){const te=this.trees[this._limitZoom(B)],fe=Math.pow(2,B),{extent:Se,radius:_e}=this.options,pe=_e/Se,Ce=(ee-pe)/fe,He=(ee+1+pe)/fe,gt={features:[]};return this._addTileFeatures(te.range((G-pe)/fe,Ce,(G+1+pe)/fe,He),te.points,G,ee,fe,gt),G===0&&this._addTileFeatures(te.range(1-pe/fe,Ce,1,He),te.points,fe,ee,fe,gt),G===fe-1&&this._addTileFeatures(te.range(0,Ce,pe/fe,He),te.points,-1,ee,fe,gt),gt.features.length?gt:null}getClusterExpansionZoom(B){let G=this._getOriginZoom(B)-1;for(;G<=this.options.maxZoom;){const ee=this.getChildren(B);if(G++,ee.length!==1)break;B=ee[0].properties.cluster_id}return G}_appendLeaves(B,G,ee,te,fe){const Se=this.getChildren(G);for(const _e of Se){const pe=_e.properties;if(pe&&pe.cluster?fe+pe.point_count<=te?fe+=pe.point_count:fe=this._appendLeaves(B,pe.cluster_id,ee,te,fe):fe<te?fe++:B.push(_e),B.length===ee)break}return fe}_addTileFeatures(B,G,ee,te,fe,Se){for(const _e of B){const pe=G[_e],Ce=pe.numPoints;let He,gt,Ye;if(Ce)He=ut(pe),gt=pe.x,Ye=pe.y;else{const It=this.points[pe.index];He=It.properties,gt=ct(It.geometry.coordinates[0]),Ye=Ht(It.geometry.coordinates[1])}const ei={type:1,geometry:[[Math.round(this.options.extent*(gt*fe-ee)),Math.round(this.options.extent*(Ye*fe-te))]],tags:He};let ri;Ce?ri=pe.id:this.options.generateId?ri=pe.index:this.points[pe.index].id&&(ri=this.points[pe.index].id),ri!==void 0&&(ei.id=ri),Se.features.push(ei)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,G){const ee=[],{radius:te,extent:fe,reduce:Se,minPoints:_e}=this.options,pe=te/(fe*Math.pow(2,G));for(let Ce=0;Ce<B.length;Ce++){const He=B[Ce];if(He.zoom<=G)continue;He.zoom=G;const gt=this.trees[G+1],Ye=gt.within(He.x,He.y,pe),ei=He.numPoints||1;let ri=ei;for(const It of Ye){const di=gt.points[It];di.zoom>G&&(ri+=di.numPoints||1)}if(ri>ei&&ri>=_e){let It=He.x*ei,di=He.y*ei,gi=Se&&ei>1?this._map(He,!0):null;const Li=(Ce<<5)+(G+1)+this.points.length;for(const vi of Ye){const Ti=gt.points[vi];if(Ti.zoom<=G)continue;Ti.zoom=G;const Bi=Ti.numPoints||1;It+=Ti.x*Bi,di+=Ti.y*Bi,Ti.parentId=Li,Se&&(gi||(gi=this._map(He,!0)),Se(gi,this._map(Ti)))}He.parentId=Li,ee.push(Le(It/ri,di/ri,Li,ri,gi))}else if(ee.push(He),ri>1)for(const It of Ye){const di=gt.points[It];di.zoom<=G||(di.zoom=G,ee.push(di))}}return ee}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,G){if(B.numPoints)return G?Je({},B.properties):B.properties;const ee=this.points[B.index].properties,te=this.options.map(ee);return G&&te===ee?Je({},te):te}}function Le(ie,B,G,ee,te){return{x:nt(ie),y:nt(B),zoom:1/0,id:G,parentId:-1,numPoints:ee,properties:te}}function Ke(ie,B){const[G,ee]=ie.geometry.coordinates;return{x:nt(ct(G)),y:nt(Ht(ee)),zoom:1/0,index:B,parentId:-1}}function $e(ie){return{type:"Feature",id:ie.id,properties:ut(ie),geometry:{type:"Point",coordinates:[(B=ie.x,360*(B-.5)),Zt(ie.y)]}};var B}function ut(ie){const B=ie.numPoints,G=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return Je(Je({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:B,point_count_abbreviated:G})}function ct(ie){return ie/360+.5}function Ht(ie){const B=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function Zt(ie){const B=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Je(ie,B){for(const G in B)ie[G]=B[G];return ie}function Gt(ie){return ie.x}function Qt(ie){return ie.y}function mi(ie,B,G,ee){for(var te,fe=ee,Se=G-B>>1,_e=G-B,pe=ie[B],Ce=ie[B+1],He=ie[G],gt=ie[G+1],Ye=B+3;Ye<G;Ye+=3){var ei=Di(ie[Ye],ie[Ye+1],pe,Ce,He,gt);if(ei>fe)te=Ye,fe=ei;else if(ei===fe){var ri=Math.abs(Ye-Se);ri<_e&&(te=Ye,_e=ri)}}fe>ee&&(te-B>3&&mi(ie,B,te,ee),ie[te+2]=fe,G-te>3&&mi(ie,te,G,ee))}function Di(ie,B,G,ee,te,fe){var Se=te-G,_e=fe-ee;if(Se!==0||_e!==0){var pe=((ie-G)*Se+(B-ee)*_e)/(Se*Se+_e*_e);pe>1?(G=te,ee=fe):pe>0&&(G+=Se*pe,ee+=_e*pe)}return(Se=ie-G)*Se+(_e=B-ee)*_e}function wi(ie,B,G,ee){var te={id:ie===void 0?null:ie,type:B,geometry:G,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var Se=fe.geometry,_e=fe.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Ge(fe,Se);else if(_e==="Polygon"||_e==="MultiLineString")for(var pe=0;pe<Se.length;pe++)Ge(fe,Se[pe]);else if(_e==="MultiPolygon")for(pe=0;pe<Se.length;pe++)for(var Ce=0;Ce<Se[pe].length;Ce++)Ge(fe,Se[pe][Ce])}(te),te}function Ge(ie,B){for(var G=0;G<B.length;G+=3)ie.minX=Math.min(ie.minX,B[G]),ie.minY=Math.min(ie.minY,B[G+1]),ie.maxX=Math.max(ie.maxX,B[G]),ie.maxY=Math.max(ie.maxY,B[G+1])}function vt(ie,B,G,ee){if(B.geometry){var te=B.geometry.coordinates,fe=B.geometry.type,Se=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),_e=[],pe=B.id;if(G.promoteId?pe=B.properties[G.promoteId]:G.generateId&&(pe=ee||0),fe==="Point")Ri(te,_e);else if(fe==="MultiPoint")for(var Ce=0;Ce<te.length;Ce++)Ri(te[Ce],_e);else if(fe==="LineString")Ji(te,_e,Se,!1);else if(fe==="MultiLineString"){if(G.lineMetrics){for(Ce=0;Ce<te.length;Ce++)Ji(te[Ce],_e=[],Se,!1),ie.push(wi(pe,"LineString",_e,B.properties));return}si(te,_e,Se,!1)}else if(fe==="Polygon")si(te,_e,Se,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(Ce=0;Ce<B.geometry.geometries.length;Ce++)vt(ie,{id:pe,geometry:B.geometry.geometries[Ce],properties:B.properties},G,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<te.length;Ce++){var He=[];si(te[Ce],He,Se,!0),_e.push(He)}}ie.push(wi(pe,fe,_e,B.properties))}}function Ri(ie,B){B.push(Ei(ie[0])),B.push(dr(ie[1])),B.push(0)}function Ji(ie,B,G,ee){for(var te,fe,Se=0,_e=0;_e<ie.length;_e++){var pe=Ei(ie[_e][0]),Ce=dr(ie[_e][1]);B.push(pe),B.push(Ce),B.push(0),_e>0&&(Se+=ee?(te*Ce-pe*fe)/2:Math.sqrt(Math.pow(pe-te,2)+Math.pow(Ce-fe,2))),te=pe,fe=Ce}var He=B.length-3;B[2]=1,mi(B,0,He,G),B[He+2]=1,B.size=Math.abs(Se),B.start=0,B.end=B.size}function si(ie,B,G,ee){for(var te=0;te<ie.length;te++){var fe=[];Ji(ie[te],fe,G,ee),B.push(fe)}}function Ei(ie){return ie/360+.5}function dr(ie){var B=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function fr(ie,B,G,ee,te,fe,Se,_e){if(ee/=B,fe>=(G/=B)&&Se<ee)return ie;if(Se<G||fe>=ee)return null;for(var pe=[],Ce=0;Ce<ie.length;Ce++){var He=ie[Ce],gt=He.geometry,Ye=He.type,ei=te===0?He.minX:He.minY,ri=te===0?He.maxX:He.maxY;if(ei>=G&&ri<ee)pe.push(He);else if(!(ri<G||ei>=ee)){var It=[];if(Ye==="Point"||Ye==="MultiPoint")Qi(gt,It,G,ee,te);else if(Ye==="LineString")at(gt,It,G,ee,te,!1,_e.lineMetrics);else if(Ye==="MultiLineString")xi(gt,It,G,ee,te,!1);else if(Ye==="Polygon")xi(gt,It,G,ee,te,!0);else if(Ye==="MultiPolygon")for(var di=0;di<gt.length;di++){var gi=[];xi(gt[di],gi,G,ee,te,!0),gi.length&&It.push(gi)}if(It.length){if(_e.lineMetrics&&Ye==="LineString"){for(di=0;di<It.length;di++)pe.push(wi(He.id,Ye,It[di],He.tags));continue}Ye!=="LineString"&&Ye!=="MultiLineString"||(It.length===1?(Ye="LineString",It=It[0]):Ye="MultiLineString"),Ye!=="Point"&&Ye!=="MultiPoint"||(Ye=It.length===3?"Point":"MultiPoint"),pe.push(wi(He.id,Ye,It,He.tags))}}}return pe.length?pe:null}function Qi(ie,B,G,ee,te){for(var fe=0;fe<ie.length;fe+=3){var Se=ie[fe+te];Se>=G&&Se<=ee&&(B.push(ie[fe]),B.push(ie[fe+1]),B.push(ie[fe+2]))}}function at(ie,B,G,ee,te,fe,Se){for(var _e,pe,Ce=bi(ie),He=te===0?tn:yi,gt=ie.start,Ye=0;Ye<ie.length-3;Ye+=3){var ei=ie[Ye],ri=ie[Ye+1],It=ie[Ye+2],di=ie[Ye+3],gi=ie[Ye+4],Li=te===0?ei:ri,vi=te===0?di:gi,Ti=!1;Se&&(_e=Math.sqrt(Math.pow(ei-di,2)+Math.pow(ri-gi,2))),Li<G?vi>G&&(pe=He(Ce,ei,ri,di,gi,G),Se&&(Ce.start=gt+_e*pe)):Li>ee?vi<ee&&(pe=He(Ce,ei,ri,di,gi,ee),Se&&(Ce.start=gt+_e*pe)):br(Ce,ei,ri,It),vi<G&&Li>=G&&(pe=He(Ce,ei,ri,di,gi,G),Ti=!0),vi>ee&&Li<=ee&&(pe=He(Ce,ei,ri,di,gi,ee),Ti=!0),!fe&&Ti&&(Se&&(Ce.end=gt+_e*pe),B.push(Ce),Ce=bi(ie)),Se&&(gt+=_e)}var Bi=ie.length-3;ei=ie[Bi],ri=ie[Bi+1],It=ie[Bi+2],(Li=te===0?ei:ri)>=G&&Li<=ee&&br(Ce,ei,ri,It),Bi=Ce.length-3,fe&&Bi>=3&&(Ce[Bi]!==Ce[0]||Ce[Bi+1]!==Ce[1])&&br(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&B.push(Ce)}function bi(ie){var B=[];return B.size=ie.size,B.start=ie.start,B.end=ie.end,B}function xi(ie,B,G,ee,te,fe){for(var Se=0;Se<ie.length;Se++)at(ie[Se],B,G,ee,te,fe,!1)}function br(ie,B,G,ee){ie.push(B),ie.push(G),ie.push(ee)}function tn(ie,B,G,ee,te,fe){var Se=(fe-B)/(ee-B);return ie.push(fe),ie.push(G+(te-G)*Se),ie.push(1),Se}function yi(ie,B,G,ee,te,fe){var Se=(fe-G)/(te-G);return ie.push(B+(ee-B)*Se),ie.push(fe),ie.push(1),Se}function Oi(ie,B){for(var G=[],ee=0;ee<ie.length;ee++){var te,fe=ie[ee],Se=fe.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")te=wr(fe.geometry,B);else if(Se==="MultiLineString"||Se==="Polygon"){te=[];for(var _e=0;_e<fe.geometry.length;_e++)te.push(wr(fe.geometry[_e],B))}else if(Se==="MultiPolygon")for(te=[],_e=0;_e<fe.geometry.length;_e++){for(var pe=[],Ce=0;Ce<fe.geometry[_e].length;Ce++)pe.push(wr(fe.geometry[_e][Ce],B));te.push(pe)}G.push(wi(fe.id,Se,te,fe.tags))}return G}function wr(ie,B){var G=[];G.size=ie.size,ie.start!==void 0&&(G.start=ie.start,G.end=ie.end);for(var ee=0;ee<ie.length;ee+=3)G.push(ie[ee]+B,ie[ee+1],ie[ee+2]);return G}function Vr(ie,B){if(ie.transformed)return ie;var G,ee,te,fe=1<<ie.z,Se=ie.x,_e=ie.y;for(G=0;G<ie.features.length;G++){var pe=ie.features[G],Ce=pe.geometry,He=pe.type;if(pe.geometry=[],He===1)for(ee=0;ee<Ce.length;ee+=2)pe.geometry.push(lr(Ce[ee],Ce[ee+1],B,fe,Se,_e));else for(ee=0;ee<Ce.length;ee++){var gt=[];for(te=0;te<Ce[ee].length;te+=2)gt.push(lr(Ce[ee][te],Ce[ee][te+1],B,fe,Se,_e));pe.geometry.push(gt)}}return ie.transformed=!0,ie}function lr(ie,B,G,ee,te,fe){return[Math.round(G*(ie*ee-te)),Math.round(G*(B*ee-fe))]}function Dr(ie,B,G,ee,te){for(var fe=B===te.maxZoom?0:te.tolerance/((1<<B)*te.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:ee,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<ie.length;_e++){Se.numFeatures++,Xi(Se,ie[_e],fe,te);var pe=ie[_e].minX,Ce=ie[_e].minY,He=ie[_e].maxX,gt=ie[_e].maxY;pe<Se.minX&&(Se.minX=pe),Ce<Se.minY&&(Se.minY=Ce),He>Se.maxX&&(Se.maxX=He),gt>Se.maxY&&(Se.maxY=gt)}return Se}function Xi(ie,B,G,ee){var te=B.geometry,fe=B.type,Se=[];if(fe==="Point"||fe==="MultiPoint")for(var _e=0;_e<te.length;_e+=3)Se.push(te[_e]),Se.push(te[_e+1]),ie.numPoints++,ie.numSimplified++;else if(fe==="LineString")ls(Se,te,ie,G,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(_e=0;_e<te.length;_e++)ls(Se,te[_e],ie,G,fe==="Polygon",_e===0);else if(fe==="MultiPolygon")for(var pe=0;pe<te.length;pe++){var Ce=te[pe];for(_e=0;_e<Ce.length;_e++)ls(Se,Ce[_e],ie,G,!0,_e===0)}if(Se.length){var He=B.tags||null;if(fe==="LineString"&&ee.lineMetrics){for(var gt in He={},B.tags)He[gt]=B.tags[gt];He.mapbox_clip_start=te.start/te.size,He.mapbox_clip_end=te.end/te.size}var Ye={geometry:Se,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:He};B.id!==null&&(Ye.id=B.id),ie.features.push(Ye)}}function ls(ie,B,G,ee,te,fe){var Se=ee*ee;if(ee>0&&B.size<(te?Se:ee))G.numPoints+=B.length/3;else{for(var _e=[],pe=0;pe<B.length;pe+=3)(ee===0||B[pe+2]>Se)&&(G.numSimplified++,_e.push(B[pe]),_e.push(B[pe+1])),G.numPoints++;te&&function(Ce,He){for(var gt=0,Ye=0,ei=Ce.length,ri=ei-2;Ye<ei;ri=Ye,Ye+=2)gt+=(Ce[Ye]-Ce[ri])*(Ce[Ye+1]+Ce[ri+1]);if(gt>0===He)for(Ye=0,ei=Ce.length;Ye<ei/2;Ye+=2){var It=Ce[Ye],di=Ce[Ye+1];Ce[Ye]=Ce[ei-2-Ye],Ce[Ye+1]=Ce[ei-1-Ye],Ce[ei-2-Ye]=It,Ce[ei-1-Ye]=di}}(_e,fe),ie.push(_e)}}function Zr(ie,B){var G=(B=this.options=function(te,fe){for(var Se in fe)te[Se]=fe[Se];return te}(Object.create(this.options),B)).debug;if(G&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(te,fe){var Se=[];if(te.type==="FeatureCollection")for(var _e=0;_e<te.features.length;_e++)vt(Se,te.features[_e],fe,_e);else vt(Se,te.type==="Feature"?te:{geometry:te},fe);return Se}(ie,B);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(te,fe){var Se=fe.buffer/fe.extent,_e=te,pe=fr(te,1,-1-Se,Se,0,-1,2,fe),Ce=fr(te,1,1-Se,2+Se,0,-1,2,fe);return(pe||Ce)&&(_e=fr(te,1,-Se,1+Se,0,-1,2,fe)||[],pe&&(_e=Oi(pe,1).concat(_e)),Ce&&(_e=_e.concat(Oi(Ce,-1)))),_e}(ee,B),ee.length&&this.splitTile(ee,0,0,0),G&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cs(ie,B,G){return 32*((1<<ie)*G+B)+ie}function Wn(ie,B){const G=ie.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const ee=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!ee)return B(null,null);const te=new Y(ee.features);let fe=oe.exports(te);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),B(null,{vectorTile:te,rawData:fe.buffer})}Zr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zr.prototype.splitTile=function(ie,B,G,ee,te,fe,Se){for(var _e=[ie,B,G,ee],pe=this.options,Ce=pe.debug;_e.length;){ee=_e.pop(),G=_e.pop(),B=_e.pop(),ie=_e.pop();var He=1<<B,gt=cs(B,G,ee),Ye=this.tiles[gt];if(!Ye&&(Ce>1&&console.time("creation"),Ye=this.tiles[gt]=Dr(ie,B,G,ee,pe),this.tileCoords.push({z:B,x:G,y:ee}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,G,ee,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var ei="z"+B;this.stats[ei]=(this.stats[ei]||0)+1,this.total++}if(Ye.source=ie,te){if(B===pe.maxZoom||B===te)continue;var ri=1<<te-B;if(G!==Math.floor(fe/ri)||ee!==Math.floor(Se/ri))continue}else if(B===pe.indexMaxZoom||Ye.numPoints<=pe.indexMaxPoints)continue;if(Ye.source=null,ie.length!==0){Ce>1&&console.time("clipping");var It,di,gi,Li,vi,Ti,Bi=.5*pe.buffer/pe.extent,Si=.5-Bi,Mr=.5+Bi,cr=1+Bi;It=di=gi=Li=null,vi=fr(ie,He,G-Bi,G+Mr,0,Ye.minX,Ye.maxX,pe),Ti=fr(ie,He,G+Si,G+cr,0,Ye.minX,Ye.maxX,pe),ie=null,vi&&(It=fr(vi,He,ee-Bi,ee+Mr,1,Ye.minY,Ye.maxY,pe),di=fr(vi,He,ee+Si,ee+cr,1,Ye.minY,Ye.maxY,pe),vi=null),Ti&&(gi=fr(Ti,He,ee-Bi,ee+Mr,1,Ye.minY,Ye.maxY,pe),Li=fr(Ti,He,ee+Si,ee+cr,1,Ye.minY,Ye.maxY,pe),Ti=null),Ce>1&&console.timeEnd("clipping"),_e.push(It||[],B+1,2*G,2*ee),_e.push(di||[],B+1,2*G,2*ee+1),_e.push(gi||[],B+1,2*G+1,2*ee),_e.push(Li||[],B+1,2*G+1,2*ee+1)}}},Zr.prototype.getTile=function(ie,B,G){var ee=this.options,te=ee.extent,fe=ee.debug;if(ie<0||ie>24)return null;var Se=1<<ie,_e=cs(ie,B=(B%Se+Se)%Se,G);if(this.tiles[_e])return Vr(this.tiles[_e],te);fe>1&&console.log("drilling down to z%d-%d-%d",ie,B,G);for(var pe,Ce=ie,He=B,gt=G;!pe&&Ce>0;)Ce--,He=Math.floor(He/2),gt=Math.floor(gt/2),pe=this.tiles[cs(Ce,He,gt)];return pe&&pe.source?(fe>1&&console.log("found parent tile z%d-%d-%d",Ce,He,gt),fe>1&&console.time("drilling down"),this.splitTile(pe.source,Ce,He,gt,ie,B,G),fe>1&&console.timeEnd("drilling down"),this.tiles[_e]?Vr(this.tiles[_e],te):null):null};class $n extends _{constructor(B,G,ee,te){super(B,G,ee,Wn),te&&(this.loadGeoJSON=te)}loadData(B,G){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const te=!!(B&&B.request&&B.request.collectResourceTiming)&&new n.RequestPerformance(B.request);this._pendingCallback=G,this._pendingRequest=this.loadGeoJSON(B,(fe,Se)=>{if(delete this._pendingCallback,delete this._pendingRequest,fe||!Se)return G(fe);if(typeof Se!="object")return G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{S(Se,!0);try{if(B.filter){const pe=n.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(He=>`${He.key}: ${He.message}`).join(", "));Se={type:"FeatureCollection",features:Se.features.filter(He=>pe.value.evaluate({zoom:0},He))}}this._geoJSONIndex=B.cluster?new we(function({superclusterOptions:pe,clusterProperties:Ce}){if(!Ce||!pe)return pe;const He={},gt={},Ye={accumulated:null,zoom:0},ei={properties:null},ri=Object.keys(Ce);for(const It of ri){const[di,gi]=Ce[It],Li=n.createExpression(gi),vi=n.createExpression(typeof di=="string"?[di,["accumulated"],["get",It]]:di);He[It]=Li.value,gt[It]=vi.value}return pe.map=It=>{ei.properties=It;const di={};for(const gi of ri)di[gi]=He[gi].evaluate(Ye,ei);return di},pe.reduce=(It,di)=>{ei.properties=di;for(const gi of ri)Ye.accumulated=It[gi],It[gi]=gt[gi].evaluate(Ye,ei)},pe}(B)).load(Se.features):function(pe,Ce){return new Zr(pe,Ce)}(Se,B.geojsonVtOptions)}catch(pe){return G(pe)}this.loaded={};const _e={};if(te){const pe=te.finish();pe&&(_e.resourceTiming={},_e.resourceTiming[B.source]=JSON.parse(JSON.stringify(pe)))}G(null,_e)}})}reloadTile(B,G){const ee=this.loaded;return ee&&ee[B.uid]?super.reloadTile(B,G):this.loadTile(B,G)}loadGeoJSON(B,G){if(B.request)return n.getJSON(B.request,G);if(typeof B.data=="string")try{G(null,JSON.parse(B.data))}catch{G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}else G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(B,G){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),G()}getClusterExpansionZoom(B,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(ee){G(ee)}}getClusterChildren(B,G){try{G(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(ee){G(ee)}}getClusterLeaves(B,G){try{G(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(ee){G(ee)}}}class qn{constructor(B){this.self=B,this.actor=new n.Actor(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:_,geojson:$n},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,ee)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=ee},this.self.registerRTLTextPlugin=G=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=G.applyArabicShaping,n.plugin.processBidirectionalText=G.processBidirectionalText,n.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}setReferrer(B,G){this.referrer=G}setImages(B,G,ee){this.availableImages[B]=G;for(const te in this.workerSources[B]){const fe=this.workerSources[B][te];for(const Se in fe)fe[Se].availableImages=G}ee()}setLayers(B,G,ee){this.getLayerIndex(B).replace(G),ee()}updateLayers(B,G,ee){this.getLayerIndex(B).update(G.layers,G.removedIds),ee()}loadTile(B,G,ee){this.getWorkerSource(B,G.type,G.source).loadTile(G,ee)}loadDEMTile(B,G,ee){this.getDEMWorkerSource(B,G.source).loadTile(G,ee)}reloadTile(B,G,ee){this.getWorkerSource(B,G.type,G.source).reloadTile(G,ee)}abortTile(B,G,ee){this.getWorkerSource(B,G.type,G.source).abortTile(G,ee)}removeTile(B,G,ee){this.getWorkerSource(B,G.type,G.source).removeTile(G,ee)}removeDEMTile(B,G){this.getDEMWorkerSource(B,G.source).removeTile(G)}removeSource(B,G,ee){if(!this.workerSources[B]||!this.workerSources[B][G.type]||!this.workerSources[B][G.type][G.source])return;const te=this.workerSources[B][G.type][G.source];delete this.workerSources[B][G.type][G.source],te.removeSource!==void 0?te.removeSource(G,ee):ee()}loadWorkerSource(B,G,ee){try{this.self.importScripts(G.url),ee()}catch(te){ee(te.toString())}}syncRTLPluginState(B,G,ee){try{n.plugin.setState(G);const te=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&te!=null){this.self.importScripts(te);const fe=n.plugin.isParsed();ee(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${te}`),fe)}}catch(te){ee(te.toString())}}getAvailableImages(B){let G=this.availableImages[B];return G||(G=[]),G}getLayerIndex(B){let G=this.layerIndexes[B];return G||(G=this.layerIndexes[B]=new v),G}getWorkerSource(B,G,ee){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][G]||(this.workerSources[B][G]={}),!this.workerSources[B][G][ee]){const te={send:(fe,Se,_e)=>{this.actor.send(fe,Se,_e,B)}};this.workerSources[B][G][ee]=new this.workerSourceTypes[G](te,this.getLayerIndex(B),this.getAvailableImages(B))}return this.workerSources[B][G][ee]}getDEMWorkerSource(B,G){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][G]||(this.demWorkerSources[B][G]=new u),this.demWorkerSources[B][G]}enforceCacheSizeLimit(B,G){n.enforceCacheSizeLimit(G)}}return n.isWorker()&&(self.worker=new qn(self)),qn}),At(["./shared"],function(n){var g=x;function x(d){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,m,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{m=new Worker(E),a=!0}catch{a=!1}return m&&m.terminate(),URL.revokeObjectURL(E),a}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var a=document.createElement("canvas");a.width=a.height=1;var m=a.getContext("2d");if(!m)return!1;var b=m.getImageData(0,0,1,1);return b&&b.width===a.width}()?(v[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(v[s]=function(a){var m,b=function(E){var D=document.createElement("canvas"),L=Object.create(x.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=E,D.getContext("webgl",L)||D.getContext("experimental-webgl",L)}(a);if(!b)return!1;try{m=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!m||b.isContextLost())&&(b.shaderSource(m,"void main() {}"),b.compileShader(m),b.getShaderParameter(m,b.COMPILE_STATUS)===!0)}(s)),v[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(d)}var v={};function h(d,t){if(Array.isArray(d)){if(!Array.isArray(t)||d.length!==t.length)return!1;for(let s=0;s<d.length;s++)if(!h(d[s],t[s]))return!1;return!0}if(typeof d=="object"&&d!==null&&t!==null){if(typeof t!="object"||Object.keys(d).length!==Object.keys(t).length)return!1;for(const s in d)if(!h(d[s],t[s]))return!1;return!0}return d===t}x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class l{static testProp(t){if(!l.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in l.docStyle)return t[s];return t[0]}static create(t,s,a){const m=window.document.createElement(t);return s!==void 0&&(m.className=s),a&&a.appendChild(m),m}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){l.docStyle&&l.selectProp&&(l.userSelect=l.docStyle[l.selectProp],l.docStyle[l.selectProp]="none")}static enableDrag(){l.docStyle&&l.selectProp&&(l.docStyle[l.selectProp]=l.userSelect)}static setTransform(t,s){t.style[l.transformProp]=s}static addEventListener(t,s,a,m={}){t.addEventListener(s,a,"passive"in m?m:m.capture)}static removeEventListener(t,s,a,m={}){t.removeEventListener(s,a,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",l.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",l.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",l.suppressClickInternal,!0)},0)}static mousePos(t,s){const a=t.getBoundingClientRect();return new n.pointGeometry(s.clientX-a.left-t.clientLeft,s.clientY-a.top-t.clientTop)}static touchPos(t,s){const a=t.getBoundingClientRect(),m=[];for(let b=0;b<s.length;b++)m.push(new n.pointGeometry(s[b].clientX-a.left-t.clientLeft,s[b].clientY-a.top-t.clientTop));return m}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}l.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,l.selectProp=l.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),l.transformProp=l.testProp(["transform","WebkitTransform"]);class c{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,a){const m=function(b){const E=b.match(f);if(!E)throw new Error(`Unable to parse URL "${b}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(t);return m.path+=`${s}${a}`,function(b){const E=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${E}`}(m)}setTransformRequest(t){this._transformRequestFn=t}}const f=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class _{constructor(t,s,a,m){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(s,m)}update(t,s,a){const{width:m,height:b}=t,E=!(this.size&&this.size[0]===m&&this.size[1]===b||a),{context:D}=this,{gl:L}=D;if(this.useMipmap=Boolean(s&&s.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!s||s.premultiply!==!1)),E)this.size=[m,b],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||n.isImageBitmap(t)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,t):L.texImage2D(L.TEXTURE_2D,0,this.format,m,b,0,this.format,L.UNSIGNED_BYTE,t.data);else{const{x:R,y:V}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||n.isImageBitmap(t)?L.texSubImage2D(L.TEXTURE_2D,0,R,V,L.RGBA,L.UNSIGNED_BYTE,t):L.texSubImage2D(L.TEXTURE_2D,0,R,V,m,b,L.RGBA,L.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(t,s,a){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),a!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=b.LINEAR),t!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a||t),this.filter=t),s!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function u(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class S extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,a);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let a=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(s.content,s)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,s){if(!t)return!0;let a=0;for(const m of t){if(m[0]<a||m[1]<m[0]||s<m[1])return!1;a=m[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const a=this.images[t];if(a.data.width!==s.data.width||a.data.height!==s.data.height)throw new Error(`size mismatch between old image (${a.data.width}x${a.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=a.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let a=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(a=!1);this.isLoaded()||a?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const a={};for(const m of t){this.images[m]||this.fire(new n.Event("styleimagemissing",{id:m}));const b=this.images[m];b?a[m]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:n.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],a=this.getImage(t);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const m={w:a.data.width+2,h:a.data.height+2,x:0,y:0},b=new n.ImagePosition(m,a);this.patterns[t]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:s,h:a}=n.potpack(t),m=this.atlasImage;m.resize({width:s||1,height:a||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],D=E.x+1,L=E.y+1,R=this.images[b].data,V=R.width,X=R.height;n.RGBAImage.copy(R,m,{x:0,y:0},{x:D,y:L},{width:V,height:X}),n.RGBAImage.copy(R,m,{x:0,y:X-1},{x:D,y:L-1},{width:V,height:1}),n.RGBAImage.copy(R,m,{x:0,y:0},{x:D,y:L+X},{width:V,height:1}),n.RGBAImage.copy(R,m,{x:V-1,y:0},{x:D-1,y:L},{width:1,height:X}),n.RGBAImage.copy(R,m,{x:0,y:0},{x:D+V,y:L},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const a=this.images[s];a||n.warnOnce(`Image with ID: "${s}" was not found`),u(a)&&this.updateImage(s,a)}}}const C=1e20;function A(d,t,s,a,m,b,E,D,L){for(let R=t;R<t+a;R++)O(d,s*b+R,b,m,E,D,L);for(let R=s;R<s+m;R++)O(d,R*b+t,1,a,E,D,L)}function O(d,t,s,a,m,b,E){b[0]=0,E[0]=-C,E[1]=C,m[0]=d[t];for(let D=1,L=0,R=0;D<a;D++){m[D]=d[t+D*s];const V=D*D;do{const X=b[L];R=(m[D]-m[X]+V-X*X)/(D-X)/2}while(R<=E[L]&&--L>-1);L++,b[L]=D,E[L]=R,E[L+1]=C}for(let D=0,L=0;D<a;D++){for(;E[L+1]<D;)L++;const R=b[L],V=D-R;d[t+D*s]=m[R]+V*V}}class j{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const a=[];for(const m in t)for(const b of t[m])a.push({stack:m,id:b});n.asyncAll(a,({stack:m,id:b},E)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{}});let L=D.glyphs[b];if(L!==void 0)return void E(null,{stack:m,id:b,glyph:L});if(L=this._tinySDF(D,m,b),L)return D.glyphs[b]=L,void E(null,{stack:m,id:b,glyph:L});const R=Math.floor(b/256);if(256*R>65535)return void E(new Error("glyphs > 65535 not supported"));if(D.ranges[R])return void E(null,{stack:m,id:b,glyph:L});let V=D.requests[R];V||(V=D.requests[R]=[],j.loadGlyphRange(m,R,this.url,this.requestManager,(X,H)=>{if(H){for(const le in H)this._doesCharSupportLocalGlyph(+le)||(D.glyphs[+le]=H[+le]);D.ranges[R]=!0}for(const le of V)le(X,H);delete D.requests[R]})),V.push((X,H)=>{X?E(X):H&&E(null,{stack:m,id:b,glyph:H[b]||null})})},(m,b)=>{if(m)s(m);else if(b){const E={};for(const{stack:D,id:L,glyph:R}of b)(E[D]||(E[D]={}))[L]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};s(null,E)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(n.unicodeBlockLookup["CJK Unified Ideographs"](t)||n.unicodeBlockLookup["Hangul Syllables"](t)||n.unicodeBlockLookup.Hiragana(t)||n.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,a){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(a))return;let b=t.tinySDF;if(!b){let D="400";/bold/i.test(s)?D="900":/medium/i.test(s)?D="500":/light/i.test(s)&&(D="200"),b=t.tinySDF=new j.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:m,fontWeight:D})}const E=b.draw(String.fromCharCode(a));return{id:a,bitmap:new n.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}j.loadGlyphRange=function(d,t,s,a,m){const b=256*t,E=b+255,D=a.transformRequest(s.replace("{fontstack}",d).replace("{range}",`${b}-${E}`),n.ResourceType.Glyphs);n.getArrayBuffer(D,(L,R)=>{if(L)m(L);else if(R){const V={};for(const X of n.parseGlyphPbf(R))V[X.id]=X;m(null,V)}})},j.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:s=8,cutoff:a=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:E="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=s;const D=this.size=d+4*t,L=this._createCanvas(D),R=this.ctx=L.getContext("2d",{willReadFrequently:!0});R.font=`${E} ${b} ${d}px ${m}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(d){const t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:a,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(d),E=Math.ceil(s),D=Math.min(this.size-this.buffer,Math.ceil(b-m)),L=Math.min(this.size-this.buffer,E+Math.ceil(a)),R=D+2*this.buffer,V=L+2*this.buffer,X=Math.max(R*V,0),H=new Uint8ClampedArray(X),le={data:H,width:R,height:V,glyphWidth:D,glyphHeight:L,glyphTop:E,glyphLeft:0,glyphAdvance:t};if(D===0||L===0)return le;const{ctx:ne,buffer:ae,gridInner:xe,gridOuter:Ee}=this;ne.clearRect(ae,ae,D,L),ne.fillText(d,ae,ae+E);const Oe=ne.getImageData(ae,ae,D,L);Ee.fill(C,0,X),xe.fill(0,0,X);for(let ce=0;ce<L;ce++)for(let Xe=0;Xe<D;Xe++){const Ue=Oe.data[4*(ce*D+Xe)+3]/255;if(Ue===0)continue;const rt=(ce+ae)*R+Xe+ae;if(Ue===1)Ee[rt]=0,xe[rt]=C;else{const ot=.5-Ue;Ee[rt]=ot>0?ot*ot:0,xe[rt]=ot<0?ot*ot:0}}A(Ee,0,0,R,V,R,this.f,this.v,this.z),A(xe,ae,ae,D,L,R,this.f,this.v,this.z);for(let ce=0;ce<X;ce++){const Xe=Math.sqrt(Ee[ce])-Math.sqrt(xe[ce]);H[ce]=Math.round(255-255*(Xe/this.radius+this.cutoff))}return le}};const Y=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(d,t){return n.sphericalToCartesian(d.expression.evaluate(t))}interpolate(d,t,s){return{x:n.number(d.x,t.x,s),y:n.number(d.y,t.y,s),z:n.number(d.z,t.z,s)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)}),oe="-transition";class ge extends n.Evented{constructor(t){super(),this._transitionable=new n.Transitionable(Y),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(n.validateLight,t,s))for(const a in t){const m=t[a];a.endsWith(oe)?this._transitionable.setTransition(a.slice(0,-oe.length),m):this._transitionable.setValue(a,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,a){return(!a||a.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class De{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const a=t.join(",")+String(s);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,s)),this.dashEntry[a]}getDashRanges(t,s,a){const m=[];let b=t.length%2==1?-t[t.length-1]*a:0,E=t[0]*a,D=!0;m.push({left:b,right:E,isDash:D,zeroLength:t[0]===0});let L=t[0];for(let R=1;R<t.length;R++){D=!D;const V=t[R];b=L*a,L+=V,E=L*a,m.push({left:b,right:E,isDash:D,zeroLength:V===0})}return m}addRoundDash(t,s,a){const m=s/2;for(let b=-a;b<=a;b++){const E=this.width*(this.nextRow+a+b);let D=0,L=t[D];for(let R=0;R<this.width;R++){R/L.right>1&&(L=t[++D]);const V=Math.abs(R-L.left),X=Math.abs(R-L.right),H=Math.min(V,X);let le;const ne=b/a*(m+1);if(L.isDash){const ae=m-Math.abs(ne);le=Math.sqrt(H*H+ae*ae)}else le=m-Math.sqrt(H*H+ne*ne);this.data[E+R]=Math.max(0,Math.min(255,le+128))}}}addRegularDash(t){for(let D=t.length-1;D>=0;--D){const L=t[D],R=t[D+1];L.zeroLength?t.splice(D,1):R&&R.isDash===L.isDash&&(R.left=L.left,t.splice(D,1))}const s=t[0],a=t[t.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const m=this.width*this.nextRow;let b=0,E=t[b];for(let D=0;D<this.width;D++){D/E.right>1&&(E=t[++b]);const L=Math.abs(D-E.left),R=Math.abs(D-E.right),V=Math.min(L,R);this.data[m+D]=Math.max(0,Math.min(255,(E.isDash?V:-V)+128))}}addDash(t,s){const a=s?7:0,m=2*a+1;if(this.nextRow+m>this.height)return n.warnOnce("LineAtlas out of space"),null;let b=0;for(let D=0;D<t.length;D++)b+=t[D];if(b!==0){const D=this.width/b,L=this.getDashRanges(t,this.width,D);s?this.addRoundDash(L,D,a):this.addRegularDash(L)}const E={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:b};return this.nextRow+=m,this.dirty=!0,E}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class qe{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const a=this.workerPool.acquire(this.id);for(let m=0;m<a.length;m++){const b=new qe.Actor(a[m],s,this.id);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,a){n.asyncAll(this.actors,(m,b)=>{m.send(t,s,b)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function lt(d,t,s){const a=function(m,b){if(m)return s(m);if(b){const E=n.pick(n.extend(b,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(D=>D.id)),s(null,E)}};return d.url?n.getJSON(t.transformRequest(d.url,n.ResourceType.Source),a):n.exported.frame(()=>a(null,d))}qe.Actor=n.Actor;class _t{constructor(t,s,a){this.bounds=n.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),a=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*s),b=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*s),E=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=a&&t.x<b&&t.y>=m&&t.y<E}}class xt extends n.Evented{constructor(t,s,a,m){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(s,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=lt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new n.ErrorEvent(t)):s&&(n.extend(this,s),s.bounds&&(this.tileBounds=new _t(s.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}loadTile(t,s){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(a,n.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(E,D){return delete t.request,t.aborted?s(null):E&&E.status!==404?s(E):(D&&D.resourceTiming&&(t.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&t.setExpiryData(D),t.loadVectorData(D,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",m,b.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",m,b.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class st extends n.Evented{constructor(t,s,a,m){super(),this.id=t,this.dispatcher=a,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},s),n.extend(this,n.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=lt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):s&&(n.extend(this,s),s.bounds&&(this.tileBounds=new _t(s.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=n.getImage(this.map._requestManager.transformRequest(a,n.ResourceType.Tile),(m,b,E)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(m)t.state="errored",s(m);else if(b){this.map._refreshExpiredTiles&&t.setExpiryData(E);const D=this.map.painter.context,L=D.gl;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new _(D,b,L.RGBA,{useMipmap:!0}),t.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),D.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax)),t.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let yt;class it extends st{constructor(t,s,a,m){super(t,s,a,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function m(b,E){b&&(t.state="errored",s(b)),E&&(t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=n.getImage(this.map._requestManager.transformRequest(a,n.ResourceType.Tile),function(b,E){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(b)t.state="errored",s(b);else if(E){this.map._refreshExpiredTiles&&t.setExpiryData(E),delete E.cacheControl,delete E.expires;const D=n.isImageBitmap(E)&&(yt==null&&(yt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),yt)?E:n.exported.getImageData(E,1),L={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:D,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",L,m.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,a=Math.pow(2,s.z),m=(s.x-1+a)%a,b=s.x===0?t.wrap-1:t.wrap,E=(s.x+1+a)%a,D=s.x+1===a?t.wrap+1:t.wrap,L={};return L[new n.OverscaledTileID(t.overscaledZ,b,s.z,m,s.y).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,D,s.z,E,s.y).key]={backfilled:!1},s.y>0&&(L[new n.OverscaledTileID(t.overscaledZ,b,s.z,m,s.y-1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,D,s.z,E,s.y-1).key]={backfilled:!1}),s.y+1<a&&(L[new n.OverscaledTileID(t.overscaledZ,b,s.z,m,s.y+1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,D,s.z,E,s.y+1).key]={backfilled:!1}),L}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Rt extends n.Evented{constructor(t,s,a,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(m),this._data=s.data,this._options=n.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const b=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*b,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*b,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:n.EXTENT,radius:(s.clusterRadius||50)*b,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,a,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:a},m),this}_updateWorkerData(t){const s=n.extend({},this.workerOptions),a=this._data;typeof a=="string"?(s.request=this.map._requestManager.transformRequest(n.exported.resolveURL(a),n.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(a),this._pendingLoads++,this.fire(new n.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(m,b)=>{if(this._pendingLoads--,this._removed||b&&b.abandoned)return void this.fire(new n.Event("dataabort",{dataType:"source",sourceDataType:t}));let E=null;if(b&&b.resourceTiming&&b.resourceTiming[this.id]&&(E=b.resourceTiming[this.id].slice(0)),m)return void this.fire(new n.ErrorEvent(m));const D={dataType:"source",sourceDataType:t};this._collectResourceTiming&&E&&E.length>0&&n.extend(D,{resourceTiming:E}),this.fire(new n.Event("data",D))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const m={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,m,(b,E)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):b?s(b):(t.loadVectorData(E,this.map.painter,a==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Pt=n.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Q extends n.Evented{constructor(t,s,a,m){super(),this.id=t,this.dispatcher=a,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t,s){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(a,m)=>{this._loaded=!0,a?this.fire(new n.ErrorEvent(a)):m&&(this.image=m,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(n.MercatorCoordinate.fromLngLat);this.tileID=function(m){let b=1/0,E=1/0,D=-1/0,L=-1/0;for(const H of m)b=Math.min(b,H.x),E=Math.min(E,H.y),D=Math.max(D,H.x),L=Math.max(L,H.y);const R=Math.max(D-b,L-E),V=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),X=Math.pow(2,V);return new n.CanonicalTileID(V,Math.floor((b+D)/2*X),Math.floor((E+L)/2*X))}(s),this.minzoom=this.maxzoom=this.tileID.z;const a=s.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new n.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,n.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,n.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,n.EXTENT,n.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const a in this.tiles){const m=this.tiles[a];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class se extends Q{constructor(t,s,a,m){super(t,s,a,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,n.ResourceType.Source).url);n.getVideo(this.urls,(s,a)=>{this._loaded=!0,s?this.fire(new n.ErrorEvent(s)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new _(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const a in this.tiles){const m=this.tiles[a];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ue extends Q{constructor(t,s,a,m){super(t,s,a,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(E=>typeof E!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,a=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _(s,this.canvas,a.RGBA,{premultiply:!0});for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const de={vector:xt,raster:st,"raster-dem":it,geojson:Rt,video:se,image:Q,canvas:ue};function je(d,t){const s=n.create();return n.translate(s,s,[1,1,0]),n.scale(s,s,[.5*d.width,.5*d.height,1]),n.multiply(s,s,d.calculatePosMatrix(t.toUnwrapped()))}function K(d,t,s,a,m,b){const E=function(X,H,le){if(X)for(const ne of X){const ae=H[ne];if(ae&&ae.source===le&&ae.type==="fill-extrusion")return!0}else for(const ne in H){const ae=H[ne];if(ae.source===le&&ae.type==="fill-extrusion")return!0}return!1}(m&&m.layers,t,d.id),D=b.maxPitchScaleFactor(),L=d.tilesIn(a,D,E);L.sort(W);const R=[];for(const X of L)R.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(t,s,d._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,m,b,D,je(d.transform,X.tileID))});const V=function(X){const H={},le={};for(const ne of X){const ae=ne.queryResults,xe=ne.wrappedTileID,Ee=le[xe]=le[xe]||{};for(const Oe in ae){const ce=ae[Oe],Xe=Ee[Oe]=Ee[Oe]||{},Ue=H[Oe]=H[Oe]||[];for(const rt of ce)Xe[rt.featureIndex]||(Xe[rt.featureIndex]=!0,Ue.push(rt))}}return H}(R);for(const X in V)V[X].forEach(H=>{const le=H.feature,ne=d.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ne});return V}function W(d,t){const s=d.tileID,a=t.tileID;return s.overscaledZ-a.overscaledZ||s.canonical.y-a.canonical.y||s.wrap-a.wrap||s.canonical.x-a.canonical.x}class re{constructor(t,s){this.tileID=t,this.uid=n.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<n.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,b){const E={};if(!b)return E;for(const D of m){const L=D.layerIds.map(R=>b.getLayer(R)).filter(Boolean);if(L.length!==0){D.layers=L,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(R=>L.filter(V=>V.id===R)[0]));for(const R of L)E[R.id]=D}}return E}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof n.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof n.SymbolBucket&&b.hasRTLText){this.hasRTLText=!0,n.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(m).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new n.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const m=this.buckets[a];m.uploadPending()&&m.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,a,m,b,E,D,L,R,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:V,transform:L,params:D,queryPadding:this.queryPadding*R},t,s,a):{}}querySourceFeatures(t,s){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const m=a.loadVTLayers(),b=s?s.sourceLayer:"",E=m._geojsonTileLayer||m[b];if(!E)return;const D=n.createFilter(s&&s.filter),{z:L,x:R,y:V}=this.tileID.canonical,X={z:L,x:R,y:V};for(let H=0;H<E.length;H++){const le=E.feature(H);if(D.needGeometry){const xe=n.toEvaluationFeature(le,!0);if(!D.filter(new n.EvaluationParameters(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!D.filter(new n.EvaluationParameters(this.tileID.overscaledZ),le))continue;const ne=a.getId(le,b),ae=new n.GeoJSONFeature(le,L,R,V,ne);ae.tile=X,t.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const a=n.parseCacheControl(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let m=!1;if(this.expirationTime>a)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const b=this.expirationTime-s;b?this.expirationTime=a+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const b=this.buckets[m],E=b.layers[0].sourceLayer||"_geojsonTileLayer",D=a[E],L=t[E];if(!D||!L||Object.keys(L).length===0)continue;b.update(L,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=s&&s.style&&s.style.getLayer(m);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.exported.now()+t}setDependencies(t,s){const a={};for(const m of s)a[m]=!0;this.dependencies[t]=a}hasDependency(t,s){for(const a of t){const m=this.dependencies[a];if(m){for(const b of s)if(m[b])return!0}}return!1}}class ye{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,a){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:s,timeout:void 0};if(a!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},a)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const a=t.wrapped().key,m=s===void 0?0:this.data[a].indexOf(s),b=this.data[a][m];return this.data[a].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(b.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const a in this.data)for(const m of this.data[a])t(m.value)||s.push(m);for(const a of s)this.remove(a.value.tileID,a)}}class Ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,a){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},n.extend(this.stateChanges[t][m],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==m&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const b in this.state[t][m])a[b]||(this.deletedStates[t][m][b]=null)}else for(const b in a)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][b]===null&&delete this.deletedStates[t][m][b]}removeFeatureState(t,s,a){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][a]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(a in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][a]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const a=String(s),m=n.extend({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][s];if(b===null)return{};for(const E in b)delete m[E]}return m}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const a={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),n.extend(this.state[m][E],this.stateChanges[m][E]),b[E]=this.state[m][E];a[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const E in this.state[m])b[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const D of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][D];b[E]=this.state[m][E]}a[m]=a[m]||{},n.extend(a[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const m in t)t[m].setFeatureState(a,s)}}class be extends n.Evented{constructor(t,s,a){super(),this.id=t,this.dispatcher=a,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(m,b,E,D){const L=new de[b.type](m,b,E,D);if(L.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${L.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],L),L}(t,s,a,this),this._tiles={},this._cache=new ye(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ae}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new n.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const a=this._tiles[s];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Be).map(t=>t.key)}getRenderableIds(t){const s=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&s.push(this._tiles[a]);return t?s.sort((a,m)=>{const b=a.tileID,E=m.tileID,D=new n.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),L=new n.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||L.y-D.y||L.x-D.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(Be).map(a=>a.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=s),this._loadTile(a,this._tileLoaded.bind(this,a,t,s)))}_tileLoaded(t,s,a,m){if(m)return t.state="errored",void(m.status!==404?this._source.fire(new n.ErrorEvent(m,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=n.exported.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new n.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const b=s[m];if(t.neighboringTiles&&t.neighboringTiles[b]){const E=this.getTileByID(b);a(t,E),a(E,t)}}function a(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=b.tileID.canonical.x-m.tileID.canonical.x;const D=b.tileID.canonical.y-m.tileID.canonical.y,L=Math.pow(2,m.tileID.canonical.z),R=b.tileID.key;E===0&&D===0||Math.abs(D)>1||(Math.abs(E)>1&&(Math.abs(E+L)===1?E+=L:Math.abs(E-L)===1&&(E-=L)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,E,D),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,a,m){for(const b in this._tiles){let E=this._tiles[b];if(m[b]||!E.hasData()||E.tileID.overscaledZ<=s||E.tileID.overscaledZ>a)continue;let D=E.tileID;for(;E&&E.tileID.overscaledZ>s+1;){const R=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[R.key],E&&E.hasData()&&(D=R)}let L=D;for(;L.overscaledZ>s;)if(L=L.scaledTo(L.overscaledZ-1),t[L.key]){m[D.key]=D;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=s?a:null}for(let a=t.overscaledZ-1;a>=s;a--){const m=t.scaledTo(a),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(s*a*5),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const a={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),a[b.tileID.key]=b}this._tiles=a;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new n.OverscaledTileID(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(a=a.filter(R=>this._source.hasTile(R)))):a=[];const m=t.coveringZoomLevel(this._source),b=Math.max(m-be.maxOverzooming,this._source.minzoom),E=Math.max(m+be.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const V of a)if(V.canonical.z>this._source.minzoom){const X=V.scaledTo(V.canonical.z-1);R[X.key]=X;const H=V.scaledTo(Math.max(this._source.minzoom,Math.min(V.canonical.z,5)));R[H.key]=H}a=a.concat(Object.values(R))}const D=this._updateRetainedTiles(a,m);if(Ze(this._source.type)){const R={},V={},X=Object.keys(D);for(const H of X){const le=D[H],ne=this._tiles[H];if(!ne||ne.fadeEndTime&&ne.fadeEndTime<=n.exported.now())continue;const ae=this.findLoadedParent(le,b);ae&&(this._addTile(ae.tileID),R[ae.tileID.key]=ae.tileID),V[H]=le}this._retainLoadedChildren(V,m,E,D);for(const H in R)D[H]||(this._coveredTiles[H]=!0,D[H]=R[H]);if(s){const H={},le={};for(const ne of a)this._tiles[ne.key].hasData()?H[ne.key]=ne:le[ne.key]=ne;for(const ne in le){const ae=le[ne].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(H[ae[0].key]=D[ae[0].key]=ae[0],H[ae[1].key]=D[ae[1].key]=ae[1],H[ae[2].key]=D[ae[2].key]=ae[2],H[ae[3].key]=D[ae[3].key]=ae[3],delete le[ne])}for(const ne in le){const ae=this.findLoadedParent(le[ne],this._source.minzoom);if(ae){H[ae.tileID.key]=D[ae.tileID.key]=ae.tileID;for(const xe in H)H[xe].isChildOf(ae.tileID)&&delete H[xe]}}for(const ne in this._tiles)H[ne]||(this._coveredTiles[ne]=!0)}}for(const R in D)this._tiles[R].clearFadeHold();const L=n.keysDifference(this._tiles,D);for(const R of L){const V=this._tiles[R];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const a={},m={},b=Math.max(s-be.maxOverzooming,this._source.minzoom),E=Math.max(s+be.maxUnderzooming,this._source.minzoom),D={};for(const L of t){const R=this._addTile(L);a[L.key]=L,R.hasData()||s<this._source.maxzoom&&(D[L.key]=L)}this._retainLoadedChildren(D,s,E,a);for(const L of t){let R=this._tiles[L.key];if(R.hasData())continue;if(s+1>this._source.maxzoom){const X=L.children(this._source.maxzoom)[0],H=this.getTile(X);if(H&&H.hasData()){a[X.key]=X;continue}}else{const X=L.children(this._source.maxzoom);if(a[X[0].key]&&a[X[1].key]&&a[X[2].key]&&a[X[3].key])continue}let V=R.wasRequested();for(let X=L.overscaledZ-1;X>=b;--X){const H=L.scaledTo(X);if(m[H.key]||(m[H.key]=!0,R=this.getTile(H),!R&&V&&(R=this._addTile(H)),R&&(a[H.key]=H,V=R.wasRequested(),R.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let a,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){a=this._loadedParentTiles[m.key];break}s.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(a=this._getLoadedTile(b),a)break;m=b}for(const b of s)this._loadedParentTiles[b]=a}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const a=s;return s||(s=new re(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,a||this._source.fire(new n.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=s.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,a){const m=[],b=this.transform;if(!b)return m;const E=a?b.getCameraQueryGeometry(t):t,D=t.map(ne=>b.pointCoordinate(ne,this.terrain)),L=E.map(ne=>b.pointCoordinate(ne,this.terrain)),R=this.getIds();let V=1/0,X=1/0,H=-1/0,le=-1/0;for(const ne of L)V=Math.min(V,ne.x),X=Math.min(X,ne.y),H=Math.max(H,ne.x),le=Math.max(le,ne.y);for(let ne=0;ne<R.length;ne++){const ae=this._tiles[R[ne]];if(ae.holdingForFade())continue;const xe=ae.tileID,Ee=Math.pow(2,b.zoom-ae.tileID.overscaledZ),Oe=s*ae.queryPadding*n.EXTENT/ae.tileSize/Ee,ce=[xe.getTilePoint(new n.MercatorCoordinate(V,X)),xe.getTilePoint(new n.MercatorCoordinate(H,le))];if(ce[0].x-Oe<n.EXTENT&&ce[0].y-Oe<n.EXTENT&&ce[1].x+Oe>=0&&ce[1].y+Oe>=0){const Xe=D.map(rt=>xe.getTilePoint(rt)),Ue=L.map(rt=>xe.getTilePoint(rt));m.push({tile:ae,tileID:xe,queryGeometry:Xe,cameraQueryGeometry:Ue,scale:Ee})}}return m}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of s)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Ze(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=n.exported.now())return!0}return!1}setFeatureState(t,s,a){this._state.updateState(t=t||"_geojsonTileLayer",s,a)}removeFeatureState(t,s,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,a)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,a){const m=this._tiles[t];m&&m.setDependencies(s,a)}reloadTilesForDependencies(t,s){for(const a in this._tiles)this._tiles[a].hasDependency(t,s)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,s))}}function Be(d,t){const s=Math.abs(2*d.wrap)-+(d.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||a-s||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Ze(d){return d==="raster"||d==="image"||d==="video"}be.maxOverzooming=10,be.maxUnderzooming=3;const nt="mapboxgl_preloaded_worker_pool";class Re{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Re.workerCount;)this.workers.push(new Worker(no.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nt]}numActive(){return Object.keys(this.active).length}}const we=Math.floor(n.exported.hardwareConcurrency/2);let Le;function Ke(){return Le||(Le=new Re),Le}function $e(d,t){const s={};for(const a in d)a!=="ref"&&(s[a]=d[a]);return n.refProperties.forEach(a=>{a in t&&(s[a]=t[a])}),s}function ut(d){d=d.slice();const t=Object.create(null);for(let s=0;s<d.length;s++)t[d[s].id]=d[s];for(let s=0;s<d.length;s++)"ref"in d[s]&&(d[s]=$e(d[s],t[d[s].ref]));return d}Re.workerCount=Math.max(Math.min(we,6),1);const ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ht(d,t,s){s.push({command:ct.addSource,args:[d,t[d]]})}function Zt(d,t,s){t.push({command:ct.removeSource,args:[d]}),s[d]=!0}function Je(d,t,s,a){Zt(d,s,a),Ht(d,t,s)}function Gt(d,t,s){let a;for(a in d[s])if(Object.prototype.hasOwnProperty.call(d[s],a)&&a!=="data"&&!h(d[s][a],t[s][a]))return!1;for(a in t[s])if(Object.prototype.hasOwnProperty.call(t[s],a)&&a!=="data"&&!h(d[s][a],t[s][a]))return!1;return!0}function Qt(d,t,s,a,m,b){let E;for(E in t=t||{},d=d||{})Object.prototype.hasOwnProperty.call(d,E)&&(h(d[E],t[E])||s.push({command:b,args:[a,E,t[E],m]}));for(E in t)Object.prototype.hasOwnProperty.call(t,E)&&!Object.prototype.hasOwnProperty.call(d,E)&&(h(d[E],t[E])||s.push({command:b,args:[a,E,t[E],m]}))}function mi(d){return d.id}function Di(d,t){return d[t.id]=t,d}class wi{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.clamp(t,0,1);let s=1,a=this._distances[s];const m=t*this.paddedLength+this.padding;for(;a<m&&s<this._distances.length;)a=this._distances[++s];const b=s-1,E=this._distances[b],D=a-E,L=D>0?(m-E)/D:0;return this.points[b].mult(1-L).add(this.points[s].mult(L))}}function Ge(d,t){let s=!0;return d==="always"||d!=="never"&&t!=="never"||(s=!1),s}class vt{constructor(t,s,a){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(s/a);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,a,m,b){this._forEachCell(s,a,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(t,s,a,m){this._forEachCell(s-m,a-m,s+m,a+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(a),this.circles.push(m)}_insertBoxCell(t,s,a,m,b,E){this.boxCells[b].push(E)}_insertCircleCell(t,s,a,m,b,E){this.circleCells[b].push(E)}_query(t,s,a,m,b,E,D){if(a<0||t>this.width||m<0||s>this.height)return[];const L=[];if(t<=0&&s<=0&&this.width<=a&&this.height<=m){if(b)return[{key:null,x1:t,y1:s,x2:a,y2:m}];for(let R=0;R<this.boxKeys.length;R++)L.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const V=this.circles[3*R],X=this.circles[3*R+1],H=this.circles[3*R+2];L.push({key:this.circleKeys[R],x1:V-H,y1:X-H,x2:V+H,y2:X+H})}}else this._forEachCell(t,s,a,m,this._queryCell,L,{hitTest:b,overlapMode:E,seenUids:{box:{},circle:{}}},D);return L}query(t,s,a,m){return this._query(t,s,a,m,!1,null)}hitTest(t,s,a,m,b,E){return this._query(t,s,a,m,!0,b,E).length>0}hitTestCircle(t,s,a,m,b){const E=t-a,D=t+a,L=s-a,R=s+a;if(D<0||E>this.width||R<0||L>this.height)return!1;const V=[];return this._forEachCell(E,L,D,R,this._queryCellCircle,V,{hitTest:!0,overlapMode:m,circle:{x:t,y:s,radius:a},seenUids:{box:{},circle:{}}},b),V.length>0}_queryCell(t,s,a,m,b,E,D,L){const{seenUids:R,hitTest:V,overlapMode:X}=D,H=this.boxCells[b];if(H!==null){const ne=this.bboxes;for(const ae of H)if(!R.box[ae]){R.box[ae]=!0;const xe=4*ae,Ee=this.boxKeys[ae];if(t<=ne[xe+2]&&s<=ne[xe+3]&&a>=ne[xe+0]&&m>=ne[xe+1]&&(!L||L(Ee))&&(!V||!Ge(X,Ee.overlapMode))&&(E.push({key:Ee,x1:ne[xe],y1:ne[xe+1],x2:ne[xe+2],y2:ne[xe+3]}),V))return!0}}const le=this.circleCells[b];if(le!==null){const ne=this.circles;for(const ae of le)if(!R.circle[ae]){R.circle[ae]=!0;const xe=3*ae,Ee=this.circleKeys[ae];if(this._circleAndRectCollide(ne[xe],ne[xe+1],ne[xe+2],t,s,a,m)&&(!L||L(Ee))&&(!V||!Ge(X,Ee.overlapMode))){const Oe=ne[xe],ce=ne[xe+1],Xe=ne[xe+2];if(E.push({key:Ee,x1:Oe-Xe,y1:ce-Xe,x2:Oe+Xe,y2:ce+Xe}),V)return!0}}}return!1}_queryCellCircle(t,s,a,m,b,E,D,L){const{circle:R,seenUids:V,overlapMode:X}=D,H=this.boxCells[b];if(H!==null){const ne=this.bboxes;for(const ae of H)if(!V.box[ae]){V.box[ae]=!0;const xe=4*ae,Ee=this.boxKeys[ae];if(this._circleAndRectCollide(R.x,R.y,R.radius,ne[xe+0],ne[xe+1],ne[xe+2],ne[xe+3])&&(!L||L(Ee))&&!Ge(X,Ee.overlapMode))return E.push(!0),!0}}const le=this.circleCells[b];if(le!==null){const ne=this.circles;for(const ae of le)if(!V.circle[ae]){V.circle[ae]=!0;const xe=3*ae,Ee=this.circleKeys[ae];if(this._circlesCollide(ne[xe],ne[xe+1],ne[xe+2],R.x,R.y,R.radius)&&(!L||L(Ee))&&!Ge(X,Ee.overlapMode))return E.push(!0),!0}}}_forEachCell(t,s,a,m,b,E,D,L){const R=this._convertToXCellCoord(t),V=this._convertToYCellCoord(s),X=this._convertToXCellCoord(a),H=this._convertToYCellCoord(m);for(let le=R;le<=X;le++)for(let ne=V;ne<=H;ne++)if(b.call(this,t,s,a,m,this.xCellCount*ne+le,E,D,L))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,a,m,b,E){const D=m-t,L=b-s,R=a+E;return R*R>D*D+L*L}_circleAndRectCollide(t,s,a,m,b,E,D){const L=(E-m)/2,R=Math.abs(t-(m+L));if(R>L+a)return!1;const V=(D-b)/2,X=Math.abs(s-(b+V));if(X>V+a)return!1;if(R<=L||X<=V)return!0;const H=R-L,le=X-V;return H*H+le*le<=a*a}}function Ri(d,t,s,a,m){const b=n.create();return t?(n.scale(b,b,[1/m,1/m,1]),s||n.rotateZ(b,b,a.angle)):n.multiply(b,a.labelPlaneMatrix,d),b}function Ji(d,t,s,a,m){if(t){const b=n.clone(d);return n.scale(b,b,[m,m,1]),s||n.rotateZ(b,b,-a.angle),b}return a.glCoordMatrix}function si(d,t,s){let a;s?(a=[d.x,d.y,s(d.x,d.y),1],n.transformMat4(a,a,t)):(a=[d.x,d.y,0,1],Oi(a,a,t));const m=a[3];return{point:new n.pointGeometry(a[0]/m,a[1]/m),signedDistanceFromCamera:m}}function Ei(d,t){return .5+d/t*.5}function dr(d,t){const s=d[0]/d[3],a=d[1]/d[3];return s>=-t[0]&&s<=t[0]&&a>=-t[1]&&a<=t[1]}function fr(d,t,s,a,m,b,E,D,L,R){const V=a?d.textSizeData:d.iconSizeData,X=n.evaluateSizeForZoom(V,s.transform.zoom),H=[256/s.width*2+1,256/s.height*2+1],le=a?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;le.clear();const ne=d.lineVertexArray,ae=a?d.text.placedSymbolArray:d.icon.placedSymbolArray,xe=s.transform.width/s.transform.height;let Ee=!1;for(let Oe=0;Oe<ae.length;Oe++){const ce=ae.get(Oe);if(ce.hidden||ce.writingMode===n.WritingMode.vertical&&!Ee){yi(ce.numGlyphs,le);continue}let Xe;if(Ee=!1,R?(Xe=[ce.anchorX,ce.anchorY,R(ce.anchorX,ce.anchorY),1],n.transformMat4(Xe,Xe,t)):(Xe=[ce.anchorX,ce.anchorY,0,1],Oi(Xe,Xe,t)),!dr(Xe,H)){yi(ce.numGlyphs,le);continue}const Ue=Ei(s.transform.cameraToCenterDistance,Xe[3]),rt=n.evaluateSizeForFeature(V,X,ce),ot=E?rt/Ue:rt*Ue,St=new n.pointGeometry(ce.anchorX,ce.anchorY),Qe=si(St,m,R).point,Xt={},Lt=bi(ce,ot,!1,D,t,m,b,d.glyphOffsetArray,ne,le,Qe,St,Xt,xe,L,R);Ee=Lt.useVertical,(Lt.notEnoughRoom||Ee||Lt.needsFlipping&&bi(ce,ot,!0,D,t,m,b,d.glyphOffsetArray,ne,le,Qe,St,Xt,xe,L,R).notEnoughRoom)&&yi(ce.numGlyphs,le)}a?d.text.dynamicLayoutVertexBuffer.updateData(le):d.icon.dynamicLayoutVertexBuffer.updateData(le)}function Qi(d,t,s,a,m,b,E,D,L,R,V,X,H){const le=D.glyphStartIndex+D.numGlyphs,ne=D.lineStartIndex,ae=D.lineStartIndex+D.lineLength,xe=t.getoffsetX(D.glyphStartIndex),Ee=t.getoffsetX(le-1),Oe=br(d*xe,s,a,m,b,E,D.segment,ne,ae,L,R,V,X,H);if(!Oe)return null;const ce=br(d*Ee,s,a,m,b,E,D.segment,ne,ae,L,R,V,X,H);return ce?{first:Oe,last:ce}:null}function at(d,t,s,a){return d===n.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*a?{useVertical:!0}:(d===n.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function bi(d,t,s,a,m,b,E,D,L,R,V,X,H,le,ne,ae){const xe=t/24,Ee=d.lineOffsetX*xe,Oe=d.lineOffsetY*xe;let ce;if(d.numGlyphs>1){const Xe=d.glyphStartIndex+d.numGlyphs,Ue=d.lineStartIndex,rt=d.lineStartIndex+d.lineLength,ot=Qi(xe,D,Ee,Oe,s,V,X,d,L,b,H,ne,ae);if(!ot)return{notEnoughRoom:!0};const St=si(ot.first.point,E,ae).point,Qe=si(ot.last.point,E,ae).point;if(a&&!s){const Xt=at(d.writingMode,St,Qe,le);if(Xt)return Xt}ce=[ot.first];for(let Xt=d.glyphStartIndex+1;Xt<Xe-1;Xt++)ce.push(br(xe*D.getoffsetX(Xt),Ee,Oe,s,V,X,d.segment,Ue,rt,L,b,H,ne,ae));ce.push(ot.last)}else{if(a&&!s){const Ue=si(X,m,ae).point,rt=d.lineStartIndex+d.segment+1,ot=new n.pointGeometry(L.getx(rt),L.gety(rt)),St=si(ot,m,ae),Qe=St.signedDistanceFromCamera>0?St.point:xi(X,ot,Ue,1,m,ae),Xt=at(d.writingMode,Ue,Qe,le);if(Xt)return Xt}const Xe=br(xe*D.getoffsetX(d.glyphStartIndex),Ee,Oe,s,V,X,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,L,b,H,ne,ae);if(!Xe)return{notEnoughRoom:!0};ce=[Xe]}for(const Xe of ce)n.addDynamicAttributes(R,Xe.point,Xe.angle);return{}}function xi(d,t,s,a,m,b){const E=si(d.add(d.sub(t)._unit()),m,b).point,D=s.sub(E);return s.add(D._mult(a/D.mag()))}function br(d,t,s,a,m,b,E,D,L,R,V,X,H,le){const ne=a?d-t:d+t;let ae=ne>0?1:-1,xe=0;a&&(ae*=-1,xe=Math.PI),ae<0&&(xe+=Math.PI);let Ee=ae>0?D+E:D+E+1,Oe=m,ce=m,Xe=0,Ue=0;const rt=Math.abs(ne),ot=[];for(;Xe+Ue<=rt;){if(Ee+=ae,Ee<D||Ee>=L)return null;if(ce=Oe,ot.push(Oe),Oe=X[Ee],Oe===void 0){const Kt=new n.pointGeometry(R.getx(Ee),R.gety(Ee)),Ci=si(Kt,V,le);if(Ci.signedDistanceFromCamera>0)Oe=X[Ee]=Ci.point;else{const Pi=Ee-ae;Oe=xi(Xe===0?b:new n.pointGeometry(R.getx(Pi),R.gety(Pi)),Kt,ce,rt-Xe+1,V,le)}}Xe+=Ue,Ue=ce.dist(Oe)}const St=(rt-Xe)/Ue,Qe=Oe.sub(ce),Xt=Qe.mult(St)._add(ce);Xt._add(Qe._unit()._perp()._mult(s*ae));const Lt=xe+Math.atan2(Oe.y-ce.y,Oe.x-ce.x);return ot.push(Xt),{point:Xt,angle:H?Lt:0,path:ot}}const tn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function yi(d,t){for(let s=0;s<d;s++){const a=t.length;t.resize(a+4),t.float32.set(tn,3*a)}}function Oi(d,t,s){const a=t[0],m=t[1];return d[0]=s[0]*a+s[4]*m+s[12],d[1]=s[1]*a+s[5]*m+s[13],d[3]=s[3]*a+s[7]*m+s[15],d}const wr=100;class Vr{constructor(t,s=new vt(t.width+200,t.height+200,25),a=new vt(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wr,this.screenBottomBoundary=t.height+wr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,a,m,b,E){const D=this.projectAndGetPerspectiveRatio(m,t.anchorPointX,t.anchorPointY,E),L=a*D.perspectiveRatio,R=t.x1*L+D.point.x,V=t.y1*L+D.point.y,X=t.x2*L+D.point.x,H=t.y2*L+D.point.y;return!this.isInsideGrid(R,V,X,H)||s!=="always"&&this.grid.hitTest(R,V,X,H,s,b)||D.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[R,V,X,H],offscreen:this.isOffscreen(R,V,X,H)}}placeCollisionCircles(t,s,a,m,b,E,D,L,R,V,X,H,le,ne){const ae=[],xe=new n.pointGeometry(s.anchorX,s.anchorY),Ee=si(xe,E,ne),Oe=Ei(this.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),ce=(V?b/Oe:b*Oe)/n.ONE_EM,Xe=si(xe,D,ne).point,Ue=Qi(ce,m,s.lineOffsetX*ce,s.lineOffsetY*ce,!1,Xe,xe,s,a,D,{},!1,ne);let rt=!1,ot=!1,St=!0;if(Ue){const Qe=.5*H*Oe+le,Xt=new n.pointGeometry(-100,-100),Lt=new n.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Kt=new wi,Ci=Ue.first,Pi=Ue.last;let hi=[];for(let Ni=Ci.path.length-1;Ni>=1;Ni--)hi.push(Ci.path[Ni]);for(let Ni=1;Ni<Pi.path.length;Ni++)hi.push(Pi.path[Ni]);const ir=2.5*Qe;if(L){const Ni=hi.map(Gi=>si(Gi,L,ne));hi=Ni.some(Gi=>Gi.signedDistanceFromCamera<=0)?[]:Ni.map(Gi=>Gi.point)}let rr=[];if(hi.length>0){const Ni=hi[0].clone(),Gi=hi[0].clone();for(let nr=1;nr<hi.length;nr++)Ni.x=Math.min(Ni.x,hi[nr].x),Ni.y=Math.min(Ni.y,hi[nr].y),Gi.x=Math.max(Gi.x,hi[nr].x),Gi.y=Math.max(Gi.y,hi[nr].y);rr=Ni.x>=Xt.x&&Gi.x<=Lt.x&&Ni.y>=Xt.y&&Gi.y<=Lt.y?[hi]:Gi.x<Xt.x||Ni.x>Lt.x||Gi.y<Xt.y||Ni.y>Lt.y?[]:n.clipLine([hi],Xt.x,Xt.y,Lt.x,Lt.y)}for(const Ni of rr){Kt.reset(Ni,.25*Qe);let Gi=0;Gi=Kt.length<=.5*Qe?1:Math.ceil(Kt.paddedLength/ir)+1;for(let nr=0;nr<Gi;nr++){const Wr=nr/Math.max(Gi-1,1),gs=Kt.lerp(Wr),ts=gs.x+wr,_s=gs.y+wr;ae.push(ts,_s,Qe,0);const Xs=ts-Qe,Nn=_s-Qe,Cn=ts+Qe,Ts=_s+Qe;if(St=St&&this.isOffscreen(Xs,Nn,Cn,Ts),ot=ot||this.isInsideGrid(Xs,Nn,Cn,Ts),t!=="always"&&this.grid.hitTestCircle(ts,_s,Qe,t,X)&&(rt=!0,!R))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!R&&rt||!ot||Oe<this.perspectiveRatioCutoff?[]:ae,offscreen:St,collisionDetected:rt}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let a=1/0,m=1/0,b=-1/0,E=-1/0;for(const V of t){const X=new n.pointGeometry(V.x+wr,V.y+wr);a=Math.min(a,X.x),m=Math.min(m,X.y),b=Math.max(b,X.x),E=Math.max(E,X.y),s.push(X)}const D=this.grid.query(a,m,b,E).concat(this.ignoredGrid.query(a,m,b,E)),L={},R={};for(const V of D){const X=V.key;if(L[X.bucketInstanceId]===void 0&&(L[X.bucketInstanceId]={}),L[X.bucketInstanceId][X.featureIndex])continue;const H=[new n.pointGeometry(V.x1,V.y1),new n.pointGeometry(V.x2,V.y1),new n.pointGeometry(V.x2,V.y2),new n.pointGeometry(V.x1,V.y2)];n.polygonIntersectsPolygon(s,H)&&(L[X.bucketInstanceId][X.featureIndex]=!0,R[X.bucketInstanceId]===void 0&&(R[X.bucketInstanceId]=[]),R[X.bucketInstanceId].push(X.featureIndex))}return R}insertCollisionBox(t,s,a,m,b,E){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,a,m,b,E){const D=a?this.ignoredGrid:this.grid,L={bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:s};for(let R=0;R<t.length;R+=4)D.insertCircle(L,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,s,a,m){let b;return m?(b=[s,a,m(s,a),1],n.transformMat4(b,b,t)):(b=[s,a,0,1],Oi(b,b,t)),{point:new n.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+wr,(-b[1]/b[3]+1)/2*this.transform.height+wr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(t,s,a,m){return a<wr||t>=this.screenRightBoundary||m<wr||s>this.screenBottomBoundary}isInsideGrid(t,s,a,m){return a>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=n.identity([]);return n.translate(t,t,[-100,-100,0]),t}}function lr(d,t,s){return t*(n.EXTENT/(d.tileSize*Math.pow(2,s-d.tileID.overscaledZ)))}class Dr{constructor(t,s,a,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Xi{constructor(t,s,a,m,b){this.text=new Dr(t?t.text:null,s,a,b),this.icon=new Dr(t?t.icon:null,s,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ls{constructor(t,s,a){this.text=t,this.icon=s,this.skipFade=a}}class Zr{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class cs{constructor(t,s,a,m,b){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=a,this.bucketIndex=m,this.tileID=b}}class Wn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:a=>a.collisionGroupID===s}}return this.collisionGroups[t]}}function $n(d,t,s,a,m){const{horizontalAlign:b,verticalAlign:E}=n.getAnchorAlignment(d),D=-(b-.5)*t,L=-(E-.5)*s,R=n.evaluateVariableOffset(d,a);return new n.pointGeometry(D+R[0]*m,L+R[1]*m)}function qn(d,t,s,a,m,b){const{x1:E,x2:D,y1:L,y2:R,anchorPointX:V,anchorPointY:X}=d,H=new n.pointGeometry(t,s);return a&&H._rotate(m?b:-b),{x1:E+H.x,y1:L+H.y,x2:D+H.x,y2:R+H.y,anchorPointX:V,anchorPointY:X}}class ie{constructor(t,s,a,m,b){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Vr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Wn(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,a,m){const b=a.getBucket(s),E=a.latestFeatureIndex;if(!b||!E||s.id!==b.layerIds[0])return;const D=a.collisionBoxArray,L=b.layers[0].layout,R=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),V=a.tileSize/n.EXTENT,X=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),H=L.get("text-pitch-alignment")==="map",le=L.get("text-rotation-alignment")==="map",ne=lr(a,1,this.transform.zoom),ae=Ri(X,H,le,this.transform,ne);let xe=null;if(H){const Oe=Ji(X,H,le,this.transform,ne);xe=n.multiply([],this.transform.labelPlaneMatrix,Oe)}this.retainedQueryData[b.bucketInstanceId]=new cs(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,a.tileID);const Ee={bucket:b,layout:L,posMatrix:X,textLabelPlaneMatrix:ae,labelToScreenMatrix:xe,scale:R,textPixelRatio:V,holdingForFade:a.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const Oe of b.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:Xe,symbolInstanceEnd:Ue}=Oe;t.push({sortKey:ce,symbolInstanceStart:Xe,symbolInstanceEnd:Ue,parameters:Ee})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(t,s,a,m,b,E,D,L,R,V,X,H,le,ne,ae,xe){const Ee=[H.textOffset0,H.textOffset1],Oe=$n(t,a,m,Ee,b),ce=this.collisionIndex.placeCollisionBox(qn(s,Oe.x,Oe.y,E,D,this.transform.angle),X,L,R,V.predicate,xe);if((!ae||this.collisionIndex.placeCollisionBox(qn(ae,Oe.x,Oe.y,E,D,this.transform.angle),X,L,R,V.predicate,xe).box.length!==0)&&ce.box.length>0){let Xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Ee,width:a,height:m,anchor:t,textBoxScale:b,prevAnchor:Xe},this.markUsedJustification(le,t,H,ne),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ne,H),this.placedOrientations[H.crossTileID]=ne),{shift:Oe,placedGlyphBoxes:ce}}}placeLayerBucketPart(t,s,a){const{bucket:m,layout:b,posMatrix:E,textLabelPlaneMatrix:D,labelToScreenMatrix:L,textPixelRatio:R,holdingForFade:V,collisionBoxArray:X,partiallyEvaluatedTextSize:H,collisionGroup:le}=t.parameters,ne=b.get("text-optional"),ae=b.get("icon-optional"),xe=n.getOverlapMode(b,"text-overlap","text-allow-overlap"),Ee=xe==="always",Oe=n.getOverlapMode(b,"icon-overlap","icon-allow-overlap"),ce=Oe==="always",Xe=b.get("text-rotation-alignment")==="map",Ue=b.get("text-pitch-alignment")==="map",rt=b.get("icon-text-fit")!=="none",ot=b.get("symbol-z-order")==="viewport-y",St=Ee&&(ce||!m.hasIconData()||ae),Qe=ce&&(Ee||!m.hasTextData()||ne);!m.collisionArrays&&X&&m.deserializeCollisionBoxes(X);const Xt=(Lt,Kt)=>{if(s[Lt.crossTileID])return;if(V)return void(this.placements[Lt.crossTileID]=new ls(!1,!1,!1));let Ci=!1,Pi=!1,hi=!0,ir=null,rr={box:null,offscreen:null},Ni={box:null,offscreen:null},Gi=null,nr=null,Wr=null,gs=0,ts=0,_s=0;Kt.textFeatureIndex?gs=Kt.textFeatureIndex:Lt.useRuntimeCollisionCircles&&(gs=Lt.featureIndex),Kt.verticalTextFeatureIndex&&(ts=Kt.verticalTextFeatureIndex);const Xs=this.retainedQueryData[m.bucketInstanceId].tileID,Nn=this.terrain?(Rr,ki)=>this.terrain.getElevation(Xs,Rr,ki):null;for(const Rr of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const ki=Kt[Rr];ki&&(ki.elevation=Nn?Nn(ki.anchorPointX,ki.anchorPointY):0)}const Cn=Kt.textBox;if(Cn){const Rr=Hi=>{let $r=n.WritingMode.horizontal;if(m.allowVerticalPlacement&&!Hi&&this.prevPlacement){const qr=this.prevPlacement.placedOrientations[Lt.crossTileID];qr&&(this.placedOrientations[Lt.crossTileID]=qr,$r=qr,this.markUsedOrientation(m,$r,Lt))}return $r},ki=(Hi,$r)=>{if(m.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&Kt.verticalTextBox){for(const qr of m.writingModes)if(qr===n.WritingMode.vertical?(rr=$r(),Ni=rr):rr=Hi(),rr&&rr.box&&rr.box.length)break}else rr=Hi()};if(b.get("text-variable-anchor")){let Hi=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt.crossTileID]){const vr=this.prevPlacement.variableOffsets[Lt.crossTileID];Hi.indexOf(vr.anchor)>0&&(Hi=Hi.filter(Gn=>Gn!==vr.anchor),Hi.unshift(vr.anchor))}const $r=(vr,Gn,so)=>{const Ga=vr.x2-vr.x1,Ao=vr.y2-vr.y1,Pl=Lt.textBoxScale,Xa=rt&&Oe==="never"?Gn:null;let Ws={box:[],offscreen:!1};const oo=xe!=="never"?2*Hi.length:Hi.length;for(let ao=0;ao<oo;++ao){const ya=this.attemptAnchorPlacement(Hi[ao%Hi.length],vr,Ga,Ao,Pl,Xe,Ue,R,E,le,ao>=Hi.length?xe:"never",Lt,m,so,Xa,Nn);if(ya&&(Ws=ya.placedGlyphBoxes,Ws&&Ws.box&&Ws.box.length)){Ci=!0,ir=ya.shift;break}}return Ws};ki(()=>$r(Cn,Kt.iconBox,n.WritingMode.horizontal),()=>{const vr=Kt.verticalTextBox;return m.allowVerticalPlacement&&!(rr&&rr.box&&rr.box.length)&&Lt.numVerticalGlyphVertices>0&&vr?$r(vr,Kt.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null}}),rr&&(Ci=rr.box,hi=rr.offscreen);const qr=Rr(rr&&rr.box);if(!Ci&&this.prevPlacement){const vr=this.prevPlacement.variableOffsets[Lt.crossTileID];vr&&(this.variableOffsets[Lt.crossTileID]=vr,this.markUsedJustification(m,vr.anchor,Lt,qr))}}else{const Hi=($r,qr)=>{const vr=this.collisionIndex.placeCollisionBox($r,xe,R,E,le.predicate,Nn);return vr&&vr.box&&vr.box.length&&(this.markUsedOrientation(m,qr,Lt),this.placedOrientations[Lt.crossTileID]=qr),vr};ki(()=>Hi(Cn,n.WritingMode.horizontal),()=>{const $r=Kt.verticalTextBox;return m.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&$r?Hi($r,n.WritingMode.vertical):{box:null,offscreen:null}}),Rr(rr&&rr.box&&rr.box.length)}}if(Gi=rr,Ci=Gi&&Gi.box&&Gi.box.length>0,hi=Gi&&Gi.offscreen,Lt.useRuntimeCollisionCircles){const Rr=m.text.placedSymbolArray.get(Lt.centerJustifiedTextSymbolIndex),ki=n.evaluateSizeForFeature(m.textSizeData,H,Rr),Hi=b.get("text-padding");nr=this.collisionIndex.placeCollisionCircles(xe,Rr,m.lineVertexArray,m.glyphOffsetArray,ki,E,D,L,a,Ue,le.predicate,Lt.collisionCircleDiameter,Hi,Nn),nr.circles.length&&nr.collisionDetected&&!a&&n.warnOnce("Collisions detected, but collision boxes are not shown"),Ci=Ee||nr.circles.length>0&&!nr.collisionDetected,hi=hi&&nr.offscreen}if(Kt.iconFeatureIndex&&(_s=Kt.iconFeatureIndex),Kt.iconBox){const Rr=ki=>{const Hi=rt&&ir?qn(ki,ir.x,ir.y,Xe,Ue,this.transform.angle):ki;return this.collisionIndex.placeCollisionBox(Hi,Oe,R,E,le.predicate,Nn)};Ni&&Ni.box&&Ni.box.length&&Kt.verticalIconBox?(Wr=Rr(Kt.verticalIconBox),Pi=Wr.box.length>0):(Wr=Rr(Kt.iconBox),Pi=Wr.box.length>0),hi=hi&&Wr.offscreen}const Ts=ne||Lt.numHorizontalGlyphVertices===0&&Lt.numVerticalGlyphVertices===0,_a=ae||Lt.numIconVertices===0;if(Ts||_a?_a?Ts||(Pi=Pi&&Ci):Ci=Pi&&Ci:Pi=Ci=Pi&&Ci,Ci&&Gi&&Gi.box&&this.collisionIndex.insertCollisionBox(Gi.box,xe,b.get("text-ignore-placement"),m.bucketInstanceId,Ni&&Ni.box&&ts?ts:gs,le.ID),Pi&&Wr&&this.collisionIndex.insertCollisionBox(Wr.box,Oe,b.get("icon-ignore-placement"),m.bucketInstanceId,_s,le.ID),nr&&(Ci&&this.collisionIndex.insertCollisionCircles(nr.circles,xe,b.get("text-ignore-placement"),m.bucketInstanceId,gs,le.ID),a)){const Rr=m.bucketInstanceId;let ki=this.collisionCircleArrays[Rr];ki===void 0&&(ki=this.collisionCircleArrays[Rr]=new Zr);for(let Hi=0;Hi<nr.circles.length;Hi+=4)ki.circles.push(nr.circles[Hi+0]),ki.circles.push(nr.circles[Hi+1]),ki.circles.push(nr.circles[Hi+2]),ki.circles.push(nr.collisionDetected?1:0)}if(Lt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Lt.crossTileID]=new ls(Ci||St,Pi||Qe,hi||m.justReloaded),s[Lt.crossTileID]=!0};if(ot){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Lt=m.getSortedSymbolIndexes(this.transform.angle);for(let Kt=Lt.length-1;Kt>=0;--Kt){const Ci=Lt[Kt];Xt(m.symbolInstances.get(Ci),m.collisionArrays[Ci])}}else for(let Lt=t.symbolInstanceStart;Lt<t.symbolInstanceEnd;Lt++)Xt(m.symbolInstances.get(Lt),m.collisionArrays[Lt]);if(a&&m.bucketInstanceId in this.collisionCircleArrays){const Lt=this.collisionCircleArrays[m.bucketInstanceId];n.invert(Lt.invProjMatrix,E),Lt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(t,s,a,m){let b;b=m===n.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(s)];const E=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const D of E)D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=b>=0&&D!==b?0:a.crossTileID)}markUsedOrientation(t,s,a){const m=s===n.WritingMode.horizontal||s===n.WritingMode.horizontalOnly?s:0,b=s===n.WritingMode.vertical?s:0,E=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const D of E)t.text.placedSymbolArray.get(D).placedOrientation=m;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let a=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,b=s?s.opacities:{},E=s?s.variableOffsets:{},D=s?s.placedOrientations:{};for(const L in this.placements){const R=this.placements[L],V=b[L];V?(this.opacities[L]=new Xi(V,m,R.text,R.icon),a=a||R.text!==V.text.placed||R.icon!==V.icon.placed):(this.opacities[L]=new Xi(null,m,R.text,R.icon,R.skipFade),a=a||R.text||R.icon)}for(const L in b){const R=b[L];if(!this.opacities[L]){const V=new Xi(R,m,!1,!1);V.isHidden()||(this.opacities[L]=V,a=a||R.text.placed||R.icon.placed)}}for(const L in E)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=E[L]);for(const L in D)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=D[L]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const a={};for(const m of s){const b=m.getBucket(t);b&&m.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,a,m.collisionBoxArray)}}updateBucketOpacities(t,s,a){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,b=new Xi(null,0,!1,!1,!0),E=m.get("text-allow-overlap"),D=m.get("icon-allow-overlap"),L=m.get("text-variable-anchor"),R=m.get("text-rotation-alignment")==="map",V=m.get("text-pitch-alignment")==="map",X=m.get("icon-text-fit")!=="none",H=new Xi(null,0,E&&(D||!t.hasIconData()||m.get("icon-optional")),D&&(E||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const le=(ne,ae,xe)=>{for(let Ee=0;Ee<ae/4;Ee++)ne.opacityVertexArray.emplaceBack(xe)};for(let ne=0;ne<t.symbolInstances.length;ne++){const ae=t.symbolInstances.get(ne),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Ee,crossTileID:Oe}=ae;let ce=this.opacities[Oe];s[Oe]?ce=b:ce||(ce=H,this.opacities[Oe]=ce),s[Oe]=!0;const Xe=ae.numIconVertices>0,Ue=this.placedOrientations[ae.crossTileID],rt=Ue===n.WritingMode.vertical,ot=Ue===n.WritingMode.horizontal||Ue===n.WritingMode.horizontalOnly;if(xe>0||Ee>0){const St=Ce(ce.text);le(t.text,xe,rt?He:St),le(t.text,Ee,ot?He:St);const Qe=ce.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(Kt=>{Kt>=0&&(t.text.placedSymbolArray.get(Kt).hidden=Qe||rt?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=Qe||ot?1:0);const Xt=this.variableOffsets[ae.crossTileID];Xt&&this.markUsedJustification(t,Xt.anchor,ae,Ue);const Lt=this.placedOrientations[ae.crossTileID];Lt&&(this.markUsedJustification(t,"left",ae,Lt),this.markUsedOrientation(t,Lt,ae))}if(Xe){const St=Ce(ce.icon),Qe=!(X&&ae.verticalPlacedIconSymbolIndex&&rt);ae.placedIconSymbolIndex>=0&&(le(t.icon,ae.numIconVertices,Qe?St:He),t.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=ce.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(le(t.icon,ae.numVerticalIconVertices,Qe?He:St),t.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const St=t.collisionArrays[ne];if(St){let Qe=new n.pointGeometry(0,0);if(St.textBox||St.verticalTextBox){let Lt=!0;if(L){const Kt=this.variableOffsets[Oe];Kt?(Qe=$n(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textBoxScale),R&&Qe._rotate(V?this.transform.angle:-this.transform.angle)):Lt=!1}St.textBox&&B(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Lt||rt,Qe.x,Qe.y),St.verticalTextBox&&B(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Lt||ot,Qe.x,Qe.y)}const Xt=Boolean(!ot&&St.verticalIconBox);St.iconBox&&B(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,Xt,X?Qe.x:0,X?Qe.y:0),St.verticalIconBox&&B(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,!Xt,X?Qe.x:0,X?Qe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ne.invProjMatrix,t.placementViewportMatrix=ne.viewportMatrix,t.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const a=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function B(d,t,s,a,m){d.emplaceBack(t?1:0,s?1:0,a||0,m||0),d.emplaceBack(t?1:0,s?1:0,a||0,m||0),d.emplaceBack(t?1:0,s?1:0,a||0,m||0),d.emplaceBack(t?1:0,s?1:0,a||0,m||0)}const G=Math.pow(2,25),ee=Math.pow(2,24),te=Math.pow(2,17),fe=Math.pow(2,16),Se=Math.pow(2,9),_e=Math.pow(2,8),pe=Math.pow(2,1);function Ce(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,s=Math.floor(127*d.opacity);return s*G+t*ee+s*te+t*fe+s*Se+t*_e+s*pe+t}const He=0;class gt{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,a,m,b){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(E,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((D,L)=>D.sortKey-L.sortKey));this._currentPartIndex<E.length;)if(s.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,b())return!0;return!1}}class Ye{constructor(t,s,a,m,b,E,D,L){this.placement=new ie(t,s,E,D,L),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,s,a){const m=n.exported.now(),b=()=>{const E=n.exported.now()-m;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=s[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=D)&&(!E.maxzoom||E.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new gt(E)),this._inProgressLayer.continuePlacement(a[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ei=512/n.EXTENT/2;class ri{constructor(t,s,a){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let m=0;m<s.length;m++){const b=s.get(m),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,t)})}}getScaledCoordinates(t,s){const a=ei/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*n.EXTENT+t.anchorX)*a),y:Math.floor((s.canonical.y*n.EXTENT+t.anchorY)*a)}}findMatches(t,s,a){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let b=0;b<t.length;b++){const E=t.get(b);if(E.crossTileID)continue;const D=this.indexedSymbolInstances[E.key];if(!D)continue;const L=this.getScaledCoordinates(E,s);for(const R of D)if(Math.abs(R.coord.x-L.x)<=m&&Math.abs(R.coord.y-L.y)<=m&&!a[R.crossTileID]){a[R.crossTileID]=!0,E.crossTileID=R.crossTileID;break}}}}class It{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class di{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const a in this.indexes){const m=this.indexes[a],b={};for(const E in m){const D=m[E];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+s),b[D.tileID.key]=D}this.indexes[a]=b}this.lng=t}addBucket(t,s,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<s.symbolInstances.length;b++)s.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>t.overscaledZ)for(const D in E){const L=E[D];L.tileID.isChildOf(t)&&L.findMatches(s.symbolInstances,t,m)}else{const D=E[t.scaledTo(Number(b)).key];D&&D.findMatches(s.symbolInstances,t,m)}}for(let b=0;b<s.symbolInstances.length;b++){const E=s.symbolInstances.get(b);E.crossTileID||(E.crossTileID=a.generate(),m[E.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ri(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const a in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[a])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let s=!1;for(const a in this.indexes){const m=this.indexes[a];for(const b in m)t[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,m[b]),delete m[b],s=!0)}return s}}class gi{constructor(){this.layerIndexes={},this.crossTileIDs=new It,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,a){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new di);let b=!1;const E={};m.handleWrapJump(a);for(const D of s){const L=D.getBucket(t);L&&t.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(D.tileID,L,this.crossTileIDs)&&(b=!0),E[L.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(t){const s={};t.forEach(a=>{s[a]=!0});for(const a in this.layerIndexes)s[a]||delete this.layerIndexes[a]}}var Li=n.createLayout([{name:"a_pos",type:"Int16",components:2}]);class vi extends n.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(a=>a.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const a of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(a.key),this._tiles[a.key]||(a.posMatrix=new Float64Array(16),n.ortho(a.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),this._tiles[a.key]=new re(a,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((a,m)=>this.renderHistory.indexOf(a)===m).slice(0,this.renderHistorySize);for(const a of this._renderableTilesKeys)s[a]=!0;for(const a of this.renderHistory)s[a]=!0;for(const a in this._tiles)s[a]||(this._tiles[a].clearTextures(t),delete this._tiles[a])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const a of this._renderableTilesKeys){const m=this._tiles[a].tileID;if(m.canonical.equals(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16),n.ortho(b.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),s[a]=b}else if(m.canonical.isChildOf(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const E=m.canonical.z-t.canonical.z,D=m.canonical.x-(m.canonical.x>>E<<E),L=m.canonical.y-(m.canonical.y>>E<<E),R=n.EXTENT>>E;n.ortho(b.posMatrix,0,R,0,R,0,1),n.translate(b.posMatrix,b.posMatrix,[-D*R,-L*R,0]),s[a]=b}else if(t.canonical.isChildOf(m.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const E=t.canonical.z-m.canonical.z,D=t.canonical.x-(t.canonical.x>>E<<E),L=t.canonical.y-(t.canonical.y>>E<<E),R=n.EXTENT>>E;n.ortho(b.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),n.translate(b.posMatrix,b.posMatrix,[D*R,L*R,0]),n.scale(b.posMatrix,b.posMatrix,[1/2**E,1/2**E,0]),s[a]=b}}return s}getSourceTile(t,s){const a=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>a.maxzoom&&(m=a.maxzoom),m<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!b||!b.dem)&&s)for(;m>=a.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(t.scaledTo(m--).key);return b}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class Ti{constructor(t,s,a){this.style=t,this.sourceCache=new vi(s),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.elevationOffset=typeof a.elevationOffset=="number"?a.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,a,m=n.EXTENT){if(!(s>=0&&s<m&&a>=0&&a<m))return this.elevationOffset;let b=0;const E=this.getTerrainData(t);if(E.tile&&E.tile.dem){const D=n.transformMat4$1([],[s/m*n.EXTENT,a/m*n.EXTENT],E.u_terrain_matrix),L=[D[0]*E.tile.dem.dim,D[1]*E.tile.dem.dim],R=[Math.floor(L[0]),Math.floor(L[1])],V=E.tile.dem.get(R[0],R[1]),X=E.tile.dem.get(R[0],R[1]+1),H=E.tile.dem.get(R[0]+1,R[1]),le=E.tile.dem.get(R[0]+1,R[1]+1);b=n.number(n.number(V,X,L[0]-R[0]),n.number(H,le,L[0]-R[0]),L[1]-R[1])}return b}rememberForRerender(t,s){for(const a in this.sourceCache._tiles){const m=this.sourceCache._tiles[a];(m.tileID.equals(s)||m.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(m.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][m.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,a,m=n.EXTENT){return(this.getDEMElevation(t,s,a,m)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.style.map.painter.context,b=new n.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _(m,new n.RGBAImage({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const m=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new _(m,s.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),s.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const a=s&&s+s.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?b=t.canonical.z-m:n.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=t.canonical.x-(t.canonical.x>>b<<b),D=t.canonical.y-(t.canonical.y>>b<<b),L=n.fromScaling(new Float64Array(16),[1/(n.EXTENT<<b),1/(n.EXTENT<<b),0]);n.translate(L,L,[E*n.EXTENT,D*n.EXTENT,0]),this._demMatrixCache[t.key]={matrix:L,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,a=s.width/devicePixelRatio,m=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _(s.context,{width:a,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _(s.context,{width:a,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(a,m,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,a,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,E=0;b<this._coordsTextureSize;b++)for(let D=0;D<this._coordsTextureSize;D++,E+=4)s[E+0]=255&D,s[E+1]=255&b,s[E+2]=D>>8<<4|b>>8,s[E+3]=0;const a=new n.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),m=new _(t,a,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){const s=new Uint8Array(4),a=this.style.map.painter,m=a.context,b=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(t.x,a.height/devicePixelRatio-t.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,s),m.bindFramebuffer.set(null);const E=s[0]+(s[2]>>4<<8),D=s[1]+((15&s[2])<<8),L=this.coordsIndex[255-s[3]],R=L&&this.sourceCache.getTileByID(L);if(!R)return null;const V=this._coordsTextureSize,X=(1<<R.tileID.canonical.z)*V;return new n.MercatorCoordinate((R.tileID.canonical.x*V+E)/X,(R.tileID.canonical.y*V+D)/X,this.getElevation(R.tileID,E,D,V))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new n.PosArray,a=new n.TriangleIndexArray,m=this.meshSize,b=n.EXTENT/m,E=m*m;for(let D=0;D<=m;D++)for(let L=0;L<=m;L++)s.emplaceBack(L*b,D*b);for(let D=0;D<E;D+=m+1)for(let L=0;L<m;L++)a.emplaceBack(L+D,m+L+D+1,m+L+D+2),a.emplaceBack(L+D,m+L+D+2,L+D+1);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(s,Li.members),segments:n.SegmentVector.simpleSegment(0,0,s.length,a.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return s&&s.dem&&(a.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,a.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),a}}const Bi=(d,t)=>n.emitValidationErrors(d,t&&t.filter(s=>s.identifier!=="source.canvas")),Si=n.pick(ct,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Mr=n.pick(ct,["setCenter","setZoom","setBearing","setPitch"]),cr=function(){const d={},t=n.spec.$version;for(const s in n.spec.$root){const a=n.spec.$root[s];if(a.required){let m=null;m=s==="version"?t:a.type==="array"?[]:{},m!=null&&(d[s]=m)}}return d}();class gr extends n.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new qe(Ke(),this),this.imageManager=new S,this.imageManager.setEventedParent(this),this.glyphManager=new j(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new De(256,512),this.crossTileSymbolIndex=new gi,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const a=this;this._rtlTextPluginCallback=gr.registerForPluginStateChange(m=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(b,E)=>{if(n.triggerPluginCompletionEvent(b),E&&E.every(D=>D))for(const D in a.sourceCaches)a.sourceCaches[D].reload()})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const b=this.sourceCaches[m.sourceId];if(!b)return;const E=b.getSource();if(E&&E.vectorLayerIds)for(const D in this._layers){const L=this._layers[D];L.source===E.id&&this._validateLayer(L)}})}loadURL(t,s={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const a=typeof s.validate!="boolean"||s.validate,m=this.map._requestManager.transformRequest(t,n.ResourceType.Style);this._request=n.getJSON(m,(b,E)=>{this._request=null,b?this.fire(new n.ErrorEvent(b)):E&&this._load(E,a)})}loadJSON(t,s={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(cr,!1)}_load(t,s){if(s&&Bi(this,n.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const a=ut(this.stylesheet.layers);this._order=a.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of a)m=n.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ge(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,a,m,b){let E,D,L;const R=m>1?"@2x":"";let V=n.getJSON(a.transformRequest(a.normalizeSpriteURL(s,R,".json"),n.ResourceType.SpriteJSON),(le,ne)=>{V=null,L||(L=le,E=ne,H())}),X=n.getImage(a.transformRequest(a.normalizeSpriteURL(s,R,".png"),n.ResourceType.SpriteImage),(le,ne)=>{X=null,L||(L=le,D=ne,H())});function H(){if(L)b(L);else if(E&&D){const le=n.exported.getImageData(D),ne={};for(const ae in E){const{width:xe,height:Ee,x:Oe,y:ce,sdf:Xe,pixelRatio:Ue,stretchX:rt,stretchY:ot,content:St}=E[ae],Qe=new n.RGBAImage({width:xe,height:Ee});n.RGBAImage.copy(le,Qe,{x:Oe,y:ce},{x:0,y:0},{width:xe,height:Ee}),ne[ae]={data:Qe,pixelRatio:Ue,sdf:Xe,stretchX:rt,stretchY:ot,content:St}}b(null,ne)}}return{cancel(){V&&(V.cancel(),V=null),X&&(X.cancel(),X=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,a)=>{if(this._spriteRequest=null,s)this.fire(new n.ErrorEvent(s));else if(a)for(const m in a)this.imageManager.addImage(m,a[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const a=t.sourceLayer;if(!a)return;const m=s.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(a)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const a of t){const m=this._layers[a];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const E in this._updatedSources){const D=this._updatedSources[E];if(D==="reload")this._reloadSource(E);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(E)}}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];a[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in a){const b=this.sourceCaches[m];a[m]!==b.used&&b.fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new Ti(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=a=>{a.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=a=>{a.tile&&(a.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(a.sourceId,a.tile.tileID)):a.source.type==="geojson"&&this.terrain.rememberForRerender(a.sourceId,a.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new n.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Bi(this,n.validateStyle(t)))return!1;(t=n.clone$1(t)).layers=ut(t.layers);const s=function(m,b){if(!m)return[{command:ct.setStyle,args:[b]}];let E=[];try{if(!h(m.version,b.version))return[{command:ct.setStyle,args:[b]}];h(m.center,b.center)||E.push({command:ct.setCenter,args:[b.center]}),h(m.zoom,b.zoom)||E.push({command:ct.setZoom,args:[b.zoom]}),h(m.bearing,b.bearing)||E.push({command:ct.setBearing,args:[b.bearing]}),h(m.pitch,b.pitch)||E.push({command:ct.setPitch,args:[b.pitch]}),h(m.sprite,b.sprite)||E.push({command:ct.setSprite,args:[b.sprite]}),h(m.glyphs,b.glyphs)||E.push({command:ct.setGlyphs,args:[b.glyphs]}),h(m.transition,b.transition)||E.push({command:ct.setTransition,args:[b.transition]}),h(m.light,b.light)||E.push({command:ct.setLight,args:[b.light]});const D={},L=[];(function(V,X,H,le){let ne;for(ne in X=X||{},V=V||{})Object.prototype.hasOwnProperty.call(V,ne)&&(Object.prototype.hasOwnProperty.call(X,ne)||Zt(ne,H,le));for(ne in X)Object.prototype.hasOwnProperty.call(X,ne)&&(Object.prototype.hasOwnProperty.call(V,ne)?h(V[ne],X[ne])||(V[ne].type==="geojson"&&X[ne].type==="geojson"&&Gt(V,X,ne)?H.push({command:ct.setGeoJSONSourceData,args:[ne,X[ne].data]}):Je(ne,X,H,le)):Ht(ne,X,H))})(m.sources,b.sources,L,D);const R=[];m.layers&&m.layers.forEach(V=>{D[V.source]?E.push({command:ct.removeLayer,args:[V.id]}):R.push(V)}),E=E.concat(L),function(V,X,H){X=X||[];const le=(V=V||[]).map(mi),ne=X.map(mi),ae=V.reduce(Di,{}),xe=X.reduce(Di,{}),Ee=le.slice(),Oe=Object.create(null);let ce,Xe,Ue,rt,ot,St,Qe;for(ce=0,Xe=0;ce<le.length;ce++)Ue=le[ce],Object.prototype.hasOwnProperty.call(xe,Ue)?Xe++:(H.push({command:ct.removeLayer,args:[Ue]}),Ee.splice(Ee.indexOf(Ue,Xe),1));for(ce=0,Xe=0;ce<ne.length;ce++)Ue=ne[ne.length-1-ce],Ee[Ee.length-1-ce]!==Ue&&(Object.prototype.hasOwnProperty.call(ae,Ue)?(H.push({command:ct.removeLayer,args:[Ue]}),Ee.splice(Ee.lastIndexOf(Ue,Ee.length-Xe),1)):Xe++,St=Ee[Ee.length-ce],H.push({command:ct.addLayer,args:[xe[Ue],St]}),Ee.splice(Ee.length-ce,0,Ue),Oe[Ue]=!0);for(ce=0;ce<ne.length;ce++)if(Ue=ne[ce],rt=ae[Ue],ot=xe[Ue],!Oe[Ue]&&!h(rt,ot))if(h(rt.source,ot.source)&&h(rt["source-layer"],ot["source-layer"])&&h(rt.type,ot.type)){for(Qe in Qt(rt.layout,ot.layout,H,Ue,null,ct.setLayoutProperty),Qt(rt.paint,ot.paint,H,Ue,null,ct.setPaintProperty),h(rt.filter,ot.filter)||H.push({command:ct.setFilter,args:[Ue,ot.filter]}),h(rt.minzoom,ot.minzoom)&&h(rt.maxzoom,ot.maxzoom)||H.push({command:ct.setLayerZoomRange,args:[Ue,ot.minzoom,ot.maxzoom]}),rt)Object.prototype.hasOwnProperty.call(rt,Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?Qt(rt[Qe],ot[Qe],H,Ue,Qe.slice(6),ct.setPaintProperty):h(rt[Qe],ot[Qe])||H.push({command:ct.setLayerProperty,args:[Ue,Qe,ot[Qe]]}));for(Qe in ot)Object.prototype.hasOwnProperty.call(ot,Qe)&&!Object.prototype.hasOwnProperty.call(rt,Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?Qt(rt[Qe],ot[Qe],H,Ue,Qe.slice(6),ct.setPaintProperty):h(rt[Qe],ot[Qe])||H.push({command:ct.setLayerProperty,args:[Ue,Qe,ot[Qe]]}))}else H.push({command:ct.removeLayer,args:[Ue]}),St=Ee[Ee.lastIndexOf(Ue)+1],H.push({command:ct.addLayer,args:[ot,St]})}(R,b.layers,E)}catch(D){console.warn("Unable to compute style diff:",D),E=[{command:ct.setStyle,args:[b]}]}return E}(this.serialize(),t).filter(m=>!(m.command in Mr));if(s.length===0)return!1;const a=s.filter(m=>!(m.command in Si));if(a.length>0)throw new Error(`Unimplemented: ${a.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new n.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new n.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(n.validateStyle.source,`sources.${t}`,s,null,a))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=this.sourceCaches[t]=new be(t,s,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,a={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new n.ErrorEvent(new Error(`Layer "${m}" already exists on this map.`)));let b;if(t.type==="custom"){if(Bi(this,n.validateCustomStyleLayer(t)))return;b=n.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=n.clone$1(t),t=n.extend(t,{source:m})),this._validate(n.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},a))return;b=n.createStyleLayer(t),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[b.id]=b.serialize()}const E=s?this._order.indexOf(s):this._order.length;if(s&&E===-1)this.fire(new n.ErrorEvent(new Error(`Cannot add layer "${m}" before non-existing layer "${s}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const D=this._removedLayers[m];delete this._removedLayers[m],D.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const a=this._order.indexOf(t);this._order.splice(a,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new n.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new n.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,a){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===a||(s!=null&&(m.minzoom=s),a!=null&&(m.maxzoom=a),this._updateLayer(m)):this.fire(new n.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,a={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!h(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(n.validateStyle.filter,`layers.${m.id}.filter`,s,null,a)||(m.filter=n.clone$1(s),this._updateLayer(m)))}else this.fire(new n.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return n.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,a,m={}){this._checkLoaded();const b=this.getLayer(t);b?h(b.getLayoutProperty(s),a)||(b.setLayoutProperty(s,a,m),this._updateLayer(b)):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const a=this.getLayer(t);if(a)return a.getLayoutProperty(s);this.fire(new n.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,a,m={}){this._checkLoaded();const b=this.getLayer(t);b?h(b.getPaintProperty(s),a)||(b.setPaintProperty(s,a,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const a=t.source,m=t.sourceLayer,b=this.sourceCaches[a];if(b===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const E=b.getSource().type;E==="geojson"&&m?this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,t.id,s)):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const a=t.source,m=this.sourceCaches[a];if(m===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const b=m.getSource().type,E=b==="vector"?t.sourceLayer:void 0;b!=="vector"||E?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,t.id,s):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,a=t.sourceLayer,m=this.sourceCaches[s];if(m!==void 0)return m.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),m.getFeatureState(a,t.id)):void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:n.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=E=>this._layers[E].type==="fill-extrusion",a={},m=[];for(let E=this._order.length-1;E>=0;E--){const D=this._order[E];if(s(D)){a[D]=E;for(const L of t){const R=L[D];if(R)for(const V of R)m.push(V)}}}m.sort((E,D)=>D.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const D=this._order[E];if(s(D))for(let L=m.length-1;L>=0;L--){const R=m[L].feature;if(a[R.layer.id]<E)break;b.push(R),m.pop()}else for(const L of t){const R=L[D];if(R)for(const V of R)b.push(V.feature)}}return b}queryRenderedFeatures(t,s,a){s&&s.filter&&this._validate(n.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of s.layers){const D=this._layers[E];if(!D)return this.fire(new n.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];m[D.source]=!0}}const b=[];s.availableImages=this._availableImages;for(const E in this.sourceCaches)s.layers&&!m[E]||b.push(K(this.sourceCaches[E],this._layers,this._serializedLayers,t,s,a));return this.placement&&b.push(function(E,D,L,R,V,X,H){const le={},ne=X.queryRenderedSymbols(R),ae=[];for(const xe of Object.keys(ne).map(Number))ae.push(H[xe]);ae.sort(W);for(const xe of ae){const Ee=xe.featureIndex.lookupSymbolFeatures(ne[xe.bucketInstanceId],D,xe.bucketIndex,xe.sourceLayerIndex,V.filter,V.layers,V.availableImages,E);for(const Oe in Ee){const ce=le[Oe]=le[Oe]||[],Xe=Ee[Oe];Xe.sort((Ue,rt)=>{const ot=xe.featureSortOrder;if(ot){const St=ot.indexOf(Ue.featureIndex);return ot.indexOf(rt.featureIndex)-St}return rt.featureIndex-Ue.featureIndex});for(const Ue of Xe)ce.push(Ue)}}for(const xe in le)le[xe].forEach(Ee=>{const Oe=Ee.feature,ce=L[E[xe].source].getFeatureState(Oe.layer["source-layer"],Oe.id);Oe.source=Oe.layer.source,Oe.layer["source-layer"]&&(Oe.sourceLayer=Oe.layer["source-layer"]),Oe.state=ce});return le}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,s){s&&s.filter&&this._validate(n.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const a=this.sourceCaches[t];return a?function(m,b){const E=m.getRenderableIds().map(R=>m.getTileByID(R)),D=[],L={};for(let R=0;R<E.length;R++){const V=E[R],X=V.tileID.canonical.key;L[X]||(L[X]=!0,V.querySourceFeatures(D,b))}return D}(a,s):[]}addSourceType(t,s,a){return gr.getSourceType(t)?a(new Error(`A source type called "${t}" already exists.`)):(gr.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const a=this.light.getLight();let m=!1;for(const E in t)if(!h(t[E],a[E])){m=!0;break}if(!m)return;const b={now:n.exported.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(b)}_validate(t,s,a,m,b={}){return(!b||b.validate!==!1)&&Bi(this,t.call(n.validateStyle,n.extend({key:s,style:this.serialize(),value:a,styleSpec:n.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,a,m,b=!1){let E=!1,D=!1;const L={};for(const R of this._order){const V=this._layers[R];if(V.type!=="symbol")continue;if(!L[V.source]){const H=this.sourceCaches[V.source];L[V.source]=H.getRenderableIds(!0).map(le=>H.getTileByID(le)).sort((le,ne)=>ne.tileID.overscaledZ-le.tileID.overscaledZ||(le.tileID.isLessThan(ne.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(V,L[V.source],t.center.lng);E=E||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ye(t,this.terrain,this._order,b,s,a,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),D=!0),E&&this.pauseablePlacement.placement.setStale()),D||E)for(const R of this._order){const V=this._layers[R];V.type==="symbol"&&this.placement.updateLayerOpacities(V,L[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,a){this.imageManager.getImages(s.icons,a),this._updateTilesForChangedImages();const m=this.sourceCaches[s.source];m&&m.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,a){this.glyphManager.getGlyphs(s.stacks,a)}getResource(t,s,a){return n.makeRequest(s,a)}}gr.getSourceType=function(d){return de[d]},gr.setSourceType=function(d,t){de[d]=t},gr.registerForPluginStateChange=n.registerForPluginStateChange;var Kr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const xs={prelude:Vi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Vi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Vi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Vi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Vi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Vi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Vi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Vi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Vi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Vi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Vi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Vi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Vi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Vi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Vi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Vi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Vi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Kr),terrainDepth:Vi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Kr),terrainCoords:Vi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Kr)};function Vi(d,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),m=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=b?b.concat(m):m,D={};return{fragmentSource:d=d.replace(s,(L,R,V,X,H)=>(D[H]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${V} ${X} ${H};
#else
uniform ${V} ${X} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${V} ${X} ${H} = u_${H};
#endif
`)),vertexSource:t=t.replace(s,(L,R,V,X,H)=>{const le=X==="float"?"vec2":"vec4",ne=H.match(/color/)?"color":le;return D[H]?R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${V} ${le} a_${H};
varying ${V} ${X} ${H};
#else
uniform ${V} ${X} u_${H};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${V} ${X} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${ne}(a_${H}, u_${H}_t);
#else
    ${V} ${X} ${H} = u_${H};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${V} ${le} a_${H};
#else
uniform ${V} ${X} u_${H};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${V} ${X} ${H} = a_${H};
#else
    ${V} ${X} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${V} ${X} ${H} = unpack_mix_${ne}(a_${H}, u_${H}_t);
#else
    ${V} ${X} ${H} = u_${H};
#endif
`}),staticAttributes:a,staticUniforms:E}}class Yn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,a,m,b,E,D,L,R){this.context=t;let V=this.boundPaintVertexBuffers.length!==m.length;for(let X=0;!V&&X<m.length;X++)this.boundPaintVertexBuffers[X]!==m[X]&&(V=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===a&&!V&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===D&&this.boundDynamicVertexBuffer2===L&&this.boundDynamicVertexBuffer3===R?(t.bindVertexArrayOES.set(this.vao),D&&D.bind(),b&&b.dynamicDraw&&b.bind(),L&&L.bind(),R&&R.bind()):this.freshBind(s,a,m,b,E,D,L,R)}freshBind(t,s,a,m,b,E,D,L){let R;const V=t.numAttributes,X=this.context,H=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=L;else{R=X.currentNumAttributes||0;for(let le=V;le<R;le++)H.disableVertexAttribArray(le)}s.enableAttributes(H,t);for(const le of a)le.enableAttributes(H,t);E&&E.enableAttributes(H,t),D&&D.enableAttributes(H,t),L&&L.enableAttributes(H,t),s.bind(),s.setVertexAttribPointers(H,t,b);for(const le of a)le.bind(),le.setVertexAttribPointers(H,t,b);E&&(E.bind(),E.setVertexAttribPointers(H,t,b)),m&&m.bind(),D&&(D.bind(),D.setVertexAttribPointers(H,t,b)),L&&(L.bind(),L.setVertexAttribPointers(H,t,b)),X.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function mo(d){const t=[];for(let s=0;s<d.length;s++){if(d[s]===null)continue;const a=d[s].split(" ");t.push(a.pop())}return t}class ca{constructor(t,s,a,m,b,E,D){const L=t.gl;this.program=L.createProgram();const R=mo(a.staticAttributes),V=m?m.getBinderAttributes():[],X=R.concat(V),H=xs.prelude.staticUniforms?mo(xs.prelude.staticUniforms):[],le=a.staticUniforms?mo(a.staticUniforms):[],ne=m?m.getBinderUniforms():[],ae=H.concat(le).concat(ne),xe=[];for(const ot of ae)xe.indexOf(ot)<0&&xe.push(ot);const Ee=m?m.defines():[];E&&Ee.push("#define OVERDRAW_INSPECTOR;"),D&&Ee.push("#define TERRAIN3D;");const Oe=Ee.concat(xs.prelude.fragmentSource,a.fragmentSource).join(`
`),ce=Ee.concat(xs.prelude.vertexSource,a.vertexSource).join(`
`),Xe=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(Xe,Oe),L.compileShader(Xe),L.attachShader(this.program,Xe);const Ue=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(Ue,ce),L.compileShader(Ue),L.attachShader(this.program,Ue),this.attributes={};const rt={};this.numAttributes=X.length;for(let ot=0;ot<this.numAttributes;ot++)X[ot]&&(L.bindAttribLocation(this.program,ot,X[ot]),this.attributes[X[ot]]=ot);L.linkProgram(this.program),L.deleteShader(Ue),L.deleteShader(Xe);for(let ot=0;ot<xe.length;ot++){const St=xe[ot];if(St&&!rt[St]){const Qe=L.getUniformLocation(this.program,St);Qe&&(rt[St]=Qe)}}this.fixedUniforms=b(t,rt),this.terrainUniforms=((ot,St)=>({u_depth:new n.Uniform1i(ot,St.u_depth),u_terrain:new n.Uniform1i(ot,St.u_terrain),u_terrain_dim:new n.Uniform1f(ot,St.u_terrain_dim),u_terrain_matrix:new n.UniformMatrix4f(ot,St.u_terrain_matrix),u_terrain_unpack:new n.Uniform4f(ot,St.u_terrain_unpack),u_terrain_offset:new n.Uniform1f(ot,St.u_terrain_offset),u_terrain_exaggeration:new n.Uniform1f(ot,St.u_terrain_exaggeration)}))(t,rt),this.binderUniforms=m?m.getUniforms(t,rt):[]}draw(t,s,a,m,b,E,D,L,R,V,X,H,le,ne,ae,xe,Ee,Oe){const ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(m),t.setColorMode(b),t.setCullFace(E),L){t.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,L.depthTexture),t.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,L.texture);for(const Ue in this.terrainUniforms)this.terrainUniforms[Ue].set(L[Ue])}for(const Ue in this.fixedUniforms)this.fixedUniforms[Ue].set(D[Ue]);ae&&ae.setUniforms(t,this.binderUniforms,le,{zoom:ne});let Xe=0;switch(s){case ce.LINES:Xe=2;break;case ce.TRIANGLES:Xe=3;break;case ce.LINE_STRIP:Xe=1}for(const Ue of H.get()){const rt=Ue.vaos||(Ue.vaos={});(rt[R]||(rt[R]=new Yn)).bind(t,this,V,ae?ae.getPaintVertexBuffers():[],X,Ue.vertexOffset,xe,Ee,Oe),ce.drawElements(s,Ue.primitiveLength*Xe,ce.UNSIGNED_SHORT,Ue.primitiveOffset*Xe*2)}}}function ha(d,t,s){const a=1/lr(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),b=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,E=b*(s.tileID.canonical.x+s.tileID.wrap*m),D=b*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[E>>16,D>>16],u_pixel_coord_lower:[65535&E,65535&D]}}const Fo=(d,t,s,a)=>{const m=t.style.light,b=m.properties.get("position"),E=[b.x,b.y,b.z],D=n.create$1();m.properties.get("anchor")==="viewport"&&n.fromRotation(D,-t.transform.angle),n.transformMat3(E,E,D);const L=m.properties.get("color");return{u_matrix:d,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+s,u_opacity:a}},ua=(d,t,s,a,m,b,E)=>n.extend(Fo(d,t,s,a),ha(b,t,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),go=d=>({u_matrix:d}),Ro=(d,t,s,a)=>n.extend(go(d),ha(s,t,a)),da=(d,t)=>({u_matrix:d,u_world:t}),fa=(d,t,s,a,m)=>n.extend(Ro(d,t,s,a),{u_world:m}),Bo=(d,t,s,a)=>{const m=d.transform;let b,E;if(a.paint.get("circle-pitch-alignment")==="map"){const D=lr(s,1,m.zoom);b=!0,E=[D,D]}else b=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(t.posMatrix,s,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:E}},T=(d,t,s)=>{const a=lr(s,1,t.zoom),m=Math.pow(2,t.zoom-s.tileID.overscaledZ),b=s.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*m),t.pixelsToGLUnits[1]/(a*m)],u_overscale_factor:b}},z=(d,t,s=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:s}),q=d=>({u_matrix:d}),ve=(d,t,s,a)=>({u_matrix:d,u_extrude_scale:lr(t,1,s),u_intensity:a});function ze(d,t){const s=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new n.MercatorCoordinate(0,a/s).toLngLat().lat,new n.MercatorCoordinate(0,(a+1)/s).toLngLat().lat]}const Te=(d,t,s,a)=>{const m=d.transform;return{u_matrix:Ve(d,t,s,a),u_ratio:1/lr(t,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},ke=(d,t,s,a,m)=>n.extend(Te(d,t,s,m),{u_image:0,u_image_height:a}),Ct=(d,t,s,a,m)=>{const b=d.transform,E=Tt(t,b);return{u_matrix:Ve(d,t,s,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/lr(t,1,b.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[E,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},bt=(d,t,s,a,m,b)=>{const E=d.lineAtlas,D=Tt(t,d.transform),L=s.layout.get("line-cap")==="round",R=E.getDash(a.from,L),V=E.getDash(a.to,L),X=R.width*m.fromScale,H=V.width*m.toScale;return n.extend(Te(d,t,s,b),{u_patternscale_a:[D/X,-R.height/2],u_patternscale_b:[D/H,-V.height/2],u_sdfgamma:E.width/(256*Math.min(X,H)*d.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:V.y,u_mix:m.t})};function Tt(d,t){return 1/lr(d,1,t.tileZoom)}function Ve(d,t,s,a){return d.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Dt=(d,t,s,a,m)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:qt(m.paint.get("raster-hue-rotate"))};var b,E};function qt(d){d*=Math.PI/180;const t=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const li=(d,t,s,a,m,b,E,D,L,R)=>{const V=m.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:V.width/V.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:D,u_is_text:+L,u_pitch_with_map:+a,u_texsize:R,u_texture:0}},_i=(d,t,s,a,m,b,E,D,L,R,V)=>{const X=m.transform;return n.extend(li(d,t,s,a,m,b,E,D,L,R),{u_gamma_scale:a?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+V})},Sr=(d,t,s,a,m,b,E,D,L,R)=>n.extend(_i(d,t,s,a,m,b,E,D,!0,L,!0),{u_texsize_icon:R,u_texture_icon:1}),mt=(d,t,s)=>({u_matrix:d,u_opacity:t,u_color:s}),ti=(d,t,s,a,m,b)=>n.extend(function(E,D,L,R){const V=L.imageManager.getPattern(E.from.toString()),X=L.imageManager.getPattern(E.to.toString()),{width:H,height:le}=L.imageManager.getPixelSize(),ne=Math.pow(2,R.tileID.overscaledZ),ae=R.tileSize*Math.pow(2,L.transform.tileZoom)/ne,xe=ae*(R.tileID.canonical.x+R.tileID.wrap*ne),Ee=ae*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[H,le],u_mix:D.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/lr(R,1,L.transform.tileZoom),u_pixel_coord_upper:[xe>>16,Ee>>16],u_pixel_coord_lower:[65535&xe,65535&Ee]}}(a,b,s,m),{u_matrix:d,u_opacity:t}),qi={fillExtrusion:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_lightpos:new n.Uniform3f(d,t.u_lightpos),u_lightintensity:new n.Uniform1f(d,t.u_lightintensity),u_lightcolor:new n.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(d,t.u_vertical_gradient),u_opacity:new n.Uniform1f(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_lightpos:new n.Uniform3f(d,t.u_lightpos),u_lightintensity:new n.Uniform1f(d,t.u_lightintensity),u_lightcolor:new n.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(d,t.u_vertical_gradient),u_height_factor:new n.Uniform1f(d,t.u_height_factor),u_image:new n.Uniform1i(d,t.u_image),u_texsize:new n.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade),u_opacity:new n.Uniform1f(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image:new n.Uniform1i(d,t.u_image),u_texsize:new n.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_world:new n.Uniform2f(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_world:new n.Uniform2f(d,t.u_world),u_image:new n.Uniform1i(d,t.u_image),u_texsize:new n.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_scale_with_map:new n.Uniform1i(d,t.u_scale_with_map),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_extrude_scale:new n.Uniform2f(d,t.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pixels_to_tile_units:new n.Uniform1f(d,t.u_pixels_to_tile_units),u_extrude_scale:new n.Uniform2f(d,t.u_extrude_scale),u_overscale_factor:new n.Uniform1f(d,t.u_overscale_factor)}),collisionCircle:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_inv_matrix:new n.UniformMatrix4f(d,t.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new n.UniformColor(d,t.u_color),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_overlay:new n.Uniform1i(d,t.u_overlay),u_overlay_scale:new n.Uniform1f(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new n.Uniform1f(d,t.u_extrude_scale),u_intensity:new n.Uniform1f(d,t.u_intensity),u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_world:new n.Uniform2f(d,t.u_world),u_image:new n.Uniform1i(d,t.u_image),u_color_ramp:new n.Uniform1i(d,t.u_color_ramp),u_opacity:new n.Uniform1f(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image:new n.Uniform1i(d,t.u_image),u_latrange:new n.Uniform2f(d,t.u_latrange),u_light:new n.Uniform2f(d,t.u_light),u_shadow:new n.UniformColor(d,t.u_shadow),u_highlight:new n.UniformColor(d,t.u_highlight),u_accent:new n.UniformColor(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image:new n.Uniform1i(d,t.u_image),u_dimension:new n.Uniform2f(d,t.u_dimension),u_zoom:new n.Uniform1f(d,t.u_zoom),u_unpack:new n.Uniform4f(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels),u_image:new n.Uniform1i(d,t.u_image),u_image_height:new n.Uniform1f(d,t.u_image_height)}),linePattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_texsize:new n.Uniform2f(d,t.u_texsize),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_image:new n.Uniform1i(d,t.u_image),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade)}),lineSDF:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels),u_patternscale_a:new n.Uniform2f(d,t.u_patternscale_a),u_patternscale_b:new n.Uniform2f(d,t.u_patternscale_b),u_sdfgamma:new n.Uniform1f(d,t.u_sdfgamma),u_image:new n.Uniform1i(d,t.u_image),u_tex_y_a:new n.Uniform1f(d,t.u_tex_y_a),u_tex_y_b:new n.Uniform1f(d,t.u_tex_y_b),u_mix:new n.Uniform1f(d,t.u_mix)}),raster:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_tl_parent:new n.Uniform2f(d,t.u_tl_parent),u_scale_parent:new n.Uniform1f(d,t.u_scale_parent),u_buffer_scale:new n.Uniform1f(d,t.u_buffer_scale),u_fade_t:new n.Uniform1f(d,t.u_fade_t),u_opacity:new n.Uniform1f(d,t.u_opacity),u_image0:new n.Uniform1i(d,t.u_image0),u_image1:new n.Uniform1i(d,t.u_image1),u_brightness_low:new n.Uniform1f(d,t.u_brightness_low),u_brightness_high:new n.Uniform1f(d,t.u_brightness_high),u_saturation_factor:new n.Uniform1f(d,t.u_saturation_factor),u_contrast_factor:new n.Uniform1f(d,t.u_contrast_factor),u_spin_weights:new n.Uniform3f(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new n.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,t.u_size_t),u_size:new n.Uniform1f(d,t.u_size),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(d,t.u_pitch),u_rotate_symbol:new n.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,t.u_fade_change),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new n.Uniform1i(d,t.u_is_text),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_texsize:new n.Uniform2f(d,t.u_texsize),u_texture:new n.Uniform1i(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new n.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,t.u_size_t),u_size:new n.Uniform1f(d,t.u_size),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(d,t.u_pitch),u_rotate_symbol:new n.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,t.u_fade_change),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new n.Uniform1i(d,t.u_is_text),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_texsize:new n.Uniform2f(d,t.u_texsize),u_texture:new n.Uniform1i(d,t.u_texture),u_gamma_scale:new n.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new n.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,t.u_size_t),u_size:new n.Uniform1f(d,t.u_size),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(d,t.u_pitch),u_rotate_symbol:new n.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,t.u_fade_change),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new n.Uniform1i(d,t.u_is_text),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_texsize:new n.Uniform2f(d,t.u_texsize),u_texsize_icon:new n.Uniform2f(d,t.u_texsize_icon),u_texture:new n.Uniform1i(d,t.u_texture),u_texture_icon:new n.Uniform1i(d,t.u_texture_icon),u_gamma_scale:new n.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_opacity:new n.Uniform1f(d,t.u_opacity),u_color:new n.UniformColor(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_opacity:new n.Uniform1f(d,t.u_opacity),u_image:new n.Uniform1i(d,t.u_image),u_pattern_tl_a:new n.Uniform2f(d,t.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(d,t.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(d,t.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(d,t.u_pattern_br_b),u_texsize:new n.Uniform2f(d,t.u_texsize),u_mix:new n.Uniform1f(d,t.u_mix),u_pattern_size_a:new n.Uniform2f(d,t.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(d,t.u_pattern_size_b),u_scale_a:new n.Uniform1f(d,t.u_scale_a),u_scale_b:new n.Uniform1f(d,t.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_texture:new n.Uniform1i(d,t.u_texture)}),terrainDepth:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),terrainCoords:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_texture:new n.Uniform1i(d,t.u_texture),u_terrain_coords_id:new n.Uniform1f(d,t.u_terrain_coords_id)})};class $i{constructor(t,s,a){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ci{constructor(t,s,a,m){this.length=s.length,this.attributes=a,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let a=0;a<this.attributes.length;a++){const m=s.attributes[this.attributes[a].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,a){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],E=s.attributes[b.name];E!==void 0&&t.vertexAttribPointer(E,b.components,t[hr[b.type]],!1,this.itemSize,b.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ai{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hn extends Ai{getDefault(){return n.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wi extends Ai{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jr extends Ai{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Or extends Ai{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _o extends Ai{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class rn extends Ai{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class xn extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Hs extends Ai{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Zs extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Uo extends Ai{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class yo extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class bs extends Ai{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class vo extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class xo extends Ai{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class bo extends Ai{getDefault(){return n.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class hs extends Ai{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class jo extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ks extends Ai{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Oa extends Ai{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Vo extends Ai{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ks extends Ai{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class No extends Ai{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Go extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Xo extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ws extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class wo extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Wo extends Ai{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $o extends Ai{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Ds extends Ai{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class pa extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class qo extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Os extends Ai{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class fn extends Os{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class zn extends Os{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bn{constructor(t,s,a,m){this.context=t,this.width=s,this.height=a;const b=t.gl,E=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new fn(t,E),m&&(this.depthAttachment=new zn(t,E)),b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class er{constructor(t,s,a){this.blendFunction=t,this.blendColor=s,this.mask=a}}er.Replace=[1,0],er.disabled=new er(er.Replace,n.Color.transparent,[!1,!1,!1,!1]),er.unblended=new er(er.Replace,n.Color.transparent,[!0,!0,!0,!0]),er.alphaBlended=new er([1,771],n.Color.transparent,[!0,!0,!0,!0]);class Zn{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hn(this),this.clearDepth=new Wi(this),this.clearStencil=new Jr(this),this.colorMask=new Or(this),this.depthMask=new _o(this),this.stencilMask=new rn(this),this.stencilFunc=new xn(this),this.stencilOp=new Hs(this),this.stencilTest=new Zs(this),this.depthRange=new Uo(this),this.depthTest=new yo(this),this.depthFunc=new bs(this),this.blend=new vo(this),this.blendFunc=new xo(this),this.blendColor=new bo(this),this.blendEquation=new hs(this),this.cullFace=new jo(this),this.cullFaceSide=new ks(this),this.frontFace=new Oa(this),this.program=new Vo(this),this.activeTexture=new Ks(this),this.viewport=new No(this),this.bindFramebuffer=new Go(this),this.bindRenderbuffer=new Xo(this),this.bindTexture=new ws(this),this.bindVertexBuffer=new wo(this),this.bindElementBuffer=new Wo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $o(this),this.pixelStoreUnpack=new Ds(this),this.pixelStoreUnpackPremultiplyAlpha=new pa(this),this.pixelStoreUnpackFlipY=new qo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new $i(this,t,s)}createVertexBuffer(t,s,a){return new ci(this,t,s,a)}createRenderbuffer(t,s,a){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,t,s,a),this.bindRenderbuffer.set(null),b}createFramebuffer(t,s,a){return new bn(this,t,s,a)}clear({color:t,depth:s}){const a=this.gl;let m=0;t&&(m|=a.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(m|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),a.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h(t.blendFunction,er.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Mi{constructor(t,s,a){this.func=t,this.mask=s,this.range=a}}Mi.ReadOnly=!1,Mi.ReadWrite=!0,Mi.disabled=new Mi(519,Mi.ReadOnly,[0,1]);const Ui=7680;class Yi{constructor(t,s,a,m,b,E){this.test=t,this.ref=s,this.mask=a,this.fail=m,this.depthFail=b,this.pass=E}}Yi.disabled=new Yi({func:519,mask:0},0,0,Ui,Ui,Ui);class ar{constructor(t,s,a){this.enable=t,this.mode=s,this.frontFace=a}}let Ls;function zs(d,t,s,a,m,b,E){const D=d.context,L=D.gl,R=d.useProgram("collisionBox"),V=[];let X=0,H=0;for(let ce=0;ce<a.length;ce++){const Xe=a[ce],Ue=t.getTile(Xe),rt=Ue.getBucket(s);if(!rt)continue;let ot=Xe.posMatrix;m[0]===0&&m[1]===0||(ot=d.translatePosMatrix(Xe.posMatrix,Ue,m,b));const St=E?rt.textCollisionBox:rt.iconCollisionBox,Qe=rt.collisionCircleArray;if(Qe.length>0){const Xt=n.create(),Lt=ot;n.mul(Xt,rt.placementInvProjMatrix,d.transform.glCoordMatrix),n.mul(Xt,Xt,rt.placementViewportMatrix),V.push({circleArray:Qe,circleOffset:H,transform:Lt,invTransform:Xt,coord:Xe}),X+=Qe.length/4,H=X}St&&R.draw(D,L.LINES,Mi.disabled,Yi.disabled,d.colorModeForRenderPass(),ar.disabled,T(ot,d.transform,Ue),d.style.terrain&&d.style.terrain.getTerrainData(Xe),s.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,d.transform.zoom,null,null,St.collisionVertexBuffer)}if(!E||!V.length)return;const le=d.useProgram("collisionCircle"),ne=new n.CollisionCircleLayoutArray;ne.resize(4*X),ne._trim();let ae=0;for(const ce of V)for(let Xe=0;Xe<ce.circleArray.length/4;Xe++){const Ue=4*Xe,rt=ce.circleArray[Ue+0],ot=ce.circleArray[Ue+1],St=ce.circleArray[Ue+2],Qe=ce.circleArray[Ue+3];ne.emplace(ae++,rt,ot,St,Qe,0),ne.emplace(ae++,rt,ot,St,Qe,1),ne.emplace(ae++,rt,ot,St,Qe,2),ne.emplace(ae++,rt,ot,St,Qe,3)}(!Ls||Ls.length<2*X)&&(Ls=function(ce){const Xe=2*ce,Ue=new n.QuadTriangleArray;Ue.resize(Xe),Ue._trim();for(let rt=0;rt<Xe;rt++){const ot=6*rt;Ue.uint16[ot+0]=4*rt+0,Ue.uint16[ot+1]=4*rt+1,Ue.uint16[ot+2]=4*rt+2,Ue.uint16[ot+3]=4*rt+2,Ue.uint16[ot+4]=4*rt+3,Ue.uint16[ot+5]=4*rt+0}return Ue}(X));const xe=D.createIndexBuffer(Ls,!0),Ee=D.createVertexBuffer(ne,n.collisionCircleLayout.members,!0);for(const ce of V){const Xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(Oe=d.transform).cameraToCenterDistance,u_viewport_size:[Oe.width,Oe.height]};le.draw(D,L.TRIANGLES,Mi.disabled,Yi.disabled,d.colorModeForRenderPass(),ar.disabled,Xe,d.style.terrain&&d.style.terrain.getTerrainData(ce.coord),s.id,Ee,xe,n.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,d.transform.zoom,null,null,null)}var Oe;Ee.destroy(),xe.destroy()}ar.disabled=new ar(!1,1029,2305),ar.backCCW=new ar(!0,1029,2305);const La=n.identity(new Float32Array(16));function ma(d,t,s,a,m,b){const{horizontalAlign:E,verticalAlign:D}=n.getAnchorAlignment(d),L=-(E-.5)*t,R=-(D-.5)*s,V=n.evaluateVariableOffset(d,a);return new n.pointGeometry((L/m+V[0])*b,(R/m+V[1])*b)}function Yo(d,t,s,a,m,b,E,D,L,R,V){const X=d.text.placedSymbolArray,H=d.text.dynamicLayoutVertexArray,le=d.icon.dynamicLayoutVertexArray,ne={};H.clear();for(let ae=0;ae<X.length;ae++){const xe=X.get(ae),Ee=d.allowVerticalPlacement&&!xe.placedOrientation,Oe=xe.hidden||!xe.crossTileID||Ee?null:a[xe.crossTileID];if(Oe){const ce=new n.pointGeometry(xe.anchorX,xe.anchorY),Xe=si(ce,s?E:b,V),Ue=Ei(m.cameraToCenterDistance,Xe.signedDistanceFromCamera);let rt=n.evaluateSizeForFeature(d.textSizeData,L,xe)*Ue/n.ONE_EM;s&&(rt*=d.tilePixelRatio/D);const{width:ot,height:St,anchor:Qe,textOffset:Xt,textBoxScale:Lt}=Oe,Kt=ma(Qe,ot,St,Xt,Lt,rt),Ci=s?si(ce.add(Kt),b,V).point:Xe.point.add(t?Kt.rotate(-m.angle):Kt),Pi=d.allowVerticalPlacement&&xe.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let hi=0;hi<xe.numGlyphs;hi++)n.addDynamicAttributes(H,Ci,Pi);R&&xe.associatedIconIndex>=0&&(ne[xe.associatedIconIndex]={shiftedAnchor:Ci,angle:Pi})}else yi(xe.numGlyphs,H)}if(R){le.clear();const ae=d.icon.placedSymbolArray;for(let xe=0;xe<ae.length;xe++){const Ee=ae.get(xe);if(Ee.hidden)yi(Ee.numGlyphs,le);else{const Oe=ne[xe];if(Oe)for(let ce=0;ce<Ee.numGlyphs;ce++)n.addDynamicAttributes(le,Oe.shiftedAnchor,Oe.angle);else yi(Ee.numGlyphs,le)}}d.icon.dynamicLayoutVertexBuffer.updateData(le)}d.text.dynamicLayoutVertexBuffer.updateData(H)}function So(d,t,s){return s.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Kn(d,t,s,a,m,b,E,D,L,R,V,X){const H=d.context,le=H.gl,ne=d.transform,ae=D==="map",xe=L==="map",Ee=D!=="viewport"&&s.layout.get("symbol-placement")!=="point",Oe=ae&&!xe&&!Ee,ce=!s.layout.get("symbol-sort-key").isConstant();let Xe=!1;const Ue=d.depthModeForSublayer(0,Mi.ReadOnly),rt=s.layout.get("text-variable-anchor"),ot=[];for(const St of a){const Qe=t.getTile(St),Xt=Qe.getBucket(s);if(!Xt)continue;const Lt=m?Xt.text:Xt.icon;if(!Lt||!Lt.segments.get().length)continue;const Kt=Lt.programConfigurations.get(s.id),Ci=m||Xt.sdfIcons,Pi=m?Xt.textSizeData:Xt.iconSizeData,hi=xe||ne.pitch!==0,ir=d.useProgram(So(Ci,m,Xt),Kt),rr=n.evaluateSizeForZoom(Pi,ne.zoom),Ni=d.style.terrain&&d.style.terrain.getTerrainData(St);let Gi,nr,Wr,gs,ts=[0,0],_s=null;if(m){if(nr=Qe.glyphAtlasTexture,Wr=le.LINEAR,Gi=Qe.glyphAtlasTexture.size,Xt.iconsInText){ts=Qe.imageAtlasTexture.size,_s=Qe.imageAtlasTexture;const Gn=Pi.kind==="composite"||Pi.kind==="camera";gs=hi||d.options.rotating||d.options.zooming||Gn?le.LINEAR:le.NEAREST}}else{const Gn=s.layout.get("icon-size").constantOr(0)!==1||Xt.iconsNeedLinear;nr=Qe.imageAtlasTexture,Wr=Ci||d.options.rotating||d.options.zooming||Gn||hi?le.LINEAR:le.NEAREST,Gi=Qe.imageAtlasTexture.size}const Xs=lr(Qe,1,d.transform.zoom),Nn=Ri(St.posMatrix,xe,ae,d.transform,Xs),Cn=Ji(St.posMatrix,xe,ae,d.transform,Xs),Ts=rt&&Xt.hasTextData(),_a=s.layout.get("icon-text-fit")!=="none"&&Ts&&Xt.hasIconData();if(Ee){const Gn=d.style.terrain?(Ga,Ao)=>d.style.terrain.getElevation(St,Ga,Ao):null,so=s.layout.get("text-rotation-alignment")==="map";fr(Xt,St.posMatrix,d,m,Nn,Cn,xe,R,so,Gn)}const Rr=d.translatePosMatrix(St.posMatrix,Qe,b,E),ki=Ee||m&&rt||_a?La:Nn,Hi=d.translatePosMatrix(Cn,Qe,b,E,!0),$r=Ci&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qr;qr=Ci?Xt.iconsInText?Sr(Pi.kind,rr,Oe,xe,d,Rr,ki,Hi,Gi,ts):_i(Pi.kind,rr,Oe,xe,d,Rr,ki,Hi,m,Gi,!0):li(Pi.kind,rr,Oe,xe,d,Rr,ki,Hi,m,Gi);const vr={program:ir,buffers:Lt,uniformValues:qr,atlasTexture:nr,atlasTextureIcon:_s,atlasInterpolation:Wr,atlasInterpolationIcon:gs,isSDF:Ci,hasHalo:$r};if(ce&&Xt.canOverlap){Xe=!0;const Gn=Lt.segments.get();for(const so of Gn)ot.push({segments:new n.SegmentVector([so]),sortKey:so.sortKey,state:vr,terrainData:Ni})}else ot.push({segments:Lt.segments,sortKey:0,state:vr,terrainData:Ni})}Xe&&ot.sort((St,Qe)=>St.sortKey-Qe.sortKey);for(const St of ot){const Qe=St.state;if(H.activeTexture.set(le.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,le.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(H.activeTexture.set(le.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),Qe.isSDF){const Xt=Qe.uniformValues;Qe.hasHalo&&(Xt.u_is_halo=1,Js(Qe.buffers,St.segments,s,d,Qe.program,Ue,V,X,Xt,St.terrainData)),Xt.u_is_halo=0}Js(Qe.buffers,St.segments,s,d,Qe.program,Ue,V,X,Qe.uniformValues,St.terrainData)}}function Js(d,t,s,a,m,b,E,D,L,R){const V=a.context;m.draw(V,V.gl.TRIANGLES,b,E,D,ar.disabled,L,R,s.id,d.layoutVertexBuffer,d.indexBuffer,t,s.paint,a.transform.zoom,d.programConfigurations.get(s.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function wn(d,t,s,a,m,b,E){const D=d.context.gl,L=s.paint.get("fill-pattern"),R=L&&L.constantOr(1),V=s.getCrossfadeParameters();let X,H,le,ne,ae;E?(H=R&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=D.LINES):(H=R?"fillPattern":"fill",X=D.TRIANGLES);for(const xe of a){const Ee=t.getTile(xe);if(R&&!Ee.patternsLoaded())continue;const Oe=Ee.getBucket(s);if(!Oe)continue;const ce=Oe.programConfigurations.get(s.id),Xe=d.useProgram(H,ce),Ue=d.style.terrain&&d.style.terrain.getTerrainData(xe);R&&(d.context.activeTexture.set(D.TEXTURE0),Ee.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ce.updatePaintBuffers(V));const rt=L.constantOr(null);if(rt&&Ee.imageAtlas){const Qe=Ee.imageAtlas,Xt=Qe.patternPositions[rt.to.toString()],Lt=Qe.patternPositions[rt.from.toString()];Xt&&Lt&&ce.setConstantPatternPositions(Xt,Lt)}const ot=Ue?xe:null,St=d.translatePosMatrix(ot?ot.posMatrix:xe.posMatrix,Ee,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(E){ne=Oe.indexBuffer2,ae=Oe.segments2;const Qe=[D.drawingBufferWidth,D.drawingBufferHeight];le=H==="fillOutlinePattern"&&R?fa(St,d,V,Ee,Qe):da(St,Qe)}else ne=Oe.indexBuffer,ae=Oe.segments,le=R?Ro(St,d,V,Ee):go(St);Xe.draw(d.context,X,m,d.stencilModeForClipping(xe),b,ar.disabled,le,Ue,s.id,Oe.layoutVertexBuffer,ne,ae,s.paint,d.transform.zoom,ce)}}function Qs(d,t,s,a,m,b,E){const D=d.context,L=D.gl,R=s.paint.get("fill-extrusion-pattern"),V=R.constantOr(1),X=s.getCrossfadeParameters(),H=s.paint.get("fill-extrusion-opacity");for(const le of a){const ne=t.getTile(le),ae=ne.getBucket(s);if(!ae)continue;const xe=d.style.terrain&&d.style.terrain.getTerrainData(le),Ee=ae.programConfigurations.get(s.id),Oe=d.useProgram(V?"fillExtrusionPattern":"fillExtrusion",Ee);V&&(d.context.activeTexture.set(L.TEXTURE0),ne.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ee.updatePaintBuffers(X));const ce=R.constantOr(null);if(ce&&ne.imageAtlas){const ot=ne.imageAtlas,St=ot.patternPositions[ce.to.toString()],Qe=ot.patternPositions[ce.from.toString()];St&&Qe&&Ee.setConstantPatternPositions(St,Qe)}const Xe=d.translatePosMatrix(le.posMatrix,ne,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ue=s.paint.get("fill-extrusion-vertical-gradient"),rt=V?ua(Xe,d,Ue,H,le,X,ne):Fo(Xe,d,Ue,H);Oe.draw(D,D.gl.TRIANGLES,m,b,E,ar.backCCW,rt,xe,s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,s.paint,d.transform.zoom,Ee,d.style.terrain&&ae.centroidVertexBuffer)}}function Jn(d,t,s,a,m,b,E){const D=d.context,L=D.gl,R=s.fbo;if(!R)return;const V=d.useProgram("hillshade"),X=d.style.terrain&&d.style.terrain.getTerrainData(t);D.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,R.colorAttachment.get()),V.draw(D,L.TRIANGLES,m,b,E,ar.disabled,((H,le,ne,ae)=>{const xe=ne.paint.get("hillshade-shadow-color"),Ee=ne.paint.get("hillshade-highlight-color"),Oe=ne.paint.get("hillshade-accent-color");let ce=ne.paint.get("hillshade-illumination-direction")*(Math.PI/180);ne.paint.get("hillshade-illumination-anchor")==="viewport"&&(ce-=H.transform.angle);const Xe=!H.options.moving;return{u_matrix:ae?ae.posMatrix:H.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:ze(0,le.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),ce],u_shadow:xe,u_highlight:Ee,u_accent:Oe}})(d,s,a,X?t:null),X,a.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Ho(d,t,s,a,m,b){const E=d.context,D=E.gl,L=t.dem;if(L&&L.data){const R=L.dim,V=L.stride,X=L.getPixels();if(E.activeTexture.set(D.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(V),t.demTexture){const le=t.demTexture;le.update(X,{premultiply:!1}),le.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else t.demTexture=new _(E,X,D.RGBA,{premultiply:!1}),t.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);E.activeTexture.set(D.TEXTURE0);let H=t.fbo;if(!H){const le=new _(E,{width:R,height:R,data:null},D.RGBA);le.bind(D.LINEAR,D.CLAMP_TO_EDGE),H=t.fbo=E.createFramebuffer(R,R,!0),H.colorAttachment.set(le.texture)}E.bindFramebuffer.set(H.framebuffer),E.viewport.set([0,0,R,R]),d.useProgram("hillshadePrepare").draw(E,D.TRIANGLES,a,m,b,ar.disabled,((le,ne)=>{const ae=ne.stride,xe=n.create();return n.ortho(xe,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(xe,xe,[0,-n.EXTENT,0]),{u_matrix:xe,u_image:1,u_dimension:[ae,ae],u_zoom:le.overscaledZ,u_unpack:ne.getUnpackVector()}})(t.tileID,L),null,s.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Co(d,t,s,a,m,b){const E=a.paint.get("raster-fade-duration");if(!b&&E>0){const D=n.exported.now(),L=(D-d.timeAdded)/E,R=t?(D-t.timeAdded)/E:-1,V=s.getSource(),X=m.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),H=!t||Math.abs(t.tileID.overscaledZ-X)>Math.abs(d.tileID.overscaledZ-X),le=H&&d.refreshedUponExpiration?1:n.clamp(H?L:1-R,0,1);return d.refreshedUponExpiration&&L>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}const Ss=new n.Color(1,0,0,1),pn=new n.Color(0,1,0,1),Zo=new n.Color(0,0,1,1),To=new n.Color(1,0,1,1),Ko=new n.Color(0,1,1,1);function In(d,t,s,a){Rs(d,0,t+s/2,d.transform.width,s,a)}function Fs(d,t,s,a){Rs(d,t-s/2,0,s,d.transform.height,a)}function Rs(d,t,s,a,m,b){const E=d.context,D=E.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*d.pixelRatio,s*d.pixelRatio,a*d.pixelRatio,m*d.pixelRatio),E.clear({color:b}),D.disable(D.SCISSOR_TEST)}function Ie(d,t,s){const a=d.context,m=a.gl,b=s.posMatrix,E=d.useProgram("debug"),D=Mi.disabled,L=Yi.disabled,R=d.colorModeForRenderPass(),V="$debug",X=d.style.terrain&&d.style.terrain.getTerrainData(s);a.activeTexture.set(m.TEXTURE0),d.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE);const H=t.getTileByID(s.key).latestRawTileData,le=Math.floor((H&&H.byteLength||0)/1024),ne=t.getTile(s).tileSize,ae=512/Math.min(ne,512)*(s.overscaledZ/d.transform.zoom)*.5;let xe=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(xe+=` => ${s.overscaledZ}`),function(Ee,Oe){Ee.initDebugOverlayCanvas();const ce=Ee.debugOverlayCanvas,Xe=Ee.context.gl,Ue=Ee.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,ce.width,ce.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(Oe,5,5),Ue.strokeText(Oe,5,5),Ee.debugOverlayTexture.update(ce),Ee.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(d,`${xe} ${le}kB`),E.draw(a,m.TRIANGLES,D,L,er.alphaBlended,ar.disabled,z(b,n.Color.transparent,ae),null,V,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),E.draw(a,m.LINE_STRIP,D,L,R,ar.disabled,z(b,n.Color.red),X,V,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function et(d,t,s){const a=d.context,m=a.gl,b=d.colorModeForRenderPass(),E=new Mi(m.LEQUAL,Mi.ReadWrite,d.depthRangeFor3D),D=d.useProgram("terrain"),L=t.getTerrainMesh(),R=t.getTerrainData(s.tileID);a.bindFramebuffer.set(null),a.viewport.set([0,0,d.width,d.height]),a.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const V=d.transform.calculatePosMatrix(s.tileID.toUnwrapped());D.draw(a,m.TRIANGLES,E,Yi.disabled,b,ar.backCCW,{u_matrix:V,u_texture:0},R,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}function Ft(d,t,s,a){const m=d.context,b=s.tileSize*t.qualityFactor;s.textures[a]||(s.textures[a]=d.getTileTexture(b)||new _(m,{width:b,height:b,data:null},m.gl.RGBA),s.textures[a].bind(m.gl.LINEAR,m.gl.CLAMP_TO_EDGE),a===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const E=t.getRTTFramebuffer();E.colorAttachment.set(s.textures[a].texture),m.bindFramebuffer.set(E.framebuffer),m.viewport.set([0,0,b,b])}class fi{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const m=t.sourceCaches[a].getVisibleCoordinates();for(const b of m){const E=s.sourceCache.getTerrainCoords(b);for(const D in E)this._coordsDescendingInv[a][D]||(this._coordsDescendingInv[a][D]=[]),this._coordsDescendingInv[a][D].push(E[D])}}for(const a of t._order){const m=t._layers[a],b=m.source;if(this._renderToTexture[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const E in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][E]=this._coordsDescendingInv[b][E].map(D=>D.key).sort().join()}}return this._renderableTiles.forEach(a=>{for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][a.tileID.key];b&&b!==a.textureCoords[m]&&a.clearTextures(this.painter),s.needsRerender(m,a.tileID)&&a.clearTextures(this.painter)}this._rerender[a.tileID.key]=!a.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,a=this.painter,m=a.style._order,b=a.currentLayer,E=b+1===m.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(m[b]),!E))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&E){this._prevType=s;const D=this._stacks.length-1,L=this._stacks[D]||[];for(const R of this._renderableTiles){if(Ft(a,a.style.terrain,R,D),this._rerender[R.tileID.key]){a.context.clear({color:n.Color.transparent});for(let V=0;V<L.length;V++){const X=a.style._layers[L[V]],H=X.source?this._coordsDescendingInv[X.source][R.tileID.key]:[R.tileID];a._renderTileClippingMasks(X,H),a.renderLayer(a,a.style.sourceCaches[X.source],X,H),X.source&&(R.textureCoords[X.source]=this._coordsDescendingInvStr[X.source][R.tileID.key])}}et(a,a.style.terrain,R)}if(s==="hillshade"){this._stacks.push([m[b]]);for(const R of this._renderableTiles){const V=this._coordsDescendingInv[t.source][R.tileID.key];Ft(a,a.style.terrain,R,this._stacks.length-1),a.context.clear({color:n.Color.transparent}),a._renderTileClippingMasks(t,V),a.renderLayer(a,a.style.sourceCaches[t.source],t,V),et(a,a.style.terrain,R)}return!0}return this._renderToTexture[s]}return!1}}const tr={symbol:function(d,t,s,a,m){if(d.renderPass!=="translucent")return;const b=Yi.disabled,E=d.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(D,L,R,V,X,H,le){const ne=L.transform,ae=X==="map",xe=H==="map";for(const Ee of D){const Oe=V.getTile(Ee),ce=Oe.getBucket(R);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const Xe=n.evaluateSizeForZoom(ce.textSizeData,ne.zoom),Ue=lr(Oe,1,L.transform.zoom),rt=Ri(Ee.posMatrix,xe,ae,L.transform,Ue),ot=R.layout.get("icon-text-fit")!=="none"&&ce.hasIconData();if(Xe){const St=Math.pow(2,ne.zoom-Oe.tileID.overscaledZ);Yo(ce,ae,xe,le,ne,rt,Ee.posMatrix,St,Xe,ot,L.style.terrain?(Qe,Xt)=>L.style.terrain.getElevation(Ee,Qe,Xt):null)}}}(a,d,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&Kn(d,t,s,a,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),b,E),s.paint.get("text-opacity").constantOr(1)!==0&&Kn(d,t,s,a,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),b,E),t.map.showCollisionBoxes&&(zs(d,t,s,a,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),zs(d,t,s,a,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,s,a){if(d.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),b=s.paint.get("circle-stroke-width"),E=s.paint.get("circle-stroke-opacity"),D=!s.layout.get("circle-sort-key").isConstant();if(m.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const L=d.context,R=L.gl,V=d.depthModeForSublayer(0,Mi.ReadOnly),X=Yi.disabled,H=d.colorModeForRenderPass(),le=[];for(let ne=0;ne<a.length;ne++){const ae=a[ne],xe=t.getTile(ae),Ee=xe.getBucket(s);if(!Ee)continue;const Oe=Ee.programConfigurations.get(s.id),ce=d.useProgram("circle",Oe),Xe=Ee.layoutVertexBuffer,Ue=Ee.indexBuffer,rt=d.style.terrain&&d.style.terrain.getTerrainData(ae),ot={programConfiguration:Oe,program:ce,layoutVertexBuffer:Xe,indexBuffer:Ue,uniformValues:Bo(d,ae,xe,s),terrainData:rt};if(D){const St=Ee.segments.get();for(const Qe of St)le.push({segments:new n.SegmentVector([Qe]),sortKey:Qe.sortKey,state:ot})}else le.push({segments:Ee.segments,sortKey:0,state:ot})}D&&le.sort((ne,ae)=>ne.sortKey-ae.sortKey);for(const ne of le){const{programConfiguration:ae,program:xe,layoutVertexBuffer:Ee,indexBuffer:Oe,uniformValues:ce,terrainData:Xe}=ne.state;xe.draw(L,R.TRIANGLES,V,X,H,ar.disabled,ce,Xe,s.id,Ee,Oe,ne.segments,s.paint,d.transform.zoom,ae)}},heatmap:function(d,t,s,a){if(s.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const m=d.context,b=m.gl,E=Yi.disabled,D=new er([b.ONE,b.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(L,R,V){const X=L.gl;L.activeTexture.set(X.TEXTURE1),L.viewport.set([0,0,R.width/4,R.height/4]);let H=V.heatmapFbo;if(H)X.bindTexture(X.TEXTURE_2D,H.colorAttachment.get()),L.bindFramebuffer.set(H.framebuffer);else{const le=X.createTexture();X.bindTexture(X.TEXTURE_2D,le),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),H=V.heatmapFbo=L.createFramebuffer(R.width/4,R.height/4,!1),function(ne,ae,xe,Ee){const Oe=ne.gl;Oe.texImage2D(Oe.TEXTURE_2D,0,Oe.RGBA,ae.width/4,ae.height/4,0,Oe.RGBA,ne.extRenderToTextureHalfFloat?ne.extTextureHalfFloat.HALF_FLOAT_OES:Oe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(xe)}(L,R,le,H)}})(m,d,s),m.clear({color:n.Color.transparent});for(let L=0;L<a.length;L++){const R=a[L];if(t.hasRenderableParent(R))continue;const V=t.getTile(R),X=V.getBucket(s);if(!X)continue;const H=X.programConfigurations.get(s.id),le=d.useProgram("heatmap",H),{zoom:ne}=d.transform;le.draw(m,b.TRIANGLES,Mi.disabled,E,D,ar.disabled,ve(R.posMatrix,V,ne,s.paint.get("heatmap-intensity")),null,s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,d.transform.zoom,H)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,b){const E=m.context,D=E.gl,L=b.heatmapFbo;if(!L)return;E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,L.colorAttachment.get()),E.activeTexture.set(D.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new _(E,b.colorRamp,D.RGBA)),R.bind(D.LINEAR,D.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(E,D.TRIANGLES,Mi.disabled,Yi.disabled,m.colorModeForRenderPass(),ar.disabled,((V,X,H,le)=>{const ne=n.create();n.ortho(ne,0,V.width,V.height,0,0,1);const ae=V.context.gl;return{u_matrix:ne,u_world:[ae.drawingBufferWidth,ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(m,b),null,b.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,b.paint,m.transform.zoom)}(d,s))},line:function(d,t,s,a){if(d.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),b=s.paint.get("line-width");if(m.constantOr(1)===0||b.constantOr(1)===0)return;const E=d.depthModeForSublayer(0,Mi.ReadOnly),D=d.colorModeForRenderPass(),L=s.paint.get("line-dasharray"),R=s.paint.get("line-pattern"),V=R.constantOr(1),X=s.paint.get("line-gradient"),H=s.getCrossfadeParameters(),le=V?"linePattern":L?"lineSDF":X?"lineGradient":"line",ne=d.context,ae=ne.gl;let xe=!0;for(const Ee of a){const Oe=t.getTile(Ee);if(V&&!Oe.patternsLoaded())continue;const ce=Oe.getBucket(s);if(!ce)continue;const Xe=ce.programConfigurations.get(s.id),Ue=d.context.program.get(),rt=d.useProgram(le,Xe),ot=xe||rt.program!==Ue,St=d.style.terrain&&d.style.terrain.getTerrainData(Ee),Qe=R.constantOr(null);if(Qe&&Oe.imageAtlas){const Kt=Oe.imageAtlas,Ci=Kt.patternPositions[Qe.to.toString()],Pi=Kt.patternPositions[Qe.from.toString()];Ci&&Pi&&Xe.setConstantPatternPositions(Ci,Pi)}const Xt=St?Ee:null,Lt=V?Ct(d,Oe,s,H,Xt):L?bt(d,Oe,s,L,H,Xt):X?ke(d,Oe,s,ce.lineClipsArray.length,Xt):Te(d,Oe,s,Xt);if(V)ne.activeTexture.set(ae.TEXTURE0),Oe.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Xe.updatePaintBuffers(H);else if(L&&(ot||d.lineAtlas.dirty))ne.activeTexture.set(ae.TEXTURE0),d.lineAtlas.bind(ne);else if(X){const Kt=ce.gradients[s.id];let Ci=Kt.texture;if(s.gradientVersion!==Kt.version){let Pi=256;if(s.stepInterpolant){const hi=t.getSource().maxzoom,ir=Ee.canonical.z===hi?Math.ceil(1<<d.transform.maxZoom-Ee.canonical.z):1;Pi=n.clamp(n.nextPowerOfTwo(ce.maxLineLength/n.EXTENT*1024*ir),256,ne.maxTextureSize)}Kt.gradient=n.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Pi,image:Kt.gradient||void 0,clips:ce.lineClipsArray}),Kt.texture?Kt.texture.update(Kt.gradient):Kt.texture=new _(ne,Kt.gradient,ae.RGBA),Kt.version=s.gradientVersion,Ci=Kt.texture}ne.activeTexture.set(ae.TEXTURE0),Ci.bind(s.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}rt.draw(ne,ae.TRIANGLES,E,d.stencilModeForClipping(Ee),D,ar.disabled,Lt,St,s.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,s.paint,d.transform.zoom,Xe,ce.layoutVertexBuffer2),xe=!1}},fill:function(d,t,s,a){const m=s.paint.get("fill-color"),b=s.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=d.colorModeForRenderPass(),D=s.paint.get("fill-pattern"),L=d.opaquePassEnabledForLayer()&&!D.constantOr(1)&&m.constantOr(n.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===L){const R=d.depthModeForSublayer(1,d.renderPass==="opaque"?Mi.ReadWrite:Mi.ReadOnly);wn(d,t,s,a,R,E,!1)}if(d.renderPass==="translucent"&&s.paint.get("fill-antialias")){const R=d.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Mi.ReadOnly);wn(d,t,s,a,R,E,!0)}},"fill-extrusion":function(d,t,s,a){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&d.renderPass==="translucent"){const b=new Mi(d.context.gl.LEQUAL,Mi.ReadWrite,d.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Qs(d,t,s,a,b,Yi.disabled,er.disabled),Qs(d,t,s,a,b,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const E=d.colorModeForRenderPass();Qs(d,t,s,a,b,Yi.disabled,E)}}},hillshade:function(d,t,s,a){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const m=d.context,b=d.depthModeForSublayer(0,Mi.ReadOnly),E=d.colorModeForRenderPass(),[D,L]=d.renderPass==="translucent"?d.stencilConfigForOverlap(a):[{},a];for(const R of L){const V=t.getTile(R);V.needsHillshadePrepare!==void 0&&V.needsHillshadePrepare&&d.renderPass==="offscreen"?Ho(d,V,s,b,Yi.disabled,E):d.renderPass==="translucent"&&Jn(d,R,V,s,b,D[R.overscaledZ],E)}m.viewport.set([0,0,d.width,d.height])},raster:function(d,t,s,a){if(d.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!a.length)return;const m=d.context,b=m.gl,E=t.getSource(),D=d.useProgram("raster"),L=d.colorModeForRenderPass(),[R,V]=E instanceof Q?[{},a]:d.stencilConfigForOverlap(a),X=V[V.length-1].overscaledZ,H=!d.options.moving;for(const le of V){const ne=d.depthModeForSublayer(le.overscaledZ-X,s.paint.get("raster-opacity")===1?Mi.ReadWrite:Mi.ReadOnly,b.LESS),ae=t.getTile(le);ae.registerFadeDuration(s.paint.get("raster-fade-duration"));const xe=t.findLoadedParent(le,0),Ee=Co(ae,xe,t,s,d.transform,d.style.terrain);let Oe,ce;const Xe=s.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;m.activeTexture.set(b.TEXTURE0),ae.texture.bind(Xe,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),m.activeTexture.set(b.TEXTURE1),xe?(xe.texture.bind(Xe,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),Oe=Math.pow(2,xe.tileID.overscaledZ-ae.tileID.overscaledZ),ce=[ae.tileID.canonical.x*Oe%1,ae.tileID.canonical.y*Oe%1]):ae.texture.bind(Xe,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);const Ue=d.style.terrain&&d.style.terrain.getTerrainData(le),rt=Ue?le:null,ot=rt?rt.posMatrix:d.transform.calculatePosMatrix(le.toUnwrapped(),H),St=Dt(ot,ce||[0,0],Oe||1,Ee,s);E instanceof Q?D.draw(m,b.TRIANGLES,ne,Yi.disabled,L,ar.disabled,St,Ue,s.id,E.boundsBuffer,d.quadTriangleIndexBuffer,E.boundsSegments):D.draw(m,b.TRIANGLES,ne,R[le.overscaledZ],L,ar.disabled,St,Ue,s.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,t,s,a){const m=s.paint.get("background-color"),b=s.paint.get("background-opacity");if(b===0)return;const E=d.context,D=E.gl,L=d.transform,R=L.tileSize,V=s.paint.get("background-pattern");if(d.isPatternMissing(V))return;const X=!V&&m.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==X)return;const H=Yi.disabled,le=d.depthModeForSublayer(0,X==="opaque"?Mi.ReadWrite:Mi.ReadOnly),ne=d.colorModeForRenderPass(),ae=d.useProgram(V?"backgroundPattern":"background"),xe=a||L.coveringTiles({tileSize:R,terrain:d.style.terrain});V&&(E.activeTexture.set(D.TEXTURE0),d.imageManager.bind(d.context));const Ee=s.getCrossfadeParameters();for(const Oe of xe){const ce=a?Oe.posMatrix:d.transform.calculatePosMatrix(Oe.toUnwrapped()),Xe=V?ti(ce,b,d,V,{tileID:Oe,tileSize:R},Ee):mt(ce,b,m),Ue=d.style.terrain&&d.style.terrain.getTerrainData(Oe);ae.draw(E,D.TRIANGLES,le,H,ne,ar.disabled,Xe,Ue,s.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}},debug:function(d,t,s){for(let a=0;a<s.length;a++)Ie(d,t,s[a])},custom:function(d,t,s){const a=d.context,m=s.implementation;if(d.renderPass==="offscreen"){const b=m.prerender;b&&(d.setCustomLayerDefaults(),a.setColorMode(d.colorModeForRenderPass()),b.call(m,a.gl,d.transform.customLayerMatrix()),a.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),a.setColorMode(d.colorModeForRenderPass()),a.setStencilMode(Yi.disabled);const b=m.renderingMode==="3d"?new Mi(d.context.gl.LEQUAL,Mi.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Mi.ReadOnly);a.setDepthMode(b),m.render(a.gl,d.transform.customLayerMatrix()),a.setDirty(),d.setBaseState(),a.bindFramebuffer.set(null)}}};class zi{constructor(t,s){this.context=new Zn(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.create(),renderTime:0},this.setup(),this.numSublayers=be.maxUnderzooming+be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gi,this.gpuTimers={}}resize(t,s,a){if(this.width=t*a,this.height=s*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,s=new n.PosArray;s.emplaceBack(0,0),s.emplaceBack(n.EXTENT,0),s.emplaceBack(0,n.EXTENT),s.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,Li.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const a=new n.PosArray;a.emplaceBack(0,0),a.emplaceBack(n.EXTENT,0),a.emplaceBack(0,n.EXTENT),a.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=t.createVertexBuffer(a,Li.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const m=new n.RasterBoundsArray;m.emplaceBack(0,0,0,0),m.emplaceBack(n.EXTENT,0,n.EXTENT,0),m.emplaceBack(0,n.EXTENT,0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(m,Pt.members),this.rasterBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const b=new n.PosArray;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Li.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const E=new n.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(E);const D=new n.TriangleIndexArray;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D),this.emptyTexture=new _(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const L=this.context.gl;this.stencilClearMode=new Yi({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=n.create();n.ortho(a,0,this.width,this.height,0,0,1),n.scale(a,a,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Mi.disabled,this.stencilClearMode,er.disabled,ar.disabled,q(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const a=this.context,m=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(er.disabled),a.setDepthMode(Mi.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of s){const D=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,L=this.style.terrain&&this.style.terrain.getTerrainData(E);b.draw(a,m.TRIANGLES,Mi.disabled,new Yi({func:m.ALWAYS,mask:0},D,255,m.KEEP,m.KEEP,m.REPLACE),er.disabled,ar.disabled,q(E.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Yi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Yi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,a=t.sort((E,D)=>D.overscaledZ-E.overscaledZ),m=a[a.length-1].overscaledZ,b=a[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let D=0;D<b;D++)E[D+m]=new Yi({func:s.GEQUAL,mask:255},D+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=b,[E,a]}return[{[m]:Yi.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new er([t.CONSTANT_COLOR,t.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?er.unblended:er.alphaBlended}depthModeForSublayer(t,s,a){if(!this.opaquePassEnabledForLayer())return Mi.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Mi(a||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const a=this.style._order,m=this.style.sourceCaches,b=this.style.terrain&&new fi(this);for(const R in m){const V=m[R];V.used&&V.prepare(this.context)}const E={},D={},L={};for(const R in m){const V=m[R];E[R]=V.getVisibleCoordinates(),D[R]=E[R].slice().reverse(),L[R]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<a.length;R++)if(this.style._layers[a[R]].is3D()){this.opaquePassCutoff=R;break}if(b){this.opaquePassCutoff=0;const R=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!n.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||R.length)&&(n.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(V,X){const H=V.context,le=H.gl,ne=er.unblended,ae=new Mi(le.LEQUAL,Mi.ReadWrite,[0,1]),xe=X.getTerrainMesh(),Ee=X.sourceCache.getRenderableTiles(),Oe=V.useProgram("terrainDepth");H.bindFramebuffer.set(X.getFramebuffer("depth").framebuffer),H.viewport.set([0,0,V.width/devicePixelRatio,V.height/devicePixelRatio]),H.clear({color:n.Color.transparent,depth:1});for(const ce of Ee){const Xe=X.getTerrainData(ce.tileID),Ue=V.transform.calculatePosMatrix(ce.tileID.toUnwrapped());Oe.draw(H,le.TRIANGLES,ae,Yi.disabled,ne,ar.backCCW,{u_matrix:Ue},Xe,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments)}H.bindFramebuffer.set(null),H.viewport.set([0,0,V.width,V.height])}(this,this.style.terrain),function(V,X){const H=V.context,le=H.gl,ne=er.unblended,ae=new Mi(le.LEQUAL,Mi.ReadWrite,[0,1]),xe=X.getTerrainMesh(),Ee=X.getCoordsTexture(),Oe=X.sourceCache.getRenderableTiles(),ce=V.useProgram("terrainCoords");H.bindFramebuffer.set(X.getFramebuffer("coords").framebuffer),H.viewport.set([0,0,V.width/devicePixelRatio,V.height/devicePixelRatio]),H.clear({color:n.Color.transparent,depth:1}),X.coordsIndex=[];for(const Xe of Oe){const Ue=X.getTerrainData(Xe.tileID);H.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_2D,Ee.texture);const rt=V.transform.calculatePosMatrix(Xe.tileID.toUnwrapped());ce.draw(H,le.TRIANGLES,ae,Yi.disabled,ne,ar.backCCW,{u_matrix:rt,u_terrain_coords_id:(255-X.coordsIndex.length)/255,u_texture:0},Ue,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments),X.coordsIndex.push(Xe.tileID.key)}H.bindFramebuffer.set(null),H.viewport.set([0,0,V.width,V.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const R of a){const V=this.style._layers[R];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const X=D[V.source];(V.type==="custom"||X.length)&&this.renderLayer(this,m[V.source],V,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!b)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[a[this.currentLayer]],V=m[R.source],X=E[R.source];this._renderTileClippingMasks(R,X),this.renderLayer(this,V,R,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const R=this.style._layers[a[this.currentLayer]],V=m[R.source];if(b&&b.renderLayer(R))continue;const X=(R.type==="symbol"?L:D)[R.source];this._renderTileClippingMasks(R,E[R.source]),this.renderLayer(this,V,R,X)}if(this.options.showTileBoundaries){let R,V;Object.values(this.style._layers).forEach(X=>{X.source&&!X.isHidden(this.transform.zoom)&&(X.source!==(V&&V.id)&&(V=this.style.sourceCaches[X.source]),(!R||R.getSource().maxzoom<V.getSource().maxzoom)&&(R=V))}),R&&tr.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const V=R.transform.padding;In(R,R.transform.height-(V.top||0),3,Ss),In(R,V.bottom||0,3,pn),Fs(R,V.left||0,3,Zo),Fs(R,R.transform.width-(V.right||0),3,To);const X=R.transform.centerPoint;(function(H,le,ne,ae){Rs(H,le-1,ne-10,2,20,ae),Rs(H,le-10,ne-1,20,2,ae)})(R,X.x,R.transform.height-X.y,Ko)}(this),this.context.setDefault()}renderLayer(t,s,a,m){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(m||[]).length)&&(this.id=a.id,this.gpuTimingStart(a),tr[a.type](t,s,a,m,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let a=this.gpuTimers[t.id];a||(a=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),a.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,a.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const a in t){const m=t[a],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(m.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(m.query),s[a]=E}return s}translatePosMatrix(t,s,a,m,b){if(!a[0]&&!a[1])return t;const E=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const R=Math.sin(E),V=Math.cos(E);a=[a[0]*V-a[1]*R,a[0]*R+a[1]*V]}const D=[b?a[0]:lr(s,a[0],this.transform.zoom),b?a[1]:lr(s,a[1],this.transform.zoom),0],L=new Float32Array(16);return n.translate(L,t,D),L}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!s||!a}useProgram(t,s){this.cache=this.cache||{};const a=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new ca(this.context,t,xs[t],s,qi[t],this._showOverdrawInspector,this.style.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class ur{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,a){const m=Math.pow(2,a),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const L=1/(D=n.transformMat4([],D,t))[3]/s*m;return n.mul$1(D,D,[L,L,1/D[3],L])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const L=n.sub([],b[D[0]],b[D[1]]),R=n.sub([],b[D[2]],b[D[1]]),V=n.normalize([],n.cross([],L,R)),X=-n.dot(V,b[D[1]]);return V.concat(X)});return new ur(b,E)}}class pr{constructor(t,s){this.min=t,this.max=s,this.center=n.scale$1([],n.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],a=n.clone$2(this.min),m=n.clone$2(this.max);for(let b=0;b<s.length;b++)a[b]=s[b]?this.min[b]:this.center[b],m[b]=s[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new pr(a,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let m=0;m<t.planes.length;m++){const b=t.planes[m];let E=0;for(let D=0;D<s.length;D++)n.dot$1(b,s[D])>=0&&E++;if(E===0)return 0;E!==s.length&&(a=!1)}if(a)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const L=t.points[D][m]-this.min[m];b=Math.min(b,L),E=Math.max(E,L)}if(E<0||b>this.max[m]-this.min[m])return 0}return 1}}class Nr{constructor(t=0,s=0,a=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(a)||a<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=a,this.right=m}interpolate(t,s,a){return s.top!=null&&t.top!=null&&(this.top=n.number(t.top,s.top,a)),s.bottom!=null&&t.bottom!=null&&(this.bottom=n.number(t.bottom,s.bottom,a)),s.left!=null&&t.left!=null&&(this.left=n.number(t.left,s.left,a)),s.right!=null&&t.right!=null&&(this.right=n.number(t.right,s.right,a)),this}getCenter(t,s){const a=n.clamp((this.left+t-this.right)/2,0,t),m=n.clamp((this.top+s-this.bottom)/2,0,s);return new n.pointGeometry(a,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Nr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class _r{constructor(t,s,a,m,b){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=b===void 0||!!b,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=a==null?0:a,this._maxPitch=m==null?60:m,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Nr,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new _r(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-n.wrap(t,-180,180)*Math.PI/180;var a;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(a=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),function(m,b,E){var D=b[0],L=b[1],R=b[2],V=b[3],X=Math.sin(E),H=Math.cos(E);m[0]=D*H+R*X,m[1]=L*H+V*X,m[2]=D*-X+R*H,m[3]=L*-X+V*H}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=n.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,a){this._unmodified=!1,this._edgeInsets.interpolate(t,s,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new n.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new n.pointGeometry(0,0)),m=this.pointCoordinate(new n.pointGeometry(this.width,0)),b=this.pointCoordinate(new n.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new n.pointGeometry(0,this.height)),D=Math.floor(Math.min(a.x,m.x,b.x,E.x)),L=Math.floor(Math.max(a.x,m.x,b.x,E.x)),R=1;for(let V=D-R;V<=L+R;V++)V!==0&&s.push(new n.UnwrappedTileID(V,t))}return s}coveringTiles(t){var s,a;let m=this.coveringZoomLevel(t);const b=m;if(t.minzoom!==void 0&&m<t.minzoom)return[];t.maxzoom!==void 0&&m>t.maxzoom&&(m=t.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),D=n.MercatorCoordinate.fromLngLat(this.center),L=Math.pow(2,m),R=[L*E.x,L*E.y,0],V=[L*D.x,L*D.y,0],X=ur.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let H=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=m);const le=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,ne=ce=>({aabb:new pr([ce*L,0,0],[(ce+1)*L,L,0]),zoom:0,x:0,y:0,wrap:ce,fullyVisible:!1}),ae=[],xe=[],Ee=m,Oe=t.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let ce=1;ce<=3;ce++)ae.push(ne(-ce)),ae.push(ne(ce));for(ae.push(ne(0));ae.length>0;){const ce=ae.pop(),Xe=ce.x,Ue=ce.y;let rt=ce.fullyVisible;if(!rt){const Kt=ce.aabb.intersects(X);if(Kt===0)continue;rt=Kt===2}const ot=t.terrain?R:V,St=ce.aabb.distanceX(ot),Qe=ce.aabb.distanceY(ot),Xt=Math.max(Math.abs(St),Math.abs(Qe)),Lt=le+(1<<Ee-ce.zoom)-2;if(ce.zoom===Ee||Xt>Lt&&ce.zoom>=H){const Kt=Ee-ce.zoom,Ci=R[0]-.5-(Xe<<Kt),Pi=R[1]-.5-(Ue<<Kt);xe.push({tileID:new n.OverscaledTileID(ce.zoom===Ee?Oe:ce.zoom,ce.wrap,ce.zoom,Xe,Ue),distanceSq:n.sqrLen([V[0]-.5-Xe,V[1]-.5-Ue]),tileDistanceToCamera:Math.sqrt(Ci*Ci+Pi*Pi)})}else for(let Kt=0;Kt<4;Kt++){const Ci=(Xe<<1)+Kt%2,Pi=(Ue<<1)+(Kt>>1),hi=ce.zoom+1;let ir=ce.aabb.quadrant(Kt);if(t.terrain){const rr=new n.OverscaledTileID(hi,ce.wrap,hi,Ci,Pi),Ni=t.terrain.getMinMaxElevation(rr),Gi=(s=Ni.minElevation)!==null&&s!==void 0?s:this.elevation,nr=(a=Ni.maxElevation)!==null&&a!==void 0?a:this.elevation;ir=new pr([ir.min[0],ir.min[1],Gi],[ir.max[0],ir.max[1],nr])}ae.push({aabb:ir,zoom:hi,x:Ci,y:Pi,wrap:ce.wrap,fullyVisible:rt})}}return xe.sort((ce,Xe)=>ce.distanceSq-Xe.distanceSq).map(ce=>ce.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=n.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new n.pointGeometry(n.mercatorXfromLng(t.lng)*this.worldSize,n.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new n.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const a=n.MercatorCoordinate.fromLngLat(t),m=(1<<this.tileZoom)*n.EXTENT,b=a.x*m,E=a.y*m,D=Math.floor(b/n.EXTENT),L=Math.floor(E/n.EXTENT),R=new n.OverscaledTileID(this.tileZoom,0,this.tileZoom,D,L);return s.getElevation(R,b%n.EXTENT,E%n.EXTENT,n.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),a=this.getElevation(s,t);if(!(this.elevation-a))return;const m=this.getCameraPosition(),b=n.MercatorCoordinate.fromLngLat(m.lngLat,m.altitude),E=n.MercatorCoordinate.fromLngLat(s,a),D=b.x-E.x,L=b.y-E.y,R=b.z-E.z,V=Math.sqrt(D*D+L*L+R*R),X=this.scaleZoom(this.cameraToCenterDistance/V/this.tileSize);this._elevation=a,this._center=s,this.zoom=X}setLocationAtPoint(t,s){const a=this.pointCoordinate(s),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(t),E=new n.MercatorCoordinate(b.x-(a.x-m.x),b.y-(a.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return n.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const H=s.pointCoordinate(t);if(H!=null)return H}const a=[t.x,t.y,0,1],m=[t.x,t.y,1,1];n.transformMat4(a,a,this.pixelMatrixInverse),n.transformMat4(m,m,this.pixelMatrixInverse);const b=a[3],E=m[3],D=a[1]/b,L=m[1]/E,R=a[2]/b,V=m[2]/E,X=R===V?0:(0-R)/(V-R);return new n.MercatorCoordinate(n.number(a[0]/b,m[0]/E,X)/this.worldSize,n.number(D,L,X)/this.worldSize)}coordinatePoint(t,s=0,a=this.pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,s,1];return n.transformMat4(m,m,a),new n.pointGeometry(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new n.LngLatBounds().extend(this.pointLocation(new n.pointGeometry(0,t))).extend(this.pointLocation(new n.pointGeometry(this.width,t))).extend(this.pointLocation(new n.pointGeometry(this.width,this.height))).extend(this.pointLocation(new n.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new n.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const a=t.key,m=s?this._alignedPosMatrixCache:this._posMatrixCache;if(m[a])return m[a];const b=t.canonical,E=this.worldSize/this.zoomScale(b.z),D=b.x+Math.pow(2,b.z)*t.wrap,L=n.identity(new Float64Array(16));return n.translate(L,L,[D*E,b.y*E,0]),n.scale(L,L,[E/n.EXTENT,E/n.EXTENT,1]),n.multiply(L,s?this.alignedProjMatrix:this.projMatrix,L),m[a]=new Float32Array(L),m[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,a,m,b=-90,E=90,D=-180,L=180;const R=this.size,V=this._unmodified;if(this.latRange){const le=this.latRange;b=n.mercatorYfromLat(le[1])*this.worldSize,E=n.mercatorYfromLat(le[0])*this.worldSize,t=E-b<R.y?R.y/(E-b):0}if(this.lngRange){const le=this.lngRange;D=n.wrap(n.mercatorXfromLng(le[0])*this.worldSize,0,this.worldSize),L=n.wrap(n.mercatorXfromLng(le[1])*this.worldSize,0,this.worldSize),L<D&&(L+=this.worldSize),s=L-D<R.x?R.x/(L-D):0}const X=this.point,H=Math.max(s||0,t||0);if(H)return this.center=this.unproject(new n.pointGeometry(s?(L+D)/2:X.x,t?(E+b)/2:X.y)),this.zoom+=this.scaleZoom(H),this._unmodified=V,void(this._constraining=!1);if(this.latRange){const le=X.y,ne=R.y/2;le-ne<b&&(m=b+ne),le+ne>E&&(m=E-ne)}if(this.lngRange){const le=(D+L)/2,ne=n.wrap(X.x,le-this.worldSize/2,le+this.worldSize/2),ae=R.x/2;ne-ae<D&&(a=D+ae),ne+ae>L&&(a=L-ae)}a===void 0&&m===void 0||(this.center=this.unproject(new n.pointGeometry(a!==void 0?a:X.x,m!==void 0?m:X.y)).wrap()),this._unmodified=V,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let m=n.identity(new Float64Array(16));n.scale(m,m,[this.width/2,-this.height/2,1]),n.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=n.identity(new Float64Array(16)),n.scale(m,m,[1,-1,1]),n.translate(m,m,[-1,-1,0]),n.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const b=Math.PI/2+this._pitch,E=this._fov*(.5+t.y/this.height),D=Math.sin(E)*this.cameraToSeaLevelDistance/Math.sin(n.clamp(Math.PI-b-E,.01,Math.PI-.01)),L=this.getHorizon(),R=2*Math.atan(L/this.cameraToCenterDistance)*(.5+t.y/(2*L)),V=Math.sin(R)*this.cameraToSeaLevelDistance/Math.sin(n.clamp(Math.PI-b-R,.01,Math.PI-.01)),X=Math.cos(Math.PI/2-this._pitch)*D+this.cameraToSeaLevelDistance,H=Math.cos(Math.PI/2-this._pitch)*V+this.cameraToSeaLevelDistance,le=1.01*Math.min(X,H),ne=this.height/50;m=new Float64Array(16),n.perspective(m,this._fov,this.width/this.height,ne,le),m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height,n.scale(m,m,[1,-1,1]),n.translate(m,m,[0,0,-this.cameraToCenterDistance]),n.rotateX(m,m,this._pitch),n.rotateZ(m,m,this.angle),n.translate(m,m,[-s,-a,0]),this.mercatorMatrix=n.scale([],m,[this.worldSize,this.worldSize,this.worldSize]),n.scale(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,m),n.translate(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=n.invert([],m),this.pixelMatrix3D=n.multiply(new Float64Array(16),this.labelPlaneMatrix,m);const ae=this.width%2/2,xe=this.height%2/2,Ee=Math.cos(this.angle),Oe=Math.sin(this.angle),ce=s-Math.round(s)+Ee*ae+Oe*xe,Xe=a-Math.round(a)+Ee*xe+Oe*ae,Ue=new Float64Array(m);if(n.translate(Ue,Ue,[ce>.5?ce-1:ce,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Ue,m=n.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new n.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return n.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let a=s.x,m=s.y,b=s.x,E=s.y;for(const D of t)a=Math.min(a,D.x),m=Math.min(m,D.y),b=Math.max(b,D.x),E=Math.max(E,D.y);return[new n.pointGeometry(a,m),new n.pointGeometry(b,m),new n.pointGeometry(b,E),new n.pointGeometry(a,E),new n.pointGeometry(a,m)]}}}class Pr{constructor(t){this._hashName=t&&encodeURIComponent(t),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,a){let m=!1,b=null;const E=()=>{b=null,m&&(s(),b=setTimeout(E,300),m=!1)};return()=>(m=!0,b||E(),b)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,m=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),E=Math.round(s.lng*b)/b,D=Math.round(s.lat*b)/b,L=this._map.getBearing(),R=this._map.getPitch();let V="";if(V+=t?`/${E}/${D}/${a}`:`${a}/${D}/${E}`,(L||R)&&(V+="/"+Math.round(10*L)/10),R&&(V+=`/${Math.round(R)}`),this._hashName){const X=this._hashName;let H=!1;const le=window.location.hash.slice(1).split("&").map(ne=>{const ae=ne.split("=")[0];return ae===X?(H=!0,`${ae}=${V}`):ne}).filter(ne=>ne);return H||le.push(`${X}=${V}`),`#${le.join("&")}`}return`#${V}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(s=a)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const nn={linearity:.3,easing:n.bezier(0,0,.3,1)},Fn=n.extend({deceleration:2500,maxSpeed:1400},nn),Gr=n.extend({deceleration:20,maxSpeed:1400},nn),Rn=n.extend({deceleration:1e3,maxSpeed:360},nn),An=n.extend({deceleration:1e3,maxSpeed:90},nn);class eo{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=n.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new n.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)s.zoom+=b.zoomDelta||0,s.bearing+=b.bearingDelta||0,s.pitch+=b.pitchDelta||0,b.panDelta&&s.pan._add(b.panDelta),b.around&&(s.around=b.around),b.pinchAround&&(s.pinchAround=b.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const b=Qn(s.pan.mag(),a,n.extend({},Fn,t||{}));m.offset=s.pan.mult(b.amount/s.pan.mag()),m.center=this._map.transform.center,Bn(m,b)}if(s.zoom){const b=Qn(s.zoom,a,Gr);m.zoom=this._map.transform.zoom+b.amount,Bn(m,b)}if(s.bearing){const b=Qn(s.bearing,a,Rn);m.bearing=this._map.transform.bearing+n.clamp(b.amount,-179,179),Bn(m,b)}if(s.pitch){const b=Qn(s.pitch,a,An);m.pitch=this._map.transform.pitch+b.amount,Bn(m,b)}if(m.zoom||m.bearing){const b=s.pinchAround===void 0?s.around:s.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),n.extend(m,{noMoveStart:!0})}}function Bn(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Qn(d,t,s){const{maxSpeed:a,linearity:m,deceleration:b}=s,E=n.clamp(d*m/(t/1e3),-a,a),D=Math.abs(E)/(b*m);return{easing:s.easing,duration:1e3*D,amount:E*(D/2)}}class sn extends n.Event{constructor(t,s,a,m={}){const b=l.mousePos(s.getCanvasContainer(),a),E=s.unproject(b);super(t,n.extend({point:b,lngLat:E,originalEvent:a},m)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class to extends n.Event{constructor(t,s,a){const m=t==="touchend"?a.changedTouches:a.touches,b=l.touchPos(s.getCanvasContainer(),m),E=b.map(L=>s.unproject(L)),D=b.reduce((L,R,V,X)=>L.add(R.div(X.length)),new n.pointGeometry(0,0));super(t,{points:b,point:D,lngLats:E,lngLat:s.unproject(D),originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class mn extends n.Event{constructor(t,s,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class sr{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new mn(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new sn(t.type,this._map,t))}mouseup(t){this._map.fire(new sn(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new sn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new sn(t.type,this._map,t))}mouseover(t){this._map.fire(new sn(t.type,this._map,t))}mouseout(t){this._map.fire(new sn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new to(t.type,this._map,t))}touchmove(t){this._map.fire(new to(t.type,this._map,t))}touchend(t){this._map.fire(new to(t.type,this._map,t))}touchcancel(t){this._map.fire(new to(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ji{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new sn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new sn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class io{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(l.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const a=s;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=a,this._box||(this._box=l.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(m.x,a.x),E=Math.max(m.x,a.x),D=Math.min(m.y,a.y),L=Math.max(m.y,a.y);l.setTransform(this._box,`translate(${b}px,${D}px)`),this._box.style.width=E-b+"px",this._box.style.height=L-D+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const a=this._startPos,m=s;if(this.reset(),l.suppressClick(),a.x!==m.x||a.y!==m.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(a,m,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(l.remove(this._box),this._box=null),l.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new n.Event(t,{originalEvent:s}))}}function Xr(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);const s={};for(let a=0;a<d.length;a++)s[d[a].identifier]=t[a];return s}class Cs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(m){const b=new n.pointGeometry(0,0);for(const E of m)b._add(E);return b.div(m.length)}(s),this.touches=Xr(a,s)))}touchmove(t,s,a){if(this.aborted||!this.centroid)return;const m=Xr(a,s);for(const b in this.touches){const E=this.touches[b],D=m[b];(!D||D.dist(E)>30)&&(this.aborted=!0)}}touchend(t,s,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class on{constructor(t){this.singleTap=new Cs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,a){this.singleTap.touchstart(t,s,a)}touchmove(t,s,a){this.singleTap.touchmove(t,s,a)}touchend(t,s,a){const m=this.singleTap.touchend(t,s,a);if(m){const b=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(b&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class es{constructor(){this._zoomIn=new on({numTouches:1,numTaps:2}),this._zoomOut=new on({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,a){this._zoomIn.touchstart(t,s,a),this._zoomOut.touchstart(t,s,a)}touchmove(t,s,a){this._zoomIn.touchmove(t,s,a),this._zoomOut.touchmove(t,s,a)}touchend(t,s,a){const m=this._zoomIn.touchend(t,s,a),b=this._zoomOut.touchend(t,s,a);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(m)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const us={0:1,2:2};class ds{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const a=l.mouseButton(t);this._correctButton(t,a)&&(this._lastPoint=s,this._eventButton=a)}mousemoveWindow(t,s){const a=this._lastPoint;if(a){if(t.preventDefault(),function(m,b){const E=us[b];return m.buttons===void 0||(m.buttons&E)!==E}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(a,s)}}mouseupWindow(t){this._lastPoint&&l.mouseButton(t)===this._eventButton&&(this._moved&&l.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fs extends ds{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class an extends ds{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const a=.8*(s.x-t.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(t){t.preventDefault()}}class Ut extends ds{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const a=-.5*(s.y-t.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(t){t.preventDefault()}}class Jo{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,a){return this._calculateTransform(t,s,a)}touchmove(t,s,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,a)}touchend(t,s,a){this._calculateTransform(t,s,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,a){a.length>0&&(this._active=!0);const m=Xr(a,s),b=new n.pointGeometry(0,0),E=new n.pointGeometry(0,0);let D=0;for(const R in m){const V=m[R],X=this._touches[R];X&&(b._add(V),E._add(V.sub(X)),D++,m[R]=V)}if(this._touches=m,D<this._minTouches||!E.mag())return;const L=E.div(D);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(D),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Un{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,a){return{}}touchstart(t,s,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,a){if(!this._firstTwoTouches)return;t.preventDefault();const[m,b]=this._firstTwoTouches,E=jn(a,s,m),D=jn(a,s,b);if(!E||!D)return;const L=this._aroundCenter?null:E.add(D).div(2);return this._move([E,D],L,t)}touchend(t,s,a){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,E=jn(a,s,m),D=jn(a,s,b);E&&D||(this._active&&l.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jn(d,t,s){for(let a=0;a<d.length;a++)if(d[a].identifier===s)return t[a]}function Bs(d,t){return Math.log(d/t)/Math.LN2}class Ot extends Un{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Bs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bs(this._distance,a),pinchAround:s}}}function ro(d,t){return 180*d.angleWith(t)/Math.PI}class Eo extends Un{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ro(this._vector,a),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,a=ro(t,this._startVector);return Math.abs(a)<s}}function Us(d){return Math.abs(d.y)>Math.abs(d.x)}class za extends Un{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,a){super.touchstart(t,s,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Us(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,a){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,b=s.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const E=t.y>0==s.y>0;return Us(t)&&Us(s)&&E}}const yl={panStep:100,bearingStep:15,pitchStep:10};class vl{constructor(){const t=yl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,a=0,m=0,b=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(a=0,m=0),{cameraAnimation:D=>{const L=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Jl,zoom:s?Math.round(L)+s*(t.shiftKey?2:1):L,bearing:D.getBearing()+a*this._bearingStep,pitch:D.getPitch()+m*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:D.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jl(d){return d*(2-d)}const xl=4.000244140625;class Fa{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=n.exported.now(),m=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,s!==0&&s%xl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=l.mousePos(this._el,t);this._around=n.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>xl?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const R=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(R*L))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,m=this._easing;let b,E=!1;if(this._type==="wheel"&&a&&m){const D=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),L=m(D);b=n.number(a,s,L),D<1?this._frameId||(this._frameId=!0):E=!0}else b=s,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=n.ease;if(this._prevEase){const a=this._prevEase,m=(n.exported.now()-a.start)/a.duration,b=a.easing(m+.01)-a.easing(m),E=.27/Math.sqrt(b*b+1e-4)*.01,D=Math.sqrt(.0729-E*E);s=n.bezier(E,D,.25,1)}return this._prevEase={start:n.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class Ra{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ba{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(t.shiftKey?-1:1),around:a.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ua{constructor(){this._tap=new on({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,a){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=s[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(t,s,a))}touchmove(t,s,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const m=s[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,s,a)}touchend(t,s,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(t,s,a)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sn{constructor(t,s,a){this._el=t,this._mousePan=s,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class js{constructor(t,s,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bl{constructor(t,s,a,m){this._el=t,this._touchZoom=s,this._touchRotate=a,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Po=d=>d.zoom||d.drag||d.pitch||d.rotate;class ja extends n.Event{}function Qo(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class wl{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new eo(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),n.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,E]of this._listeners)l.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,s,a]of this._listeners)l.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const s=this._map,a=s.getCanvasContainer();this._add("mapEvent",new sr(s,t));const m=s.boxZoom=new io(s,t);this._add("boxZoom",m);const b=new es,E=new Ba;s.doubleClickZoom=new Ra(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const D=new Ua;this._add("tapDragZoom",D);const L=s.touchPitch=new za(s);this._add("touchPitch",L);const R=new an(t),V=new Ut(t);s.dragRotate=new js(t,R,V),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const X=new fs(t),H=new Jo(t,s);s.dragPan=new Sn(a,X,H),this._add("mousePan",X),this._add("touchPan",H,["touchZoom","touchRotate"]);const le=new Eo,ne=new Ot;s.touchZoomRotate=new bl(a,ne,le,D),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]);const ae=s.scrollZoom=new Fa(s,this);this._add("scrollZoom",ae,["mousePan"]);const xe=s.keyboard=new vl;this._add("keyboard",xe),this._add("blockableMapEvent",new ji(s));for(const Ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Ee]&&s[Ee].enable(t[Ee])}_add(t,s,a){this._handlers.push({handlerName:t,handler:s,allowed:a}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Po(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,a){for(const m in t)if(m!==a&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const a of t)this._el.contains(a.target)&&s.push(a);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=t.type==="renderFrame"?void 0:t,m={needsRenderFrame:!1},b={},E={},D=t.touches,L=D?this._getMapTouches(D):void 0,R=L?l.touchPos(this._el,L):l.mousePos(this._el,t);for(const{handlerName:H,handler:le,allowed:ne}of this._handlers){if(!le.isEnabled())continue;let ae;this._blockedByActive(E,ne,H)?le.reset():le[s||t.type]&&(ae=le[s||t.type](t,R,L),this.mergeHandlerResult(m,b,ae,H,a),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||le.isActive())&&(E[H]=le)}const V={};for(const H in this._previousActiveHandlers)E[H]||(V[H]=a);this._previousActiveHandlers=E,(Object.keys(V).length||Qo(m))&&(this._changes.push([m,b,V]),this._triggerRenderFrame()),(Object.keys(E).length||Qo(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=m;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(t,s,a,m,b){if(!a)return;n.extend(t,a);const E={handlerName:m,originalEvent:a.originalEvent||b};a.zoomDelta!==void 0&&(s.zoom=E),a.panDelta!==void 0&&(s.drag=E),a.pitchDelta!==void 0&&(s.pitch=E),a.bearingDelta!==void 0&&(s.rotate=E)}_applyChanges(){const t={},s={},a={};for(const[m,b,E]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new n.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),n.extend(s,b),n.extend(a,E);this._updateMapTransform(t,s,a),this._changes=[]}_updateMapTransform(t,s,a){const m=this._map,b=m.transform,E=m.style&&m.style.terrain;if(!(Qo(t)||E&&this._drag))return this._fireEvents(s,a,!0);let{panDelta:D,zoomDelta:L,bearingDelta:R,pitchDelta:V,around:X,pinchAround:H}=t;H!==void 0&&(X=H),m._stop(!0),X=X||m.transform.centerPoint;const le=b.pointLocation(D?X.sub(D):X);R&&(b.bearing+=R),V&&(b.pitch+=V),L&&(b.zoom+=L),E?s.drag&&!this._drag?(this._drag={center:b.centerPoint,lngLat:b.pointLocation(X),point:X,handlerName:s.drag.handlerName},m.fire(new n.Event("freezeElevation",{freeze:!0}))):this._drag&&a[this._drag.handlerName]?(m.fire(new n.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(b.center=b.pointLocation(b.centerPoint.sub(D))):b.setLocationAtPoint(le,X),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,a,!0)}_fireEvents(t,s,a){const m=Po(this._eventsInProgress),b=Po(t),E={};for(const V in t){const{originalEvent:X}=t[V];this._eventsInProgress[V]||(E[`${V}start`]=X),this._eventsInProgress[V]=t[V]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const V in E)this._fireEvent(V,E[V]);b&&this._fireEvent("move",b.originalEvent);for(const V in t){const{originalEvent:X}=t[V];this._fireEvent(V,X)}const D={};let L;for(const V in this._eventsInProgress){const{handlerName:X,originalEvent:H}=this._eventsInProgress[V];this._handlersById[X].isActive()||(delete this._eventsInProgress[V],L=s[X]||H,D[`${V}end`]=L)}for(const V in D)this._fireEvent(V,D[V]);const R=Po(this._eventsInProgress);if(a&&(m||b)&&!R){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;V?(X(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:L})):(this._map.fire(new n.Event("moveend",{originalEvent:L})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new n.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new ja("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Vn={extend:(d,...t)=>n.extend(d,...t),run(d){d()},logToElement(d,t=!1,s="log"){const a=window.document.getElementById(s);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${d}`)}};class yr extends n.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,a){return t=n.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,n.extend({offset:t},s),a)}panTo(t,s,a){return this.easeTo(n.extend({center:t},s),a)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,a){return this.easeTo(n.extend({zoom:t},s),a)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,a){return this.easeTo(n.extend({bearing:t},s),a)}resetNorth(t,s){return this.rotateTo(0,n.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=n.LngLatBounds.convert(t);const a=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,s)}_cameraForBoxAndBearing(t,s,a,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=n.extend({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Ue=m.padding;m.padding={top:Ue,bottom:Ue,right:Ue,left:Ue}}m.padding=n.extend(b,m.padding);const E=this.transform,D=E.padding,L=E.project(n.LngLat.convert(t)),R=E.project(n.LngLat.convert(s)),V=L.rotate(-a*Math.PI/180),X=R.rotate(-a*Math.PI/180),H=new n.pointGeometry(Math.max(V.x,X.x),Math.max(V.y,X.y)),le=new n.pointGeometry(Math.min(V.x,X.x),Math.min(V.y,X.y)),ne=H.sub(le),ae=(E.width-(D.left+D.right+m.padding.left+m.padding.right))/ne.x,xe=(E.height-(D.top+D.bottom+m.padding.top+m.padding.bottom))/ne.y;if(xe<0||ae<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ee=Math.min(E.scaleZoom(E.scale*Math.min(ae,xe)),m.maxZoom),Oe=n.pointGeometry.convert(m.offset),ce=new n.pointGeometry((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a*Math.PI/180),Xe=Oe.add(ce).mult(E.scale/E.zoomScale(Ee));return{center:E.unproject(L.add(R).div(2).sub(Xe)),zoom:Ee,bearing:a}}fitBounds(t,s,a){return this._fitInternal(this.cameraForBounds(t,s),s,a)}fitScreenCoordinates(t,s,a,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.pointGeometry.convert(t)),this.transform.pointLocation(n.pointGeometry.convert(s)),a,m),m,b)}_fitInternal(t,s,a){return t?(delete(s=n.extend(t,s)).padding,s.linear?this.easeTo(s,a):this.flyTo(s,a)):this}jumpTo(t,s){this.stop();const a=this.transform;let m=!1,b=!1,E=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(m=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=n.LngLat.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(b=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(E=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this.fire(new n.Event("movestart",s)).fire(new n.Event("move",s)),m&&this.fire(new n.Event("zoomstart",s)).fire(new n.Event("zoom",s)).fire(new n.Event("zoomend",s)),b&&this.fire(new n.Event("rotatestart",s)).fire(new n.Event("rotate",s)).fire(new n.Event("rotateend",s)),E&&this.fire(new n.Event("pitchstart",s)).fire(new n.Event("pitch",s)).fire(new n.Event("pitchend",s)),this.fire(new n.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,a,m=0){const b=n.MercatorCoordinate.fromLngLat(t,s),E=n.MercatorCoordinate.fromLngLat(a,m),D=E.x-b.x,L=E.y-b.y,R=E.z-b.z,V=Math.hypot(D,L,R);if(V===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(D,L),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),le=180*Math.atan2(D,-L)/Math.PI;let ne=180*Math.acos(X/V)/Math.PI;return ne=R<0?90-ne:90+ne,{center:E.toLngLat(),zoom:H,pitch:ne,bearing:le}}easeTo(t,s){this._stop(!1,t.easeId),((t=n.extend({offset:[0,0],duration:500,easing:n.ease},t)).animate===!1||!t.essential&&n.exported.prefersReducedMotion)&&(t.duration=0);const a=this.transform,m=this.getZoom(),b=this.getBearing(),E=this.getPitch(),D=this.getPadding(),L="zoom"in t?+t.zoom:m,R="bearing"in t?this._normalizeBearing(t.bearing,b):b,V="pitch"in t?+t.pitch:E,X="padding"in t?t.padding:a.padding,H=n.pointGeometry.convert(t.offset);let le=a.centerPoint.add(H);const ne=a.pointLocation(le),ae=n.LngLat.convert(t.center||ne);this._normalizeCenter(ae);const xe=a.project(ne),Ee=a.project(ae).sub(xe),Oe=a.zoomScale(L-m);let ce,Xe;t.around&&(ce=n.LngLat.convert(t.around),Xe=a.locationPoint(ce));const Ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||L!==m,this._rotating=this._rotating||b!==R,this._pitching=this._pitching||V!==E,this._padding=!a.isPaddingEqual(X),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Ue),this._ease(rt=>{if(this._zooming&&(a.zoom=n.number(m,L,rt)),this._rotating&&(a.bearing=n.number(b,R,rt)),this._pitching&&(a.pitch=n.number(E,V,rt)),this._padding&&(a.interpolatePadding(D,X,rt),le=a.centerPoint.add(H)),ce)a.setLocationAtPoint(ce,Xe);else{const ot=a.zoomScale(a.zoom-m),St=L>m?Math.min(2,Oe):Math.max(.5,Oe),Qe=Math.pow(St,1-rt),Xt=a.unproject(xe.add(Ee.mult(rt*Qe)).mult(ot));a.setLocationAtPoint(a.renderWorldCopies?Xt.wrap():Xt,le)}this._fireMoveEvents(s)},rt=>{this._afterEase(s,rt)},t),this}_prepareEase(t,s,a={}){this._moving=!0,this.fire(new n.Event("freezeElevation",{freeze:!0})),s||a.moving||this.fire(new n.Event("movestart",t)),this._zooming&&!a.zooming&&this.fire(new n.Event("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new n.Event("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new n.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.Event("move",t)),this._zooming&&this.fire(new n.Event("zoom",t)),this._rotating&&this.fire(new n.Event("rotate",t)),this._pitching&&this.fire(new n.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new n.Event("freezeElevation",{freeze:!1}));const a=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new n.Event("zoomend",t)),m&&this.fire(new n.Event("rotateend",t)),b&&this.fire(new n.Event("pitchend",t)),this.fire(new n.Event("moveend",t))}flyTo(t,s){if(!t.essential&&n.exported.prefersReducedMotion){const hi=n.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(hi,s)}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},t);const a=this.transform,m=this.getZoom(),b=this.getBearing(),E=this.getPitch(),D=this.getPadding(),L="zoom"in t?n.clamp(+t.zoom,a.minZoom,a.maxZoom):m,R="bearing"in t?this._normalizeBearing(t.bearing,b):b,V="pitch"in t?+t.pitch:E,X="padding"in t?t.padding:a.padding,H=a.zoomScale(L-m),le=n.pointGeometry.convert(t.offset);let ne=a.centerPoint.add(le);const ae=a.pointLocation(ne),xe=n.LngLat.convert(t.center||ae);this._normalizeCenter(xe);const Ee=a.project(ae),Oe=a.project(xe).sub(Ee);let ce=t.curve;const Xe=Math.max(a.width,a.height),Ue=Xe/H,rt=Oe.mag();if("minZoom"in t){const hi=n.clamp(Math.min(t.minZoom,m,L),a.minZoom,a.maxZoom),ir=Xe/a.zoomScale(hi-m);ce=Math.sqrt(ir/rt*2)}const ot=ce*ce;function St(hi){const ir=(Ue*Ue-Xe*Xe+(hi?-1:1)*ot*ot*rt*rt)/(2*(hi?Ue:Xe)*ot*rt);return Math.log(Math.sqrt(ir*ir+1)-ir)}function Qe(hi){return(Math.exp(hi)-Math.exp(-hi))/2}function Xt(hi){return(Math.exp(hi)+Math.exp(-hi))/2}const Lt=St(0);let Kt=function(hi){return Xt(Lt)/Xt(Lt+ce*hi)},Ci=function(hi){return Xe*((Xt(Lt)*(Qe(ir=Lt+ce*hi)/Xt(ir))-Qe(Lt))/ot)/rt;var ir},Pi=(St(1)-Lt)/ce;if(Math.abs(rt)<1e-6||!isFinite(Pi)){if(Math.abs(Xe-Ue)<1e-6)return this.easeTo(t,s);const hi=Ue<Xe?-1:1;Pi=Math.abs(Math.log(Ue/Xe))/ce,Ci=function(){return 0},Kt=function(ir){return Math.exp(hi*ce*ir)}}return t.duration="duration"in t?+t.duration:1e3*Pi/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=b!==R,this._pitching=V!==E,this._padding=!a.isPaddingEqual(X),this._prepareEase(s,!1),this._ease(hi=>{const ir=hi*Pi,rr=1/Kt(ir);a.zoom=hi===1?L:m+a.scaleZoom(rr),this._rotating&&(a.bearing=n.number(b,R,hi)),this._pitching&&(a.pitch=n.number(E,V,hi)),this._padding&&(a.interpolatePadding(D,X,hi),ne=a.centerPoint.add(le));const Ni=hi===1?xe:a.unproject(Ee.add(Oe.mult(Ci(ir))).mult(rr));a.setLocationAtPoint(a.renderWorldCopies?Ni.wrap():Ni,ne),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,s)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,s,a){a.animate===!1||a.duration===0?(t(1),s()):(this._easeStart=n.exported.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=n.wrap(t,-180,180);const a=Math.abs(t-s);return Math.abs(t-360-s)<a&&(t-=360),Math.abs(t+360-s)<a&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const a=t.lng-s.center.lng;t.lng+=a>180?-360:a<-180?360:0}}class ea{constructor(t={}){this.options=t,n.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=l.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=l.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){l.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const a=this._map._getUIString(`AttributionControl.${s}`);t.title=a,t.setAttribute("aria-label",a)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style.sourceCaches;for(const m in s){const b=s[m];if(b.used||b.usedForTerrain){const E=b.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,b)=>m.length-b.length),t=t.filter((m,b)=>{for(let E=b+1;E<t.length;E++)if(t[E].indexOf(m)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ga{constructor(t={}){this.options=t,n.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=l.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=l.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){l.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Sl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,a=s?this._queue.concat(s):this._queue;for(const m of a)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const a of s)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Cl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Tl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Ql={showCompass:!0,showZoom:!0,visualizePitch:!1};class ps{constructor(t,s,a=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new an({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,a&&(this.mousePitch=new Ut({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener(s,"mousedown",this.mousedown),l.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),l.addEventListener(s,"touchmove",this.touchmove),l.addEventListener(s,"touchend",this.touchend),l.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),l.disableDrag()}move(t,s){const a=this.map,m=this.mouseRotate.mousemoveWindow(t,s);if(m&&m.bearingDelta&&a.setBearing(a.getBearing()+m.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,s);b&&b.pitchDelta&&a.setPitch(a.getPitch()+b.pitchDelta)}}off(){const t=this.element;l.removeEventListener(t,"mousedown",this.mousedown),l.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),l.removeEventListener(t,"touchmove",this.touchmove),l.removeEventListener(t,"touchend",this.touchend),l.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){l.enableDrag(),l.removeEventListener(window,"mousemove",this.mousemove),l.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(n.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),l.mousePos(this.element,t)),l.addEventListener(window,"mousemove",this.mousemove),l.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,l.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=l.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=l.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ta(d,t,s){if(d=new n.LngLat(d.lng,d.lat),t){const a=new n.LngLat(d.lng-360,d.lat),m=new n.LngLat(d.lng+360,d.lat),b=s.locationPoint(d).distSqr(t);s.locationPoint(a).distSqr(t)<b?d=a:s.locationPoint(m).distSqr(t)<b&&(d=m)}for(;Math.abs(d.lng-s.center.lng)>180;){const a=s.locationPoint(d);if(a.x>=0&&a.y>=0&&a.x<=s.width&&a.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const oi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pi(d,t,s){const a=d.classList;for(const m in oi)a.remove(`maplibregl-${s}-anchor-${m}`,`mapboxgl-${s}-anchor-${m}`);a.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class Io extends n.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=n.extend({element:t},s)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=n.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=l.create("div"),this._element.setAttribute("aria-label","Map marker");const a=l.createNS("http://www.w3.org/2000/svg","svg"),m=41,b=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${m}px`),a.setAttributeNS(null,"width",`${b}px`),a.setAttributeNS(null,"viewBox",`0 0 ${b} ${m}`);const E=l.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const D=l.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill-rule","nonzero");const L=l.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Oe of R){const ce=l.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",Oe.rx),ce.setAttributeNS(null,"ry",Oe.ry),L.appendChild(ce)}const V=l.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const X=l.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild(X);const H=l.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const le=l.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(le);const ne=l.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ne.setAttributeNS(null,"fill","#FFFFFF");const ae=l.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const xe=l.createNS("http://www.w3.org/2000/svg","circle");xe.setAttributeNS(null,"fill","#000000"),xe.setAttributeNS(null,"opacity","0.25"),xe.setAttributeNS(null,"cx","5.5"),xe.setAttributeNS(null,"cy","5.5"),xe.setAttributeNS(null,"r","5.4999962");const Ee=l.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#FFFFFF"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962"),ae.appendChild(xe),ae.appendChild(Ee),D.appendChild(L),D.appendChild(V),D.appendChild(H),D.appendChild(ne),D.appendChild(ae),a.appendChild(D),a.setAttributeNS(null,"height",m*this._scale+"px"),a.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(a),this._offset=n.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),pi(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),l.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,a=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&a!==32&&a!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,a=this._element;this._popup&&(s===a||a.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let a="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?a="rotateX(0deg)":this._pitchAlignment==="map"&&(a=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),l.setTransform(this._element,`${oi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${a} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),b=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*b?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=n.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Va={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vs,Qr=0,Ns=!1;const ms={maxWidth:100,unit:"metric"};function El(d,t,s){const a=s&&s.maxWidth||100,m=d._container.clientHeight/2,b=d.unproject([0,m]),E=d.unproject([a,m]),D=b.distanceTo(E);if(s&&s.unit==="imperial"){const L=3.2808*D;L>5280?Gs(t,a,L/5280,d._getUIString("ScaleControl.Miles")):Gs(t,a,L,d._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Gs(t,a,D/1852,d._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Gs(t,a,D/1e3,d._getUIString("ScaleControl.Kilometers")):Gs(t,a,D,d._getUIString("ScaleControl.Meters"))}function Gs(d,t,s,a){const m=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let D=b/E;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(L){const R=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*R)/R}(D),E*D}(s);d.style.width=t*(m/s)+"px",d.innerHTML=`${m}&nbsp;${a}`}const Ir={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Na(d){if(d){if(typeof d=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new n.pointGeometry(0,0),top:new n.pointGeometry(0,d),"top-left":new n.pointGeometry(t,t),"top-right":new n.pointGeometry(-t,t),bottom:new n.pointGeometry(0,-d),"bottom-left":new n.pointGeometry(t,-t),"bottom-right":new n.pointGeometry(-t,-t),left:new n.pointGeometry(d,0),right:new n.pointGeometry(-d,0)}}if(d instanceof n.pointGeometry||Array.isArray(d)){const t=n.pointGeometry.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:n.pointGeometry.convert(d.center||[0,0]),top:n.pointGeometry.convert(d.top||[0,0]),"top-left":n.pointGeometry.convert(d["top-left"]||[0,0]),"top-right":n.pointGeometry.convert(d["top-right"]||[0,0]),bottom:n.pointGeometry.convert(d.bottom||[0,0]),"bottom-left":n.pointGeometry.convert(d["bottom-left"]||[0,0]),"bottom-right":n.pointGeometry.convert(d["bottom-right"]||[0,0]),left:n.pointGeometry.convert(d.left||[0,0]),right:n.pointGeometry.convert(d.right||[0,0])}}return Na(new n.pointGeometry(0,0))}const no={supported:g,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends yr{constructor(d){var t;if(n.PerformanceUtils.mark(n.PerformanceMarkers.create),(d=n.extend({},Tl,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _r(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Sl,this._controls=[],this._mapId=n.uniqueId(),this._locale=n.extend({},Cl,d.locale),this._clickTolerance=d.clickTolerance,this._pixelRatio=(t=d.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new c(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wl(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new Pr(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,n.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new ea({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new ga,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new n.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new n.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new n.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(s,a.firstChild):a.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,t,s,a){return a==null&&this.style.terrain&&(a=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(d,t,s,a)}resize(d){const t=this._containerDimensions(),s=t[0],a=t[1];this._resizeCanvas(s,a,this.getPixelRatio()),this.transform.resize(s,a),this.painter.resize(s,a,this.getPixelRatio());const m=!this._moving;return m&&(this.stop(),this.fire(new n.Event("movestart",d)).fire(new n.Event("move",d))),this.fire(new n.Event("resize",d)),m&&this.fire(new n.Event("moveend",d)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(d){const[t,s]=this._containerDimensions();this._pixelRatio=d,this._resizeCanvas(t,s,d),this.painter.resize(t,s,d)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(n.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d==null?60:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(n.LngLat.convert(d),this.style&&this.style.terrain)}unproject(d){return this.transform.pointLocation(n.pointGeometry.convert(d),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(d,t,s){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layer:t,listener:s,delegates:{mousemove:b=>{const E=this.getLayer(t)?this.queryRenderedFeatures(b.point,{layers:[t]}):[];E.length?a||(a=!0,s.call(this,new sn(d,this,b.originalEvent,{features:E}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layer:t,listener:s,delegates:{mousemove:E=>{(this.getLayer(t)?this.queryRenderedFeatures(E.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,s.call(this,new sn(d,this,E.originalEvent)))},mouseout:E=>{a&&(a=!1,s.call(this,new sn(d,this,E.originalEvent)))}}}}{const a=m=>{const b=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];b.length&&(m.features=b,s.call(this,m),delete m.features)};return{layer:t,listener:s,delegates:{[d]:a}}}}on(d,t,s){if(s===void 0)return super.on(d,t);const a=this._createDelegatedListener(d,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(a);for(const m in a.delegates)this.on(m,a.delegates[m]);return this}once(d,t,s){if(s===void 0)return super.once(d,t);const a=this._createDelegatedListener(d,t,s);for(const m in a.delegates)this.once(m,a.delegates[m]);return this}off(d,t,s){return s===void 0?super.off(d,t):(this._delegatedListeners&&this._delegatedListeners[d]&&(a=>{const m=this._delegatedListeners[d];for(let b=0;b<m.length;b++){const E=m[b];if(E.layer===t&&E.listener===s){for(const D in E.delegates)this.off(D,E.delegates[D]);return m.splice(b,1),this}}})(),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let s;if(t!==void 0||d===void 0||d instanceof n.pointGeometry||Array.isArray(d)||(t=d,d=void 0),t=t||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof n.pointGeometry||typeof d[0]=="number")s=[n.pointGeometry.convert(d)];else{const a=n.pointGeometry.convert(d[0]),m=n.pointGeometry.convert(d[1]);s=[a,new n.pointGeometry(m.x,a.y),m,new n.pointGeometry(a.x,m.y),a]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new gr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new gr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const s=this._requestManager.transformRequest(d,n.ResourceType.Style);n.getJSON(s,(a,m)=>{a?this.fire(new n.ErrorEvent(a)):m&&this._updateDiff(m,t)})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d)&&this._update(!0)}catch(s){n.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.warnOnce("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style.sourceCaches[d];if(t!==void 0)return t.loaded();this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){return this.style.setTerrain(d),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const t in d){const s=d[t]._tiles;for(const a in s){const m=s[a];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(d,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,s)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,{pixelRatio:s=1,sdf:a=!1,stretchX:m,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||n.isImageBitmap(t)){const{width:D,height:L,data:R}=n.exported.getImageData(t);this.style.addImage(d,{data:new n.RGBAImage({width:D,height:L},R),pixelRatio:s,stretchX:m,stretchY:b,content:E,sdf:a,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:L,data:R}=t,V=t;this.style.addImage(d,{data:new n.RGBAImage({width:D,height:L},new Uint8Array(R)),pixelRatio:s,stretchX:m,stretchY:b,content:E,sdf:a,version:0,userImage:V}),V.onAdd&&V.onAdd(this,d)}}}updateImage(d,t){const s=this.style.getImage(d);if(!s)return this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||n.isImageBitmap(t)?n.exported.getImageData(t):t,{width:m,height:b,data:E}=a;if(m===void 0||b===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==s.data.width||b!==s.data.height)return this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(t instanceof HTMLImageElement||n.isImageBitmap(t));s.data.replace(E,D),this.style.updateImage(d,s)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){n.getImage(this._requestManager.transformRequest(d,n.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,t,s){return this.style.setLayerZoomRange(d,t,s),this._update(!0)}setFilter(d,t,s={}){return this.style.setFilter(d,t,s),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,s,a={}){return this.style.setPaintProperty(d,t,s,a),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,s,a={}){return this.style.setLayoutProperty(d,t,s,a),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=l.create("div","maplibregl-canvas-container mapboxgl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=l.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const a=this._controlContainer=l.create("div","maplibregl-control-container mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{m[b]=l.create("div",`maplibregl-ctrl-${b} mapboxgl-ctrl-${b}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const d=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=l.create("div","maplibregl-cooperative-gesture-screen",d);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",a=>{a.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",a=>{a.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",a=>{this._onCooperativeGesture(a,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(d,t,s){this._canvas.width=s*d,this._canvas.height=s*t,this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const d=n.extend({},g.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);t?(this.painter=new zi(t,this.transform),n.exported$1.testSupport(t)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(d,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){let t,s=0;const a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,t),s=n.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let m=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,D=n.exported.now();this.style.zoomHistory.update(E,D);const L=new n.EvaluationParameters(E,{now:D,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=L.crossFadingFactor();R===1&&R===this._crossFadingFactor||(m=!0,this._crossFadingFactor=R),this.style.update(L)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.load),this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=n.exported.now()-s;a.endQueryEXT(a.TIME_ELAPSED_EXT,t),setTimeout(()=>{const D=a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(t),this.fire(new n.Event("gpu-timing-frame",{cpuTime:E,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(E);this.fire(new n.Event("gpu-timing-layer",{layerTimes:D}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty;return b||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.Event("idle")),!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),l.remove(this._canvasContainer),l.remove(this._controlContainer),this._cooperativeGestures&&l.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),n.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=n.exported.frame(d=>{n.PerformanceUtils.frame(d),this._frame=null,this._render(d)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,t){n.setCacheLimits(d,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(d){this.options=n.extend({},Ql,d),this._container=l.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),l.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),l.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=l.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map.getZoom(),t=d===this._map.getMaxZoom(),s=d===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=d}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ps(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){l.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const s=l.create("button",d,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(d,t){const s=this._map._getUIString(`NavigationControl.${t}`);d.title=s,d.setAttribute("aria-label",s)}},GeolocateControl:class extends n.Evented{constructor(d){super(),this.options=n.extend({},Va,d),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(d){var t;return this._map=d,this._container=l.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Vs!==void 0?t(Vs):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{Vs=s.state!=="denied",t(Vs)}):(Vs=!!window.navigator.geolocation,t(Vs)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),l.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Qr=0,Ns=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),s=d.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",d)),this._finish()}}_updateCamera(d){const t=new n.LngLat(d.coords.longitude,d.coords.latitude),s=d.coords.accuracy,a=this._map.getBearing(),m=n.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new n.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.clientHeight/2,t=this._map.unproject([0,d]),s=this._map.unproject([1,d]),a=t.distanceTo(s),m=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&Ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=l.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),l.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Io(this._dotElement),this._circleElement=l.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Io({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Qr--,Ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Qr++,Qr>1?(d={maximumAge:6e5,timeout:0},Ns=!0):(d=this.options.positionOptions,Ns=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ea,LogoControl:ga,ScaleControl:class{constructor(d){this.options=n.extend({},ms,d),n.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){El(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=l.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){l.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,El(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=l.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){l.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=l.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);l.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(d){this.options=d,n.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(d){return this._map=d,this._container=l.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=l.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),l.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){l.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends n.Evented{constructor(d){super(),this.options=n.extend(Object.create(Ir),d),n.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&l.remove(this._content),this._container&&(l.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=n.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),s=document.createElement("body");let a;for(s.innerHTML=d;a=s.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=l.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=l.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_update(d){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=l.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=l.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(b=>this._container.classList.add(b)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d))return;const t=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let s=this.options.anchor;const a=Na(this.options.offset);if(!s){const b=this._container.offsetWidth,E=this._container.offsetHeight;let D;D=t.y+a.bottom.y<E?["top"]:t.y>this._map.transform.height-E?["bottom"]:[],t.x<b/2?D.push("left"):t.x>this._map.transform.width-b/2&&D.push("right"),s=D.length===0?"bottom":D.join("-")}const m=t.add(a[s]).round();l.setTransform(this._container,`${oi[s]} translate(${m.x}px,${m.y}px)`),pi(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Lr);d&&d.focus()}_onClose(){this.remove()}},Marker:Io,Style:gr,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.pointGeometry,MercatorCoordinate:n.MercatorCoordinate,Evented:n.Evented,AJAXError:n.AJAXError,config:n.config,CanvasSource:ue,GeoJSONSource:Rt,ImageSource:Q,RasterDEMTileSource:it,RasterTileSource:st,VectorTileSource:xt,VideoSource:se,prewarm:function(){Ke().acquire(nt)},clearPrewarmedResources:function(){const d=Le;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(nt),Le=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Re.workerCount},set workerCount(d){Re.workerCount=d},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){n.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){n.clearTileCache(d)},workerUrl:"",addProtocol(d,t){n.config.REGISTERED_PROTOCOLS[d]=t},removeProtocol(d){delete n.config.REGISTERED_PROTOCOLS[d]}};return Vn.extend(no,{isSafari:n.isSafari,getPerformanceMetrics:n.PerformanceUtils.getPerformanceMetrics}),no});var Mt=wt;return Mt})})(Wc);const xu=Wc.exports;const jc=as(),Vc=as();var jr=(Fe=>(Fe[Fe.AddingPolygon=1]="AddingPolygon",Fe[Fe.Waiting=2]="Waiting",Fe[Fe.EditingPolygon=3]="EditingPolygon",Fe[Fe.DeletingPolygon=4]="DeletingPolygon",Fe[Fe.PickPolygon=5]="PickPolygon",Fe))(jr||{});const os=as(2),Aa=as(!1),la=as(!1),If="http",Af="localhost",Mf=42001,kf=window.location.href,$c=new URL(kf),qc=$c.protocol.replace(/:/g,"")||If,Mu=$c.hostname||Af,ku=parseInt($c.port)||(qc==="https:"?443:80)||Mf;class Df{constructor(I=as(qc),pt=as(Mu),tt=as(ku)){this.schema=I,this.host=pt,this.port=tt}get apiURL(){return Cf([this.schema,this.host,this.port],([I,pt,tt])=>`${I}://${pt}:${tt}`)}}const Zl=new Df,Yc=as(`${qc}://${Mu}:${ku}`);class Of{constructor(I=as("https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL"),pt=as("https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL")){this.uri=I,this.accepted_uri=pt}}const Kl=new Of;as(Kl.accepted_uri);const Du=as(new Map),gl="rgb(127, 127, 127)",Lf=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(0, 0, 0)","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":["case",["==",["get","user_color_rgb_str"],null],gl,["get","user_color_rgb_str"]],"fill-outline-color":"rgb(0, 0, 0)","fill-opacity":.5}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"rgb(0, 0, 255)"}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(178, 204, 255)","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"rgb(0, 0, 255)"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":3,"circle-color":"rgb(0, 0, 255)"}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(0, 0, 0)","line-width":3}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","false"]],paint:{"fill-color":["case",["==",["get","user_color_rgb_str"],null],gl,["get","user_color_rgb_str"]],"fill-outline-color":"rgb(0, 0, 0)","fill-opacity":.25}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(0, 0, 0)","line-width":3}}];function zf(Fe){let I,pt;return{c(){I=Wt("div"),pt=Wt("div"),this.h()},l(tt){I=$t(tt,"DIV",{class:!0});var wt=ii(I);pt=$t(wt,"DIV",{class:!0,id:!0}),ii(pt).forEach(Nt),wt.forEach(Nt),this.h()},h(){Yt(pt,"class","map"),Yt(pt,"id","map"),Yt(I,"class","map-wrap")},m(tt,wt){qs(tt,I,wt),ht(I,pt),Fe[4](pt)},p:Ys,i:Ys,o:Ys,d(tt){tt&&Nt(I),Fe[4](null)}}}function Ff(Fe,I,pt){let tt,wt,At,Mt;vn(Fe,Du,_=>pt(6,tt=_)),vn(Fe,Vc,_=>pt(7,wt=_)),vn(Fe,jc,_=>pt(8,At=_));let n;const{accepted_uri:g}=Kl;vn(Fe,g,_=>pt(9,Mt=_));let x=Mt;const v=g.subscribe(_=>{x!==_&&(At.setStyle(_),x=Mt)});_l(()=>{const _={lng:0,lat:0,zoom:5};jc.set(new Wc.exports.Map({container:n,style:x,center:[_.lng,_.lat],zoom:_.zoom})),At.on("load",()=>{At.resize()}),At.on("click","gl-draw-polygon-fill-inactive.cold",function(u){var oe,ge;const S=Array.from(tt.values()).map((De,qe)=>`<option value="${De.id}">${De.id}</option>`),C=wt.get(u.features[0].properties.id),A=`
                <div id="custom-popup">
                    <div class="row">
                        <div class="input-field col s12">
                            <select id="select-canvas">
                                <option value="" disabled selected>Pick up polygon</option>
                                ${S.join(`
`)}
                            </select>
                            <label>Attach canvas polygons</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input value="${(oe=C==null?void 0:C.properties)==null?void 0:oe.road_lane_direction}" id="lane-direction" type="number" class="validate">
                            <label class="active" for="lane-direction">Direction value</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input value="${(ge=C==null?void 0:C.properties)==null?void 0:ge.road_lane_num}" id="lane-number" type="number" class="validate">
                            <label class="active" for="lane-number">Lane</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <button id="attach-canvas-btn" class="btn-small waves-effect waves-light" type="submit" name="action" onclick>Save
                                <i class="material-icons right">save</i>
                            </button>
                        </div>
                    </div>
                </div>
            `;new xu.Popup({className:"custom-popup"}).setLngLat(u.lngLat).setHTML(A).addTo(At);const O=u.features[0],j=document.getElementById("select-canvas");Array.from(tt.values()).some(De=>{if(De.properties.spatial_object_id===C.id)return j.value=De.id,!0}),M.FormSelect.init(j,{}),document.getElementById("attach-canvas-btn").addEventListener("click",De=>{const qe=document.getElementById("lane-direction"),lt=document.getElementById("lane-number");c(O.properties.id,j.value,{road_lane_direction:qe.value,road_lane_num:lt.value,coordinates:wt.get(O.properties.id).geometry.coordinates})})})}),Gc(()=>{v(),At.remove()});function h(_){At.addControl(_)}const l=(_,u)=>{if(u.forEach(A=>{_.add(A)}),u.size===0)return;const S=Array.from(u.values())[0].geometry.coordinates;let C=new xu.LngLatBounds(S[0]);for(const A of S)C.extend(A);At.fitBounds(C,{maxZoom:18,padding:100})},c=(_,u,S={road_lane_direction:-1,road_lane_num:-1,coordinates:[]})=>{if(_===""||u===""||_===null||u===null||_===void 0||u===void 0)return;let C=tt.get(u),A=wt.get(_);if(!(A===void 0||(A==null?void 0:A.properties)===null)){if(A.properties.canvas_object_id!==null&&A.properties.canvas_object_id!==void 0){let O=tt.get(A.properties.canvas_object_id);O.properties.spatial_object_id=null,O.properties.road_lane_direction=-1,O.properties.road_lane_num=-1,O.geometry.coordinates=[[],[],[],[],[]],tt.set(A.properties.canvas_object_id,O)}wt.getAll().features.forEach(O=>{O.properties===null||O.id===_||O.properties.canvas_object_id===u&&(O.properties.canvas_object_id=null,O.properties.color_rgb=[127,127,127],O.properties.color_rgb_str=gl,wt.add(O),wt.setFeatureProperty(O.id,"color_rgb_str",gl))}),A.properties.canvas_object_id=u,A.properties.color_rgb=C.properties.color_rgb,A.properties.color_rgb_str=C.properties.color_rgb_str,A.properties.road_lane_direction=Number(S.road_lane_direction),A.properties.road_lane_num=Number(S.road_lane_num),wt.add(A),wt.setFeatureProperty(_,"color_rgb_str",C.properties.color_rgb_str),C.properties.spatial_object_id=_,C.properties.road_lane_direction=Number(S.road_lane_direction),C.properties.road_lane_num=Number(S.road_lane_num),C.geometry.coordinates=S.coordinates,tt.set(u,C)}};function f(_){Pu[_?"unshift":"push"](()=>{n=_,pt(0,n)})}return[n,g,h,l,f]}class Rf extends Ma{constructor(I){super(),ka(this,I,Ff,zf,Da,{attachDraw:2,drawGeoPolygons:3})}get attachDraw(){return this.$$.ctx[2]}get drawGeoPolygons(){return this.$$.ctx[3]}}function Bf(Fe){let I,pt,tt,wt,At,Mt,n;return{c(){I=Wt("div"),pt=Wt("img"),wt=Zi(),At=Wt("canvas"),this.h()},l(g){I=$t(g,"DIV",{id:!0});var x=ii(I);pt=$t(x,"IMG",{id:!0,src:!0,width:!0,height:!0}),wt=Ki(x),At=$t(x,"CANVAS",{id:!0}),ii(At).forEach(Nt),x.forEach(Nt),this.h()},h(){Yt(pt,"id","fit_img"),Uc(pt.src,tt=Fe[0]+"/live_streaming")||Yt(pt,"src",tt),Yt(pt,"width","500"),Yt(pt,"height","500"),Yt(At,"id","fit_canvas"),Yt(I,"id","mjpeg")},m(g,x){qs(g,I,x),ht(I,pt),ht(I,wt),ht(I,At),Mt||(n=Ms(pt,"load",Fe[2]),Mt=!0)},p(g,[x]){x&1&&!Uc(pt.src,tt=g[0]+"/live_streaming")&&Yt(pt,"src",tt)},i:Ys,o:Ys,d(g){g&&Nt(I),Mt=!1,n()}}}function Uf(Fe,I,pt){let tt;const{apiURL:wt}=Zl;vn(Fe,wt,g=>pt(3,tt=g));let At=`${tt}`;const Mt=()=>{Aa.set(!0)},n=Yc.subscribe(g=>{At!==g&&(console.log(`Need to change API URL for MJPEG: '${tt}'`),pt(0,At=g))});return _l(()=>{}),Gc(()=>{n()}),[At,wt,Mt]}class jf extends Ma{constructor(I){super(),ka(this,I,Uf,Bf,Da,{})}}function Vf(Fe){let I,pt,tt,wt,At,Mt,n,g,x,v,h,l,c,f,_,u,S,C,A,O,j,Y,oe,ge,De,qe,lt,_t;return{c(){I=Wt("div"),pt=Wt("form"),tt=Wt("div"),wt=Wt("div"),At=Wt("div"),Mt=Wt("input"),n=Zi(),g=Wt("label"),x=Tr("Protocol schema type"),v=Zi(),h=Wt("div"),l=Wt("div"),c=Wt("input"),f=Zi(),_=Wt("label"),u=Tr("Address or explicit IP"),S=Zi(),C=Wt("div"),A=Wt("div"),O=Wt("input"),j=Zi(),Y=Wt("label"),oe=Tr("Port"),ge=Zi(),De=Wt("button"),qe=Tr("Switch"),this.h()},l(xt){I=$t(xt,"DIV",{class:!0});var st=ii(I);pt=$t(st,"FORM",{autocomplete:!0});var yt=ii(pt);tt=$t(yt,"DIV",{class:!0});var it=ii(tt);wt=$t(it,"DIV",{class:!0});var Rt=ii(wt);At=$t(Rt,"DIV",{class:!0});var Pt=ii(At);Mt=$t(Pt,"INPUT",{id:!0,type:!0,class:!0}),n=Ki(Pt),g=$t(Pt,"LABEL",{class:!0,for:!0});var Q=ii(g);x=Er(Q,"Protocol schema type"),Q.forEach(Nt),Pt.forEach(Nt),Rt.forEach(Nt),v=Ki(it),h=$t(it,"DIV",{class:!0});var se=ii(h);l=$t(se,"DIV",{class:!0});var ue=ii(l);c=$t(ue,"INPUT",{id:!0,type:!0,class:!0}),f=Ki(ue),_=$t(ue,"LABEL",{class:!0,for:!0});var de=ii(_);u=Er(de,"Address or explicit IP"),de.forEach(Nt),ue.forEach(Nt),se.forEach(Nt),S=Ki(it),C=$t(it,"DIV",{class:!0});var je=ii(C);A=$t(je,"DIV",{class:!0});var K=ii(A);O=$t(K,"INPUT",{id:!0,type:!0,class:!0}),j=Ki(K),Y=$t(K,"LABEL",{class:!0,for:!0});var W=ii(Y);oe=Er(W,"Port"),W.forEach(Nt),K.forEach(Nt),je.forEach(Nt),it.forEach(Nt),yt.forEach(Nt),ge=Ki(st),De=$t(st,"BUTTON",{class:!0,type:!0,name:!0});var re=ii(De);qe=Er(re,"Switch"),re.forEach(Nt),st.forEach(Nt),this.h()},h(){Yt(Mt,"id","input_protocol"),Yt(Mt,"type","text"),Yt(Mt,"class","validate"),Yt(g,"class","active"),Yt(g,"for","input_protocol"),Yt(At,"class","input-field"),Yt(wt,"class","addr-part row svelte-1mo9bfd"),Yt(c,"id","input_protocol"),Yt(c,"type","text"),Yt(c,"class","validate"),Yt(_,"class","active"),Yt(_,"for","input_protocol"),Yt(l,"class","input-field"),Yt(h,"class","addr-part row svelte-1mo9bfd"),Yt(O,"id","input_protocol"),Yt(O,"type","number"),Yt(O,"class","validate"),Yt(Y,"class","active"),Yt(Y,"for","input_protocol"),Yt(A,"class","input-field"),Yt(C,"class","addr-part row svelte-1mo9bfd"),Yt(tt,"class","addr-form svelte-1mo9bfd"),Yt(pt,"autocomplete","off"),Yt(De,"class","btn waves-effect waves-light btn-small red"),Yt(De,"type","submit"),Yt(De,"name","action"),Yt(I,"class","addr-container svelte-1mo9bfd")},m(xt,st){qs(xt,I,st),ht(I,pt),ht(pt,tt),ht(tt,wt),ht(wt,At),ht(At,Mt),zo(Mt,Fe[0]),ht(At,n),ht(At,g),ht(g,x),ht(tt,v),ht(tt,h),ht(h,l),ht(l,c),zo(c,Fe[1]),ht(l,f),ht(l,_),ht(_,u),ht(tt,S),ht(tt,C),ht(C,A),ht(A,O),zo(O,Fe[2]),ht(A,j),ht(A,Y),ht(Y,oe),ht(I,ge),ht(I,De),ht(De,qe),lt||(_t=[Ms(Mt,"input",Fe[8]),Ms(c,"input",Fe[9]),Ms(O,"input",Fe[10]),Ms(De,"click",Fe[7])],lt=!0)},p(xt,[st]){st&1&&Mt.value!==xt[0]&&zo(Mt,xt[0]),st&2&&c.value!==xt[1]&&zo(c,xt[1]),st&4&&Iu(O.value)!==xt[2]&&zo(O,xt[2])},i:Ys,o:Ys,d(xt){xt&&Nt(I),lt=!1,Xc(_t)}}}function Nf(Fe,I,pt){let tt,wt,At,Mt;const{schema:n,host:g,port:x}=Zl;vn(Fe,n,u=>pt(0,wt=u)),vn(Fe,g,u=>pt(1,At=u)),vn(Fe,x,u=>pt(2,Mt=u));const{apiURL:v}=Zl;vn(Fe,v,u=>pt(12,tt=u));let h=tt;const l=()=>{h!==tt&&(Yc.set(tt),h=tt)};_l(()=>{console.log(`Initial address: '${tt}'`)});function c(){wt=this.value,n.set(wt)}function f(){At=this.value,g.set(At)}function _(){Mt=Iu(this.value),x.set(Mt)}return[wt,At,Mt,n,g,x,v,l,c,f,_]}class Gf extends Ma{constructor(I){super(),ka(this,I,Nf,Vf,Da,{})}}function Xf(Fe){let I,pt,tt,wt,At,Mt,n,g,x,v,h,l,c,f;return{c(){I=Wt("div"),pt=Wt("form"),tt=Wt("div"),wt=Wt("div"),At=Wt("div"),Mt=Wt("input"),n=Zi(),g=Wt("label"),x=Tr("URI for Maptiler styles JSON"),v=Zi(),h=Wt("button"),l=Tr("Switch"),this.h()},l(_){I=$t(_,"DIV",{class:!0});var u=ii(I);pt=$t(u,"FORM",{autocomplete:!0});var S=ii(pt);tt=$t(S,"DIV",{class:!0});var C=ii(tt);wt=$t(C,"DIV",{class:!0});var A=ii(wt);At=$t(A,"DIV",{class:!0});var O=ii(At);Mt=$t(O,"INPUT",{id:!0,type:!0,class:!0}),n=Ki(O),g=$t(O,"LABEL",{class:!0,for:!0});var j=ii(g);x=Er(j,"URI for Maptiler styles JSON"),j.forEach(Nt),O.forEach(Nt),A.forEach(Nt),C.forEach(Nt),S.forEach(Nt),v=Ki(u),h=$t(u,"BUTTON",{class:!0,type:!0,name:!0});var Y=ii(h);l=Er(Y,"Switch"),Y.forEach(Nt),u.forEach(Nt),this.h()},h(){Yt(Mt,"id","input_protocol"),Yt(Mt,"type","text"),Yt(Mt,"class","validate"),Yt(g,"class","active"),Yt(g,"for","input_style_url"),Yt(At,"class","input-field"),Yt(wt,"class","styles-switch-part row svelte-qox066"),Yt(tt,"class","styles-switch-form svelte-qox066"),Yt(pt,"autocomplete","off"),Yt(h,"class","btn waves-effect waves-light btn-small red"),Yt(h,"type","submit"),Yt(h,"name","action"),Yt(I,"class","styles-switch-container svelte-qox066")},m(_,u){qs(_,I,u),ht(I,pt),ht(pt,tt),ht(tt,wt),ht(wt,At),ht(At,Mt),zo(Mt,Fe[0]),ht(At,n),ht(At,g),ht(g,x),ht(I,v),ht(I,h),ht(h,l),c||(f=[Ms(Mt,"input",Fe[3]),Ms(h,"click",Fe[2])],c=!0)},p(_,[u]){u&1&&Mt.value!==_[0]&&zo(Mt,_[0])},i:Ys,o:Ys,d(_){_&&Nt(I),c=!1,Xc(f)}}}function Wf(Fe,I,pt){let tt;const{uri:wt}=Kl;vn(Fe,wt,g=>pt(0,tt=g));let At=tt;const Mt=()=>{At!==tt&&(At=tt,Kl.accepted_uri.update(()=>At))};_l(()=>{console.log(`Initial styles URL: '${tt}'`)});function n(){tt=this.value,wt.set(tt)}return[tt,wt,Mt,n]}class $f extends Ma{constructor(I){super(),ka(this,I,Wf,Xf,Da,{})}}function qf(Fe){let I,pt,tt,wt,At;return pt=new Gf({}),wt=new $f({}),{c(){I=Wt("div"),hl(pt.$$.fragment),tt=Zi(),hl(wt.$$.fragment),this.h()},l(Mt){I=$t(Mt,"DIV",{class:!0});var n=ii(I);ul(pt.$$.fragment,n),tt=Ki(n),ul(wt.$$.fragment,n),n.forEach(Nt),this.h()},h(){Yt(I,"class","switcher-container svelte-dysck9")},m(Mt,n){qs(Mt,I,n),dl(pt,I,null),ht(I,tt),dl(wt,I,null),At=!0},p:Ys,i(Mt){At||(fl(pt.$$.fragment,Mt),fl(wt.$$.fragment,Mt),At=!0)},o(Mt){pl(pt.$$.fragment,Mt),pl(wt.$$.fragment,Mt),At=!1},d(Mt){Mt&&Nt(I),ml(pt),ml(wt)}}}class Yf extends Ma{constructor(I){super(),ka(this,I,null,qf,Da,{})}}var Ou={exports:{}};(function(Fe,I){(function(pt,tt){Fe.exports=tt()})(Ia,function(){var pt=function(T,z){var q={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ve={on:function(Te,ke,Ct){if(q[Te]===void 0)throw new Error("Invalid event type: "+Te);q[Te].push({selector:ke,fn:Ct})},render:function(Te){z.store.featureChanged(Te)}},ze=function(Te,ke){for(var Ct=q[Te],bt=Ct.length;bt--;){var Tt=Ct[bt];if(Tt.selector(ke)){Tt.fn.call(ve,ke)||z.store.render(),z.ui.updateMapClasses();break}}};return T.start.call(ve),{render:T.render,stop:function(){T.stop&&T.stop()},trash:function(){T.trash&&(T.trash(),z.store.render())},combineFeatures:function(){T.combineFeatures&&T.combineFeatures()},uncombineFeatures:function(){T.uncombineFeatures&&T.uncombineFeatures()},drag:function(Te){ze("drag",Te)},click:function(Te){ze("click",Te)},mousemove:function(Te){ze("mousemove",Te)},mousedown:function(Te){ze("mousedown",Te)},mouseup:function(Te){ze("mouseup",Te)},mouseout:function(Te){ze("mouseout",Te)},keydown:function(Te){ze("keydown",Te)},keyup:function(Te){ze("keyup",Te)},touchstart:function(Te){ze("touchstart",Te)},touchmove:function(Te){ze("touchmove",Te)},touchend:function(Te){ze("touchend",Te)},tap:function(Te){ze("tap",Te)}}},tt=6378137;function wt(T){var z=0;if(T&&T.length>0){z+=Math.abs(At(T[0]));for(var q=1;q<T.length;q++)z-=Math.abs(At(T[q]))}return z}function At(T){var z,q,ve,ze,Te,ke,Ct=0,bt=T.length;if(bt>2){for(ke=0;ke<bt;ke++)ke===bt-2?(ve=bt-2,ze=bt-1,Te=0):ke===bt-1?(ve=bt-1,ze=0,Te=1):(ve=ke,ze=ke+1,Te=ke+2),z=T[ve],q=T[ze],Ct+=(Mt(T[Te][0])-Mt(z[0]))*Math.sin(Mt(q[1]));Ct=Ct*tt*tt/2}return Ct}function Mt(T){return T*Math.PI/180}var n={geometry:function T(z){var q,ve=0;switch(z.type){case"Polygon":return wt(z.coordinates);case"MultiPolygon":for(q=0;q<z.coordinates.length;q++)ve+=wt(z.coordinates[q]);return ve;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(q=0;q<z.geometries.length;q++)ve+=T(z.geometries[q]);return ve}},ring:At},g="mapboxgl-ctrl",x="mapbox-gl-draw_ctrl-draw-btn",v="mapbox-gl-draw_line",h="mapbox-gl-draw_polygon",l="mapbox-gl-draw_point",c="mapbox-gl-draw_trash",f="mapbox-gl-draw_combine",_="mapbox-gl-draw_uncombine",u="mapboxgl-ctrl-group",S="active",C="mapbox-gl-draw_boxselect",A="mapbox-gl-draw-hot",O="mapbox-gl-draw-cold",j="add",Y="move",oe="drag",ge="pointer",De="none",qe={POLYGON:"polygon",LINE:"line_string",POINT:"point"},lt="Feature",_t="Polygon",xt="LineString",st="Point",yt="FeatureCollection",it="Multi",Rt="MultiPoint",Pt="MultiLineString",Q="MultiPolygon",se={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},ue="draw.create",de="draw.delete",je="draw.update",K="draw.selectionchange",W="draw.modechange",re="draw.actionable",ye="draw.render",Ae="draw.combine",be="draw.uncombine",Be="move",Ze="change_coordinates",nt="feature",Re="midpoint",we="vertex",Le="true",Ke="false",$e=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ut={Point:0,LineString:1,Polygon:2};function ct(T,z){var q=ut[T.geometry.type]-ut[z.geometry.type];return q===0&&T.geometry.type===_t?T.area-z.area:q}function Ht(T){if(this._items={},this._nums={},this._length=T?T.length:0,T)for(var z=0,q=T.length;z<q;z++)this.add(T[z]),T[z]!==void 0&&(typeof T[z]=="string"?this._items[T[z]]=z:this._nums[T[z]]=z)}Ht.prototype.add=function(T){return this.has(T)||(this._length++,typeof T=="string"?this._items[T]=this._length:this._nums[T]=this._length),this},Ht.prototype.delete=function(T){return this.has(T)===!1||(this._length--,delete this._items[T],delete this._nums[T]),this},Ht.prototype.has=function(T){return(typeof T=="string"||typeof T=="number")&&(this._items[T]!==void 0||this._nums[T]!==void 0)},Ht.prototype.values=function(){var T=this,z=[];return Object.keys(this._items).forEach(function(q){z.push({k:q,v:T._items[q]})}),Object.keys(this._nums).forEach(function(q){z.push({k:JSON.parse(q),v:T._nums[q]})}),z.sort(function(q,ve){return q.v-ve.v}).map(function(q){return q.k})},Ht.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Zt=[nt,Re,we],Je={click:function(T,z,q){return Gt(T,z,q,q.options.clickBuffer)},touch:function(T,z,q){return Gt(T,z,q,q.options.touchBuffer)}};function Gt(T,z,q,ve){if(q.map===null)return[];var ze=T?function(Tt,Ve){return Ve===void 0&&(Ve=0),[[Tt.point.x-Ve,Tt.point.y-Ve],[Tt.point.x+Ve,Tt.point.y+Ve]]}(T,ve):z,Te={};q.options.styles&&(Te.layers=q.options.styles.map(function(Tt){return Tt.id}));var ke=q.map.queryRenderedFeatures(ze,Te).filter(function(Tt){return Zt.indexOf(Tt.properties.meta)!==-1}),Ct=new Ht,bt=[];return ke.forEach(function(Tt){var Ve=Tt.properties.id;Ct.has(Ve)||(Ct.add(Ve),bt.push(Tt))}),function(Tt){return Tt.map(function(Ve){return Ve.geometry.type===_t&&(Ve.area=n.geometry({type:lt,property:{},geometry:Ve.geometry})),Ve}).sort(ct).map(function(Ve){return delete Ve.area,Ve})}(bt)}function Qt(T,z){var q=Je.click(T,null,z),ve={mouse:De};return q[0]&&(ve.mouse=q[0].properties.active===Le?Y:ge,ve.feature=q[0].properties.meta),z.events.currentModeName().indexOf("draw")!==-1&&(ve.mouse=j),z.ui.queueMapClasses(ve),z.ui.updateMapClasses(),q[0]}function mi(T,z){var q=T.x-z.x,ve=T.y-z.y;return Math.sqrt(q*q+ve*ve)}function Di(T,z,q){q===void 0&&(q={});var ve=q.fineTolerance!=null?q.fineTolerance:4,ze=q.grossTolerance!=null?q.grossTolerance:12,Te=q.interval!=null?q.interval:500;T.point=T.point||z.point,T.time=T.time||z.time;var ke=mi(T.point,z.point);return ke<ve||ke<ze&&z.time-T.time<Te}function wi(T,z,q){q===void 0&&(q={});var ve=q.tolerance!=null?q.tolerance:25,ze=q.interval!=null?q.interval:250;return T.point=T.point||z.point,T.time=T.time||z.time,mi(T.point,z.point)<ve&&z.time-T.time<ze}function Ge(T,z){return T(z={exports:{}},z.exports),z.exports}var vt=Ge(function(T){var z=T.exports=function(q,ve){if(ve||(ve=16),q===void 0&&(q=128),q<=0)return"0";for(var ze=Math.log(Math.pow(2,q))/Math.log(ve),Te=2;ze===1/0;Te*=2)ze=Math.log(Math.pow(2,q/Te))/Math.log(ve)*Te;var ke=ze-Math.floor(ze),Ct="";for(Te=0;Te<Math.floor(ze);Te++)Ct=Math.floor(Math.random()*ve).toString(ve)+Ct;if(ke){var bt=Math.pow(ve,ke);Ct=Math.floor(Math.random()*bt).toString(ve)+Ct}var Tt=parseInt(Ct,ve);return Tt!==1/0&&Tt>=Math.pow(2,q)?z(q,ve):Ct};z.rack=function(q,ve,ze){var Te=function(Ct){var bt=0;do{if(bt++>10){if(!ze)throw new Error("too many ID collisions, use more bits");q+=ze}var Tt=z(q,ve)}while(Object.hasOwnProperty.call(ke,Tt));return ke[Tt]=Ct,Tt},ke=Te.hats={};return Te.get=function(Ct){return Te.hats[Ct]},Te.set=function(Ct,bt){return Te.hats[Ct]=bt,Te},Te.bits=q||128,Te.base=ve||16,Te}}),Ri=function(T,z){this.ctx=T,this.properties=z.properties||{},this.coordinates=z.geometry.coordinates,this.id=z.id||vt(),this.type=z.geometry.type};Ri.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ri.prototype.incomingCoords=function(T){this.setCoordinates(T)},Ri.prototype.setCoordinates=function(T){this.coordinates=T,this.changed()},Ri.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ri.prototype.setProperty=function(T,z){this.properties[T]=z},Ri.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:lt,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ri.prototype.internal=function(T){var z={id:this.id,meta:nt,"meta:type":this.type,active:Ke,mode:T};if(this.ctx.options.userProperties)for(var q in this.properties)z["user_"+q]=this.properties[q];return{type:lt,properties:z,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Ji=function(T,z){Ri.call(this,T,z)};(Ji.prototype=Object.create(Ri.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Ji.prototype.updateCoordinate=function(T,z,q){this.coordinates=arguments.length===3?[z,q]:[T,z],this.changed()},Ji.prototype.getCoordinate=function(){return this.getCoordinates()};var si=function(T,z){Ri.call(this,T,z)};(si.prototype=Object.create(Ri.prototype)).isValid=function(){return this.coordinates.length>1},si.prototype.addCoordinate=function(T,z,q){this.changed();var ve=parseInt(T,10);this.coordinates.splice(ve,0,[z,q])},si.prototype.getCoordinate=function(T){var z=parseInt(T,10);return JSON.parse(JSON.stringify(this.coordinates[z]))},si.prototype.removeCoordinate=function(T){this.changed(),this.coordinates.splice(parseInt(T,10),1)},si.prototype.updateCoordinate=function(T,z,q){var ve=parseInt(T,10);this.coordinates[ve]=[z,q],this.changed()};var Ei=function(T,z){Ri.call(this,T,z),this.coordinates=this.coordinates.map(function(q){return q.slice(0,-1)})};(Ei.prototype=Object.create(Ri.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(T){return T.length>2})},Ei.prototype.incomingCoords=function(T){this.coordinates=T.map(function(z){return z.slice(0,-1)}),this.changed()},Ei.prototype.setCoordinates=function(T){this.coordinates=T,this.changed()},Ei.prototype.addCoordinate=function(T,z,q){this.changed();var ve=T.split(".").map(function(ze){return parseInt(ze,10)});this.coordinates[ve[0]].splice(ve[1],0,[z,q])},Ei.prototype.removeCoordinate=function(T){this.changed();var z=T.split(".").map(function(ve){return parseInt(ve,10)}),q=this.coordinates[z[0]];q&&(q.splice(z[1],1),q.length<3&&this.coordinates.splice(z[0],1))},Ei.prototype.getCoordinate=function(T){var z=T.split(".").map(function(ve){return parseInt(ve,10)}),q=this.coordinates[z[0]];return JSON.parse(JSON.stringify(q[z[1]]))},Ei.prototype.getCoordinates=function(){return this.coordinates.map(function(T){return T.concat([T[0]])})},Ei.prototype.updateCoordinate=function(T,z,q){this.changed();var ve=T.split("."),ze=parseInt(ve[0],10),Te=parseInt(ve[1],10);this.coordinates[ze]===void 0&&(this.coordinates[ze]=[]),this.coordinates[ze][Te]=[z,q]};var dr={MultiPoint:Ji,MultiLineString:si,MultiPolygon:Ei},fr=function(T,z,q,ve,ze){var Te=q.split("."),ke=parseInt(Te[0],10),Ct=Te[1]?Te.slice(1).join("."):null;return T[ke][z](Ct,ve,ze)},Qi=function(T,z){if(Ri.call(this,T,z),delete this.coordinates,this.model=dr[z.geometry.type],this.model===void 0)throw new TypeError(z.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(z.geometry.coordinates)};function at(T){this.map=T.map,this.drawConfig=JSON.parse(JSON.stringify(T.options||{})),this._ctx=T}(Qi.prototype=Object.create(Ri.prototype))._coordinatesToFeatures=function(T){var z=this,q=this.model.bind(this);return T.map(function(ve){return new q(z.ctx,{id:vt(),type:lt,properties:{},geometry:{coordinates:ve,type:z.type.replace("Multi","")}})})},Qi.prototype.isValid=function(){return this.features.every(function(T){return T.isValid()})},Qi.prototype.setCoordinates=function(T){this.features=this._coordinatesToFeatures(T),this.changed()},Qi.prototype.getCoordinate=function(T){return fr(this.features,"getCoordinate",T)},Qi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(T){return T.type===_t?T.getCoordinates():T.coordinates})))},Qi.prototype.updateCoordinate=function(T,z,q){fr(this.features,"updateCoordinate",T,z,q),this.changed()},Qi.prototype.addCoordinate=function(T,z,q){fr(this.features,"addCoordinate",T,z,q),this.changed()},Qi.prototype.removeCoordinate=function(T){fr(this.features,"removeCoordinate",T),this.changed()},Qi.prototype.getFeatures=function(){return this.features},at.prototype.setSelected=function(T){return this._ctx.store.setSelected(T)},at.prototype.setSelectedCoordinates=function(T){var z=this;this._ctx.store.setSelectedCoordinates(T),T.reduce(function(q,ve){return q[ve.feature_id]===void 0&&(q[ve.feature_id]=!0,z._ctx.store.get(ve.feature_id).changed()),q},{})},at.prototype.getSelected=function(){return this._ctx.store.getSelected()},at.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},at.prototype.isSelected=function(T){return this._ctx.store.isSelected(T)},at.prototype.getFeature=function(T){return this._ctx.store.get(T)},at.prototype.select=function(T){return this._ctx.store.select(T)},at.prototype.deselect=function(T){return this._ctx.store.deselect(T)},at.prototype.deleteFeature=function(T,z){return z===void 0&&(z={}),this._ctx.store.delete(T,z)},at.prototype.addFeature=function(T){return this._ctx.store.add(T)},at.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},at.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},at.prototype.setActionableState=function(T){T===void 0&&(T={});var z={trash:T.trash||!1,combineFeatures:T.combineFeatures||!1,uncombineFeatures:T.uncombineFeatures||!1};return this._ctx.events.actionable(z)},at.prototype.changeMode=function(T,z,q){return z===void 0&&(z={}),q===void 0&&(q={}),this._ctx.events.changeMode(T,z,q)},at.prototype.updateUIClasses=function(T){return this._ctx.ui.queueMapClasses(T)},at.prototype.activateUIButton=function(T){return this._ctx.ui.setActiveButton(T)},at.prototype.featuresAt=function(T,z,q){if(q===void 0&&(q="click"),q!=="click"&&q!=="touch")throw new Error("invalid buffer type");return Je[q](T,z,this._ctx)},at.prototype.newFeature=function(T){var z=T.geometry.type;return z===st?new Ji(this._ctx,T):z===xt?new si(this._ctx,T):z===_t?new Ei(this._ctx,T):new Qi(this._ctx,T)},at.prototype.isInstanceOf=function(T,z){if(T===st)return z instanceof Ji;if(T===xt)return z instanceof si;if(T===_t)return z instanceof Ei;if(T==="MultiFeature")return z instanceof Qi;throw new Error("Unknown feature class: "+T)},at.prototype.doRender=function(T){return this._ctx.store.featureChanged(T)},at.prototype.onSetup=function(){},at.prototype.onDrag=function(){},at.prototype.onClick=function(){},at.prototype.onMouseMove=function(){},at.prototype.onMouseDown=function(){},at.prototype.onMouseUp=function(){},at.prototype.onMouseOut=function(){},at.prototype.onKeyUp=function(){},at.prototype.onKeyDown=function(){},at.prototype.onTouchStart=function(){},at.prototype.onTouchMove=function(){},at.prototype.onTouchEnd=function(){},at.prototype.onTap=function(){},at.prototype.onStop=function(){},at.prototype.onTrash=function(){},at.prototype.onCombineFeature=function(){},at.prototype.onUncombineFeature=function(){},at.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var bi={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},xi=Object.keys(bi);function br(T){var z=Object.keys(T);return function(q,ve){ve===void 0&&(ve={});var ze={},Te=z.reduce(function(ke,Ct){return ke[Ct]=T[Ct],ke},new at(q));return{start:function(){var ke=this;ze=Te.onSetup(ve),xi.forEach(function(Ct){var bt,Tt=bi[Ct],Ve=function(){return!1};T[Tt]&&(Ve=function(){return!0}),ke.on(Ct,Ve,(bt=Tt,function(Dt){return Te[bt](ze,Dt)}))})},stop:function(){Te.onStop(ze)},trash:function(){Te.onTrash(ze)},combineFeatures:function(){Te.onCombineFeatures(ze)},uncombineFeatures:function(){Te.onUncombineFeatures(ze)},render:function(ke,Ct){Te.toDisplayFeatures(ze,ke,Ct)}}}}function tn(T){return[].concat(T).filter(function(z){return z!==void 0})}function yi(){var T=this;if(!(T.ctx.map&&T.ctx.map.getSource(A)!==void 0))return bt();var z=T.ctx.events.currentModeName();T.ctx.ui.queueMapClasses({mode:z});var q=[],ve=[];T.isDirty?ve=T.getAllIds():(q=T.getChangedIds().filter(function(Tt){return T.get(Tt)!==void 0}),ve=T.sources.hot.filter(function(Tt){return Tt.properties.id&&q.indexOf(Tt.properties.id)===-1&&T.get(Tt.properties.id)!==void 0}).map(function(Tt){return Tt.properties.id})),T.sources.hot=[];var ze=T.sources.cold.length;T.sources.cold=T.isDirty?[]:T.sources.cold.filter(function(Tt){var Ve=Tt.properties.id||Tt.properties.parent;return q.indexOf(Ve)===-1});var Te=ze!==T.sources.cold.length||ve.length>0;function ke(Tt,Ve){var Dt=T.get(Tt).internal(z);T.ctx.events.currentModeRender(Dt,function(qt){T.sources[Ve].push(qt)})}if(q.forEach(function(Tt){return ke(Tt,"hot")}),ve.forEach(function(Tt){return ke(Tt,"cold")}),Te&&T.ctx.map.getSource(O).setData({type:yt,features:T.sources.cold}),T.ctx.map.getSource(A).setData({type:yt,features:T.sources.hot}),T._emitSelectionChange&&(T.ctx.map.fire(K,{features:T.getSelected().map(function(Tt){return Tt.toGeoJSON()}),points:T.getSelectedCoordinates().map(function(Tt){return{type:lt,properties:{},geometry:{type:st,coordinates:Tt.coordinates}}})}),T._emitSelectionChange=!1),T._deletedFeaturesToEmit.length){var Ct=T._deletedFeaturesToEmit.map(function(Tt){return Tt.toGeoJSON()});T._deletedFeaturesToEmit=[],T.ctx.map.fire(de,{features:Ct})}function bt(){T.isDirty=!1,T.clearChangedIds()}bt(),T.ctx.map.fire(ye,{})}function Oi(T){var z,q=this;this._features={},this._featureIds=new Ht,this._selectedFeatureIds=new Ht,this._selectedCoordinates=[],this._changedFeatureIds=new Ht,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=T,this.sources={hot:[],cold:[]},this.render=function(){z||(z=requestAnimationFrame(function(){z=null,yi.call(q)}))},this.isDirty=!1}function wr(T,z){var q=T._selectedCoordinates.filter(function(ve){return T._selectedFeatureIds.has(ve.feature_id)});T._selectedCoordinates.length===q.length||z.silent||(T._emitSelectionChange=!0),T._selectedCoordinates=q}Oi.prototype.createRenderBatch=function(){var T=this,z=this.render,q=0;return this.render=function(){q++},function(){T.render=z,q>0&&T.render()}},Oi.prototype.setDirty=function(){return this.isDirty=!0,this},Oi.prototype.featureChanged=function(T){return this._changedFeatureIds.add(T),this},Oi.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Oi.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Oi.prototype.getAllIds=function(){return this._featureIds.values()},Oi.prototype.add=function(T){return this.featureChanged(T.id),this._features[T.id]=T,this._featureIds.add(T.id),this},Oi.prototype.delete=function(T,z){var q=this;return z===void 0&&(z={}),tn(T).forEach(function(ve){q._featureIds.has(ve)&&(q._featureIds.delete(ve),q._selectedFeatureIds.delete(ve),z.silent||q._deletedFeaturesToEmit.indexOf(q._features[ve])===-1&&q._deletedFeaturesToEmit.push(q._features[ve]),delete q._features[ve],q.isDirty=!0)}),wr(this,z),this},Oi.prototype.get=function(T){return this._features[T]},Oi.prototype.getAll=function(){var T=this;return Object.keys(this._features).map(function(z){return T._features[z]})},Oi.prototype.select=function(T,z){var q=this;return z===void 0&&(z={}),tn(T).forEach(function(ve){q._selectedFeatureIds.has(ve)||(q._selectedFeatureIds.add(ve),q._changedFeatureIds.add(ve),z.silent||(q._emitSelectionChange=!0))}),this},Oi.prototype.deselect=function(T,z){var q=this;return z===void 0&&(z={}),tn(T).forEach(function(ve){q._selectedFeatureIds.has(ve)&&(q._selectedFeatureIds.delete(ve),q._changedFeatureIds.add(ve),z.silent||(q._emitSelectionChange=!0))}),wr(this,z),this},Oi.prototype.clearSelected=function(T){return T===void 0&&(T={}),this.deselect(this._selectedFeatureIds.values(),{silent:T.silent}),this},Oi.prototype.setSelected=function(T,z){var q=this;return z===void 0&&(z={}),T=tn(T),this.deselect(this._selectedFeatureIds.values().filter(function(ve){return T.indexOf(ve)===-1}),{silent:z.silent}),this.select(T.filter(function(ve){return!q._selectedFeatureIds.has(ve)}),{silent:z.silent}),this},Oi.prototype.setSelectedCoordinates=function(T){return this._selectedCoordinates=T,this._emitSelectionChange=!0,this},Oi.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Oi.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Oi.prototype.getSelected=function(){var T=this;return this._selectedFeatureIds.values().map(function(z){return T.get(z)})},Oi.prototype.getSelectedCoordinates=function(){var T=this;return this._selectedCoordinates.map(function(z){return{coordinates:T.get(z.feature_id).getCoordinate(z.coord_path)}})},Oi.prototype.isSelected=function(T){return this._selectedFeatureIds.has(T)},Oi.prototype.setFeatureProperty=function(T,z,q){this.get(T).setProperty(z,q),this.featureChanged(T)},Oi.prototype.storeMapConfig=function(){var T=this;$e.forEach(function(z){T.ctx.map[z]&&(T._mapInitialConfig[z]=T.ctx.map[z].isEnabled())})},Oi.prototype.restoreMapConfig=function(){var T=this;Object.keys(this._mapInitialConfig).forEach(function(z){T._mapInitialConfig[z]?T.ctx.map[z].enable():T.ctx.map[z].disable()})},Oi.prototype.getInitialConfigValue=function(T){return this._mapInitialConfig[T]===void 0||this._mapInitialConfig[T]};var Vr=function(){for(var T=arguments,z={},q=0;q<arguments.length;q++){var ve=T[q];for(var ze in ve)lr.call(ve,ze)&&(z[ze]=ve[ze])}return z},lr=Object.prototype.hasOwnProperty,Dr=["mode","feature","mouse"];function Xi(T){var z=null,q=null,ve={onRemove:function(){return T.map.off("load",ve.connect),clearInterval(q),ve.removeLayers(),T.store.restoreMapConfig(),T.ui.removeButtons(),T.events.removeEventListeners(),T.ui.clearMapClasses(),T.map=null,T.container=null,T.store=null,z&&z.parentNode&&z.parentNode.removeChild(z),z=null,this},connect:function(){T.map.off("load",ve.connect),clearInterval(q),ve.addLayers(),T.store.storeMapConfig(),T.events.addEventListeners()},onAdd:function(ze){var Te=ze.fire;return ze.fire=function(ke,Ct){var bt=arguments;return Te.length===1&&arguments.length!==1&&(bt=[Vr({},{type:ke},Ct)]),Te.apply(ze,bt)},T.map=ze,T.events=function(ke){var Ct=Object.keys(ke.options.modes).reduce(function(mt,ti){return mt[ti]=br(ke.options.modes[ti]),mt},{}),bt={},Tt={},Ve={},Dt=null,qt=null;Ve.drag=function(mt,ti){ti({point:mt.point,time:new Date().getTime()})?(ke.ui.queueMapClasses({mouse:oe}),qt.drag(mt)):mt.originalEvent.stopPropagation()},Ve.mousedrag=function(mt){Ve.drag(mt,function(ti){return!Di(bt,ti)})},Ve.touchdrag=function(mt){Ve.drag(mt,function(ti){return!wi(Tt,ti)})},Ve.mousemove=function(mt){if((mt.originalEvent.buttons!==void 0?mt.originalEvent.buttons:mt.originalEvent.which)===1)return Ve.mousedrag(mt);var ti=Qt(mt,ke);mt.featureTarget=ti,qt.mousemove(mt)},Ve.mousedown=function(mt){bt={time:new Date().getTime(),point:mt.point};var ti=Qt(mt,ke);mt.featureTarget=ti,qt.mousedown(mt)},Ve.mouseup=function(mt){var ti=Qt(mt,ke);mt.featureTarget=ti,Di(bt,{point:mt.point,time:new Date().getTime()})?qt.click(mt):qt.mouseup(mt)},Ve.mouseout=function(mt){qt.mouseout(mt)},Ve.touchstart=function(mt){if(mt.originalEvent.preventDefault(),ke.options.touchEnabled){Tt={time:new Date().getTime(),point:mt.point};var ti=Je.touch(mt,null,ke)[0];mt.featureTarget=ti,qt.touchstart(mt)}},Ve.touchmove=function(mt){if(mt.originalEvent.preventDefault(),ke.options.touchEnabled)return qt.touchmove(mt),Ve.touchdrag(mt)},Ve.touchend=function(mt){if(mt.originalEvent.preventDefault(),ke.options.touchEnabled){var ti=Je.touch(mt,null,ke)[0];mt.featureTarget=ti,wi(Tt,{time:new Date().getTime(),point:mt.point})?qt.tap(mt):qt.touchend(mt)}};var li=function(mt){return!(mt===8||mt===46||mt>=48&&mt<=57)};function _i(mt,ti,qi){qi===void 0&&(qi={}),qt.stop();var $i=Ct[mt];if($i===void 0)throw new Error(mt+" is not valid");Dt=mt;var hr=$i(ke,ti);qt=pt(hr,ke),qi.silent||ke.map.fire(W,{mode:mt}),ke.store.setDirty(),ke.store.render()}Ve.keydown=function(mt){(mt.srcElement||mt.target).classList[0]==="mapboxgl-canvas"&&(mt.keyCode!==8&&mt.keyCode!==46||!ke.options.controls.trash?li(mt.keyCode)?qt.keydown(mt):mt.keyCode===49&&ke.options.controls.point?_i(se.DRAW_POINT):mt.keyCode===50&&ke.options.controls.line_string?_i(se.DRAW_LINE_STRING):mt.keyCode===51&&ke.options.controls.polygon&&_i(se.DRAW_POLYGON):(mt.preventDefault(),qt.trash()))},Ve.keyup=function(mt){li(mt.keyCode)&&qt.keyup(mt)},Ve.zoomend=function(){ke.store.changeZoom()},Ve.data=function(mt){if(mt.dataType==="style"){var ti=ke.setup,qi=ke.map,$i=ke.options,hr=ke.store;$i.styles.some(function(ci){return qi.getLayer(ci.id)})||(ti.addLayers(),hr.setDirty(),hr.render())}};var Sr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Dt=ke.options.defaultMode,qt=pt(Ct[Dt](ke),ke)},changeMode:_i,actionable:function(mt){var ti=!1;Object.keys(mt).forEach(function(qi){if(Sr[qi]===void 0)throw new Error("Invalid action type");Sr[qi]!==mt[qi]&&(ti=!0),Sr[qi]=mt[qi]}),ti&&ke.map.fire(re,{actions:Sr})},currentModeName:function(){return Dt},currentModeRender:function(mt,ti){return qt.render(mt,ti)},fire:function(mt,ti){Ve[mt]&&Ve[mt](ti)},addEventListeners:function(){ke.map.on("mousemove",Ve.mousemove),ke.map.on("mousedown",Ve.mousedown),ke.map.on("mouseup",Ve.mouseup),ke.map.on("data",Ve.data),ke.map.on("touchmove",Ve.touchmove),ke.map.on("touchstart",Ve.touchstart),ke.map.on("touchend",Ve.touchend),ke.container.addEventListener("mouseout",Ve.mouseout),ke.options.keybindings&&(ke.container.addEventListener("keydown",Ve.keydown),ke.container.addEventListener("keyup",Ve.keyup))},removeEventListeners:function(){ke.map.off("mousemove",Ve.mousemove),ke.map.off("mousedown",Ve.mousedown),ke.map.off("mouseup",Ve.mouseup),ke.map.off("data",Ve.data),ke.map.off("touchmove",Ve.touchmove),ke.map.off("touchstart",Ve.touchstart),ke.map.off("touchend",Ve.touchend),ke.container.removeEventListener("mouseout",Ve.mouseout),ke.options.keybindings&&(ke.container.removeEventListener("keydown",Ve.keydown),ke.container.removeEventListener("keyup",Ve.keyup))},trash:function(mt){qt.trash(mt)},combineFeatures:function(){qt.combineFeatures()},uncombineFeatures:function(){qt.uncombineFeatures()},getMode:function(){return Dt}}}(T),T.ui=function(ke){var Ct={},bt=null,Tt={mode:null,feature:null,mouse:null},Ve={mode:null,feature:null,mouse:null};function Dt(mt){Ve=Vr(Ve,mt)}function qt(){var mt,ti;if(ke.container){var qi=[],$i=[];Dr.forEach(function(hr){Ve[hr]!==Tt[hr]&&(qi.push(hr+"-"+Tt[hr]),Ve[hr]!==null&&$i.push(hr+"-"+Ve[hr]))}),qi.length>0&&(mt=ke.container.classList).remove.apply(mt,qi),$i.length>0&&(ti=ke.container.classList).add.apply(ti,$i),Tt=Vr(Tt,Ve)}}function li(mt,ti){ti===void 0&&(ti={});var qi=document.createElement("button");return qi.className=x+" "+ti.className,qi.setAttribute("title",ti.title),ti.container.appendChild(qi),qi.addEventListener("click",function($i){if($i.preventDefault(),$i.stopPropagation(),$i.target===bt)return _i(),void ti.onDeactivate();Sr(mt),ti.onActivate()},!0),qi}function _i(){bt&&(bt.classList.remove(S),bt=null)}function Sr(mt){_i();var ti=Ct[mt];ti&&ti&&mt!=="trash"&&(ti.classList.add(S),bt=ti)}return{setActiveButton:Sr,queueMapClasses:Dt,updateMapClasses:qt,clearMapClasses:function(){Dt({mode:null,feature:null,mouse:null}),qt()},addButtons:function(){var mt=ke.options.controls,ti=document.createElement("div");return ti.className=u+" "+g,mt&&(mt[qe.LINE]&&(Ct[qe.LINE]=li(qe.LINE,{container:ti,className:v,title:"LineString tool "+(ke.options.keybindings?"(l)":""),onActivate:function(){return ke.events.changeMode(se.DRAW_LINE_STRING)},onDeactivate:function(){return ke.events.trash()}})),mt[qe.POLYGON]&&(Ct[qe.POLYGON]=li(qe.POLYGON,{container:ti,className:h,title:"Polygon tool "+(ke.options.keybindings?"(p)":""),onActivate:function(){return ke.events.changeMode(se.DRAW_POLYGON)},onDeactivate:function(){return ke.events.trash()}})),mt[qe.POINT]&&(Ct[qe.POINT]=li(qe.POINT,{container:ti,className:l,title:"Marker tool "+(ke.options.keybindings?"(m)":""),onActivate:function(){return ke.events.changeMode(se.DRAW_POINT)},onDeactivate:function(){return ke.events.trash()}})),mt.trash&&(Ct.trash=li("trash",{container:ti,className:c,title:"Delete",onActivate:function(){ke.events.trash()}})),mt.combine_features&&(Ct.combine_features=li("combineFeatures",{container:ti,className:f,title:"Combine",onActivate:function(){ke.events.combineFeatures()}})),mt.uncombine_features&&(Ct.uncombine_features=li("uncombineFeatures",{container:ti,className:_,title:"Uncombine",onActivate:function(){ke.events.uncombineFeatures()}}))),ti},removeButtons:function(){Object.keys(Ct).forEach(function(mt){var ti=Ct[mt];ti.parentNode&&ti.parentNode.removeChild(ti),delete Ct[mt]})}}}(T),T.container=ze.getContainer(),T.store=new Oi(T),z=T.ui.addButtons(),T.options.boxSelect&&(ze.boxZoom.disable(),ze.dragPan.disable(),ze.dragPan.enable()),ze.loaded()?ve.connect():(ze.on("load",ve.connect),q=setInterval(function(){ze.loaded()&&ve.connect()},16)),T.events.start(),z},addLayers:function(){T.map.addSource(O,{data:{type:yt,features:[]},type:"geojson"}),T.map.addSource(A,{data:{type:yt,features:[]},type:"geojson"}),T.options.styles.forEach(function(ze){T.map.addLayer(ze)}),T.store.setDirty(!0),T.store.render()},removeLayers:function(){T.options.styles.forEach(function(ze){T.map.getLayer(ze.id)&&T.map.removeLayer(ze.id)}),T.map.getSource(O)&&T.map.removeSource(O),T.map.getSource(A)&&T.map.removeSource(A)}};return T.setup=ve,ve}function ls(T){return function(z){var q=z.featureTarget;return!!q&&!!q.properties&&q.properties.meta===T}}function Zr(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.active===Le&&T.featureTarget.properties.meta===nt}function cs(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.active===Ke&&T.featureTarget.properties.meta===nt}function Wn(T){return T.featureTarget===void 0}function $n(T){var z=T.featureTarget;return!!z&&!!z.properties&&z.properties.meta===we}function qn(T){return!!T.originalEvent&&T.originalEvent.shiftKey===!0}function ie(T){return T.keyCode===27}function B(T){return T.keyCode===13}var G=ee;function ee(T,z){this.x=T,this.y=z}function te(T,z){var q=z.getBoundingClientRect();return new G(T.clientX-q.left-(z.clientLeft||0),T.clientY-q.top-(z.clientTop||0))}function fe(T,z,q,ve){return{type:lt,properties:{meta:we,parent:T,coord_path:q,active:ve?Le:Ke},geometry:{type:st,coordinates:z}}}function Se(T,z,q){z===void 0&&(z={}),q===void 0&&(q=null);var ve,ze=T.geometry,Te=ze.type,ke=ze.coordinates,Ct=T.properties&&T.properties.id,bt=[];function Tt(Dt,qt){var li="",_i=null;Dt.forEach(function(Sr,mt){var ti=qt!=null?qt+"."+mt:String(mt),qi=fe(Ct,Sr,ti,Ve(ti));if(z.midpoints&&_i){var $i=function(ci,Ai,Hn){var Wi=Ai.geometry.coordinates,Jr=Hn.geometry.coordinates;if(Wi[1]>85||Wi[1]<-85||Jr[1]>85||Jr[1]<-85)return null;var Or={lng:(Wi[0]+Jr[0])/2,lat:(Wi[1]+Jr[1])/2};return{type:lt,properties:{meta:Re,parent:ci,lng:Or.lng,lat:Or.lat,coord_path:Hn.properties.coord_path},geometry:{type:st,coordinates:[Or.lng,Or.lat]}}}(Ct,_i,qi);$i&&bt.push($i)}_i=qi;var hr=JSON.stringify(Sr);li!==hr&&bt.push(qi),mt===0&&(li=hr)})}function Ve(Dt){return!!z.selectedPaths&&z.selectedPaths.indexOf(Dt)!==-1}return Te===st?bt.push(fe(Ct,ke,q,Ve(q))):Te===_t?ke.forEach(function(Dt,qt){Tt(Dt,q!==null?q+"."+qt:String(qt))}):Te===xt?Tt(ke,q):Te.indexOf(it)===0&&(ve=Te.replace(it,""),ke.forEach(function(Dt,qt){var li={type:lt,properties:T.properties,geometry:{type:ve,coordinates:Dt}};bt=bt.concat(Se(li,z,qt))})),bt}ee.prototype={clone:function(){return new ee(this.x,this.y)},add:function(T){return this.clone()._add(T)},sub:function(T){return this.clone()._sub(T)},multByPoint:function(T){return this.clone()._multByPoint(T)},divByPoint:function(T){return this.clone()._divByPoint(T)},mult:function(T){return this.clone()._mult(T)},div:function(T){return this.clone()._div(T)},rotate:function(T){return this.clone()._rotate(T)},rotateAround:function(T,z){return this.clone()._rotateAround(T,z)},matMult:function(T){return this.clone()._matMult(T)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(T){return this.x===T.x&&this.y===T.y},dist:function(T){return Math.sqrt(this.distSqr(T))},distSqr:function(T){var z=T.x-this.x,q=T.y-this.y;return z*z+q*q},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(T){return Math.atan2(this.y-T.y,this.x-T.x)},angleWith:function(T){return this.angleWithSep(T.x,T.y)},angleWithSep:function(T,z){return Math.atan2(this.x*z-this.y*T,this.x*T+this.y*z)},_matMult:function(T){var z=T[0]*this.x+T[1]*this.y,q=T[2]*this.x+T[3]*this.y;return this.x=z,this.y=q,this},_add:function(T){return this.x+=T.x,this.y+=T.y,this},_sub:function(T){return this.x-=T.x,this.y-=T.y,this},_mult:function(T){return this.x*=T,this.y*=T,this},_div:function(T){return this.x/=T,this.y/=T,this},_multByPoint:function(T){return this.x*=T.x,this.y*=T.y,this},_divByPoint:function(T){return this.x/=T.x,this.y/=T.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var T=this.y;return this.y=this.x,this.x=-T,this},_rotate:function(T){var z=Math.cos(T),q=Math.sin(T),ve=z*this.x-q*this.y,ze=q*this.x+z*this.y;return this.x=ve,this.y=ze,this},_rotateAround:function(T,z){var q=Math.cos(T),ve=Math.sin(T),ze=z.x+q*(this.x-z.x)-ve*(this.y-z.y),Te=z.y+ve*(this.x-z.x)+q*(this.y-z.y);return this.x=ze,this.y=Te,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ee.convert=function(T){return T instanceof ee?T:Array.isArray(T)?new ee(T[0],T[1]):T};var _e=function(T){setTimeout(function(){T.map&&T.map.doubleClickZoom&&T._ctx&&T._ctx.store&&T._ctx.store.getInitialConfigValue&&T._ctx.store.getInitialConfigValue("doubleClickZoom")&&T.map.doubleClickZoom.enable()},0)},pe=function(T){setTimeout(function(){T.map&&T.map.doubleClickZoom&&T.map.doubleClickZoom.disable()},0)},Ce=function(T){if(!T||!T.type)return null;var z=He[T.type];if(!z)return null;if(z==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:T}]};if(z==="feature")return{type:"FeatureCollection",features:[T]};if(z==="featurecollection")return T},He={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function gt(T){switch(T&&T.type||null){case"FeatureCollection":return T.features=T.features.reduce(function(z,q){return z.concat(gt(q))},[]),T;case"Feature":return T.geometry?gt(T.geometry).map(function(z){var q={type:"Feature",properties:JSON.parse(JSON.stringify(T.properties)),geometry:z};return T.id!==void 0&&(q.id=T.id),q}):[T];case"MultiPoint":return T.coordinates.map(function(z){return{type:"Point",coordinates:z}});case"MultiPolygon":return T.coordinates.map(function(z){return{type:"Polygon",coordinates:z}});case"MultiLineString":return T.coordinates.map(function(z){return{type:"LineString",coordinates:z}});case"GeometryCollection":return T.geometries.map(gt).reduce(function(z,q){return z.concat(q)},[]);case"Point":case"Polygon":case"LineString":return[T]}}var Ye=function(T){if(!T)return[];var z=gt(Ce(T)),q=[];return z.features.forEach(function(ve){ve.geometry&&(q=q.concat(function ze(Te){return Array.isArray(Te)&&Te.length&&typeof Te[0]=="number"?[Te]:Te.reduce(function(ke,Ct){return Array.isArray(Ct)&&Array.isArray(Ct[0])?ke.concat(ze(Ct)):(ke.push(Ct),ke)},[])}(ve.geometry.coordinates)))}),q},ei=Ge(function(T){var z=T.exports=function(Ve){return new q(Ve)};function q(Ve){this.value=Ve}function ve(Ve,Dt,qt){var li=[],_i=[],Sr=!0;return function mt(ti){var qi=qt?ze(ti):ti,$i={},hr=!0,ci={node:qi,node_:ti,path:[].concat(li),parent:_i[_i.length-1],parents:_i,key:li.slice(-1)[0],isRoot:li.length===0,level:li.length,circular:null,update:function(Wi,Jr){ci.isRoot||(ci.parent.node[ci.key]=Wi),ci.node=Wi,Jr&&(hr=!1)},delete:function(Wi){delete ci.parent.node[ci.key],Wi&&(hr=!1)},remove:function(Wi){Ct(ci.parent.node)?ci.parent.node.splice(ci.key,1):delete ci.parent.node[ci.key],Wi&&(hr=!1)},keys:null,before:function(Wi){$i.before=Wi},after:function(Wi){$i.after=Wi},pre:function(Wi){$i.pre=Wi},post:function(Wi){$i.post=Wi},stop:function(){Sr=!1},block:function(){hr=!1}};if(!Sr)return ci;function Ai(){if(typeof ci.node=="object"&&ci.node!==null){ci.keys&&ci.node_===ci.node||(ci.keys=Te(ci.node)),ci.isLeaf=ci.keys.length==0;for(var Wi=0;Wi<_i.length;Wi++)if(_i[Wi].node_===ti){ci.circular=_i[Wi];break}}else ci.isLeaf=!0,ci.keys=null;ci.notLeaf=!ci.isLeaf,ci.notRoot=!ci.isRoot}Ai();var Hn=Dt.call(ci,ci.node);return Hn!==void 0&&ci.update&&ci.update(Hn),$i.before&&$i.before.call(ci,ci.node),hr&&(typeof ci.node!="object"||ci.node===null||ci.circular||(_i.push(ci),Ai(),bt(ci.keys,function(Wi,Jr){li.push(Wi),$i.pre&&$i.pre.call(ci,ci.node[Wi],Wi);var Or=mt(ci.node[Wi]);qt&&Tt.call(ci.node,Wi)&&(ci.node[Wi]=Or.node),Or.isLast=Jr==ci.keys.length-1,Or.isFirst=Jr==0,$i.post&&$i.post.call(ci,Or),li.pop()}),_i.pop()),$i.after&&$i.after.call(ci,ci.node)),ci}(Ve).node}function ze(Ve){if(typeof Ve=="object"&&Ve!==null){var Dt;if(Ct(Ve))Dt=[];else if(ke(Ve)==="[object Date]")Dt=new Date(Ve.getTime?Ve.getTime():Ve);else if(function(_i){return ke(_i)==="[object RegExp]"}(Ve))Dt=new RegExp(Ve);else if(function(_i){return ke(_i)==="[object Error]"}(Ve))Dt={message:Ve.message};else if(function(_i){return ke(_i)==="[object Boolean]"}(Ve))Dt=new Boolean(Ve);else if(function(_i){return ke(_i)==="[object Number]"}(Ve))Dt=new Number(Ve);else if(function(_i){return ke(_i)==="[object String]"}(Ve))Dt=new String(Ve);else if(Object.create&&Object.getPrototypeOf)Dt=Object.create(Object.getPrototypeOf(Ve));else if(Ve.constructor===Object)Dt={};else{var qt=Ve.constructor&&Ve.constructor.prototype||Ve.__proto__||{},li=function(){};li.prototype=qt,Dt=new li}return bt(Te(Ve),function(_i){Dt[_i]=Ve[_i]}),Dt}return Ve}q.prototype.get=function(Ve){for(var Dt=this.value,qt=0;qt<Ve.length;qt++){var li=Ve[qt];if(!Dt||!Tt.call(Dt,li)){Dt=void 0;break}Dt=Dt[li]}return Dt},q.prototype.has=function(Ve){for(var Dt=this.value,qt=0;qt<Ve.length;qt++){var li=Ve[qt];if(!Dt||!Tt.call(Dt,li))return!1;Dt=Dt[li]}return!0},q.prototype.set=function(Ve,Dt){for(var qt=this.value,li=0;li<Ve.length-1;li++){var _i=Ve[li];Tt.call(qt,_i)||(qt[_i]={}),qt=qt[_i]}return qt[Ve[li]]=Dt,Dt},q.prototype.map=function(Ve){return ve(this.value,Ve,!0)},q.prototype.forEach=function(Ve){return this.value=ve(this.value,Ve,!1),this.value},q.prototype.reduce=function(Ve,Dt){var qt=arguments.length===1,li=qt?this.value:Dt;return this.forEach(function(_i){this.isRoot&&qt||(li=Ve.call(this,li,_i))}),li},q.prototype.paths=function(){var Ve=[];return this.forEach(function(Dt){Ve.push(this.path)}),Ve},q.prototype.nodes=function(){var Ve=[];return this.forEach(function(Dt){Ve.push(this.node)}),Ve},q.prototype.clone=function(){var Ve=[],Dt=[];return function qt(li){for(var _i=0;_i<Ve.length;_i++)if(Ve[_i]===li)return Dt[_i];if(typeof li=="object"&&li!==null){var Sr=ze(li);return Ve.push(li),Dt.push(Sr),bt(Te(li),function(mt){Sr[mt]=qt(li[mt])}),Ve.pop(),Dt.pop(),Sr}return li}(this.value)};var Te=Object.keys||function(Ve){var Dt=[];for(var qt in Ve)Dt.push(qt);return Dt};function ke(Ve){return Object.prototype.toString.call(Ve)}var Ct=Array.isArray||function(Ve){return Object.prototype.toString.call(Ve)==="[object Array]"},bt=function(Ve,Dt){if(Ve.forEach)return Ve.forEach(Dt);for(var qt=0;qt<Ve.length;qt++)Dt(Ve[qt],qt,Ve)};bt(Te(q.prototype),function(Ve){z[Ve]=function(Dt){var qt=[].slice.call(arguments,1),li=new q(Dt);return li[Ve].apply(li,qt)}});var Tt=Object.hasOwnProperty||function(Ve,Dt){return Dt in Ve}}),ri=It;function It(T){if(!(this instanceof It))return new It(T);this._bbox=T||[1/0,1/0,-1/0,-1/0],this._valid=!!T}It.prototype.include=function(T){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],T[0]),this._bbox[1]=Math.min(this._bbox[1],T[1]),this._bbox[2]=Math.max(this._bbox[2],T[0]),this._bbox[3]=Math.max(this._bbox[3],T[1]),this},It.prototype.equals=function(T){var z;return z=T instanceof It?T.bbox():T,this._bbox[0]==z[0]&&this._bbox[1]==z[1]&&this._bbox[2]==z[2]&&this._bbox[3]==z[3]},It.prototype.center=function(T){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},It.prototype.union=function(T){var z;return this._valid=!0,z=T instanceof It?T.bbox():T,this._bbox[0]=Math.min(this._bbox[0],z[0]),this._bbox[1]=Math.min(this._bbox[1],z[1]),this._bbox[2]=Math.max(this._bbox[2],z[2]),this._bbox[3]=Math.max(this._bbox[3],z[3]),this},It.prototype.bbox=function(){return this._valid?this._bbox:null},It.prototype.contains=function(T){if(!T)return this._fastContains();if(!this._valid)return null;var z=T[0],q=T[1];return this._bbox[0]<=z&&this._bbox[1]<=q&&this._bbox[2]>=z&&this._bbox[3]>=q},It.prototype.intersect=function(T){return this._valid?(z=T instanceof It?T.bbox():T,!(this._bbox[0]>z[2]||this._bbox[2]<z[0]||this._bbox[3]<z[1]||this._bbox[1]>z[3])):null;var z},It.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var T="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",T)},It.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var di={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},gi=Object.keys(di),Li=function(T){return vi(T).bbox()};function vi(T){for(var z=ri(),q=Ye(T),ve=0;ve<q.length;ve++)z.include(q[ve]);return z}Li.polygon=function(T){return vi(T).polygon()},Li.bboxify=function(T){return ei(T).map(function(z){z&&gi.some(function(q){return!!z[q]&&di[q].indexOf(z.type)!==-1})&&(z.bbox=vi(z).bbox(),this.update(z))})};function Ti(T,z){var q=-90,ve=90,ze=-90,Te=90,ke=270,Ct=-270;T.forEach(function(Tt){var Ve=Li(Tt),Dt=Ve[1],qt=Ve[3],li=Ve[0],_i=Ve[2];Dt>q&&(q=Dt),qt<ve&&(ve=qt),qt>ze&&(ze=qt),Dt<Te&&(Te=Dt),li<ke&&(ke=li),_i>Ct&&(Ct=_i)});var bt=z;return q+bt.lat>85&&(bt.lat=85-q),ze+bt.lat>90&&(bt.lat=90-ze),ve+bt.lat<-85&&(bt.lat=-85-ve),Te+bt.lat<-90&&(bt.lat=-90-Te),ke+bt.lng<=-270&&(bt.lng+=360*Math.ceil(Math.abs(bt.lng)/360)),Ct+bt.lng>=270&&(bt.lng-=360*Math.ceil(Math.abs(bt.lng)/360)),bt}function Bi(T,z){var q=Ti(T.map(function(ve){return ve.toGeoJSON()}),z);T.forEach(function(ve){var ze,Te=ve.getCoordinates(),ke=function(bt){var Tt={lng:bt[0]+q.lng,lat:bt[1]+q.lat};return[Tt.lng,Tt.lat]},Ct=function(bt){return bt.map(function(Tt){return ke(Tt)})};ve.type===st?ze=ke(Te):ve.type===xt||ve.type===Rt?ze=Te.map(ke):ve.type===_t||ve.type===Pt?ze=Te.map(Ct):ve.type===Q&&(ze=Te.map(function(bt){return bt.map(function(Tt){return Ct(Tt)})})),ve.incomingCoords(ze)})}var Si={onSetup:function(T){var z=this,q={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:T.featureIds||[]};return this.setSelected(q.initiallySelectedFeatureIds.filter(function(ve){return z.getFeature(ve)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),q},fireUpdate:function(){this.map.fire(je,{action:Be,features:this.getSelected().map(function(T){return T.toGeoJSON()})})},fireActionable:function(){var T=this,z=this.getSelected(),q=z.filter(function(Ct){return T.isInstanceOf("MultiFeature",Ct)}),ve=!1;if(z.length>1){ve=!0;var ze=z[0].type.replace("Multi","");z.forEach(function(Ct){Ct.type.replace("Multi","")!==ze&&(ve=!1)})}var Te=q.length>0,ke=z.length>0;this.setActionableState({combineFeatures:ve,uncombineFeatures:Te,trash:ke})},getUniqueIds:function(T){return T.length?T.map(function(z){return z.properties.id}).filter(function(z){return z!==void 0}).reduce(function(z,q){return z.add(q),z},new Ht).values():[]},stopExtendedInteractions:function(T){T.boxSelectElement&&(T.boxSelectElement.parentNode&&T.boxSelectElement.parentNode.removeChild(T.boxSelectElement),T.boxSelectElement=null),this.map.dragPan.enable(),T.boxSelecting=!1,T.canBoxSelect=!1,T.dragMoving=!1,T.canDragMove=!1},onStop:function(){_e(this)},onMouseMove:function(T){return this.stopExtendedInteractions(T),!0},onMouseOut:function(T){return!T.dragMoving||this.fireUpdate()}};Si.onTap=Si.onClick=function(T,z){return Wn(z)?this.clickAnywhere(T,z):ls(we)(z)?this.clickOnVertex(T,z):function(q){return!!q.featureTarget&&!!q.featureTarget.properties&&q.featureTarget.properties.meta===nt}(z)?this.clickOnFeature(T,z):void 0},Si.clickAnywhere=function(T){var z=this,q=this.getSelectedIds();q.length&&(this.clearSelectedFeatures(),q.forEach(function(ve){return z.doRender(ve)})),_e(this),this.stopExtendedInteractions(T)},Si.clickOnVertex=function(T,z){this.changeMode(se.DIRECT_SELECT,{featureId:z.featureTarget.properties.parent,coordPath:z.featureTarget.properties.coord_path,startPos:z.lngLat}),this.updateUIClasses({mouse:Y})},Si.startOnActiveFeature=function(T,z){this.stopExtendedInteractions(T),this.map.dragPan.disable(),this.doRender(z.featureTarget.properties.id),T.canDragMove=!0,T.dragMoveLocation=z.lngLat},Si.clickOnFeature=function(T,z){var q=this;pe(this),this.stopExtendedInteractions(T);var ve=qn(z),ze=this.getSelectedIds(),Te=z.featureTarget.properties.id,ke=this.isSelected(Te);if(!ve&&ke&&this.getFeature(Te).type!==st)return this.changeMode(se.DIRECT_SELECT,{featureId:Te});ke&&ve?(this.deselect(Te),this.updateUIClasses({mouse:ge}),ze.length===1&&_e(this)):!ke&&ve?(this.select(Te),this.updateUIClasses({mouse:Y})):ke||ve||(ze.forEach(function(Ct){return q.doRender(Ct)}),this.setSelected(Te),this.updateUIClasses({mouse:Y})),this.doRender(Te)},Si.onMouseDown=function(T,z){return Zr(z)?this.startOnActiveFeature(T,z):this.drawConfig.boxSelect&&function(q){return!!q.originalEvent&&!!q.originalEvent.shiftKey&&q.originalEvent.button===0}(z)?this.startBoxSelect(T,z):void 0},Si.startBoxSelect=function(T,z){this.stopExtendedInteractions(T),this.map.dragPan.disable(),T.boxSelectStartLocation=te(z.originalEvent,this.map.getContainer()),T.canBoxSelect=!0},Si.onTouchStart=function(T,z){if(Zr(z))return this.startOnActiveFeature(T,z)},Si.onDrag=function(T,z){return T.canDragMove?this.dragMove(T,z):this.drawConfig.boxSelect&&T.canBoxSelect?this.whileBoxSelect(T,z):void 0},Si.whileBoxSelect=function(T,z){T.boxSelecting=!0,this.updateUIClasses({mouse:j}),T.boxSelectElement||(T.boxSelectElement=document.createElement("div"),T.boxSelectElement.classList.add(C),this.map.getContainer().appendChild(T.boxSelectElement));var q=te(z.originalEvent,this.map.getContainer()),ve=Math.min(T.boxSelectStartLocation.x,q.x),ze=Math.max(T.boxSelectStartLocation.x,q.x),Te=Math.min(T.boxSelectStartLocation.y,q.y),ke=Math.max(T.boxSelectStartLocation.y,q.y),Ct="translate("+ve+"px, "+Te+"px)";T.boxSelectElement.style.transform=Ct,T.boxSelectElement.style.WebkitTransform=Ct,T.boxSelectElement.style.width=ze-ve+"px",T.boxSelectElement.style.height=ke-Te+"px"},Si.dragMove=function(T,z){T.dragMoving=!0,z.originalEvent.stopPropagation();var q={lng:z.lngLat.lng-T.dragMoveLocation.lng,lat:z.lngLat.lat-T.dragMoveLocation.lat};Bi(this.getSelected(),q),T.dragMoveLocation=z.lngLat},Si.onMouseUp=function(T,z){var q=this;if(T.dragMoving)this.fireUpdate();else if(T.boxSelecting){var ve=[T.boxSelectStartLocation,te(z.originalEvent,this.map.getContainer())],ze=this.featuresAt(null,ve,"click"),Te=this.getUniqueIds(ze).filter(function(ke){return!q.isSelected(ke)});Te.length&&(this.select(Te),Te.forEach(function(ke){return q.doRender(ke)}),this.updateUIClasses({mouse:Y}))}this.stopExtendedInteractions(T)},Si.toDisplayFeatures=function(T,z,q){z.properties.active=this.isSelected(z.properties.id)?Le:Ke,q(z),this.fireActionable(),z.properties.active===Le&&z.geometry.type!==st&&Se(z).forEach(q)},Si.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Si.onCombineFeatures=function(){var T=this.getSelected();if(!(T.length===0||T.length<2)){for(var z=[],q=[],ve=T[0].type.replace("Multi",""),ze=0;ze<T.length;ze++){var Te=T[ze];if(Te.type.replace("Multi","")!==ve)return;Te.type.includes("Multi")?Te.getCoordinates().forEach(function(Ct){z.push(Ct)}):z.push(Te.getCoordinates()),q.push(Te.toGeoJSON())}if(q.length>1){var ke=this.newFeature({type:lt,properties:q[0].properties,geometry:{type:"Multi"+ve,coordinates:z}});this.addFeature(ke),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ke.id]),this.map.fire(Ae,{createdFeatures:[ke.toGeoJSON()],deletedFeatures:q})}this.fireActionable()}},Si.onUncombineFeatures=function(){var T=this,z=this.getSelected();if(z.length!==0){for(var q=[],ve=[],ze=function(ke){var Ct=z[ke];T.isInstanceOf("MultiFeature",Ct)&&(Ct.getFeatures().forEach(function(bt){T.addFeature(bt),bt.properties=Ct.properties,q.push(bt.toGeoJSON()),T.select([bt.id])}),T.deleteFeature(Ct.id,{silent:!0}),ve.push(Ct.toGeoJSON()))},Te=0;Te<z.length;Te++)ze(Te);q.length>1&&this.map.fire(be,{createdFeatures:q,deletedFeatures:ve}),this.fireActionable()}};var Mr=ls(we),cr=ls(Re),gr={fireUpdate:function(){this.map.fire(je,{action:Ze,features:this.getSelected().map(function(T){return T.toGeoJSON()})})},fireActionable:function(T){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:T.selectedCoordPaths.length>0})},startDragging:function(T,z){this.map.dragPan.disable(),T.canDragMove=!0,T.dragMoveLocation=z.lngLat},stopDragging:function(T){this.map.dragPan.enable(),T.dragMoving=!1,T.canDragMove=!1,T.dragMoveLocation=null},onVertex:function(T,z){this.startDragging(T,z);var q=z.featureTarget.properties,ve=T.selectedCoordPaths.indexOf(q.coord_path);qn(z)||ve!==-1?qn(z)&&ve===-1&&T.selectedCoordPaths.push(q.coord_path):T.selectedCoordPaths=[q.coord_path];var ze=this.pathsToCoordinates(T.featureId,T.selectedCoordPaths);this.setSelectedCoordinates(ze)},onMidpoint:function(T,z){this.startDragging(T,z);var q=z.featureTarget.properties;T.feature.addCoordinate(q.coord_path,q.lng,q.lat),this.fireUpdate(),T.selectedCoordPaths=[q.coord_path]},pathsToCoordinates:function(T,z){return z.map(function(q){return{feature_id:T,coord_path:q}})},onFeature:function(T,z){T.selectedCoordPaths.length===0?this.startDragging(T,z):this.stopDragging(T)},dragFeature:function(T,z,q){Bi(this.getSelected(),q),T.dragMoveLocation=z.lngLat},dragVertex:function(T,z,q){for(var ve=T.selectedCoordPaths.map(function(Ct){return T.feature.getCoordinate(Ct)}),ze=Ti(ve.map(function(Ct){return{type:lt,properties:{},geometry:{type:st,coordinates:Ct}}}),q),Te=0;Te<ve.length;Te++){var ke=ve[Te];T.feature.updateCoordinate(T.selectedCoordPaths[Te],ke[0]+ze.lng,ke[1]+ze.lat)}},clickNoTarget:function(){this.changeMode(se.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(se.SIMPLE_SELECT)},clickActiveFeature:function(T){T.selectedCoordPaths=[],this.clearSelectedCoordinates(),T.feature.changed()},onSetup:function(T){var z=T.featureId,q=this.getFeature(z);if(!q)throw new Error("You must provide a featureId to enter direct_select mode");if(q.type===st)throw new TypeError("direct_select mode doesn't handle point features");var ve={featureId:z,feature:q,dragMoveLocation:T.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:T.coordPath?[T.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(z,ve.selectedCoordPaths)),this.setSelected(z),pe(this),this.setActionableState({trash:!0}),ve},onStop:function(){_e(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(T,z,q){T.featureId===z.properties.id?(z.properties.active=Le,q(z),Se(z,{map:this.map,midpoints:!0,selectedPaths:T.selectedCoordPaths}).forEach(q)):(z.properties.active=Ke,q(z)),this.fireActionable(T)},onTrash:function(T){T.selectedCoordPaths.sort(function(z,q){return q.localeCompare(z,"en",{numeric:!0})}).forEach(function(z){return T.feature.removeCoordinate(z)}),this.fireUpdate(),T.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(T),T.feature.isValid()===!1&&(this.deleteFeature([T.featureId]),this.changeMode(se.SIMPLE_SELECT,{}))},onMouseMove:function(T,z){var q=Zr(z),ve=Mr(z),ze=T.selectedCoordPaths.length===0;return q&&ze||ve&&!ze?this.updateUIClasses({mouse:Y}):this.updateUIClasses({mouse:De}),this.stopDragging(T),!0},onMouseOut:function(T){return T.dragMoving&&this.fireUpdate(),!0}};gr.onTouchStart=gr.onMouseDown=function(T,z){return Mr(z)?this.onVertex(T,z):Zr(z)?this.onFeature(T,z):cr(z)?this.onMidpoint(T,z):void 0},gr.onDrag=function(T,z){if(T.canDragMove===!0){T.dragMoving=!0,z.originalEvent.stopPropagation();var q={lng:z.lngLat.lng-T.dragMoveLocation.lng,lat:z.lngLat.lat-T.dragMoveLocation.lat};T.selectedCoordPaths.length>0?this.dragVertex(T,z,q):this.dragFeature(T,z,q),T.dragMoveLocation=z.lngLat}},gr.onClick=function(T,z){return Wn(z)?this.clickNoTarget(T,z):Zr(z)?this.clickActiveFeature(T,z):cs(z)?this.clickInactive(T,z):void this.stopDragging(T)},gr.onTap=function(T,z){return Wn(z)?this.clickNoTarget(T,z):Zr(z)?this.clickActiveFeature(T,z):cs(z)?this.clickInactive(T,z):void 0},gr.onTouchEnd=gr.onMouseUp=function(T){T.dragMoving&&this.fireUpdate(),this.stopDragging(T)};var Kr={};function xs(T,z){return!!T.lngLat&&T.lngLat.lng===z[0]&&T.lngLat.lat===z[1]}Kr.onSetup=function(){var T=this.newFeature({type:lt,properties:{},geometry:{type:st,coordinates:[]}});return this.addFeature(T),this.clearSelectedFeatures(),this.updateUIClasses({mouse:j}),this.activateUIButton(qe.POINT),this.setActionableState({trash:!0}),{point:T}},Kr.stopDrawingAndRemove=function(T){this.deleteFeature([T.point.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT)},Kr.onTap=Kr.onClick=function(T,z){this.updateUIClasses({mouse:Y}),T.point.updateCoordinate("",z.lngLat.lng,z.lngLat.lat),this.map.fire(ue,{features:[T.point.toGeoJSON()]}),this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.point.id]})},Kr.onStop=function(T){this.activateUIButton(),T.point.getCoordinate().length||this.deleteFeature([T.point.id],{silent:!0})},Kr.toDisplayFeatures=function(T,z,q){var ve=z.properties.id===T.point.id;if(z.properties.active=ve?Le:Ke,!ve)return q(z)},Kr.onTrash=Kr.stopDrawingAndRemove,Kr.onKeyUp=function(T,z){if(ie(z)||B(z))return this.stopDrawingAndRemove(T,z)};var Vi={onSetup:function(){var T=this.newFeature({type:lt,properties:{},geometry:{type:_t,coordinates:[[]]}});return this.addFeature(T),this.clearSelectedFeatures(),pe(this),this.updateUIClasses({mouse:j}),this.activateUIButton(qe.POLYGON),this.setActionableState({trash:!0}),{polygon:T,currentVertexPosition:0}},clickAnywhere:function(T,z){if(T.currentVertexPosition>0&&xs(z,T.polygon.coordinates[0][T.currentVertexPosition-1]))return this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.polygon.id]});this.updateUIClasses({mouse:j}),T.polygon.updateCoordinate("0."+T.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),T.currentVertexPosition++,T.polygon.updateCoordinate("0."+T.currentVertexPosition,z.lngLat.lng,z.lngLat.lat)},clickOnVertex:function(T){return this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.polygon.id]})},onMouseMove:function(T,z){T.polygon.updateCoordinate("0."+T.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),$n(z)&&this.updateUIClasses({mouse:ge})}};Vi.onTap=Vi.onClick=function(T,z){return $n(z)?this.clickOnVertex(T,z):this.clickAnywhere(T,z)},Vi.onKeyUp=function(T,z){ie(z)?(this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT)):B(z)&&this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.polygon.id]})},Vi.onStop=function(T){this.updateUIClasses({mouse:De}),_e(this),this.activateUIButton(),this.getFeature(T.polygon.id)!==void 0&&(T.polygon.removeCoordinate("0."+T.currentVertexPosition),T.polygon.isValid()?this.map.fire(ue,{features:[T.polygon.toGeoJSON()]}):(this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT,{},{silent:!0})))},Vi.toDisplayFeatures=function(T,z,q){var ve=z.properties.id===T.polygon.id;if(z.properties.active=ve?Le:Ke,!ve)return q(z);if(z.geometry.coordinates.length!==0){var ze=z.geometry.coordinates[0].length;if(!(ze<3)){if(z.properties.meta=nt,q(fe(T.polygon.id,z.geometry.coordinates[0][0],"0.0",!1)),ze>3){var Te=z.geometry.coordinates[0].length-3;q(fe(T.polygon.id,z.geometry.coordinates[0][Te],"0."+Te,!1))}if(ze<=4){var ke=[[z.geometry.coordinates[0][0][0],z.geometry.coordinates[0][0][1]],[z.geometry.coordinates[0][1][0],z.geometry.coordinates[0][1][1]]];if(q({type:lt,properties:z.properties,geometry:{coordinates:ke,type:xt}}),ze===3)return}return q(z)}}},Vi.onTrash=function(T){this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT)};var Yn={onSetup:function(T){var z,q,ve=(T=T||{}).featureId,ze="forward";if(ve){if(!(z=this.getFeature(ve)))throw new Error("Could not find a feature with the provided featureId");var Te=T.from;if(Te&&Te.type==="Feature"&&Te.geometry&&Te.geometry.type==="Point"&&(Te=Te.geometry),Te&&Te.type==="Point"&&Te.coordinates&&Te.coordinates.length===2&&(Te=Te.coordinates),!Te||!Array.isArray(Te))throw new Error("Please use the `from` property to indicate which point to continue the line from");var ke=z.coordinates.length-1;if(z.coordinates[ke][0]===Te[0]&&z.coordinates[ke][1]===Te[1])q=ke+1,z.addCoordinate.apply(z,[q].concat(z.coordinates[ke]));else{if(z.coordinates[0][0]!==Te[0]||z.coordinates[0][1]!==Te[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ze="backwards",q=0,z.addCoordinate.apply(z,[q].concat(z.coordinates[0]))}}else z=this.newFeature({type:lt,properties:{},geometry:{type:xt,coordinates:[]}}),q=0,this.addFeature(z);return this.clearSelectedFeatures(),pe(this),this.updateUIClasses({mouse:j}),this.activateUIButton(qe.LINE),this.setActionableState({trash:!0}),{line:z,currentVertexPosition:q,direction:ze}},clickAnywhere:function(T,z){if(T.currentVertexPosition>0&&xs(z,T.line.coordinates[T.currentVertexPosition-1])||T.direction==="backwards"&&xs(z,T.line.coordinates[T.currentVertexPosition+1]))return this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.line.id]});this.updateUIClasses({mouse:j}),T.line.updateCoordinate(T.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),T.direction==="forward"?(T.currentVertexPosition++,T.line.updateCoordinate(T.currentVertexPosition,z.lngLat.lng,z.lngLat.lat)):T.line.addCoordinate(0,z.lngLat.lng,z.lngLat.lat)},clickOnVertex:function(T){return this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.line.id]})},onMouseMove:function(T,z){T.line.updateCoordinate(T.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),$n(z)&&this.updateUIClasses({mouse:ge})}};Yn.onTap=Yn.onClick=function(T,z){if($n(z))return this.clickOnVertex(T,z);this.clickAnywhere(T,z)},Yn.onKeyUp=function(T,z){B(z)?this.changeMode(se.SIMPLE_SELECT,{featureIds:[T.line.id]}):ie(z)&&(this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT))},Yn.onStop=function(T){_e(this),this.activateUIButton(),this.getFeature(T.line.id)!==void 0&&(T.line.removeCoordinate(""+T.currentVertexPosition),T.line.isValid()?this.map.fire(ue,{features:[T.line.toGeoJSON()]}):(this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT,{},{silent:!0})))},Yn.onTrash=function(T){this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(se.SIMPLE_SELECT)},Yn.toDisplayFeatures=function(T,z,q){var ve=z.properties.id===T.line.id;if(z.properties.active=ve?Le:Ke,!ve)return q(z);z.geometry.coordinates.length<2||(z.properties.meta=nt,q(fe(T.line.id,z.geometry.coordinates[T.direction==="forward"?z.geometry.coordinates.length-2:1],""+(T.direction==="forward"?z.geometry.coordinates.length-2:1),!1)),q(z))};var mo={simple_select:Si,direct_select:gr,draw_point:Kr,draw_polygon:Vi,draw_line_string:Yn},ca={defaultMode:se.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:mo,controls:{},userProperties:!1},ha={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Fo={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ua(T,z){return T.map(function(q){return q.source?q:Vr(q,{id:q.id+"."+z,source:z==="hot"?A:O})})}var go=Ge(function(T,z){var q="[object Arguments]",ve="[object Map]",ze="[object Object]",Te="[object Set]",ke=/^\[object .+?Constructor\]$/,Ct=/^(?:0|[1-9]\d*)$/,bt={};bt["[object Float32Array]"]=bt["[object Float64Array]"]=bt["[object Int8Array]"]=bt["[object Int16Array]"]=bt["[object Int32Array]"]=bt["[object Uint8Array]"]=bt["[object Uint8ClampedArray]"]=bt["[object Uint16Array]"]=bt["[object Uint32Array]"]=!0,bt[q]=bt["[object Array]"]=bt["[object ArrayBuffer]"]=bt["[object Boolean]"]=bt["[object DataView]"]=bt["[object Date]"]=bt["[object Error]"]=bt["[object Function]"]=bt[ve]=bt["[object Number]"]=bt[ze]=bt["[object RegExp]"]=bt[Te]=bt["[object String]"]=bt["[object WeakMap]"]=!1;var Tt=typeof Ia=="object"&&Ia&&Ia.Object===Object&&Ia,Ve=typeof self=="object"&&self&&self.Object===Object&&self,Dt=Tt||Ve||Function("return this")(),qt=z&&!z.nodeType&&z,li=qt&&T&&!T.nodeType&&T,_i=li&&li.exports===qt,Sr=_i&&Tt.process,mt=function(){try{return Sr&&Sr.binding&&Sr.binding("util")}catch{}}(),ti=mt&&mt.isTypedArray;function qi(Ie,et){for(var Ft=-1,fi=Ie==null?0:Ie.length;++Ft<fi;)if(et(Ie[Ft],Ft,Ie))return!0;return!1}function $i(Ie){var et=-1,Ft=Array(Ie.size);return Ie.forEach(function(fi,tr){Ft[++et]=[tr,fi]}),Ft}function hr(Ie){var et=-1,Ft=Array(Ie.size);return Ie.forEach(function(fi){Ft[++et]=fi}),Ft}var ci,Ai,Hn,Wi=Array.prototype,Jr=Function.prototype,Or=Object.prototype,_o=Dt["__core-js_shared__"],rn=Jr.toString,xn=Or.hasOwnProperty,Hs=(ci=/[^.]+$/.exec(_o&&_o.keys&&_o.keys.IE_PROTO||""))?"Symbol(src)_1."+ci:"",Zs=Or.toString,Uo=RegExp("^"+rn.call(xn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yo=_i?Dt.Buffer:void 0,bs=Dt.Symbol,vo=Dt.Uint8Array,xo=Or.propertyIsEnumerable,bo=Wi.splice,hs=bs?bs.toStringTag:void 0,jo=Object.getOwnPropertySymbols,ks=yo?yo.isBuffer:void 0,Oa=(Ai=Object.keys,Hn=Object,function(Ie){return Ai(Hn(Ie))}),Vo=Kn(Dt,"DataView"),Ks=Kn(Dt,"Map"),No=Kn(Dt,"Promise"),Go=Kn(Dt,"Set"),Xo=Kn(Dt,"WeakMap"),ws=Kn(Object,"create"),wo=Jn(Vo),Wo=Jn(Ks),$o=Jn(No),Ds=Jn(Go),pa=Jn(Xo),qo=bs?bs.prototype:void 0,Os=qo?qo.valueOf:void 0;function fn(Ie){var et=-1,Ft=Ie==null?0:Ie.length;for(this.clear();++et<Ft;){var fi=Ie[et];this.set(fi[0],fi[1])}}function zn(Ie){var et=-1,Ft=Ie==null?0:Ie.length;for(this.clear();++et<Ft;){var fi=Ie[et];this.set(fi[0],fi[1])}}function bn(Ie){var et=-1,Ft=Ie==null?0:Ie.length;for(this.clear();++et<Ft;){var fi=Ie[et];this.set(fi[0],fi[1])}}function er(Ie){var et=-1,Ft=Ie==null?0:Ie.length;for(this.__data__=new bn;++et<Ft;)this.add(Ie[et])}function Zn(Ie){var et=this.__data__=new zn(Ie);this.size=et.size}function Mi(Ie,et){var Ft=Ss(Ie),fi=!Ft&&Co(Ie),tr=!Ft&&!fi&&pn(Ie),zi=!Ft&&!fi&&!tr&&Fs(Ie),ur=Ft||fi||tr||zi,pr=ur?function(Pr,nn){for(var Fn=-1,Gr=Array(Pr);++Fn<Pr;)Gr[Fn]=nn(Fn);return Gr}(Ie.length,String):[],Nr=pr.length;for(var _r in Ie)!et&&!xn.call(Ie,_r)||ur&&(_r=="length"||tr&&(_r=="offset"||_r=="parent")||zi&&(_r=="buffer"||_r=="byteLength"||_r=="byteOffset")||Qs(_r,Nr))||pr.push(_r);return pr}function Ui(Ie,et){for(var Ft=Ie.length;Ft--;)if(Ho(Ie[Ft][0],et))return Ft;return-1}function Yi(Ie){return Ie==null?Ie===void 0?"[object Undefined]":"[object Null]":hs&&hs in Object(Ie)?function(et){var Ft=xn.call(et,hs),fi=et[hs];try{et[hs]=void 0;var tr=!0}catch{}var zi=Zs.call(et);return tr&&(Ft?et[hs]=fi:delete et[hs]),zi}(Ie):function(et){return Zs.call(et)}(Ie)}function ar(Ie){return In(Ie)&&Yi(Ie)==q}function Ls(Ie,et,Ft,fi,tr){return Ie===et||(Ie==null||et==null||!In(Ie)&&!In(et)?Ie!=Ie&&et!=et:function(zi,ur,pr,Nr,_r,Pr){var nn=Ss(zi),Fn=Ss(ur),Gr=nn?"[object Array]":wn(zi),Rn=Fn?"[object Array]":wn(ur),An=(Gr=Gr==q?ze:Gr)==ze,eo=(Rn=Rn==q?ze:Rn)==ze,Bn=Gr==Rn;if(Bn&&pn(zi)){if(!pn(ur))return!1;nn=!0,An=!1}if(Bn&&!An)return Pr||(Pr=new Zn),nn||Fs(zi)?ma(zi,ur,pr,Nr,_r,Pr):function(sr,ji,io,Xr,Cs,on,es){switch(io){case"[object DataView]":if(sr.byteLength!=ji.byteLength||sr.byteOffset!=ji.byteOffset)return!1;sr=sr.buffer,ji=ji.buffer;case"[object ArrayBuffer]":return!(sr.byteLength!=ji.byteLength||!on(new vo(sr),new vo(ji)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ho(+sr,+ji);case"[object Error]":return sr.name==ji.name&&sr.message==ji.message;case"[object RegExp]":case"[object String]":return sr==ji+"";case ve:var us=$i;case Te:var ds=1&Xr;if(us||(us=hr),sr.size!=ji.size&&!ds)return!1;var fs=es.get(sr);if(fs)return fs==ji;Xr|=2,es.set(sr,ji);var an=ma(us(sr),us(ji),Xr,Cs,on,es);return es.delete(sr),an;case"[object Symbol]":if(Os)return Os.call(sr)==Os.call(ji)}return!1}(zi,ur,Gr,pr,Nr,_r,Pr);if(!(1&pr)){var Qn=An&&xn.call(zi,"__wrapped__"),sn=eo&&xn.call(ur,"__wrapped__");if(Qn||sn){var to=Qn?zi.value():zi,mn=sn?ur.value():ur;return Pr||(Pr=new Zn),_r(to,mn,pr,Nr,Pr)}}return Bn?(Pr||(Pr=new Zn),function(sr,ji,io,Xr,Cs,on){var es=1&io,us=Yo(sr),ds=us.length,fs=Yo(ji).length;if(ds!=fs&&!es)return!1;for(var an=ds;an--;){var Ut=us[an];if(!(es?Ut in ji:xn.call(ji,Ut)))return!1}var Jo=on.get(sr);if(Jo&&on.get(ji))return Jo==ji;var Un=!0;on.set(sr,ji),on.set(ji,sr);for(var jn=es;++an<ds;){Ut=us[an];var Bs=sr[Ut],Ot=ji[Ut];if(Xr)var ro=es?Xr(Ot,Bs,Ut,ji,sr,on):Xr(Bs,Ot,Ut,sr,ji,on);if(!(ro===void 0?Bs===Ot||Cs(Bs,Ot,io,Xr,on):ro)){Un=!1;break}jn||(jn=Ut=="constructor")}if(Un&&!jn){var Eo=sr.constructor,Us=ji.constructor;Eo==Us||!("constructor"in sr)||!("constructor"in ji)||typeof Eo=="function"&&Eo instanceof Eo&&typeof Us=="function"&&Us instanceof Us||(Un=!1)}return on.delete(sr),on.delete(ji),Un}(zi,ur,pr,Nr,_r,Pr)):!1}(Ie,et,Ft,fi,Ls,tr))}function zs(Ie){return!(!Ko(Ie)||function(et){return!!Hs&&Hs in et}(Ie))&&(Zo(Ie)?Uo:ke).test(Jn(Ie))}function La(Ie){if(Ft=(et=Ie)&&et.constructor,fi=typeof Ft=="function"&&Ft.prototype||Or,et!==fi)return Oa(Ie);var et,Ft,fi,tr=[];for(var zi in Object(Ie))xn.call(Ie,zi)&&zi!="constructor"&&tr.push(zi);return tr}function ma(Ie,et,Ft,fi,tr,zi){var ur=1&Ft,pr=Ie.length,Nr=et.length;if(pr!=Nr&&!(ur&&Nr>pr))return!1;var _r=zi.get(Ie);if(_r&&zi.get(et))return _r==et;var Pr=-1,nn=!0,Fn=2&Ft?new er:void 0;for(zi.set(Ie,et),zi.set(et,Ie);++Pr<pr;){var Gr=Ie[Pr],Rn=et[Pr];if(fi)var An=ur?fi(Rn,Gr,Pr,et,Ie,zi):fi(Gr,Rn,Pr,Ie,et,zi);if(An!==void 0){if(An)continue;nn=!1;break}if(Fn){if(!qi(et,function(eo,Bn){if(Qn=Bn,!Fn.has(Qn)&&(Gr===eo||tr(Gr,eo,Ft,fi,zi)))return Fn.push(Bn);var Qn})){nn=!1;break}}else if(Gr!==Rn&&!tr(Gr,Rn,Ft,fi,zi)){nn=!1;break}}return zi.delete(Ie),zi.delete(et),nn}function Yo(Ie){return function(et,Ft,fi){var tr=Ft(et);return Ss(et)?tr:function(zi,ur){for(var pr=-1,Nr=ur.length,_r=zi.length;++pr<Nr;)zi[_r+pr]=ur[pr];return zi}(tr,fi(et))}(Ie,Rs,Js)}function So(Ie,et){var Ft,fi,tr=Ie.__data__;return((fi=typeof(Ft=et))=="string"||fi=="number"||fi=="symbol"||fi=="boolean"?Ft!=="__proto__":Ft===null)?tr[typeof et=="string"?"string":"hash"]:tr.map}function Kn(Ie,et){var Ft=function(fi,tr){return fi==null?void 0:fi[tr]}(Ie,et);return zs(Ft)?Ft:void 0}fn.prototype.clear=function(){this.__data__=ws?ws(null):{},this.size=0},fn.prototype.delete=function(Ie){var et=this.has(Ie)&&delete this.__data__[Ie];return this.size-=et?1:0,et},fn.prototype.get=function(Ie){var et=this.__data__;if(ws){var Ft=et[Ie];return Ft==="__lodash_hash_undefined__"?void 0:Ft}return xn.call(et,Ie)?et[Ie]:void 0},fn.prototype.has=function(Ie){var et=this.__data__;return ws?et[Ie]!==void 0:xn.call(et,Ie)},fn.prototype.set=function(Ie,et){var Ft=this.__data__;return this.size+=this.has(Ie)?0:1,Ft[Ie]=ws&&et===void 0?"__lodash_hash_undefined__":et,this},zn.prototype.clear=function(){this.__data__=[],this.size=0},zn.prototype.delete=function(Ie){var et=this.__data__,Ft=Ui(et,Ie);return!(Ft<0)&&(Ft==et.length-1?et.pop():bo.call(et,Ft,1),--this.size,!0)},zn.prototype.get=function(Ie){var et=this.__data__,Ft=Ui(et,Ie);return Ft<0?void 0:et[Ft][1]},zn.prototype.has=function(Ie){return Ui(this.__data__,Ie)>-1},zn.prototype.set=function(Ie,et){var Ft=this.__data__,fi=Ui(Ft,Ie);return fi<0?(++this.size,Ft.push([Ie,et])):Ft[fi][1]=et,this},bn.prototype.clear=function(){this.size=0,this.__data__={hash:new fn,map:new(Ks||zn),string:new fn}},bn.prototype.delete=function(Ie){var et=So(this,Ie).delete(Ie);return this.size-=et?1:0,et},bn.prototype.get=function(Ie){return So(this,Ie).get(Ie)},bn.prototype.has=function(Ie){return So(this,Ie).has(Ie)},bn.prototype.set=function(Ie,et){var Ft=So(this,Ie),fi=Ft.size;return Ft.set(Ie,et),this.size+=Ft.size==fi?0:1,this},er.prototype.add=er.prototype.push=function(Ie){return this.__data__.set(Ie,"__lodash_hash_undefined__"),this},er.prototype.has=function(Ie){return this.__data__.has(Ie)},Zn.prototype.clear=function(){this.__data__=new zn,this.size=0},Zn.prototype.delete=function(Ie){var et=this.__data__,Ft=et.delete(Ie);return this.size=et.size,Ft},Zn.prototype.get=function(Ie){return this.__data__.get(Ie)},Zn.prototype.has=function(Ie){return this.__data__.has(Ie)},Zn.prototype.set=function(Ie,et){var Ft=this.__data__;if(Ft instanceof zn){var fi=Ft.__data__;if(!Ks||fi.length<199)return fi.push([Ie,et]),this.size=++Ft.size,this;Ft=this.__data__=new bn(fi)}return Ft.set(Ie,et),this.size=Ft.size,this};var Js=jo?function(Ie){return Ie==null?[]:(Ie=Object(Ie),function(et,Ft){for(var fi=-1,tr=et==null?0:et.length,zi=0,ur=[];++fi<tr;){var pr=et[fi];Ft(pr,fi,et)&&(ur[zi++]=pr)}return ur}(jo(Ie),function(et){return xo.call(Ie,et)}))}:function(){return[]},wn=Yi;function Qs(Ie,et){return!!(et=et==null?9007199254740991:et)&&(typeof Ie=="number"||Ct.test(Ie))&&Ie>-1&&Ie%1==0&&Ie<et}function Jn(Ie){if(Ie!=null){try{return rn.call(Ie)}catch{}try{return Ie+""}catch{}}return""}function Ho(Ie,et){return Ie===et||Ie!=Ie&&et!=et}(Vo&&wn(new Vo(new ArrayBuffer(1)))!="[object DataView]"||Ks&&wn(new Ks)!=ve||No&&wn(No.resolve())!="[object Promise]"||Go&&wn(new Go)!=Te||Xo&&wn(new Xo)!="[object WeakMap]")&&(wn=function(Ie){var et=Yi(Ie),Ft=et==ze?Ie.constructor:void 0,fi=Ft?Jn(Ft):"";if(fi)switch(fi){case wo:return"[object DataView]";case Wo:return ve;case $o:return"[object Promise]";case Ds:return Te;case pa:return"[object WeakMap]"}return et});var Co=ar(function(){return arguments}())?ar:function(Ie){return In(Ie)&&xn.call(Ie,"callee")&&!xo.call(Ie,"callee")},Ss=Array.isArray,pn=ks||function(){return!1};function Zo(Ie){if(!Ko(Ie))return!1;var et=Yi(Ie);return et=="[object Function]"||et=="[object GeneratorFunction]"||et=="[object AsyncFunction]"||et=="[object Proxy]"}function To(Ie){return typeof Ie=="number"&&Ie>-1&&Ie%1==0&&Ie<=9007199254740991}function Ko(Ie){var et=typeof Ie;return Ie!=null&&(et=="object"||et=="function")}function In(Ie){return Ie!=null&&typeof Ie=="object"}var Fs=ti?function(Ie){return function(et){return Ie(et)}}(ti):function(Ie){return In(Ie)&&To(Ie.length)&&!!bt[Yi(Ie)]};function Rs(Ie){return(et=Ie)!=null&&To(et.length)&&!Zo(et)?Mi(Ie):La(Ie);var et}T.exports=function(Ie,et){return Ls(Ie,et)}}),Ro={Polygon:Ei,LineString:si,Point:Ji,MultiPolygon:Qi,MultiLineString:Qi,MultiPoint:Qi};function da(T,z){return z.modes=se,z.getFeatureIdsAt=function(q){return Je.click({point:q},null,T).map(function(ve){return ve.properties.id})},z.getSelectedIds=function(){return T.store.getSelectedIds()},z.getSelected=function(){return{type:yt,features:T.store.getSelectedIds().map(function(q){return T.store.get(q)}).map(function(q){return q.toGeoJSON()})}},z.getSelectedPoints=function(){return{type:yt,features:T.store.getSelectedCoordinates().map(function(q){return{type:lt,properties:{},geometry:{type:st,coordinates:q.coordinates}}})}},z.set=function(q){if(q.type===void 0||q.type!==yt||!Array.isArray(q.features))throw new Error("Invalid FeatureCollection");var ve=T.store.createRenderBatch(),ze=T.store.getAllIds().slice(),Te=z.add(q),ke=new Ht(Te);return(ze=ze.filter(function(Ct){return!ke.has(Ct)})).length&&z.delete(ze),ve(),Te},z.add=function(q){var ve=JSON.parse(JSON.stringify(Ce(q))).features.map(function(ze){if(ze.id=ze.id||vt(),ze.geometry===null)throw new Error("Invalid geometry: null");if(T.store.get(ze.id)===void 0||T.store.get(ze.id).type!==ze.geometry.type){var Te=Ro[ze.geometry.type];if(Te===void 0)throw new Error("Invalid geometry type: "+ze.geometry.type+".");var ke=new Te(T,ze);T.store.add(ke)}else{var Ct=T.store.get(ze.id);Ct.properties=ze.properties,go(Ct.getCoordinates(),ze.geometry.coordinates)||Ct.incomingCoords(ze.geometry.coordinates)}return ze.id});return T.store.render(),ve},z.get=function(q){var ve=T.store.get(q);if(ve)return ve.toGeoJSON()},z.getAll=function(){return{type:yt,features:T.store.getAll().map(function(q){return q.toGeoJSON()})}},z.delete=function(q){return T.store.delete(q,{silent:!0}),z.getMode()!==se.DIRECT_SELECT||T.store.getSelectedIds().length?T.store.render():T.events.changeMode(se.SIMPLE_SELECT,void 0,{silent:!0}),z},z.deleteAll=function(){return T.store.delete(T.store.getAllIds(),{silent:!0}),z.getMode()===se.DIRECT_SELECT?T.events.changeMode(se.SIMPLE_SELECT,void 0,{silent:!0}):T.store.render(),z},z.changeMode=function(q,ve){return ve===void 0&&(ve={}),q===se.SIMPLE_SELECT&&z.getMode()===se.SIMPLE_SELECT?(ze=ve.featureIds||[],Te=T.store.getSelectedIds(),ze.length===Te.length&&JSON.stringify(ze.map(function(ke){return ke}).sort())===JSON.stringify(Te.map(function(ke){return ke}).sort())||(T.store.setSelected(ve.featureIds,{silent:!0}),T.store.render()),z):(q===se.DIRECT_SELECT&&z.getMode()===se.DIRECT_SELECT&&ve.featureId===T.store.getSelectedIds()[0]||T.events.changeMode(q,ve,{silent:!0}),z);var ze,Te},z.getMode=function(){return T.events.getMode()},z.trash=function(){return T.events.trash({silent:!0}),z},z.combineFeatures=function(){return T.events.combineFeatures({silent:!0}),z},z.uncombineFeatures=function(){return T.events.uncombineFeatures({silent:!0}),z},z.setFeatureProperty=function(q,ve,ze){return T.store.setFeatureProperty(q,ve,ze),z},z}var fa=function(T,z){var q={options:T=function(ze){ze===void 0&&(ze={});var Te=Vr(ze);return ze.controls||(Te.controls={}),ze.displayControlsDefault===!1?Te.controls=Vr(Fo,ze.controls):Te.controls=Vr(ha,ze.controls),(Te=Vr(ca,Te)).styles=ua(Te.styles,"cold").concat(ua(Te.styles,"hot")),Te}(T)};z=da(q,z),q.api=z;var ve=Xi(q);return z.onAdd=ve.onAdd,z.onRemove=ve.onRemove,z.types=qe,z.options=T,z};function Bo(T){fa(T,this)}return Bo.modes=mo,Bo})})(Ou);const Nc=Ou.exports;function Hf(Fe,I){return Fe.lngLat?Fe.lngLat.lng===I[0]&&Fe.lngLat.lat===I[1]:!1}const Hc=Nc.modes.draw_polygon;Hc.maxVertices=4;Hc.clickAnywhere=function(Fe,I){if(Fe.currentVertexPosition>0&&Hf(I,Fe.polygon.coordinates[0][Fe.currentVertexPosition-1]))return this.changeMode("simple_select",{featureIds:[Fe.polygon.id]});if(this.updateUIClasses({mouse:"add"}),Fe.polygon.updateCoordinate(`0.${Fe.currentVertexPosition}`,I.lngLat.lng,I.lngLat.lat),Fe.currentVertexPosition++,Fe.polygon.updateCoordinate(`0.${Fe.currentVertexPosition}`,I.lngLat.lng,I.lngLat.lat),Fe.currentVertexPosition>this.maxVertices-1)return this.updateUIClasses({mouse:"none"}),this.changeMode("simple_select",{featuresId:Fe.polygon.id})};const bu=(Fe,I)=>{const pt=Fe._offset.left,tt=Fe._offset.top,wt=I.e.pageX-pt,At=I.e.pageY-tt;return{x:wt,y:At}},Zf=Fe=>Math.abs(Math.min.apply(Math,Fe.map(function(I){return I.y}))),Kf=Fe=>Math.abs(Math.min.apply(Math,Fe.map(function(I){return I.x}))),wu=Fe=>{let I=new fabric.Point(Fe.strokeUniform?1/Fe.scaleX:1,Fe.strokeUniform?1/Fe.scaleY:1).multiply(Fe.strokeWidth);return new fabric.Point(Fe.width+I.x,Fe.height+I.y)};class Jf{generateNumber(I){return I*Math.random()|0}generateX(){return this.generateNumber(16).toString(16)}generateXes(I){let pt="";for(let tt=0;tt<I;++tt)pt+=this.generateX();return pt}generateVariant(){return(this.generateNumber(16)&3|8).toString(16)}generate(){return this.generateXes(8)+"-"+this.generateXes(4)+"-4"+this.generateXes(3)+"-"+this.generateVariant()+this.generateXes(3)+"-"+this.generateXes(12)}}function Su(Fe,I,pt){const tt=Fe.slice();return tt[37]=I[pt][0],tt[38]=I[pt][1],tt}function Cu(Fe){let I,pt=[...Fe[1]],tt=[];for(let wt=0;wt<pt.length;wt+=1)tt[wt]=Tu(Su(Fe,pt,wt));return{c(){for(let wt=0;wt<tt.length;wt+=1)tt[wt].c();I=vu()},l(wt){for(let At=0;At<tt.length;At+=1)tt[At].l(wt);I=vu()},m(wt,At){for(let Mt=0;Mt<tt.length;Mt+=1)tt[Mt].m(wt,At);qs(wt,I,At)},p(wt,At){if(At[0]&2){pt=[...wt[1]];let Mt;for(Mt=0;Mt<pt.length;Mt+=1){const n=Su(wt,pt,Mt);tt[Mt]?tt[Mt].p(n,At):(tt[Mt]=Tu(n),tt[Mt].c(),tt[Mt].m(I.parentNode,I))}for(;Mt<tt.length;Mt+=1)tt[Mt].d(1);tt.length=pt.length}},d(wt){Sf(tt,wt),wt&&Nt(I)}}}function Tu(Fe){let I,pt,tt,wt,At,Mt=Fe[38].id+"",n,g,x,v,h,l,c,f,_,u,S,C,A,O,j,Y,oe,ge,De=Fe[38].properties.road_lane_direction+"",qe,lt,_t,xt,st,yt,it,Rt=Fe[38].properties.road_lane_num+"",Pt,Q,se,ue,de,je,K,W,re,ye,Ae,be,Be,Ze,nt=JSON.stringify(Fe[38].properties.coordinates)+"",Re,we,Le,Ke,$e,ut,ct,Ht=JSON.stringify(Fe[38].geometry.coordinates)+"",Zt,Je;return{c(){I=Wt("li"),pt=Wt("div"),tt=Wt("i"),wt=Tr("place"),At=Tr("Polygon identifier: "),n=Tr(Mt),g=Zi(),x=Wt("div"),v=Wt("table"),h=Wt("thead"),l=Wt("tr"),c=Wt("th"),f=Tr("Attirubute"),_=Zi(),u=Wt("th"),S=Tr("Value"),C=Zi(),A=Wt("tbody"),O=Wt("tr"),j=Wt("td"),Y=Tr("Road lane direction"),oe=Zi(),ge=Wt("td"),qe=Tr(De),lt=Zi(),_t=Wt("tr"),xt=Wt("td"),st=Tr("Road lane number"),yt=Zi(),it=Wt("td"),Pt=Tr(Rt),Q=Zi(),se=Wt("tr"),ue=Wt("td"),de=Tr("Color"),je=Zi(),K=Wt("td"),W=Wt("div"),re=Zi(),ye=Wt("tr"),Ae=Wt("td"),be=Tr("Canvas coordinates"),Be=Zi(),Ze=Wt("td"),Re=Tr(nt),we=Zi(),Le=Wt("tr"),Ke=Wt("td"),$e=Tr("Spatial coordinates"),ut=Zi(),ct=Wt("td"),Zt=Tr(Ht),Je=Zi(),this.h()},l(Gt){I=$t(Gt,"LI",{});var Qt=ii(I);pt=$t(Qt,"DIV",{class:!0});var mi=ii(pt);tt=$t(mi,"I",{class:!0});var Di=ii(tt);wt=Er(Di,"place"),Di.forEach(Nt),At=Er(mi,"Polygon identifier: "),n=Er(mi,Mt),mi.forEach(Nt),g=Ki(Qt),x=$t(Qt,"DIV",{class:!0});var wi=ii(x);v=$t(wi,"TABLE",{class:!0});var Ge=ii(v);h=$t(Ge,"THEAD",{});var vt=ii(h);l=$t(vt,"TR",{});var Ri=ii(l);c=$t(Ri,"TH",{});var Ji=ii(c);f=Er(Ji,"Attirubute"),Ji.forEach(Nt),_=Ki(Ri),u=$t(Ri,"TH",{});var si=ii(u);S=Er(si,"Value"),si.forEach(Nt),Ri.forEach(Nt),vt.forEach(Nt),C=Ki(Ge),A=$t(Ge,"TBODY",{});var Ei=ii(A);O=$t(Ei,"TR",{});var dr=ii(O);j=$t(dr,"TD",{});var fr=ii(j);Y=Er(fr,"Road lane direction"),fr.forEach(Nt),oe=Ki(dr),ge=$t(dr,"TD",{});var Qi=ii(ge);qe=Er(Qi,De),Qi.forEach(Nt),dr.forEach(Nt),lt=Ki(Ei),_t=$t(Ei,"TR",{});var at=ii(_t);xt=$t(at,"TD",{});var bi=ii(xt);st=Er(bi,"Road lane number"),bi.forEach(Nt),yt=Ki(at),it=$t(at,"TD",{});var xi=ii(it);Pt=Er(xi,Rt),xi.forEach(Nt),at.forEach(Nt),Q=Ki(Ei),se=$t(Ei,"TR",{});var br=ii(se);ue=$t(br,"TD",{});var tn=ii(ue);de=Er(tn,"Color"),tn.forEach(Nt),je=Ki(br),K=$t(br,"TD",{});var yi=ii(K);W=$t(yi,"DIV",{style:!0}),ii(W).forEach(Nt),yi.forEach(Nt),br.forEach(Nt),re=Ki(Ei),ye=$t(Ei,"TR",{});var Oi=ii(ye);Ae=$t(Oi,"TD",{});var wr=ii(Ae);be=Er(wr,"Canvas coordinates"),wr.forEach(Nt),Be=Ki(Oi),Ze=$t(Oi,"TD",{});var Vr=ii(Ze);Re=Er(Vr,nt),Vr.forEach(Nt),Oi.forEach(Nt),we=Ki(Ei),Le=$t(Ei,"TR",{});var lr=ii(Le);Ke=$t(lr,"TD",{});var Dr=ii(Ke);$e=Er(Dr,"Spatial coordinates"),Dr.forEach(Nt),ut=Ki(lr),ct=$t(lr,"TD",{});var Xi=ii(ct);Zt=Er(Xi,Ht),Xi.forEach(Nt),lr.forEach(Nt),Ei.forEach(Nt),Ge.forEach(Nt),wi.forEach(Nt),Je=Ki(Qt),Qt.forEach(Nt),this.h()},h(){Yt(tt,"class","material-icons"),Yt(pt,"class","collapsible-header"),ll(W,"background-color",Fe[38].properties.color_rgb_str),ll(W,"width","32px"),ll(W,"height","16px"),ll(W,"border","1px solid #000000"),Yt(v,"class","collapsible-table"),Yt(x,"class","collapsible-body")},m(Gt,Qt){qs(Gt,I,Qt),ht(I,pt),ht(pt,tt),ht(tt,wt),ht(pt,At),ht(pt,n),ht(I,g),ht(I,x),ht(x,v),ht(v,h),ht(h,l),ht(l,c),ht(c,f),ht(l,_),ht(l,u),ht(u,S),ht(v,C),ht(v,A),ht(A,O),ht(O,j),ht(j,Y),ht(O,oe),ht(O,ge),ht(ge,qe),ht(A,lt),ht(A,_t),ht(_t,xt),ht(xt,st),ht(_t,yt),ht(_t,it),ht(it,Pt),ht(A,Q),ht(A,se),ht(se,ue),ht(ue,de),ht(se,je),ht(se,K),ht(K,W),ht(A,re),ht(A,ye),ht(ye,Ae),ht(Ae,be),ht(ye,Be),ht(ye,Ze),ht(Ze,Re),ht(A,we),ht(A,Le),ht(Le,Ke),ht(Ke,$e),ht(Le,ut),ht(Le,ct),ht(ct,Zt),ht(I,Je)},p(Gt,Qt){Qt[0]&2&&Mt!==(Mt=Gt[38].id+"")&&cl(n,Mt),Qt[0]&2&&De!==(De=Gt[38].properties.road_lane_direction+"")&&cl(qe,De),Qt[0]&2&&Rt!==(Rt=Gt[38].properties.road_lane_num+"")&&cl(Pt,Rt),Qt[0]&2&&ll(W,"background-color",Gt[38].properties.color_rgb_str),Qt[0]&2&&nt!==(nt=JSON.stringify(Gt[38].properties.coordinates)+"")&&cl(Re,nt),Qt[0]&2&&Ht!==(Ht=JSON.stringify(Gt[38].geometry.coordinates)+"")&&cl(Zt,Ht)},d(Gt){Gt&&Nt(I)}}}function Qf(Fe){let I,pt,tt,wt,At,Mt,n,g,x,v,h,l,c,f,_,u,S,C,A,O,j,Y,oe,ge,De,qe,lt,_t,xt,st,yt,it,Rt,Pt,Q,se,ue,de,je,K,W,re,ye,Ae,be,Be,Ze;se=new jf({});let nt=Fe[2]===!0&&Cu(Fe),Re={};return re=new Rf({props:Re}),Fe[8](re),Ae=new Yf({}),{c(){I=Wt("sveltekit:head"),pt=Wt("link"),tt=Zi(),wt=Wt("link"),At=Zi(),Mt=Wt("script"),g=Zi(),x=Wt("title"),v=Tr(Eu),h=Zi(),l=Wt("div"),c=Wt("div"),f=Wt("a"),_=Wt("i"),u=Tr("edit"),S=Zi(),C=Wt("ul"),A=Wt("li"),O=Wt("a"),j=Wt("i"),Y=Tr("add"),oe=Zi(),ge=Wt("li"),De=Wt("a"),qe=Wt("i"),lt=Tr("delete"),_t=Zi(),xt=Wt("li"),st=Wt("a"),yt=Wt("i"),it=Tr("save"),Rt=Zi(),Pt=Wt("div"),Q=Wt("div"),hl(se.$$.fragment),ue=Zi(),de=Wt("div"),je=Wt("div"),K=Wt("ul"),nt&&nt.c(),W=Zi(),hl(re.$$.fragment),ye=Zi(),hl(Ae.$$.fragment),this.h()},l(we){I=$t(we,"SVELTEKIT:HEAD",{});var Le=ii(I);pt=$t(Le,"LINK",{rel:!0,href:!0}),tt=Ki(Le),wt=$t(Le,"LINK",{href:!0,rel:!0}),At=Ki(Le),Mt=$t(Le,"SCRIPT",{src:!0});var Ke=ii(Mt);Ke.forEach(Nt),g=Ki(Le),x=$t(Le,"TITLE",{});var $e=ii(x);v=Er($e,Eu),$e.forEach(Nt),Le.forEach(Nt),h=Ki(we),l=$t(we,"DIV",{id:!0});var ut=ii(l);c=$t(ut,"DIV",{class:!0});var ct=ii(c);f=$t(ct,"A",{class:!0});var Ht=ii(f);_=$t(Ht,"I",{class:!0});var Zt=ii(_);u=Er(Zt,"edit"),Zt.forEach(Nt),Ht.forEach(Nt),S=Ki(ct),C=$t(ct,"UL",{});var Je=ii(C);A=$t(Je,"LI",{});var Gt=ii(A);O=$t(Gt,"A",{id:!0,class:!0});var Qt=ii(O);j=$t(Qt,"I",{class:!0});var mi=ii(j);Y=Er(mi,"add"),mi.forEach(Nt),Qt.forEach(Nt),Gt.forEach(Nt),oe=Ki(Je),ge=$t(Je,"LI",{});var Di=ii(ge);De=$t(Di,"A",{id:!0,class:!0});var wi=ii(De);qe=$t(wi,"I",{class:!0});var Ge=ii(qe);lt=Er(Ge,"delete"),Ge.forEach(Nt),wi.forEach(Nt),Di.forEach(Nt),_t=Ki(Je),xt=$t(Je,"LI",{});var vt=ii(xt);st=$t(vt,"A",{id:!0,class:!0});var Ri=ii(st);yt=$t(Ri,"I",{class:!0});var Ji=ii(yt);it=Er(Ji,"save"),Ji.forEach(Nt),Ri.forEach(Nt),vt.forEach(Nt),Je.forEach(Nt),ct.forEach(Nt),Rt=Ki(ut),Pt=$t(ut,"DIV",{id:!0});var si=ii(Pt);Q=$t(si,"DIV",{id:!0});var Ei=ii(Q);ul(se.$$.fragment,Ei),ue=Ki(Ei),de=$t(Ei,"DIV",{id:!0});var dr=ii(de);je=$t(dr,"DIV",{id:!0});var fr=ii(je);K=$t(fr,"UL",{id:!0,class:!0});var Qi=ii(K);nt&&nt.l(Qi),Qi.forEach(Nt),fr.forEach(Nt),dr.forEach(Nt),Ei.forEach(Nt),W=Ki(si),ul(re.$$.fragment,si),ye=Ki(si),ul(Ae.$$.fragment,si),si.forEach(Nt),ut.forEach(Nt),this.h()},h(){Yt(pt,"rel","stylesheet"),Yt(pt,"href","https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"),Yt(wt,"href","https://fonts.googleapis.com/icon?family=Material+Icons"),Yt(wt,"rel","stylesheet"),Uc(Mt.src,n="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js")||Yt(Mt,"src",n),Yt(_,"class","material-icons"),Yt(f,"class","btn-floating btn-large red"),Yt(j,"class","material-icons"),Yt(O,"id","add-btn"),Yt(O,"class","btn-floating green"),Yt(qe,"class","material-icons"),Yt(De,"id","del-btn"),Yt(De,"class","btn-floating blue"),Yt(yt,"class","material-icons"),Yt(st,"id","save-btn"),Yt(st,"class","btn-floating grey"),Yt(c,"class","fixed-action-btn horizontal click-to-toggle spin-close"),Yt(K,"id","collapsible-data"),Yt(K,"class","collapsible"),Yt(je,"id","configuration-content"),Yt(de,"id","configuration"),Yt(Q,"id","grid_component"),Yt(Pt,"id","flex_component"),Yt(l,"id","main-app")},m(we,Le){qs(we,I,Le),ht(I,pt),ht(I,tt),ht(I,wt),ht(I,At),ht(I,Mt),ht(I,g),ht(I,x),ht(x,v),qs(we,h,Le),qs(we,l,Le),ht(l,c),ht(c,f),ht(f,_),ht(_,u),ht(c,S),ht(c,C),ht(C,A),ht(A,O),ht(O,j),ht(j,Y),ht(C,oe),ht(C,ge),ht(ge,De),ht(De,qe),ht(qe,lt),ht(C,_t),ht(C,xt),ht(xt,st),ht(st,yt),ht(yt,it),ht(l,Rt),ht(l,Pt),ht(Pt,Q),dl(se,Q,null),ht(Q,ue),ht(Q,de),ht(de,je),ht(je,K),nt&&nt.m(K,null),ht(Pt,W),dl(re,Pt,null),ht(Pt,ye),dl(Ae,Pt,null),be=!0,Be||(Ze=[Ms(Mt,"load",Fe[4]),Ms(O,"click",Fe[5]),Ms(De,"click",Fe[6]),Ms(st,"click",Fe[7])],Be=!0)},p(we,Le){we[2]===!0?nt?nt.p(we,Le):(nt=Cu(we),nt.c(),nt.m(K,null)):nt&&(nt.d(1),nt=null);const Ke={};re.$set(Ke)},i(we){be||(fl(se.$$.fragment,we),fl(re.$$.fragment,we),fl(Ae.$$.fragment,we),be=!0)},o(we){pl(se.$$.fragment,we),pl(re.$$.fragment,we),pl(Ae.$$.fragment,we),be=!1},d(we){we&&Nt(I),we&&Nt(h),we&&Nt(l),ml(se),nt&&nt.d(),Fe[8](null),ml(re),ml(Ae),Be=!1,Xc(Ze)}}}const Eu="Rust Road Traffic UI";function ep(){const Fe=Math.round(16777215*Math.random()),I=Fe>>16,pt=Fe>>8&255,tt=Fe&255;return"rgb("+I+", "+pt+", "+tt+")"}function tp(Fe,I,pt){let tt,wt,At,Mt,n,g,x;vn(Fe,Du,K=>pt(1,tt=K)),vn(Fe,os,K=>pt(21,wt=K)),vn(Fe,Vc,K=>pt(22,At=K)),vn(Fe,jc,K=>pt(23,Mt=K)),vn(Fe,Aa,K=>pt(24,n=K)),vn(Fe,la,K=>pt(2,g=K));const{apiURL:v}=Zl;vn(Fe,v,K=>pt(25,x=K));let h=x,l,c,f,_,u,S,C=new Array,A=new Array,O=new Array;const j=["A","B","C","D"];let Y,oe,ge;const De=Yc.subscribe(K=>{if(h!==K){console.log(`Need to change API URL for Data: '${x}'`),h=K,Aa.set(!1),la.set(!1),oe(),ge(),tt.clear(),u!==void 0&&u!=null&&u.getObjects().forEach(re=>{u.remove(re),At!==null&&At.delete(re.unid)}),oe=Aa.subscribe(re=>{re===!0&&(u===void 0||u==null)&&lt(),re===!0&&g==!0&&_t()}),ge=la.subscribe(re=>{re===!0&&n==!0&&_t()});const W=`${h}/api/polygons/geojson`;fetch(`${W}`).then(re=>re.json()).then(re=>{re.features.forEach(ye=>{ye.properties.spatial_object_id=ye.id,ye.properties.canvas_object_id=ye.id,ye.properties.color_rgb_str=`rgb(${ye.properties.color_rgb[0]},${ye.properties.color_rgb[1]},${ye.properties.color_rgb[2]})`,tt.set(ye.id,ye)}),Y.drawGeoPolygons(At,tt),la.set(!0)}).catch(re=>{console.log("Error on loading polygons",re)})}});_l(()=>{console.log("Mounted"),oe=Aa.subscribe(W=>{W===!0&&lt(),W===!0&&g==!0&&(console.log("MJPEG is loaded before geo data"),_t())}),ge=la.subscribe(W=>{W===!0&&n==!0&&(console.log("Geo data is loaded before MJPEG"),_t())}),Vc.set(new Nc({userProperties:!0,displayControlsDefault:!1,controls:{polygon:!1,trash:!1},modes:Object.assign({draw_restricted_polygon:Hc},Nc.modes),styles:Lf})),Y.attachDraw(At),Mt.on("draw.create",function(W){W.features[0].properties={color_rgb:[127,127,127],color_rgb_str:gl,coordinates:W.features[0].geometry.coordinates,road_lane_direction:-1,road_lane_num:-1,spatial_object_id:W.features[0].id,canvas_object_id:null},At.add(W.features[0]),os.set(jr.Waiting)});const K=`${h}/api/polygons/geojson`;fetch(`${K}`).then(W=>W.json()).then(W=>{W.features.forEach(re=>{re.properties.spatial_object_id=re.id,re.properties.canvas_object_id=re.id,re.properties.color_rgb_str=`rgb(${re.properties.color_rgb[0]},${re.properties.color_rgb[1]},${re.properties.color_rgb[2]})`,tt.set(re.id,re)}),Mt.on("load",()=>{Y.drawGeoPolygons(At,tt)}),la.set(!0)}).catch(W=>{console.log("Error on loading polygons [initial]",W)})}),Gc(()=>{console.log("Destroyed"),Aa.set(!1),la.set(!1),oe(),ge(),De()});const qe=()=>{const K=document.querySelectorAll(".fixed-action-btn");M.FloatingActionButton.init(K,{direction:"left",hoverEnabled:!1});const W=document.getElementById("collapsible-data");M.Collapsible.init(W,{})},lt=()=>{f=document.getElementById("fit_canvas"),_=document.getElementById("fit_img"),f.width=_.clientWidth,f.height=_.clientHeight,l=_.clientWidth/_.naturalWidth,c=_.clientHeight/_.naturalHeight,u=new dn.fabric.Canvas("fit_canvas",{containerClass:"custom-container-canvas",fireRightClick:!0,fireMiddleClick:!0,stopContextMenu:!0}),S=document.getElementsByClassName("custom-container-canvas")[0],S.id="fbcanvas",u.on("selection:created",K=>{wt===jr.DeletingPolygon&&(yt(u,K.selected[0].unid),os.set(jr.Waiting))}),u.on("selection:updated",K=>{wt===jr.DeletingPolygon&&(yt(u,K.selected[0].unid),os.set(jr.Waiting))}),u.on("mouse:move",K=>{if(C[0]!==null&&C[0]!==void 0&&wt===jr.AddingPolygon){const W=bu(u,K);C[C.length-1].set({x2:W.x,y2:W.y}),u.renderAll()}}),u.on("mouse:down",K=>{if(wt!==jr.AddingPolygon)return;u.selection=!1;const W=bu(u,K);O.push({x:W.x,y:W.y});const re=[W.x,W.y,W.x,W.y],ye=new dn.fabric.Line(re,{strokeWidth:3,selectable:!1,stroke:"purple"}),Ae=new dn.fabric.Text(j[O.length-1],{left:W.x,top:W.y,fontSize:24,fontFamily:"Roboto",fill:"purple",shadow:"0 0 10px rgba(255, 255, 255, 0.7)",stroke:"rgb(0, 0, 0)",strokeWidth:.9});if(A.push(Ae),C.push(ye),u.add(ye),u.add(Ae),u.on("mouse:up",function(Be){u.selection=!0}),O.length<=3)return;C.forEach(Be=>{u.remove(Be)}),A.forEach(Be=>{u.remove(Be)});const be=xt(O);be.inner.on("mousedown",Be=>{if(Be.e.preventDefault(),Be.e.stopPropagation(),Be.button===3){if(wt!==jr.EditingPolygon)yu(os,wt=jr.EditingPolygon,wt);else{yu(os,wt=jr.Waiting,wt);let Ze=tt.get(be.unid);Ze.properties.coordinates=be.inner.current_points.map(nt=>[Math.floor(nt.x/l),Math.floor(nt.y/c)]),tt.set(be.unid,Ze)}st(be.inner,u)}}),be.inner.on("modified",Be=>{var we;const Ze=be.inner.calcTransformMatrix(),nt=(we=be.inner.points)==null?void 0:we.map(function(Le){return new dn.fabric.Point(Le.x-be.inner.pathOffset.x,Le.y-be.inner.pathOffset.y)}).map(function(Le){return dn.fabric.util.transformPoint(Le,Ze)});be.inner.current_points=nt,be.notation.forEach((Le,Ke)=>{const $e=be.inner.current_points[Ke];Le.set({left:$e.x,top:$e.y})});let Re=tt.get(be.unid);Re.properties.coordinates=be.inner.current_points.map(Le=>[Math.floor(Le.x/l),Math.floor(Le.y/c)]),tt.set(be.unid,Re)}),be.unid=new Jf().generate(),be.inner.unid=be.unid,be.notation.forEach((Be,Ze)=>{be.notation[Ze].text_id=be.unid}),tt.set(be.unid,{type:"Feature",id:be.unid,properties:{color_rgb:Q(be.inner.stroke),color_rgb_str:be.inner.stroke,coordinates:be.inner.current_points.map(Be=>[Math.floor(Be.x/l),Math.floor(Be.y/c)]),road_lane_direction:-1,road_lane_num:-1,spatial_object_id:null,canvas_object_id:null},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),u.add(be.inner),be.notation.forEach(Be=>{u.add(Be)}),u.renderAll(),C=[],A=[],O=[],os.set(jr.Waiting),At.changeMode("simple_select")})},_t=()=>{tt.forEach(K=>{const W=K.properties.coordinates.map(ye=>({x:ye[0]*l,y:ye[1]*c}));let re=xt(W,`rgb(${K.properties.color_rgb[0]},${K.properties.color_rgb[1]},${K.properties.color_rgb[2]})`);re.inner.on("mousedown",ye=>{if(ye.e.preventDefault(),ye.e.stopPropagation(),ye.button===3){if(wt!=jr.EditingPolygon)os.set(jr.EditingPolygon);else{os.set(jr.Waiting);let Ae=tt.get(re.unid);Ae.properties.coordinates=re.inner.current_points.map(be=>[Math.floor(be.x/l),Math.floor(be.y/c)]),tt.set(re.unid,Ae)}st(re.inner,u)}}),re.inner.on("modified",ye=>{const Ae=re.inner.calcTransformMatrix(),be=re.inner.points.map(function(Ze){return new dn.fabric.Point(Ze.x-re.inner.pathOffset.x,Ze.y-re.inner.pathOffset.y)}).map(function(Ze){return dn.fabric.util.transformPoint(Ze,Ae)});re.inner.current_points=be,re.notation.forEach((Ze,nt)=>{const Re=re.inner.current_points[nt];Ze.set({left:Re.x,top:Re.y})});let Be=tt.get(re.unid);Be.properties.coordinates=re.inner.current_points.map(Ze=>[Math.floor(Ze.x/l),Math.floor(Ze.y/c)]),tt.set(re.unid,Be)}),re.unid=K.id,re.inner.unid=K.id,re.notation.forEach((ye,Ae)=>{re.notation[Ae].text_id=K.id}),u.add(re.inner),re.notation.forEach(ye=>{u.add(ye)}),u.renderAll()})},xt=(K,W=ep())=>{let re=Kf(K),ye=Zf(K),Ae=new dn.fabric.Polygon(K,{fill:"rgba(0,0,0,0)",stroke:W,strokeWidth:3,objectCaching:!1});Ae.set({left:re,top:ye});const be=new Array;return K.forEach((Be,Ze)=>{const nt=new dn.fabric.Text(j[Ze],{left:Be.x,top:Be.y,fontSize:24,fontFamily:"Roboto",fill:W,shadow:"0 0 10px rgba(255, 255, 255, 0.7)",stroke:"rgb(0, 0, 0)",strokeWidth:.9});be.push(nt)}),Ae.current_points=Ae.points,{inner:Ae,unid:"00000000-0000-0000-0000-000000000000",notation:be}};function st(K,W){var re,ye;if(W.setActiveObject(K),K.edit=!K.edit,K.edit){let Ae=((re=K==null?void 0:K.points)==null?void 0:re.length)-1;K.cornerStyle="circle",K.cornerSize=15,K.cornerColor="rgba(0, 0, 255, 1.0)",K.controls=(ye=K==null?void 0:K.points)==null?void 0:ye.reduce(function(be,Be,Ze){return be["p"+Ze]=new dn.fabric.Control({positionHandler:se,actionHandler:ue(Ze>0?Ze-1:Ae,de),actionName:"modifyPolygon",pointIndex:Ze}),be},{})}else K.cornerColor="rgb(178, 204, 255)",K.cornerStyle="rect",K.controls=dn.fabric.Object.prototype.controls;K.hasBorders=!K.edit,W.requestRenderAll()}const yt=(K,W)=>{K.getObjects().forEach(re=>{if(re.unid===W){K.remove(re);return}}),K.getObjects().forEach(re=>{if(re.text_id===W){K.remove(re);return}}),tt.delete(W),At.delete(W)},it=()=>{wt!==jr.AddingPolygon?(os.set(jr.AddingPolygon),At.changeMode("draw_restricted_polygon")):(os.set(jr.Waiting),At.changeMode("simple_select"))},Rt=()=>{wt!==jr.DeletingPolygon?os.set(jr.DeletingPolygon):os.set(jr.Waiting)},Pt=()=>{const K={data:Array.from(tt.values()).map(re=>({lane_number:re.properties.road_lane_num,lane_direction:re.properties.road_lane_direction,color_rgb:re.properties.color_rgb,pixel_points:re.properties.coordinates,spatial_points:[...re.geometry.coordinates[0].slice(0,-1)]}))};console.log("Replacing data");const W=`${h}/api/mutations/replace_all`;fetch(`${W}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)}).then(re=>re.json()).then(re=>{const ye=`${h}/api/mutations/save_toml`;console.log("Replacing configuration with polygons:",re),fetch(`${ye}`,{method:"GET"}).then(Ae=>Ae.json()).then(Ae=>{console.log("Configuration has been updated. Reply from server:",Ae)}).catch(Ae=>{console.log("Error on updating configuration:",Ae)})}).catch(re=>{console.log("Error on replacing data",re)})},Q=K=>{const W=K.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);return W?[W[1],W[2],W[3]].map(Number):[]},se=function(K,W,re){let ye=re.points[this.pointIndex].x-re.pathOffset.x,Ae=re.points[this.pointIndex].y-re.pathOffset.y;const be=new dn.fabric.Point(ye,Ae);return dn.fabric.util.transformPoint(be,dn.fabric.util.multiplyTransformMatrices(re.canvas.viewportTransform,re.calcTransformMatrix()))},ue=function(K,W){return function(re,ye,Ae,be){let Be=ye.target;const Ze=new dn.fabric.Point(Be.points[K].x-Be.pathOffset.x,Be.points[K].y-Be.pathOffset.y);let nt=dn.fabric.util.transformPoint(Ze,Be.calcTransformMatrix()),Re=W(re,ye,Ae,be);Be._setPositionDimensions({});let we=wu(Be),Le=(Be.points[K].x-Be.pathOffset.x)/we.x,Ke=(Be.points[K].y-Be.pathOffset.y)/we.y;return Be.setPositionByOrigin(nt,Le+.5,Ke+.5),Re}},de=function(K,W,re,ye){let Ae=W.target,be=Ae.controls[Ae.__corner],Be=Ae.toLocalPoint(new dn.fabric.Point(re,ye),"center","center"),Ze=wu(Ae),nt=Ae._getTransformedDimensions(0,0),Re={x:Be.x*Ze.x/nt.x+Ae.pathOffset.x,y:Be.y*Ze.y/nt.y+Ae.pathOffset.y};return Ae.points[be.pointIndex]=Re,!0};function je(K){Pu[K?"unshift":"push"](()=>{Y=K,pt(0,Y)})}return[Y,tt,g,v,qe,it,Rt,Pt,je]}class np extends Ma{constructor(I){super(),ka(this,I,tp,Qf,Da,{},null,[-1,-1])}}export{np as default};
